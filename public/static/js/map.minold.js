/*!   2021-05-14 18.06.59 Copyright © 2018 Chaunve Inc&& Wu. All rights reserved. You may not duplicate, copy, or reuse any portion. */
function creatPathVertices(a){a.yScale=.3,a.radius=30;for(var b,c=[],e=2*Math.PI/a.segments,f=0;f<a.segments;f++){var g=new THREE.Vector3(0,a.radius*a.yScale*Math.sin(e*f),a.radius*Math.cos(e*f));c.push(g),0==f&&(b=g)}c.push(b);var i,j,k,l,m=a.pathVertices.length,n=d(a.pathVertices);a.length=n.length,a.center=n.center,a.perimeter=2*Math.PI*a.radius;var o,p=0,q=0;uvY_delta=a.perimeter/a.segments,a._uvs=[],h=new THREE.Vector3(0,0,1),a._up_=null,a._rings={},a.vertices=[];for(var f=0;f<m;f++){i=0==f?null:a.pathVertices[f-1],k=f==m-1?null:a.pathVertices[f+1],j=a.pathVertices[f],l=f23(i,j,k),a._up_||(a._up_=new THREE.Vector3(0,0,1).applyMatrix4(l).normalize()),f>0&&(p+=j.distanceTo(i)),q=0,a._rings[f]=[];j.clone().z=0,console.log("n>",l,p,c);for(var r=0,s=0;s<c.length;s++)o=c[s].clone().applyMatrix4(l),a.vertices.push(o),a._rings[f].push(o),a._uvs.push(new THREE.Vector2((p+r)/a.length,1-q/a.perimeter)),q+=uvY_delta}return a}function d(a){for(var b=0,c=a[0].clone(),d=1;d<a.length;d++)b+=a[d].distanceTo(a[d-1]),c.add(a[d]);return{length:b,center:c.divideScalar(a.length)}}function f23(a,b,c){var d,e=a&&a.clone(),f=b.clone(),g=c&&c.clone(),i=1,j=null;if(a)if(c){var k=f.clone().sub(e).normalize(),l=g.sub(f).normalize();j=k.angleTo(l)/2,i=1/Math.cos(j),i=GIM.Math.clamp(i,1,2),d=k.add(l).normalize()}else d=f.sub(e).normalize();else d=g.sub(f).normalize();var m=h.clone(),n=(new THREE.Vector3).crossVectors(d,m).normalize(),o=(new THREE.Vector3).crossVectors(n,d).normalize();h=o.clone(),n.multiplyScalar(i);var p=(new THREE.Matrix4).makeBasis(d,o,n).setPosition(b);return p.angle=j,p.vz=n,p}function e(a,b){a.forEach(function(a){a.sub(b)})}function ignorePoints(a){var b=[];b.push(a[0]);for(var c=1;c<a.length-1;c+=1){var d=a[c-1],e=a[c],f=a[c+1],g=GIM.Calc3PAngel(d,e,f);Math.abs(g.corners)>3&&b.push(e)}return b.push(a[a.length-1]),b}function segmentsIntr(a,b,c,d){var e=(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x),f=(a.x-d.x)*(b.y-d.y)-(a.y-d.y)*(b.x-d.x);if(e*f>=0)return!1;var g=(c.x-a.x)*(d.y-a.y)-(c.y-a.y)*(d.x-a.x);if(g*(g+e-f)>=0)return!1;var h=g/(f-e),i=h*(b.x-a.x),j=h*(b.y-a.y);return{x:a.x+i,y:a.y+j}}function polygonCrossPoint(a,b,c){for(var d=0;d<a.length;d++){var e=a[d],f=a[d+1>=a.length?0:d+1],g=segmentsIntr(b,c,e,f);if(g)return g}}function InstancedTexture(a,b){function c(c){b(c),InstancedTexture.TextureList.set(a,c);var d=InstancedTexture.queueCallback.get(a);if(d)for(;d.length;){var e=d.shift();e(c)}}if(InstancedTexture.queueMap.has(a)){var d=InstancedTexture.TextureList.get(a);if(d)b(d);else{var e=InstancedTexture.queueCallback.get(a);e?e.push(b):(e=[],InstancedTexture.queueCallback.set(a,e),e.push(b))}}else{var f=new THREE.TextureLoader;f.crossOrigin="Anonymous",f.load(a,c),InstancedTexture.queueMap.set(a,!0)}}function TransMeshCenter(a,b,c){if(c<=0)return void console.log("数据范围错误, rangleScale 范围为 (0, 1] ");var d=new THREE.BoxHelper(a);a.geometry.computeBoundingBox();var e=a.geometry.boundingBox,f=e.min,g=e.max;scene.add(d);var h=new THREE.Vector3;e.getCenter(h),b.target=h,camera.position.set(h.x,h.y+20,h.z+40),b.update(),null==camera.parent&&camera.updateMatrixWorld();var i,j=f.clone().project(camera),k=g.clone().project(camera),l=Math.max(Math.abs(j.x),Math.abs(k.x)),m=Math.max(Math.abs(j.y),Math.abs(k.y)),n=camera.position.distanceTo(h);i=l>m?l/c*n:m/c*n;var o=new THREE.Vector3;o.subVectors(camera.position,h),o.normalize();var p=h.clone().addScaledVector(o,i);camera.position.set(p.x,p.y,p.z),null==camera.parent&&camera.updateMatrixWorld();var j=f.clone().project(camera),k=g.clone().project(camera);b.update()}function rayCasting(a,b){for(var c=a.x,d=a.y,e=!1,f=0,g=b.length,h=g-1;f<g;h=f,f++){var i=b[f].x,j=b[f].y,k=b[h].x,l=b[h].y;if(i===c&&j===d||k===c&&l===d)return!0;if(j<d&&l>=d||j>=d&&l<d){var m=i+(d-j)*(k-i)/(l-j);if(m===c)return!0;m>c&&(e=!e)}}return e}function randomRange(a,b){return Math.random()*(b-a)+a}!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.THREE={}))}(this,function(a){"use strict";function b(){}function c(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b}function d(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function e(a,b,f,g,h,i,j,k,l,m){Object.defineProperty(this,"id",{value:Ik++}),this.uuid=Fk.generateUUID(),this.name="",this.image=void 0!==a?a:e.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==b?b:e.DEFAULT_MAPPING,this.wrapS=void 0!==f?f:ii,this.wrapT=void 0!==g?g:ii,this.magFilter=void 0!==h?h:pi,this.minFilter=void 0!==i?i:si,this.anisotropy=void 0!==l?l:1,this.format=void 0!==j?j:Ii,this.internalFormat=null,this.type=void 0!==k?k:ui,this.offset=new c(0,0),this.repeat=new c(1,1),this.center=new c(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new d,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==m?m:Uj,this.version=0,this.onUpdate=null}function f(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this.x=a,this.y=b,this.z=c,this.w=d}function g(a,b,c){this.width=a,this.height=b,this.scissor=new f(0,0,a,b),this.scissorTest=!1,this.viewport=new f(0,0,a,b),c=c||{},this.texture=new e(void 0,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.texture.image={},this.texture.image.width=a,this.texture.image.height=b,this.texture.generateMipmaps=void 0!==c.generateMipmaps&&c.generateMipmaps,this.texture.minFilter=void 0!==c.minFilter?c.minFilter:pi,this.depthBuffer=void 0===c.depthBuffer||c.depthBuffer,this.stencilBuffer=void 0===c.stencilBuffer||c.stencilBuffer,this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function h(a,b,c){g.call(this,a,b,c),this.samples=4}function i(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this._x=a,this._y=b,this._z=c,this._w=d}function j(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.x=a,this.y=b,this.z=c}function k(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function l(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=l.DefaultOrder),this._x=a,this._y=b,this._z=c,this._order=d}function m(){this.mask=1}function n(){function a(){f.setFromEuler(e,!1)}function b(){e.setFromQuaternion(f,void 0,!1)}Object.defineProperty(this,"id",{value:Uk++}),this.uuid=Fk.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DefaultUp.clone();var c=new j,e=new l,f=new i,g=new j(1,1,1);e._onChange(a),f._onChange(b),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:c},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:f},scale:{configurable:!0,enumerable:!0,value:g},modelViewMatrix:{value:new k},normalMatrix:{value:new d}}),this.matrix=new k,this.matrixWorld=new k,this.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new m,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function o(){n.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function p(a,b){this.min=void 0!==a?a:new j(1/0,1/0,1/0),this.max=void 0!==b?b:new j(-1/0,-1/0,-1/0)}function q(a,b,c,d,e){for(var f=0,g=a.length-3;f<=g;f+=3){rl.fromArray(a,f);var h=e.x*Math.abs(rl.x)+e.y*Math.abs(rl.y)+e.z*Math.abs(rl.z),i=b.dot(rl),j=c.dot(rl),k=d.dot(rl);if(Math.max(-Math.max(i,j,k),Math.min(i,j,k))>h)return!1}return!0}function r(a,b){this.center=void 0!==a?a:new j,this.radius=void 0!==b?b:-1}function s(a,b){this.origin=void 0!==a?a:new j,this.direction=void 0!==b?b:new j(0,0,-1)}function t(a,b){this.normal=void 0!==a?a:new j(1,0,0),this.constant=void 0!==b?b:0}function u(a,b,c){this.a=void 0!==a?a:new j,this.b=void 0!==b?b:new j,this.c=void 0!==c?c:new j}function v(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function w(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+6*(b-a)*(2/3-c):a}function x(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function y(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}function z(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.normal=d&&d.isVector3?d:new j,this.vertexNormals=Array.isArray(d)?d:[],this.color=e&&e.isColor?e:new v,this.vertexColors=Array.isArray(e)?e:[],this.materialIndex=void 0!==f?f:0}function A(){Object.defineProperty(this,"id",{value:Ql++}),this.uuid=Fk.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=qh,this.side=kh,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Eh,this.blendDst=Fh,this.blendEquation=vh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Oh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=tk,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=fk,this.stencilZFail=fk,this.stencilZPass=fk,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function B(a){A.call(this),this.type="MeshBasicMaterial",this.color=new v(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Th,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(a)}function C(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=a,this.itemSize=b,this.count=void 0!==a?a.length/b:0,this.normalized=!0===c,this.usage=uk,this.updateRange={offset:0,count:-1},this.version=0}function D(a,b,c){C.call(this,new Int8Array(a),b,c)}function E(a,b,c){C.call(this,new Uint8Array(a),b,c)}function F(a,b,c){C.call(this,new Uint8ClampedArray(a),b,c)}function G(a,b,c){C.call(this,new Int16Array(a),b,c)}function H(a,b,c){C.call(this,new Uint16Array(a),b,c)}function I(a,b,c){C.call(this,new Int32Array(a),b,c)}function J(a,b,c){C.call(this,new Uint32Array(a),b,c)}function K(a,b,c){C.call(this,new Float32Array(a),b,c)}function L(a,b,c){C.call(this,new Float64Array(a),b,c)}function M(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function N(a){if(0===a.length)return-1/0;for(var b=a[0],c=1,d=a.length;c<d;++c)a[c]>b&&(b=a[c]);return b}function O(){Object.defineProperty(this,"id",{value:Tl+=2}),this.uuid=Fk.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function P(a,b){n.call(this),this.type="Mesh",this.geometry=void 0!==a?a:new O,this.material=void 0!==b?b:new B,this.updateMorphTargets()}function Q(a,b,c,d,e,f,g,h){if(null===(b.side===lh?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,b.side!==mh,h)))return null;om.copy(h),om.applyMatrix4(a.matrixWorld);var i=c.ray.origin.distanceTo(om);return i<c.near||i>c.far?null:{distance:i,point:om.clone(),object:a}}function R(a,b,d,e,f,g,h,i,j,k,l,m){bm.fromBufferAttribute(f,k),cm.fromBufferAttribute(f,l),dm.fromBufferAttribute(f,m);var n=a.morphTargetInfluences;if(b.morphTargets&&g&&n){hm.set(0,0,0),im.set(0,0,0),jm.set(0,0,0);for(var o=0,p=g.length;o<p;o++){var q=n[o],r=g[o];0!==q&&(em.fromBufferAttribute(r,k),fm.fromBufferAttribute(r,l),gm.fromBufferAttribute(r,m),h?(hm.addScaledVector(em,q),im.addScaledVector(fm,q),jm.addScaledVector(gm,q)):(hm.addScaledVector(em.sub(bm),q),im.addScaledVector(fm.sub(cm),q),jm.addScaledVector(gm.sub(dm),q)))}bm.add(hm),cm.add(im),dm.add(jm)}a.isSkinnedMesh&&(a.boneTransform(k,bm),a.boneTransform(l,cm),a.boneTransform(m,dm));var s=Q(a,b,d,e,bm,cm,dm,nm);if(s){i&&(km.fromBufferAttribute(i,k),lm.fromBufferAttribute(i,l),mm.fromBufferAttribute(i,m),s.uv=u.getUV(nm,bm,cm,dm,km,lm,mm,new c)),j&&(km.fromBufferAttribute(j,k),lm.fromBufferAttribute(j,l),mm.fromBufferAttribute(j,m),s.uv2=u.getUV(nm,bm,cm,dm,km,lm,mm,new c));var t=new z(k,l,m);u.getNormal(bm,cm,dm,t.normal),s.face=t}return s}function S(){Object.defineProperty(this,"id",{value:pm+=2}),this.uuid=Fk.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function T(a){var b={};for(var c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}function U(a){for(var b={},c=0;c<a.length;c++){var d=T(a[c]);for(var e in d)b[e]=d[e]}return b}function V(a){A.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=wm,this.fragmentShader=xm,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function W(){n.call(this),this.type="Camera",this.matrixWorldInverse=new k,this.projectionMatrix=new k,this.projectionMatrixInverse=new k}function X(a,b,c,d){W.call(this),this.type="PerspectiveCamera",this.fov=void 0!==a?a:50,this.zoom=1,this.near=void 0!==c?c:.1,this.far=void 0!==d?d:2e3,this.focus=10,this.aspect=void 0!==b?b:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Y(a,b,c){if(n.call(this),this.type="CubeCamera",!0!==c.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=c;var d=new X(ym,zm,a,b);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new j(1,0,0)),this.add(d);var e=new X(ym,zm,a,b);e.layers=this.layers,e.up.set(0,-1,0),e.lookAt(new j(-1,0,0)),this.add(e);var f=new X(ym,zm,a,b);f.layers=this.layers,f.up.set(0,0,1),f.lookAt(new j(0,1,0)),this.add(f);var g=new X(ym,zm,a,b);g.layers=this.layers,g.up.set(0,0,-1),g.lookAt(new j(0,-1,0)),this.add(g);var h=new X(ym,zm,a,b);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new j(0,0,1)),this.add(h);var i=new X(ym,zm,a,b);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new j(0,0,-1)),this.add(i),this.update=function(a,b){null===this.parent&&this.updateMatrixWorld();var j=a.xr.enabled,k=a.getRenderTarget();a.xr.enabled=!1;var l=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,a.setRenderTarget(c,0),a.render(b,d),a.setRenderTarget(c,1),a.render(b,e),a.setRenderTarget(c,2),a.render(b,f),a.setRenderTarget(c,3),a.render(b,g),a.setRenderTarget(c,4),a.render(b,h),c.texture.generateMipmaps=l,a.setRenderTarget(c,5),a.render(b,i),a.setRenderTarget(k),a.xr.enabled=j},this.clear=function(a,b,d,e){for(var f=a.getRenderTarget(),g=0;g<6;g++)a.setRenderTarget(c,g),a.clear(b,d,e);a.setRenderTarget(f)}}function Z(a,b,c){Number.isInteger(b)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),b=c),g.call(this,a,a,b)}function $(a,b,c,d,f,g,h,i,j,k,l,m){e.call(this,null,g,h,i,j,k,d,f,l,m),this.image={data:a||null,width:b||1,height:c||1},this.magFilter=void 0!==j?j:ki,this.minFilter=void 0!==k?k:ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}function _(a,b,c,d,e,f){this.planes=[void 0!==a?a:new t,void 0!==b?b:new t,void 0!==c?c:new t,void 0!==d?d:new t,void 0!==e?e:new t,void 0!==f?f:new t]}function aa(){function a(c,f){d(c,f),e=b.requestAnimationFrame(a)}var b=null,c=!1,d=null,e=null;return{start:function(){!0!==c&&null!==d&&(e=b.requestAnimationFrame(a),c=!0)},stop:function(){b.cancelAnimationFrame(e),c=!1},setAnimationLoop:function(a){d=a},setContext:function(a){b=a}}}function ba(a,b){function c(b,c){var d=b.array,e=b.usage,f=a.createBuffer();a.bindBuffer(c,f),a.bufferData(c,d,e),b.onUploadCallback();var g=5126;return d instanceof Float32Array?g=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?g=5123:d instanceof Int16Array?g=5122:d instanceof Uint32Array?g=5125:d instanceof Int32Array?g=5124:d instanceof Int8Array?g=5120:d instanceof Uint8Array&&(g=5121),{buffer:f,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:b.version}}function d(b,c,d){var e=c.array,f=c.updateRange;a.bindBuffer(d,b),-1===f.count?a.bufferSubData(d,0,e):(h?a.bufferSubData(d,f.offset*e.BYTES_PER_ELEMENT,e,f.offset,f.count):a.bufferSubData(d,f.offset*e.BYTES_PER_ELEMENT,e.subarray(f.offset,f.offset+f.count)),f.count=-1)}function e(a){return a.isInterleavedBufferAttribute&&(a=a.data),i.get(a)}function f(b){b.isInterleavedBufferAttribute&&(b=b.data);var c=i.get(b);c&&(a.deleteBuffer(c.buffer),i.delete(b))}function g(a,b){a.isInterleavedBufferAttribute&&(a=a.data);var e=i.get(a);void 0===e?i.set(a,c(a,b)):e.version<a.version&&(d(e.buffer,a,b),e.version=a.version)}var h=b.isWebGL2,i=new WeakMap;return{get:e,remove:f,update:g}}function ca(a,b,c,d){S.call(this),this.type="PlaneGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:d},this.fromBufferGeometry(new da(a,b,c,d)),this.mergeVertices()}function da(a,b,c,d){O.call(this),this.type="PlaneBufferGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:d},a=a||1,b=b||1;for(var e=a/2,f=b/2,g=Math.floor(c)||1,h=Math.floor(d)||1,i=g+1,j=h+1,k=a/g,l=b/h,m=[],n=[],o=[],p=[],q=0;q<j;q++)for(var r=q*l-f,s=0;s<i;s++){var t=s*k-e;n.push(t,-r,0),o.push(0,0,1),p.push(s/g),p.push(1-q/h)}for(var u=0;u<h;u++)for(var v=0;v<g;v++){var w=v+i*u,x=v+i*(u+1),y=v+1+i*(u+1),z=v+1+i*u;m.push(w,x,z),m.push(x,y,z)}this.setIndex(m),this.setAttribute("position",new K(n,3)),this.setAttribute("normal",new K(o,3)),this.setAttribute("uv",new K(p,2))}function ea(a,b,c,d){function e(b,d,e,n){var o=!0===d.isScene?d.background:null,p=a.xr,q=p.getSession&&p.getSession();if(q&&"additive"===q.environmentBlendMode&&(o=null),null===o?f(i,j):o&&o.isColor&&(f(o,1),n=!0),(a.autoClear||n)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),o&&(o.isCubeTexture||o.isWebGLCubeRenderTarget||o.mapping===fi)){void 0===h&&(h=new P(new um(1,1,1),new V({name:"BackgroundCubeMaterial",uniforms:T(Zo.cube.uniforms),vertexShader:Zo.cube.vertexShader,fragmentShader:Zo.cube.fragmentShader,side:lh,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(h));var r=o.isWebGLCubeRenderTarget?o.texture:o;h.material.uniforms.envMap.value=r,h.material.uniforms.flipEnvMap.value=r.isCubeTexture?-1:1,k===o&&l===r.version&&m===a.toneMapping||(h.material.needsUpdate=!0,k=o,l=r.version,m=a.toneMapping),b.unshift(h,h.geometry,h.material,0,0,null)}else o&&o.isTexture&&(void 0===g&&(g=new P(new da(2,2),new V({name:"BackgroundMaterial",uniforms:T(Zo.background.uniforms),vertexShader:Zo.background.vertexShader,fragmentShader:Zo.background.fragmentShader,side:kh,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(g)),g.material.uniforms.t2D.value=o,!0===o.matrixAutoUpdate&&o.updateMatrix(),g.material.uniforms.uvTransform.value.copy(o.matrix),k===o&&l===o.version&&m===a.toneMapping||(g.material.needsUpdate=!0,k=o,l=o.version,m=a.toneMapping),b.unshift(g,g.geometry,g.material,0,0,null))}function f(a,c){b.buffers.color.setClear(a.r,a.g,a.b,c,d)}var g,h,i=new v(0),j=0,k=null,l=0,m=null;return{getClearColor:function(){return i},setClearColor:function(a,b){i.set(a),j=void 0!==b?b:1,f(i,j)},getClearAlpha:function(){return j},setClearAlpha:function(a){j=a,f(i,j)},render:e}}function fa(a,b,c,d){function e(b,d,e,f,h){var j=!1;if(z){var m=i(f,e,d);C!==m&&(C=m,g(C.object)),j=k(f),j&&l(f)}else{var n=!0===d.wireframe;C.geometry===f.id&&C.program===e.id&&C.wireframe===n||(C.geometry=f.id,C.program=e.id,C.wireframe=n,j=!0)}!0===b.isInstancedMesh&&(j=!0),null!==h&&c.update(h,34963),j&&(r(b,d,e,f),null!==h&&a.bindBuffer(34963,c.get(h).buffer))}function f(){return d.isWebGL2?a.createVertexArray():y.createVertexArrayOES()}function g(b){return d.isWebGL2?a.bindVertexArray(b):y.bindVertexArrayOES(b)}function h(b){return d.isWebGL2?a.deleteVertexArray(b):y.deleteVertexArrayOES(b)}function i(a,b,c){var d=!0===c.wireframe,e=A[a.id];void 0===e&&(e={},A[a.id]=e);var g=e[b.id];void 0===g&&(g={},e[b.id]=g);var h=g[d];return void 0===h&&(h=j(f()),g[d]=h),h}function j(a){for(var b=[],c=[],d=[],e=0;e<x;e++)b[e]=0,c[e]=0,d[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:b,enabledAttributes:c,attributeDivisors:d,object:a,attributes:{}}}function k(a){var b=C.attributes,c=a.attributes;if(Object.keys(b).length!==Object.keys(c).length)return!0;for(var d in c){var e=b[d],f=c[d];if(e.attribute!==f)return!0;if(e.data!==f.data)return!0}return!1}function l(a){var b={},c=a.attributes;for(var d in c){var e=c[d],f={};f.attribute=e,e.data&&(f.data=e.data),b[d]=f}C.attributes=b}function m(){for(var a=C.newAttributes,b=0,c=a.length;b<c;b++)a[b]=0}function n(a){o(a,0)}function o(c,e){var f=C.newAttributes,g=C.enabledAttributes,h=C.attributeDivisors;if(f[c]=1,0===g[c]&&(a.enableVertexAttribArray(c),g[c]=1),h[c]!==e){(d.isWebGL2?a:b.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](c,e),h[c]=e}}function p(){for(var b=C.newAttributes,c=C.enabledAttributes,d=0,e=c.length;d<e;d++)c[d]!==b[d]&&(a.disableVertexAttribArray(d),c[d]=0)}function q(b,c,e,f,g,h){!0!==d.isWebGL2||5124!==e&&5125!==e?a.vertexAttribPointer(b,c,e,f,g,h):a.vertexAttribIPointer(b,c,e,f,g,h)}function r(e,f,g,h){if(!1!==d.isWebGL2||!e.isInstancedMesh&&!h.isInstancedBufferGeometry||null!==b.get("ANGLE_instanced_arrays")){m();var i=h.attributes,j=g.getAttributes(),k=f.defaultAttributeValues;for(var l in j){var r=j[l];if(r>=0){var s=i[l];if(void 0!==s){var t=s.normalized,u=s.itemSize,v=c.get(s);if(void 0===v)continue;var w=v.buffer,x=v.type,y=v.bytesPerElement;if(s.isInterleavedBufferAttribute){var z=s.data,A=z.stride,B=s.offset;z&&z.isInstancedInterleavedBuffer?(o(r,z.meshPerAttribute),void 0===h._maxInstanceCount&&(h._maxInstanceCount=z.meshPerAttribute*z.count)):n(r),a.bindBuffer(34962,w),q(r,u,x,t,A*y,B*y)}else s.isInstancedBufferAttribute?(o(r,s.meshPerAttribute),void 0===h._maxInstanceCount&&(h._maxInstanceCount=s.meshPerAttribute*s.count)):n(r),a.bindBuffer(34962,w),q(r,u,x,t,0,0)}else if("instanceMatrix"===l){var C=c.get(e.instanceMatrix);if(void 0===C)continue;var D=C.buffer,E=C.type;o(r+0,1),o(r+1,1),o(r+2,1),o(r+3,1),a.bindBuffer(34962,D),a.vertexAttribPointer(r+0,4,E,!1,64,0),a.vertexAttribPointer(r+1,4,E,!1,64,16),a.vertexAttribPointer(r+2,4,E,!1,64,32),a.vertexAttribPointer(r+3,4,E,!1,64,48)}else if(void 0!==k){var F=k[l];if(void 0!==F)switch(F.length){case 2:a.vertexAttrib2fv(r,F);break;case 3:a.vertexAttrib3fv(r,F);break;case 4:a.vertexAttrib4fv(r,F);break;default:a.vertexAttrib1fv(r,F)}}}}p()}}function s(){v();for(var a in A){var b=A[a];for(var c in b){var d=b[c];for(var e in d)h(d[e].object),delete d[e];delete b[c]}delete A[a]}}function t(a){if(void 0!==A[a.id]){var b=A[a.id];for(var c in b){var d=b[c];for(var e in d)h(d[e].object),delete d[e];delete b[c]}delete A[a.id]}}function u(a){for(var b in A){var c=A[b];if(void 0!==c[a.id]){var d=c[a.id];for(var e in d)h(d[e].object),delete d[e];delete c[a.id]}}}function v(){w(),C!==B&&(C=B,g(C.object))}function w(){B.geometry=null,B.program=null,B.wireframe=!1}var x=a.getParameter(34921),y=d.isWebGL2?null:b.get("OES_vertex_array_object"),z=d.isWebGL2||null!==y,A={},B=j(null),C=B;return{setup:e,reset:v,resetDefaultState:w,dispose:s,releaseStatesOfGeometry:t,releaseStatesOfProgram:u,initAttributes:m,enableAttribute:n,disableUnusedAttributes:p}}function ga(a,b,c,d){function e(a){h=a}function f(b,d){a.drawArrays(h,b,d),c.update(d,h)}function g(d,e,f,g){if(0!==g){var j,k;if(i)j=a,k="drawArraysInstanced";else if(j=b.get("ANGLE_instanced_arrays"),k="drawArraysInstancedANGLE",null===j)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");j[k](h,e,f,g),c.update(f,h,g)}}var h,i=d.isWebGL2;this.setMode=e,this.render=f,this.renderInstances=g}function ha(a,b,c){function d(){if(void 0!==f)return f;var c=b.get("EXT_texture_filter_anisotropic");return f=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function e(b){if("highp"===b){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return"mediump"===b&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var f,g="undefined"!=typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&a instanceof WebGL2ComputeRenderingContext,h=void 0!==c.precision?c.precision:"highp",i=e(h);i!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",i,"instead."),h=i);var j=!0===c.logarithmicDepthBuffer,k=a.getParameter(34930),l=a.getParameter(35660),m=a.getParameter(3379),n=a.getParameter(34076),o=a.getParameter(34921),p=a.getParameter(36347),q=a.getParameter(36348),r=a.getParameter(36349),s=l>0,t=g||!!b.get("OES_texture_float");return{isWebGL2:g,getMaxAnisotropy:d,getMaxPrecision:e,precision:h,logarithmicDepthBuffer:j,maxTextures:k,maxVertexTextures:l,maxTextureSize:m,maxCubemapSize:n,maxAttributes:o,maxVertexUniforms:p,maxVaryings:q,maxFragmentUniforms:r,vertexTextures:s,floatFragmentTextures:t,floatVertexTextures:s&&t,maxSamples:g?a.getParameter(36183):0}}function ia(){function a(){k.value!==e&&(k.value=e,k.needsUpdate=f>0),c.numPlanes=f,c.numIntersection=0}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){if(g=k.value,!0!==e||null===g){var h=d+4*f,l=b.matrixWorldInverse;j.getNormalMatrix(l),(null===g||g.length<h)&&(g=new Float32Array(h));for(var m=0,n=d;m!==f;++m,n+=4)i.copy(a[m]).applyMatrix4(l,j),i.normal.toArray(g,n),g[n+3]=i.constant}k.value=g,k.needsUpdate=!0}return c.numPlanes=f,c.numIntersection=0,g}var c=this,e=null,f=0,g=!1,h=!1,i=new t,j=new d,k={value:null,needsUpdate:!1};this.uniform=k,this.numPlanes=0,this.numIntersection=0,this.init=function(a,c,d){var h=0!==a.length||c||0!==f||g;return g=c,e=b(a,d,0),f=a.length,h},this.beginShadows=function(){h=!0,b(null)},this.endShadows=function(){h=!1,a()},this.setState=function(c,d,i,j,l,m){if(!g||null===c||0===c.length||h&&!i)h?b(null):a();else{var n=h?0:f,o=4*n,p=l.clippingState||null;k.value=p,p=b(c,j,o,m);for(var q=0;q!==o;++q)p[q]=e[q];l.clippingState=p,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=n}}}function ja(a){var b={};return{get:function(c){if(void 0!==b[c])return b[c];var d;switch(c){case"WEBGL_depth_texture":d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=a.getExtension(c)}return null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported."),b[c]=d,d}}}function ka(a,b,c,d){function e(a){var f=a.target,g=j.get(f);null!==g.index&&b.remove(g.index);for(var h in g.attributes)b.remove(g.attributes[h]);f.removeEventListener("dispose",e),j.delete(f);var i=k.get(g);i&&(b.remove(i),k.delete(g)),d.releaseStatesOfGeometry(f),!0===f.isInstancedBufferGeometry&&delete f._maxInstanceCount,c.memory.geometries--}function f(a,b){var d=j.get(b);return d||(b.addEventListener("dispose",e),b.isBufferGeometry?d=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new O).setFromObject(a)),d=b._bufferGeometry),j.set(b,d),c.memory.geometries++,d)}function g(a){var c=a.attributes;for(var d in c)b.update(c[d],34962);var e=a.morphAttributes;for(var f in e)for(var g=e[f],h=0,i=g.length;h<i;h++)b.update(g[h],34962)}function h(a){var c=[],d=a.index,e=a.attributes.position,f=0;if(null!==d){var g=d.array;f=d.version;for(var h=0,i=g.length;h<i;h+=3){var j=g[h+0],l=g[h+1],m=g[h+2];c.push(j,l,l,m,m,j)}}else{var n=e.array;f=e.version;for(var o=0,p=n.length/3-1;o<p;o+=3){var q=o+0,r=o+1,s=o+2;c.push(q,r,r,s,s,q)}}var t=new(N(c)>65535?J:H)(c,1);t.version=f;var u=k.get(a);u&&b.remove(u),k.set(a,t)}function i(a){var b=k.get(a);if(b){var c=a.index;null!==c&&b.version<c.version&&h(a)}else h(a);return k.get(a)}var j=new WeakMap,k=new WeakMap;return{get:f,update:g,getWireframeAttribute:i}}function la(a,b,c,d){function e(a){i=a}function f(a){j=a.type,k=a.bytesPerElement}function g(b,d){a.drawElements(i,d,j,b*k),c.update(d,i)}function h(d,e,f,g){if(0!==g){var h,m;if(l)h=a,m="drawElementsInstanced";else if(h=b.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[m](i,f,j,e*k,g),c.update(f,i,g)}}var i,j,k,l=d.isWebGL2;this.setMode=e,this.setIndex=f,this.render=g,this.renderInstances=h}function ma(a){function b(a,b,c){switch(c=c||1,e.calls++,b){case 4:e.triangles+=c*(a/3);break;case 1:e.lines+=c*(a/2);break;case 3:e.lines+=c*(a-1);break;case 2:e.lines+=c*a;break;case 0:e.points+=c*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",b)}}function c(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}var d={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:d,render:e,programs:null,autoReset:!0,reset:c,update:b}}function na(a,b){return a[0]-b[0]}function oa(a,b){return Math.abs(b[1])-Math.abs(a[1])}function pa(a){function b(b,f,g,h){var i=b.morphTargetInfluences,j=void 0===i?0:i.length,k=c[f.id];if(void 0===k){k=[];for(var l=0;l<j;l++)k[l]=[l,0];c[f.id]=k}for(var m=0;m<j;m++){var n=k[m];n[0]=m,n[1]=i[m]}k.sort(oa);for(var o=0;o<8;o++)o<j&&k[o][1]?(e[o][0]=k[o][0],e[o][1]=k[o][1]):(e[o][0]=Number.MAX_SAFE_INTEGER,e[o][1]=0);e.sort(na);for(var p=g.morphTargets&&f.morphAttributes.position,q=g.morphNormals&&f.morphAttributes.normal,r=0,s=0;s<8;s++){var t=e[s],u=t[0],v=t[1];u!==Number.MAX_SAFE_INTEGER&&v?(p&&f.getAttribute("morphTarget"+s)!==p[u]&&f.setAttribute("morphTarget"+s,p[u]),q&&f.getAttribute("morphNormal"+s)!==q[u]&&f.setAttribute("morphNormal"+s,q[u]),d[s]=v,r+=v):(p&&void 0!==f.getAttribute("morphTarget"+s)&&f.deleteAttribute("morphTarget"+s),q&&void 0!==f.getAttribute("morphNormal"+s)&&f.deleteAttribute("morphNormal"+s),d[s]=0)}var w=f.morphTargetsRelative?1:1-r;h.getUniforms().setValue(a,"morphTargetBaseInfluence",w),h.getUniforms().setValue(a,"morphTargetInfluences",d)}for(var c={},d=new Float32Array(8),e=[],f=0;f<8;f++)e[f]=[f,0];return{update:b}}function qa(a,b,c,d){function e(a){var e=d.render.frame,f=a.geometry,h=b.get(a,f);return g.get(h)!==e&&(f.isGeometry&&h.updateFromObject(a),b.update(h),g.set(h,e)),a.isInstancedMesh&&c.update(a.instanceMatrix,34962),h}function f(){g=new WeakMap}var g=new WeakMap;return{update:e,dispose:f}}function ra(a,b,c,d,f,g,h,i,j,k){a=void 0!==a?a:[],b=void 0!==b?b:bi,h=void 0!==h?h:Hi,e.call(this,a,b,c,d,f,g,h,i,j,k),this.flipY=!1}function sa(a,b,c,d){e.call(this,null),this.image={data:a||null,width:b||1,height:c||1,depth:d||1},this.magFilter=ki,this.minFilter=ki,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ta(a,b,c,d){e.call(this,null),this.image={data:a||null,width:b||1,height:c||1,depth:d||1},this.magFilter=ki,this.minFilter=ki,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ua(a,b,c){var d=a[0];if(d<=0||d>0)return a;var e=b*c,f=cp[e];if(void 0===f&&(f=new Float32Array(e),cp[e]=f),0!==b){d.toArray(f,0);for(var g=1,h=0;g!==b;++g)h+=c,a[g].toArray(f,h)}return f}function va(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function wa(a,b){for(var c=0,d=b.length;c<d;c++)a[c]=b[c]}function xa(a,b){var c=dp[b];void 0===c&&(c=new Int32Array(b),dp[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocateTextureUnit();return c}function ya(a,b){var c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function za(a,b){var c=this.cache;if(void 0!==b.x)c[0]===b.x&&c[1]===b.y||(a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(va(c,b))return;a.uniform2fv(this.addr,b),wa(c,b)}}function Aa(a,b){var c=this.cache;if(void 0!==b.x)c[0]===b.x&&c[1]===b.y&&c[2]===b.z||(a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else if(void 0!==b.r)c[0]===b.r&&c[1]===b.g&&c[2]===b.b||(a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b);else{if(va(c,b))return;a.uniform3fv(this.addr,b),wa(c,b)}}function Ba(a,b){var c=this.cache;if(void 0!==b.x)c[0]===b.x&&c[1]===b.y&&c[2]===b.z&&c[3]===b.w||(a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(va(c,b))return;a.uniform4fv(this.addr,b),wa(c,b)}}function Ca(a,b){var c=this.cache,d=b.elements;if(void 0===d){if(va(c,b))return;a.uniformMatrix2fv(this.addr,!1,b),wa(c,b)}else{if(va(c,d))return;gp.set(d),a.uniformMatrix2fv(this.addr,!1,gp),wa(c,d)}}function Da(a,b){var c=this.cache,d=b.elements;if(void 0===d){if(va(c,b))return;a.uniformMatrix3fv(this.addr,!1,b),wa(c,b)}else{if(va(c,d))return;fp.set(d),a.uniformMatrix3fv(this.addr,!1,fp),wa(c,d)}}function Ea(a,b){var c=this.cache,d=b.elements;if(void 0===d){if(va(c,b))return;a.uniformMatrix4fv(this.addr,!1,b),wa(c,b)}else{if(va(c,d))return;ep.set(d),a.uniformMatrix4fv(this.addr,!1,ep),wa(c,d)}}function Fa(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.safeSetTexture2D(b||$o,e)}function Ga(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture2DArray(b||_o,e)}function Ha(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture3D(b||ap,e)}function Ia(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.safeSetTextureCube(b||bp,e)}function Ja(a,b){var c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function Ka(a,b){var c=this.cache;va(c,b)||(a.uniform2iv(this.addr,b),wa(c,b))}function La(a,b){var c=this.cache;va(c,b)||(a.uniform3iv(this.addr,b),wa(c,b))}function Ma(a,b){var c=this.cache;va(c,b)||(a.uniform4iv(this.addr,b),wa(c,b))}function Na(a,b){var c=this.cache;c[0]!==b&&(a.uniform1ui(this.addr,b),c[0]=b)}function Oa(a){switch(a){case 5126:return ya;case 35664:return za;case 35665:return Aa;case 35666:return Ba;case 35674:return Ca;case 35675:return Da;case 35676:return Ea;case 5124:case 35670:return Ja;case 35667:case 35671:return Ka;case 35668:case 35672:return La;case 35669:case 35673:return Ma;case 5125:return Na;case 35678:case 36198:case 36298:case 36306:case 35682:return Fa;case 35679:case 36299:case 36307:return Ha;case 35680:case 36300:case 36308:case 36293:return Ia;case 36289:case 36303:case 36311:case 36292:return Ga}}function Pa(a,b){a.uniform1fv(this.addr,b)}function Qa(a,b){a.uniform1iv(this.addr,b)}function Ra(a,b){a.uniform2iv(this.addr,b)}function Sa(a,b){a.uniform3iv(this.addr,b)}function Ta(a,b){a.uniform4iv(this.addr,b)}function Ua(a,b){var c=ua(b,this.size,2);a.uniform2fv(this.addr,c)}function Va(a,b){var c=ua(b,this.size,3);a.uniform3fv(this.addr,c)}function Wa(a,b){var c=ua(b,this.size,4);a.uniform4fv(this.addr,c)}function Xa(a,b){var c=ua(b,this.size,4);a.uniformMatrix2fv(this.addr,!1,c)}function Ya(a,b){var c=ua(b,this.size,9);a.uniformMatrix3fv(this.addr,!1,c)}function Za(a,b){var c=ua(b,this.size,16);a.uniformMatrix4fv(this.addr,!1,c)}function $a(a,b,c){var d=b.length,e=xa(c,d);a.uniform1iv(this.addr,e);for(var f=0;f!==d;++f)c.safeSetTexture2D(b[f]||$o,e[f])}function _a(a,b,c){var d=b.length,e=xa(c,d);a.uniform1iv(this.addr,e);for(var f=0;f!==d;++f)c.safeSetTextureCube(b[f]||bp,e[f])}function ab(a){switch(a){case 5126:return Pa;case 35664:return Ua;case 35665:return Va;case 35666:return Wa;case 35674:return Xa;case 35675:return Ya;case 35676:return Za;case 5124:case 35670:return Qa;case 35667:case 35671:return Ra;case 35668:case 35672:return Sa;case 35669:case 35673:return Ta;case 35678:case 36198:case 36298:case 36306:case 35682:return $a;case 35680:case 36300:case 36308:case 36293:return _a}}function bb(a,b,c){this.id=a,this.addr=c,this.cache=[],this.setValue=Oa(b.type)}function cb(a,b,c){this.id=a,this.addr=c,this.cache=[],this.size=b.size,this.setValue=ab(b.type)}function db(a){this.id=a,this.seq=[],this.map={}}function eb(a,b){a.seq.push(b),a.map[b.id]=b}function fb(a,b,c){var d=a.name,e=d.length;for(hp.lastIndex=0;;){var f=hp.exec(d),g=hp.lastIndex,h=f[1],i="]"===f[2],j=f[3];if(i&&(h|=0),void 0===j||"["===j&&g+2===e){eb(c,void 0===j?new bb(h,a,b):new cb(h,a,b));break}var k=c.map,l=k[h];void 0===l&&(l=new db(h),eb(c,l)),c=l}}function gb(a,b){this.seq=[],this.map={};for(var c=a.getProgramParameter(b,35718),d=0;d<c;++d){var e=a.getActiveUniform(b,d);fb(e,a.getUniformLocation(b,e.name),this)}}function hb(a,b,c){var d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),d}function ib(a){for(var b=a.split("\n"),c=0;c<b.length;c++)b[c]=c+1+": "+b[c];return b.join("\n")}function jb(a){switch(a){case Uj:return["Linear","( value )"];case Vj:return["sRGB","( value )"];case Xj:return["RGBE","( value )"];case Zj:return["RGBM","( value, 7.0 )"];case $j:return["RGBM","( value, 16.0 )"];case _j:return["RGBD","( value, 256.0 )"];case Wj:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Yj:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function kb(a,b,c){var d=a.getShaderParameter(b,35713),e=a.getShaderInfoLog(b).trim();return d&&""===e?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+c+"\n"+e+ib(a.getShaderSource(b))}function lb(a,b){var c=jb(b);return"vec4 "+a+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function mb(a,b){var c=jb(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function nb(a,b){var c;switch(b){case Xh:c="Linear";break;case Yh:c="Reinhard";break;case Zh:c="OptimizedCineon";break;case $h:c="ACESFilmic";break;case _h:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",b),c="Linear"}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function ob(a){return[a.extensionDerivatives||a.envMapCubeUV||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||"physical"===a.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rb).join("\n")}function pb(a){var b=[];for(var c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function qb(a,b){for(var c={},d=a.getProgramParameter(b,35721),e=0;e<d;e++){var f=a.getActiveAttrib(b,e),g=f.name;c[g]=a.getAttribLocation(b,g)}return c}function rb(a){return""!==a}function sb(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,b.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,b.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,b.numPointLightShadows)}function tb(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}function ub(a){return a.replace(jp,vb)}function vb(a,b){var c=Yo[b];if(void 0===c)throw new Error("Can not resolve #include <"+b+">");return ub(c)}function wb(a){return a.replace(lp,yb).replace(kp,xb)}function xb(a,b,c,d){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),yb(a,b,c,d)}function yb(a,b,c,d){for(var e="",f=parseInt(b);f<parseInt(c);f++)e+=d.replace(/\[ i \]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return e}function zb(a){var b="precision "+a.precision+" float;\nprecision "+a.precision+" int;";return"highp"===a.precision?b+="\n#define HIGH_PRECISION":"mediump"===a.precision?b+="\n#define MEDIUM_PRECISION":"lowp"===a.precision&&(b+="\n#define LOW_PRECISION"),b}function Ab(a){var b="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===hh?b="SHADOWMAP_TYPE_PCF":a.shadowMapType===ih?b="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===jh&&(b="SHADOWMAP_TYPE_VSM"),b}function Bb(a){var b="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case bi:case ci:b="ENVMAP_TYPE_CUBE";break;case fi:case gi:b="ENVMAP_TYPE_CUBE_UV";break;case di:case ei:b="ENVMAP_TYPE_EQUIREC"}return b}function Cb(a){var b="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case ci:case ei:b="ENVMAP_MODE_REFRACTION"}return b}function Db(a){var b="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case Th:b="ENVMAP_BLENDING_MULTIPLY";break;case Uh:b="ENVMAP_BLENDING_MIX";break;case Vh:b="ENVMAP_BLENDING_ADD"}return b}function Eb(a,b,c,d){var e,f,g=a.getContext(),h=c.defines,i=c.vertexShader,j=c.fragmentShader,k=Ab(c),l=Bb(c),m=Cb(c),n=Db(c),o=a.gammaFactor>0?a.gammaFactor:1,p=c.isWebGL2?"":ob(c),q=pb(h),r=g.createProgram();if(c.isRawShaderMaterial?(e=[q].filter(rb).join("\n"),e.length>0&&(e+="\n"),f=[p,q].filter(rb).join("\n"),f.length>0&&(f+="\n")):(e=[zb(c),"#define SHADER_NAME "+c.shaderName,q,c.instancing?"#define USE_INSTANCING":"",c.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+o,"#define MAX_BONES "+c.maxBones,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+m:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.useVertexTexture?"#define BONE_TEXTURE":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&!1===c.flatShading?"#define USE_MORPHNORMALS":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+k:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(rb).join("\n"),f=[p,zb(c),"#define SHADER_NAME "+c.shaderName,q,c.alphaTest?"#define ALPHATEST "+c.alphaTest+(c.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+o,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+l:"",c.envMap?"#define "+m:"",c.envMap?"#define "+n:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.sheen?"#define USE_SHEEN":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+k:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(c.extensionShaderTextureLOD||c.envMap)&&c.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==Wh?"#define TONE_MAPPING":"",c.toneMapping!==Wh?Yo.tonemapping_pars_fragment:"",c.toneMapping!==Wh?nb("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",Yo.encodings_pars_fragment,c.map?lb("mapTexelToLinear",c.mapEncoding):"",c.matcap?lb("matcapTexelToLinear",c.matcapEncoding):"",c.envMap?lb("envMapTexelToLinear",c.envMapEncoding):"",c.emissiveMap?lb("emissiveMapTexelToLinear",c.emissiveMapEncoding):"",c.lightMap?lb("lightMapTexelToLinear",c.lightMapEncoding):"",mb("linearToOutputTexel",c.outputEncoding),c.depthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(rb).join("\n")),i=ub(i),i=sb(i,c),i=tb(i,c),j=ub(j),j=sb(j,c),j=tb(j,c),i=wb(i),j=wb(j),c.isWebGL2&&!c.isRawShaderMaterial){var s=!1,t=/^\s*#version\s+300\s+es\s*\n/;c.isShaderMaterial&&null!==i.match(t)&&null!==j.match(t)&&(s=!0,i=i.replace(t,""),j=j.replace(t,"")),e=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+e,f=["#version 300 es\n","#define varying in",s?"":"out highp vec4 pc_fragColor;",s?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+f}var u=e+i,v=f+j,w=hb(g,35633,u),x=hb(g,35632,v);if(g.attachShader(r,w),g.attachShader(r,x),void 0!==c.index0AttributeName?g.bindAttribLocation(r,0,c.index0AttributeName):!0===c.morphTargets&&g.bindAttribLocation(r,0,"position"),g.linkProgram(r),a.debug.checkShaderErrors){var y=g.getProgramInfoLog(r).trim(),z=g.getShaderInfoLog(w).trim(),A=g.getShaderInfoLog(x).trim(),B=!0,C=!0;if(!1===g.getProgramParameter(r,35714)){B=!1;var D=kb(g,w,"vertex"),E=kb(g,x,"fragment");console.error("THREE.WebGLProgram: shader error: ",g.getError(),"35715",g.getProgramParameter(r,35715),"gl.getProgramInfoLog",y,D,E)}else""!==y?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",y):""!==z&&""!==A||(C=!1);C&&(this.diagnostics={runnable:B,programLog:y,vertexShader:{log:z,prefix:e},fragmentShader:{log:A,prefix:f}})}g.deleteShader(w),g.deleteShader(x);var F;this.getUniforms=function(){return void 0===F&&(F=new gb(g,r)),F};var G;return this.getAttributes=function(){return void 0===G&&(G=qb(g,r)),G},this.destroy=function(){d.releaseStatesOfProgram(this),g.deleteProgram(r),this.program=void 0},this.name=c.shaderName,this.id=ip++,this.cacheKey=b,this.usedTimes=1,this.program=r,this.vertexShader=w,this.fragmentShader=x,this}function Fb(a,b,c,d){function e(a,b){var c;if(b){var d=Zo[b];c={name:a.name||a.type,uniforms:vm.clone(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}}else c={name:a.name||a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};return c}function f(a){var b=a.skeleton,c=b.bones;if(o)return 1024;var d=p,e=Math.floor((d-20)/4),f=Math.min(e,c.length);return f<c.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+c.length+" bones. This GPU supports "+f+"."),0):f}function g(a){var b;return a?a.isTexture?b=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),b=a.texture.encoding):b=Uj,b}function h(d,h,i,j,k,l,p){var t=j.fog,u=d.isMeshStandardMaterial?j.environment:null,v=d.envMap||u,w=s[d.type],x=p.isSkinnedMesh?f(p):0;null!==d.precision&&(r=c.getMaxPrecision(d.precision))!==d.precision&&console.warn("THREE.WebGLProgram.getParameters:",d.precision,"not supported, using",r,"instead.");var y=e(d,w);d.onBeforeCompile(y,a);var z=a.getRenderTarget();return{isWebGL2:m,shaderID:w,shaderName:y.name,uniforms:y.uniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,defines:d.defines,isRawShaderMaterial:d.isRawShaderMaterial,isShaderMaterial:d.isShaderMaterial,precision:r,instancing:!0===p.isInstancedMesh,supportsVertexTextures:q,outputEncoding:null!==z?g(z.texture):a.outputEncoding,map:!!d.map,mapEncoding:g(d.map),matcap:!!d.matcap,matcapEncoding:g(d.matcap),envMap:!!v,envMapMode:v&&v.mapping,envMapEncoding:g(v),envMapCubeUV:!!v&&(v.mapping===fi||v.mapping===gi),lightMap:!!d.lightMap,lightMapEncoding:g(d.lightMap),aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:g(d.emissiveMap),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,objectSpaceNormalMap:d.normalMapType===dk,tangentSpaceNormalMap:d.normalMapType===ck,clearcoatMap:!!d.clearcoatMap,clearcoatRoughnessMap:!!d.clearcoatRoughnessMap,clearcoatNormalMap:!!d.clearcoatNormalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,gradientMap:!!d.gradientMap,sheen:!!d.sheen,combine:d.combine,vertexTangents:d.normalMap&&d.vertexTangents,vertexColors:d.vertexColors,vertexUvs:!!(d.map||d.bumpMap||d.normalMap||d.specularMap||d.alphaMap||d.emissiveMap||d.roughnessMap||d.metalnessMap||d.clearcoatMap||d.clearcoatRoughnessMap||d.clearcoatNormalMap||d.displacementMap),uvsVertexOnly:!(d.map||d.bumpMap||d.normalMap||d.specularMap||d.alphaMap||d.emissiveMap||d.roughnessMap||d.metalnessMap||d.clearcoatNormalMap||!d.displacementMap),fog:!!t,useFog:d.fog,fogExp2:t&&t.isFogExp2,flatShading:d.flatShading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:n,skinning:d.skinning&&x>0,maxBones:x,useVertexTexture:o,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:k,numClipIntersection:l,dithering:d.dithering,shadowMapEnabled:a.shadowMap.enabled&&i.length>0,shadowMapType:a.shadowMap.type,toneMapping:d.toneMapped?a.toneMapping:Wh,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:d.side===mh,flipSided:d.side===lh,depthPacking:void 0!==d.depthPacking&&d.depthPacking,index0AttributeName:d.index0AttributeName,extensionDerivatives:d.extensions&&d.extensions.derivatives,extensionFragDepth:d.extensions&&d.extensions.fragDepth,extensionDrawBuffers:d.extensions&&d.extensions.drawBuffers,extensionShaderTextureLOD:d.extensions&&d.extensions.shaderTextureLOD,rendererExtensionFragDepth:m||null!==b.get("EXT_frag_depth"),rendererExtensionDrawBuffers:m||null!==b.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:m||null!==b.get("EXT_shader_texture_lod"),customProgramCacheKey:d.customProgramCacheKey()}}function i(b){var c=[];if(b.shaderID?c.push(b.shaderID):(c.push(b.fragmentShader),c.push(b.vertexShader)),void 0!==b.defines)for(var d in b.defines)c.push(d),c.push(b.defines[d]);if(void 0===b.isRawShaderMaterial){for(var e=0;e<t.length;e++)c.push(b[t[e]]);c.push(a.outputEncoding),c.push(a.gammaFactor)}return c.push(b.customProgramCacheKey),c.join()}function j(b,c){for(var e,f=0,g=l.length;f<g;f++){var h=l[f];if(h.cacheKey===c){e=h,++e.usedTimes;break}}return void 0===e&&(e=new Eb(a,c,b,d),l.push(e)),e}function k(a){if(0==--a.usedTimes){var b=l.indexOf(a);l[b]=l[l.length-1],l.pop(),a.destroy()}}var l=[],m=c.isWebGL2,n=c.logarithmicDepthBuffer,o=c.floatVertexTextures,p=c.maxVertexUniforms,q=c.vertexTextures,r=c.precision,s={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},t=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];return{getParameters:h,getProgramCacheKey:i,acquireProgram:j,releaseProgram:k,programs:l}}function Gb(){function a(a){var b=e.get(a);return void 0===b&&(b={},e.set(a,b)),b}function b(a){e.delete(a)}function c(a,b,c){e.get(a)[b]=c}function d(){e=new WeakMap}var e=new WeakMap;return{get:a,remove:b,update:c,dispose:d}}function Hb(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function Ib(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function Jb(){function a(){h=0,i.length=0,j.length=0}function b(a,b,c,d,e,f){var i=g[h];return void 0===i?(i={id:a.id,object:a,geometry:b,material:c,program:c.program||k,groupOrder:d,renderOrder:a.renderOrder,z:e,group:f},g[h]=i):(i.id=a.id,i.object=a,i.geometry=b,i.material=c,i.program=c.program||k,i.groupOrder=d,i.renderOrder=a.renderOrder,i.z=e,i.group=f),h++,i}function c(a,c,d,e,f,g){var h=b(a,c,d,e,f,g);(!0===d.transparent?j:i).push(h)}function d(a,c,d,e,f,g){var h=b(a,c,d,e,f,g);(!0===d.transparent?j:i).unshift(h)}function e(a,b){i.length>1&&i.sort(a||Hb),j.length>1&&j.sort(b||Ib)}function f(){for(var a=h,b=g.length;a<b;a++){var c=g[a];if(null===c.id)break;c.id=null,c.object=null,c.geometry=null,c.material=null,c.program=null,c.group=null}}var g=[],h=0,i=[],j=[],k={id:-1};return{opaque:i,transparent:j,init:a,push:c,unshift:d,finish:f,sort:e}}function Kb(){function a(b){var c=b.target;c.removeEventListener("dispose",a),d.delete(c)}function b(b,c){var e,f=d.get(b);return void 0===f?(e=new Jb,d.set(b,new WeakMap),d.get(b).set(c,e),b.addEventListener("dispose",a)):void 0===(e=f.get(c))&&(e=new Jb,f.set(c,e)),e}function c(){d=new WeakMap}var d=new WeakMap;return{get:b,dispose:c}}function Lb(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case"DirectionalLight":c={direction:new j,color:new v};break;case"SpotLight":c={position:new j,direction:new j,color:new v,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new j,color:new v,distance:0,decay:0};break;case"HemisphereLight":c={direction:new j,skyColor:new v,groundColor:new v};break;case"RectAreaLight":c={color:new v,position:new j,halfWidth:new j,halfHeight:new j}}return a[b.id]=c,c}}}function Mb(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];var d;switch(b.type){case"DirectionalLight":case"SpotLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new c};break;case"PointLight":d={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new c,shadowCameraNear:1,shadowCameraFar:1e3}}return a[b.id]=d,d}}}function Nb(a,b){return(b.castShadow?1:0)-(a.castShadow?1:0)}function Ob(){function a(a,e,i){for(var j=0,k=0,l=0,m=0;m<9;m++)d.probe[m].set(0,0,0);var n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=i.matrixWorldInverse;a.sort(Nb);for(var w=0,x=a.length;w<x;w++){var y=a[w],z=y.color,A=y.intensity,B=y.distance,C=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)j+=z.r*A,k+=z.g*A,l+=z.b*A;else if(y.isLightProbe)for(var D=0;D<9;D++)d.probe[D].addScaledVector(y.sh.coefficients[D],A);else if(y.isDirectionalLight){var E=b.get(y);if(E.color.copy(y.color).multiplyScalar(y.intensity),E.direction.setFromMatrixPosition(y.matrixWorld),f.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(f),E.direction.transformDirection(v),y.castShadow){var F=y.shadow,G=c.get(y);G.shadowBias=F.bias,G.shadowNormalBias=F.normalBias,G.shadowRadius=F.radius,G.shadowMapSize=F.mapSize,d.directionalShadow[n]=G,d.directionalShadowMap[n]=C,d.directionalShadowMatrix[n]=y.shadow.matrix,s++}d.directional[n]=E,n++}else if(y.isSpotLight){var H=b.get(y);if(H.position.setFromMatrixPosition(y.matrixWorld),H.position.applyMatrix4(v),H.color.copy(z).multiplyScalar(A),H.distance=B,H.direction.setFromMatrixPosition(y.matrixWorld),f.setFromMatrixPosition(y.target.matrixWorld),H.direction.sub(f),H.direction.transformDirection(v),H.coneCos=Math.cos(y.angle),H.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),H.decay=y.decay,y.castShadow){var I=y.shadow,J=c.get(y);J.shadowBias=I.bias,J.shadowNormalBias=I.normalBias,J.shadowRadius=I.radius,J.shadowMapSize=I.mapSize,d.spotShadow[p]=J,d.spotShadowMap[p]=C,d.spotShadowMatrix[p]=y.shadow.matrix,u++}d.spot[p]=H,p++}else if(y.isRectAreaLight){var K=b.get(y);K.color.copy(z).multiplyScalar(A),K.position.setFromMatrixPosition(y.matrixWorld),K.position.applyMatrix4(v),h.identity(),g.copy(y.matrixWorld),g.premultiply(v),h.extractRotation(g),K.halfWidth.set(.5*y.width,0,0),K.halfHeight.set(0,.5*y.height,0),K.halfWidth.applyMatrix4(h),K.halfHeight.applyMatrix4(h),d.rectArea[q]=K,q++}else if(y.isPointLight){var L=b.get(y);if(L.position.setFromMatrixPosition(y.matrixWorld),L.position.applyMatrix4(v),L.color.copy(y.color).multiplyScalar(y.intensity),L.distance=y.distance,L.decay=y.decay,y.castShadow){var M=y.shadow,N=c.get(y);N.shadowBias=M.bias,N.shadowNormalBias=M.normalBias,N.shadowRadius=M.radius,N.shadowMapSize=M.mapSize,N.shadowCameraNear=M.camera.near,N.shadowCameraFar=M.camera.far,d.pointShadow[o]=N,d.pointShadowMap[o]=C,d.pointShadowMatrix[o]=y.shadow.matrix,t++}d.point[o]=L,o++}else if(y.isHemisphereLight){var O=b.get(y);O.direction.setFromMatrixPosition(y.matrixWorld),O.direction.transformDirection(v),O.direction.normalize(),O.skyColor.copy(y.color).multiplyScalar(A),O.groundColor.copy(y.groundColor).multiplyScalar(A),d.hemi[r]=O,r++}}d.ambient[0]=j,d.ambient[1]=k,d.ambient[2]=l;var P=d.hash;P.directionalLength===n&&P.pointLength===o&&P.spotLength===p&&P.rectAreaLength===q&&P.hemiLength===r&&P.numDirectionalShadows===s&&P.numPointShadows===t&&P.numSpotShadows===u||(d.directional.length=n,d.spot.length=p,d.rectArea.length=q,d.point.length=o,d.hemi.length=r,d.directionalShadow.length=s,d.directionalShadowMap.length=s,d.pointShadow.length=t,d.pointShadowMap.length=t,d.spotShadow.length=u,d.spotShadowMap.length=u,d.directionalShadowMatrix.length=s,d.pointShadowMatrix.length=t,d.spotShadowMatrix.length=u,P.directionalLength=n,P.pointLength=o,P.spotLength=p,P.rectAreaLength=q,P.hemiLength=r,P.numDirectionalShadows=s,P.numPointShadows=t,P.numSpotShadows=u,d.version=mp++)}for(var b=new Lb,c=Mb(),d={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},e=0;e<9;e++)d.probe.push(new j);var f=new j,g=new k,h=new k;return{setup:a,state:d}}function Pb(){function a(){f.length=0,g.length=0}function b(a){f.push(a)}function c(a){g.push(a)}function d(a){e.setup(f,g,a)}var e=new Ob,f=[],g=[];return{init:a,state:{lightsArray:f,shadowsArray:g,lights:e},setupLights:d,pushLight:b,pushShadow:c}}function Qb(){function a(b){var c=b.target;c.removeEventListener("dispose",a),d.delete(c)}function b(b,c){var e;return!1===d.has(b)?(e=new Pb,d.set(b,new WeakMap),d.get(b).set(c,e),b.addEventListener("dispose",a)):!1===d.get(b).has(c)?(e=new Pb,d.get(b).set(c,e)):e=d.get(b).get(c),e}function c(){d=new WeakMap}var d=new WeakMap;return{get:b,dispose:c}}function Rb(a){A.call(this),this.type="MeshDepthMaterial",this.depthPacking=ak,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(a)}function Sb(a){A.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new j,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(a)}function Tb(a,b,d){function e(c,d){var e=b.update(w);t.uniforms.shadow_pass.value=c.map.texture,t.uniforms.resolution.value=c.mapSize,t.uniforms.radius.value=c.radius,a.setRenderTarget(c.mapPass),a.clear(),a.renderBufferDirect(d,null,e,t,w,null),u.uniforms.shadow_pass.value=c.mapPass.texture,u.uniforms.resolution.value=c.mapSize,u.uniforms.radius.value=c.radius,a.setRenderTarget(c.map),a.clear(),a.renderBufferDirect(d,null,e,u,w,null)}function h(a,b,c){var d=a<<0|b<<1|c<<2,e=p[d];return void 0===e&&(e=new Rb({depthPacking:bk,morphTargets:a,skinning:b}),p[d]=e),e}function i(a,b,c){var d=a<<0|b<<1|c<<2,e=q[d];return void 0===e&&(e=new Sb({morphTargets:a,skinning:b}),q[d]=e),e}function j(b,c,d,e,f,g,j){var k=null,l=h,m=b.customDepthMaterial;if(!0===e.isPointLight&&(l=i,m=b.customDistanceMaterial),void 0===m){var n=!1;!0===d.morphTargets&&(n=c.morphAttributes&&c.morphAttributes.position&&c.morphAttributes.position.length>0);var o=!1;!0===b.isSkinnedMesh&&(!0===d.skinning?o=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",b));k=l(n,o,!0===b.isInstancedMesh)}else k=m;if(a.localClippingEnabled&&!0===d.clipShadows&&0!==d.clippingPlanes.length){var p=k.uuid,q=d.uuid,t=r[p];void 0===t&&(t={},r[p]=t);var u=t[q];void 0===u&&(u=k.clone(),t[q]=u),k=u}return k.visible=d.visible,k.wireframe=d.wireframe,k.side=j===jh?null!==d.shadowSide?d.shadowSide:d.side:null!==d.shadowSide?d.shadowSide:s[d.side],k.clipShadows=d.clipShadows,k.clippingPlanes=d.clippingPlanes,k.clipIntersection=d.clipIntersection,k.wireframeLinewidth=d.wireframeLinewidth,k.linewidth=d.linewidth,!0===e.isPointLight&&!0===k.isMeshDistanceMaterial&&(k.referencePosition.setFromMatrixPosition(e.matrixWorld),k.nearDistance=f,k.farDistance=g),k}function k(c,d,e,f,g){if(!1!==c.visible){if(c.layers.test(d.layers)&&(c.isMesh||c.isLine||c.isPoints)&&(c.castShadow||c.receiveShadow&&g===jh)&&(!c.frustumCulled||l.intersectsObject(c))){c.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,c.matrixWorld);var h=b.update(c),i=c.material;if(Array.isArray(i))for(var m=h.groups,n=0,o=m.length;n<o;n++){var p=m[n],q=i[p.materialIndex];if(q&&q.visible){var r=j(c,h,q,f,e.near,e.far,g);a.renderBufferDirect(e,null,h,r,c,p)}}else if(i.visible){var s=j(c,h,i,f,e.near,e.far,g);a.renderBufferDirect(e,null,h,s,c,null)}}for(var t=c.children,u=0,v=t.length;u<v;u++)k(t[u],d,e,f,g)}}var l=new _,m=new c,n=new c,o=new f,p=[],q=[],r={},s={0:lh,1:kh,2:mh},t=new V({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new c},radius:{value:4}},vertexShader:op,fragmentShader:np}),u=t.clone();u.defines.HORIZONAL_PASS=1;var v=new O;v.setAttribute("position",new C(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var w=new P(v,t),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=hh,this.render=function(b,c,f){if(!1!==x.enabled&&(!1!==x.autoUpdate||!1!==x.needsUpdate)&&0!==b.length){var h=a.getRenderTarget(),i=a.getActiveCubeFace(),j=a.getActiveMipmapLevel(),p=a.state;p.setBlending(ph),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var q=0,r=b.length;q<r;q++){var s=b[q],t=s.shadow;if(!1!==t.autoUpdate||!1!==t.needsUpdate)if(void 0!==t){m.copy(t.mapSize);var u=t.getFrameExtents();if(m.multiply(u),n.copy(t.mapSize),(m.x>d||m.y>d)&&(m.x>d&&(n.x=Math.floor(d/u.x),m.x=n.x*u.x,t.mapSize.x=n.x),m.y>d&&(n.y=Math.floor(d/u.y),m.y=n.y*u.y,t.mapSize.y=n.y)),null===t.map&&!t.isPointLightShadow&&this.type===jh){var v={minFilter:pi,magFilter:pi,format:Ii};t.map=new g(m.x,m.y,v),t.map.texture.name=s.name+".shadowMap",t.mapPass=new g(m.x,m.y,v),t.camera.updateProjectionMatrix()}if(null===t.map){var w={minFilter:ki,magFilter:ki,format:Ii};t.map=new g(m.x,m.y,w),t.map.texture.name=s.name+".shadowMap",t.camera.updateProjectionMatrix()}a.setRenderTarget(t.map),a.clear();for(var y=t.getViewportCount(),z=0;z<y;z++){var A=t.getViewport(z);o.set(n.x*A.x,n.y*A.y,n.x*A.z,n.y*A.w),p.viewport(o),t.updateMatrices(s,z),l=t.getFrustum(),k(c,f,t.camera,s,this.type)}t.isPointLightShadow||this.type!==jh||e(t,f),t.needsUpdate=!1}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}x.needsUpdate=!1,a.setRenderTarget(h,i,j)}}}function Ub(a,b,c){function d(){var b=!1,c=new f,d=null,e=new f(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g),c.set(b,d,f,g),!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1,d=null,e.set(-1,0,0,0)}}}function e(){var b=!1,c=null,d=null,e=null;return{setTest:function(a){a?i(2929):j(2929)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case Lh:a.depthFunc(512);break;case Mh:a.depthFunc(519);break;case Nh:a.depthFunc(513);break;case Oh:a.depthFunc(515);break;case Ph:a.depthFunc(514);break;case Qh:a.depthFunc(518);break;case Rh:a.depthFunc(516);break;case Sh:a.depthFunc(517);break;default:a.depthFunc(515)}else a.depthFunc(515);d=b}},setLocked:function(a){b=a},setClear:function(b){e!==b&&(a.clearDepth(b),e=b)},reset:function(){b=!1,c=null,d=null,e=null}}}function g(){var b=!1,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null;return{setTest:function(a){b||(a?i(2960):j(2960))},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,g){d===b&&e===c&&f===g||(a.stencilFunc(b,c,g),d=b,e=c,f=g)},setOp:function(b,c,d){g===b&&h===c&&k===d||(a.stencilOp(b,c,d),g=b,h=c,k=d)},setLocked:function(a){b=a},setClear:function(b){l!==b&&(a.clearStencil(b),l=b)},reset:function(){b=!1,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null}}}function h(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f),a.texParameteri(b,10241,9728),a.texParameteri(b,10240,9728);for(var g=0;g<d;g++)a.texImage2D(c+g,0,6408,1,1,0,6408,5121,e);return f}function i(b){!0!==F[b]&&(a.enable(b),F[b]=!0)}function j(b){!1!==F[b]&&(a.disable(b),F[b]=!1)}function k(b){return G!==b&&(a.useProgram(b),G=b,!0)}function l(b,c,d,e,f,g,h,k){if(b===ph)return void(H&&(j(3042),H=!1));if(H||(i(3042),H=!0),b===uh)f=f||c,g=g||d,h=h||e,c===J&&f===M||(a.blendEquationSeparate(ca[c],ca[f]),J=c,M=f),d===K&&e===L&&g===N&&h===O||(a.blendFuncSeparate(ea[d],ea[e],ea[g],ea[h]),K=d,L=e,N=g,O=h),I=b,P=null;else if(b!==I||k!==P){if(J===vh&&M===vh||(a.blendEquation(32774),J=vh,M=vh),k)switch(b){case qh:a.blendFuncSeparate(1,771,1,771);break;case rh:a.blendFunc(1,1);break;case sh:a.blendFuncSeparate(0,0,769,771);break;case th:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}else switch(b){case qh:a.blendFuncSeparate(770,771,1,771);break;case rh:a.blendFunc(770,1);break;case sh:a.blendFunc(0,769);break;case th:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}K=null,L=null,N=null,O=null,I=b,P=k}}function m(a,b){a.side===mh?j(2884):i(2884);var c=a.side===lh;b&&(c=!c),n(c),a.blending===qh&&!1===a.transparent?l(ph):l(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha),D.setFunc(a.depthFunc),D.setTest(a.depthTest),D.setMask(a.depthWrite),C.setMask(a.colorWrite);var d=a.stencilWrite;E.setTest(d),d&&(E.setMask(a.stencilWriteMask),E.setFunc(a.stencilFunc,a.stencilRef,a.stencilFuncMask),E.setOp(a.stencilFail,a.stencilZFail,a.stencilZPass)),q(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function n(b){Q!==b&&(b?a.frontFace(2304):a.frontFace(2305),Q=b)}function o(b){b!==ah?(i(2884),b!==R&&(b===bh?a.cullFace(1029):b===ch?a.cullFace(1028):a.cullFace(1032))):j(2884),R=b}function p(b){b!==S&&(W&&a.lineWidth(b),S=b)}function q(b,c,d){b?(i(32823),T===c&&U===d||(a.polygonOffset(c,d),T=c,U=d)):j(32823)}function r(a){a?i(3089):j(3089)}function s(b){void 0===b&&(b=33984+V-1),Z!==b&&(a.activeTexture(b),Z=b)}function t(b,c){null===Z&&s();var d=$[Z];void 0===d&&(d={type:void 0,texture:void 0},$[Z]=d),d.type===b&&d.texture===c||(a.bindTexture(b,c||ba[b]),d.type=b,d.texture=c)}function u(){var b=$[Z];void 0!==b&&void 0!==b.type&&(a.bindTexture(b.type,null),b.type=void 0,b.texture=void 0)}function v(){try{a.compressedTexImage2D.apply(a,arguments)}catch(a){console.error("THREE.WebGLState:",a)}}function w(){try{a.texImage2D.apply(a,arguments)}catch(a){console.error("THREE.WebGLState:",a)}}function x(){try{a.texImage3D.apply(a,arguments)}catch(a){console.error("THREE.WebGLState:",a)}}function y(b){!1===_.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),_.copy(b))}function z(b){!1===aa.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),aa.copy(b))}function A(){F={},Z=null,$={},G=null,I=null,Q=null,R=null,C.reset(),D.reset(),E.reset()}var B=c.isWebGL2,C=new d,D=new e,E=new g,F={},G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=!1,Q=null,R=null,S=null,T=null,U=null,V=a.getParameter(35661),W=!1,X=0,Y=a.getParameter(7938);-1!==Y.indexOf("WebGL")?(X=parseFloat(/^WebGL\ ([0-9])/.exec(Y)[1]),W=X>=1):-1!==Y.indexOf("OpenGL ES")&&(X=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Y)[1]),W=X>=2);var Z=null,$={},_=new f,aa=new f,ba={};ba[3553]=h(3553,3553,1),ba[34067]=h(34067,34069,6),C.setClear(0,0,0,1),D.setClear(1),E.setClear(0),i(2929),D.setFunc(Oh),n(!1),o(bh),i(2884),l(ph);var ca={};if(ca[vh]=32774,ca[wh]=32778,ca[xh]=32779,B)ca[yh]=32775,ca[zh]=32776;else{var da=b.get("EXT_blend_minmax");null!==da&&(ca[yh]=da.MIN_EXT,ca[zh]=da.MAX_EXT)}var ea={};return ea[Ah]=0,ea[Bh]=1,ea[Ch]=768,ea[Eh]=770,ea[Kh]=776,ea[Ih]=774,ea[Gh]=772,ea[Dh]=769,ea[Fh]=771,ea[Jh]=775,ea[Hh]=773,{buffers:{color:C,depth:D,stencil:E},enable:i,disable:j,useProgram:k,setBlending:l,setMaterial:m,setFlipSided:n,setCullFace:o,setLineWidth:p,setPolygonOffset:q,setScissorTest:r,activeTexture:s,bindTexture:t,unbindTexture:u,compressedTexImage2D:v,texImage2D:w,texImage3D:x,scissor:y,viewport:z,reset:A}}function Vb(a,b,c,d,e,f,g){function h(a,b){return V?new OffscreenCanvas(a,b):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function i(a,b,c,d){var e=1;if((a.width>d||a.height>d)&&(e=d/Math.max(a.width,a.height)),e<1||!0===b){if("undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap){var f=b?Fk.floorPowerOfTwo:Math.floor,g=f(e*a.width),i=f(e*a.height);void 0===O&&(O=h(g,i));var j=c?h(g,i):O;j.width=g,j.height=i;return j.getContext("2d").drawImage(a,0,0,g,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+g+"x"+i+")."),j}return"data"in a&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),a}return a}function j(a){return Fk.isPowerOfTwo(a.width)&&Fk.isPowerOfTwo(a.height)}function k(a){return!P&&(a.wrapS!==ii||a.wrapT!==ii||a.minFilter!==ki&&a.minFilter!==pi)}function l(a,b){return a.generateMipmaps&&b&&a.minFilter!==ki&&a.minFilter!==pi}function m(b,c,e,f){a.generateMipmap(b),d.get(c).__maxMipLevel=Math.log(Math.max(e,f))*Math.LOG2E}function n(c,d,e){if(!1===P)return d;if(null!==c){if(void 0!==a[c])return a[c];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+c+"'")}var f=d;return 6403===d&&(5126===e&&(f=33326),5131===e&&(f=33325),5121===e&&(f=33321)),6407===d&&(5126===e&&(f=34837),5131===e&&(f=34843),5121===e&&(f=32849)),6408===d&&(5126===e&&(f=34836),5131===e&&(f=34842),5121===e&&(f=32856)),33325!==f&&33326!==f&&34842!==f&&34836!==f||b.get("EXT_color_buffer_float"),f}function o(a){return a===ki||a===li||a===ni?9728:9729}function p(a){var b=a.target;b.removeEventListener("dispose",p),r(b),b.isVideoTexture&&U.delete(b),g.memory.textures--}function q(a){var b=a.target;b.removeEventListener("dispose",q),s(b),g.memory.textures--}function r(b){var c=d.get(b);void 0!==c.__webglInit&&(a.deleteTexture(c.__webglTexture),d.remove(b))}function s(b){var c=d.get(b),e=d.get(b.texture);if(b){if(void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture),b.depthTexture&&b.depthTexture.dispose(),b.isWebGLCubeRenderTarget)for(var f=0;f<6;f++)a.deleteFramebuffer(c.__webglFramebuffer[f]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[f]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer),c.__webglMultisampledFramebuffer&&a.deleteFramebuffer(c.__webglMultisampledFramebuffer),c.__webglColorRenderbuffer&&a.deleteRenderbuffer(c.__webglColorRenderbuffer),c.__webglDepthRenderbuffer&&a.deleteRenderbuffer(c.__webglDepthRenderbuffer);d.remove(b.texture),d.remove(b)}}function t(){W=0}function u(){var a=W;return a>=Q&&console.warn("THREE.WebGLTextures: Trying to use "+a+" texture units while this GPU supports only "+Q),W+=1,a}function v(a,b){var e=d.get(a);if(a.isVideoTexture&&L(a),a.version>0&&e.__version!==a.version){var f=a.image;if(void 0===f)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==f.complete)return void C(e,a,b);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}c.activeTexture(33984+b),c.bindTexture(3553,e.__webglTexture)}function w(a,b){var e=d.get(a);if(a.version>0&&e.__version!==a.version)return void C(e,a,b);c.activeTexture(33984+b),c.bindTexture(35866,e.__webglTexture)}function x(a,b){var e=d.get(a);if(a.version>0&&e.__version!==a.version)return void C(e,a,b);c.activeTexture(33984+b),c.bindTexture(32879,e.__webglTexture)}function y(b,e){if(6===b.image.length){var g=d.get(b);if(b.version>0&&g.__version!==b.version){B(g,b),c.activeTexture(33984+e),c.bindTexture(34067,g.__webglTexture),a.pixelStorei(37440,b.flipY);for(var h=b&&(b.isCompressedTexture||b.image[0].isCompressedTexture),k=b.image[0]&&b.image[0].isDataTexture,o=[],p=0;p<6;p++)o[p]=h||k?k?b.image[p].image:b.image[p]:i(b.image[p],!1,!0,R);var q=o[0],r=j(q)||P,s=f.convert(b.format),t=f.convert(b.type),u=n(b.internalFormat,s,t);A(34067,b,r);var v;if(h){for(var w=0;w<6;w++){v=o[w].mipmaps;for(var x=0;x<v.length;x++){var y=v[x];b.format!==Ii&&b.format!==Hi?null!==s?c.compressedTexImage2D(34069+w,x,u,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(34069+w,x,u,y.width,y.height,0,s,t,y.data)}}g.__maxMipLevel=v.length-1}else{v=b.mipmaps;for(var z=0;z<6;z++)if(k){c.texImage2D(34069+z,0,u,o[z].width,o[z].height,0,s,t,o[z].data);for(var C=0;C<v.length;C++){var D=v[C],E=D.image[z].image;c.texImage2D(34069+z,C+1,u,E.width,E.height,0,s,t,E.data)}}else{c.texImage2D(34069+z,0,u,s,t,o[z]);for(var F=0;F<v.length;F++){var G=v[F];c.texImage2D(34069+z,F+1,u,s,t,G.image[z])}}g.__maxMipLevel=v.length}l(b,r)&&m(34067,b,q.width,q.height),g.__version=b.version,b.onUpdate&&b.onUpdate(b)}else c.activeTexture(33984+e),c.bindTexture(34067,g.__webglTexture)}}function z(a,b){c.activeTexture(33984+b),c.bindTexture(34067,d.get(a).__webglTexture)}function A(c,f,g){g?(a.texParameteri(c,10242,X[f.wrapS]),a.texParameteri(c,10243,X[f.wrapT]),32879!==c&&35866!==c||a.texParameteri(c,32882,X[f.wrapR]),a.texParameteri(c,10240,Y[f.magFilter]),a.texParameteri(c,10241,Y[f.minFilter])):(a.texParameteri(c,10242,33071),a.texParameteri(c,10243,33071),32879!==c&&35866!==c||a.texParameteri(c,32882,33071),f.wrapS!==ii||f.wrapT,a.texParameteri(c,10240,o(f.magFilter)),a.texParameteri(c,10241,o(f.minFilter)),f.minFilter!==ki&&f.minFilter);var h=b.get("EXT_texture_filter_anisotropic");if(h){if(f.type===Ai&&null===b.get("OES_texture_float_linear"))return;if(f.type===Bi&&null===(P||b.get("OES_texture_half_float_linear")))return;(f.anisotropy>1||d.get(f).__currentAnisotropy)&&(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f.anisotropy,e.getMaxAnisotropy())),d.get(f).__currentAnisotropy=f.anisotropy)}}function B(b,c){void 0===b.__webglInit&&(b.__webglInit=!0,c.addEventListener("dispose",p),b.__webglTexture=a.createTexture(),g.memory.textures++)}function C(b,d,e){var g=3553;d.isDataTexture2DArray&&(g=35866),d.isDataTexture3D&&(g=32879),B(b,d),c.activeTexture(33984+e),c.bindTexture(g,b.__webglTexture),a.pixelStorei(37440,d.flipY),a.pixelStorei(37441,d.premultiplyAlpha),a.pixelStorei(3317,d.unpackAlignment);var h=k(d)&&!1===j(d.image),o=i(d.image,h,!1,S),p=j(o)||P,q=f.convert(d.format),r=f.convert(d.type),s=n(d.internalFormat,q,r);A(g,d,p);var t,u=d.mipmaps;if(d.isDepthTexture)s=6402,P?s=d.type===Ai?36012:d.type===zi?33190:d.type===Fi?35056:33189:d.type===Ai&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),d.format===Mi&&6402===s&&d.type!==xi&&d.type!==zi&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),d.type=xi,r=f.convert(d.type)),d.format===Ni&&6402===s&&(s=34041,d.type!==Fi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),d.type=Fi,r=f.convert(d.type))),c.texImage2D(3553,0,s,o.width,o.height,0,q,r,null);else if(d.isDataTexture)if(u.length>0&&p){for(var v=0,w=u.length;v<w;v++)t=u[v],c.texImage2D(3553,v,s,t.width,t.height,0,q,r,t.data);d.generateMipmaps=!1,b.__maxMipLevel=u.length-1}else c.texImage2D(3553,0,s,o.width,o.height,0,q,r,o.data),b.__maxMipLevel=0;else if(d.isCompressedTexture){for(var x=0,y=u.length;x<y;x++)t=u[x],d.format!==Ii&&d.format!==Hi?null!==q?c.compressedTexImage2D(3553,x,s,t.width,t.height,0,t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(3553,x,s,t.width,t.height,0,q,r,t.data);b.__maxMipLevel=u.length-1}else if(d.isDataTexture2DArray)c.texImage3D(35866,0,s,o.width,o.height,o.depth,0,q,r,o.data),b.__maxMipLevel=0;else if(d.isDataTexture3D)c.texImage3D(32879,0,s,o.width,o.height,o.depth,0,q,r,o.data),b.__maxMipLevel=0;else if(u.length>0&&p){for(var z=0,C=u.length;z<C;z++)t=u[z],c.texImage2D(3553,z,s,q,r,t);d.generateMipmaps=!1,b.__maxMipLevel=u.length-1}else c.texImage2D(3553,0,s,q,r,o),b.__maxMipLevel=0;l(d,p)&&m(g,d,o.width,o.height),b.__version=d.version,d.onUpdate&&d.onUpdate(d)}function D(b,e,g,h){var i=f.convert(e.texture.format),j=f.convert(e.texture.type),k=n(e.texture.internalFormat,i,j);c.texImage2D(h,0,k,e.width,e.height,0,i,j,null),a.bindFramebuffer(36160,b),a.framebufferTexture2D(36160,g,h,d.get(e.texture).__webglTexture,0),a.bindFramebuffer(36160,null)}function E(b,c,d){if(a.bindRenderbuffer(36161,b),c.depthBuffer&&!c.stencilBuffer){var e=33189;if(d){var g=c.depthTexture;g&&g.isDepthTexture&&(g.type===Ai?e=36012:g.type===zi&&(e=33190));var h=K(c);a.renderbufferStorageMultisample(36161,h,e,c.width,c.height)}else a.renderbufferStorage(36161,e,c.width,c.height);a.framebufferRenderbuffer(36160,36096,36161,b)}else if(c.depthBuffer&&c.stencilBuffer){if(d){var i=K(c);a.renderbufferStorageMultisample(36161,i,35056,c.width,c.height)}else a.renderbufferStorage(36161,34041,c.width,c.height);a.framebufferRenderbuffer(36160,33306,36161,b)}else{var j=f.convert(c.texture.format),k=f.convert(c.texture.type),l=n(c.texture.internalFormat,j,k);if(d){var m=K(c);a.renderbufferStorageMultisample(36161,m,l,c.width,c.height)}else a.renderbufferStorage(36161,l,c.width,c.height)}a.bindRenderbuffer(36161,null)}function F(b,c){if(c&&c.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(36160,b),!c.depthTexture||!c.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(c.depthTexture).__webglTexture&&c.depthTexture.image.width===c.width&&c.depthTexture.image.height===c.height||(c.depthTexture.image.width=c.width,c.depthTexture.image.height=c.height,c.depthTexture.needsUpdate=!0),v(c.depthTexture,0);var e=d.get(c.depthTexture).__webglTexture;if(c.depthTexture.format===Mi)a.framebufferTexture2D(36160,36096,3553,e,0);else{if(c.depthTexture.format!==Ni)throw new Error("Unknown depthTexture format");a.framebufferTexture2D(36160,33306,3553,e,0)}}function G(b){var c=d.get(b),e=!0===b.isWebGLCubeRenderTarget;if(b.depthTexture){if(e)throw new Error("target.depthTexture not supported in Cube render targets");F(c.__webglFramebuffer,b)}else if(e){c.__webglDepthbuffer=[];for(var f=0;f<6;f++)a.bindFramebuffer(36160,c.__webglFramebuffer[f]),c.__webglDepthbuffer[f]=a.createRenderbuffer(),E(c.__webglDepthbuffer[f],b,!1)}else a.bindFramebuffer(36160,c.__webglFramebuffer),c.__webglDepthbuffer=a.createRenderbuffer(),E(c.__webglDepthbuffer,b,!1);a.bindFramebuffer(36160,null)}function H(b){var e=d.get(b),h=d.get(b.texture);b.addEventListener("dispose",q),h.__webglTexture=a.createTexture(),g.memory.textures++;var i=!0===b.isWebGLCubeRenderTarget,k=!0===b.isWebGLMultisampleRenderTarget,o=j(b)||P;if(!P||b.texture.format!==Hi||b.texture.type!==Ai&&b.texture.type!==Bi||(b.texture.format=Ii,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),i){e.__webglFramebuffer=[];for(var p=0;p<6;p++)e.__webglFramebuffer[p]=a.createFramebuffer()}else if(e.__webglFramebuffer=a.createFramebuffer(),k)if(P){e.__webglMultisampledFramebuffer=a.createFramebuffer(),e.__webglColorRenderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,e.__webglColorRenderbuffer);var r=f.convert(b.texture.format),s=f.convert(b.texture.type),t=n(b.texture.internalFormat,r,s),u=K(b);a.renderbufferStorageMultisample(36161,u,t,b.width,b.height),a.bindFramebuffer(36160,e.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064,36161,e.__webglColorRenderbuffer),a.bindRenderbuffer(36161,null),b.depthBuffer&&(e.__webglDepthRenderbuffer=a.createRenderbuffer(),E(e.__webglDepthRenderbuffer,b,!0)),a.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(i){c.bindTexture(34067,h.__webglTexture),A(34067,b.texture,o);for(var v=0;v<6;v++)D(e.__webglFramebuffer[v],b,36064,34069+v);l(b.texture,o)&&m(34067,b.texture,b.width,b.height),c.bindTexture(34067,null)}else c.bindTexture(3553,h.__webglTexture),A(3553,b.texture,o),D(e.__webglFramebuffer,b,36064,3553),l(b.texture,o)&&m(3553,b.texture,b.width,b.height),c.bindTexture(3553,null);b.depthBuffer&&G(b)}function I(a){var b=a.texture;if(l(b,j(a)||P)){var e=a.isWebGLCubeRenderTarget?34067:3553,f=d.get(b).__webglTexture;c.bindTexture(e,f),m(e,b,a.width,a.height),c.bindTexture(e,null)}}function J(b){if(b.isWebGLMultisampleRenderTarget)if(P){var c=d.get(b);a.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),a.bindFramebuffer(36009,c.__webglFramebuffer);var e=b.width,f=b.height,g=16384;b.depthBuffer&&(g|=256),b.stencilBuffer&&(g|=1024),a.blitFramebuffer(0,0,e,f,0,0,e,f,g,9728),a.bindFramebuffer(36160,c.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function K(a){return P&&a.isWebGLMultisampleRenderTarget?Math.min(T,a.samples):0}function L(a){var b=g.render.frame;U.get(a)!==b&&(U.set(a,b),a.update())}function M(a,b){a&&a.isWebGLRenderTarget&&(!1===Z&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Z=!0),a=a.texture),v(a,b)}function N(a,b){a&&a.isWebGLCubeRenderTarget&&(!1===$&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),$=!0),a=a.texture),a&&a.isCubeTexture||Array.isArray(a.image)&&6===a.image.length?y(a,b):z(a,b)}var O,P=e.isWebGL2,Q=e.maxTextures,R=e.maxCubemapSize,S=e.maxTextureSize,T=e.maxSamples,U=new WeakMap,V=!1;try{V="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(a){}var W=0,X={};X[hi]=10497,X[ii]=33071,X[ji]=33648;var Y={};Y[ki]=9728,Y[li]=9984,Y[ni]=9986,Y[pi]=9729,Y[qi]=9985,Y[si]=9987;var Z=!1,$=!1;this.allocateTextureUnit=u,this.resetTextureUnits=t,this.setTexture2D=v,this.setTexture2DArray=w,this.setTexture3D=x,this.setTextureCube=y,this.setTextureCubeDynamic=z,this.setupRenderTarget=H,this.updateRenderTargetMipmap=I,this.updateMultisampleRenderTarget=J,this.safeSetTexture2D=M,this.safeSetTextureCube=N}function Wb(a,b,c){function d(a){var c;if(a===ui)return 5121;if(a===Ci)return 32819;if(a===Di)return 32820;if(a===Ei)return 33635;if(a===vi)return 5120;if(a===wi)return 5122;if(a===xi)return 5123;if(a===yi)return 5124;if(a===zi)return 5125;if(a===Ai)return 5126;if(a===Bi)return e?5131:(c=b.get("OES_texture_half_float"),null!==c?c.HALF_FLOAT_OES:null);if(a===Gi)return 6406;if(a===Hi)return 6407;if(a===Ii)return 6408;if(a===Ji)return 6409;if(a===Ki)return 6410;if(a===Mi)return 6402;if(a===Ni)return 34041;if(a===Oi)return 6403;if(a===Pi)return 36244;if(a===Qi)return 33319;if(a===Ri)return 33320;if(a===Si)return 36248;if(a===Ti)return 36249;if(a===Ui||a===Vi||a===Wi||a===Xi){if(null===(c=b.get("WEBGL_compressed_texture_s3tc")))return null;if(a===Ui)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===Vi)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===Wi)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===Xi)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(a===Yi||a===Zi||a===$i||a===_i){if(null===(c=b.get("WEBGL_compressed_texture_pvrtc")))return null;if(a===Yi)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===Zi)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===$i)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===_i)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(a===aj)return c=b.get("WEBGL_compressed_texture_etc1"),null!==c?c.COMPRESSED_RGB_ETC1_WEBGL:null;if((a===bj||a===cj)&&null!==(c=b.get("WEBGL_compressed_texture_etc"))){if(a===bj)return c.COMPRESSED_RGB8_ETC2;if(a===cj)return c.COMPRESSED_RGBA8_ETC2_EAC}return a===dj||a===ej||a===fj||a===gj||a===hj||a===ij||a===jj||a===kj||a===lj||a===mj||a===nj||a===oj||a===pj||a===qj||a===sj||a===tj||a===uj||a===vj||a===wj||a===xj||a===yj||a===zj||a===Aj||a===Bj||a===Cj||a===Dj||a===Ej||a===Fj?(c=b.get("WEBGL_compressed_texture_astc"),null!==c?a:null):a===rj?(c=b.get("EXT_texture_compression_bptc"),null!==c?a:null):a===Fi?e?34042:(c=b.get("WEBGL_depth_texture"),null!==c?c.UNSIGNED_INT_24_8_WEBGL:null):void 0}var e=c.isWebGL2;return{convert:d}}function Xb(a){X.call(this),this.cameras=a||[]}function Yb(){n.call(this),this.type="Group"}function Zb(){this._targetRay=null,this._grip=null}function $b(a,b){function c(a){var b=s.get(a.inputSource);b&&b.dispatchEvent({type:a.type})}function d(){s.forEach(function(a,b){a.disconnect(b)}),s.clear(),a.setFramebuffer(null),a.setRenderTarget(a.getRenderTarget()),C.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function e(a){o=a,C.setContext(m),C.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}function g(a){for(var b=m.inputSources,c=0;c<r.length;c++)s.set(b[c],r[c]);for(var d=0;d<a.removed.length;d++){var e=a.removed[d],f=s.get(e);f&&(f.dispatchEvent({type:"disconnected",data:e}),s.delete(e))}for(var g=0;g<a.added.length;g++){var h=a.added[g],i=s.get(h);i&&i.dispatchEvent({type:"connected",data:h})}}function h(a,b,c){z.setFromMatrixPosition(b.matrixWorld),A.setFromMatrixPosition(c.matrixWorld);var d=z.distanceTo(A),e=b.projectionMatrix.elements,f=c.projectionMatrix.elements,g=e[14]/(e[10]-1),h=e[14]/(e[10]+1),i=(e[9]+1)/e[5],j=(e[9]-1)/e[5],k=(e[8]-1)/e[0],l=(f[8]+1)/f[0],m=g*k,n=g*l,o=d/(-k+l),p=o*-k;b.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.translateX(p),a.translateZ(o),a.matrixWorld.compose(a.position,a.quaternion,a.scale),a.matrixWorldInverse.getInverse(a.matrixWorld);var q=g+o,r=h+o,s=m-p,t=n+(d-p),u=i*h/r*q,v=j*h/r*q;a.projectionMatrix.makePerspective(s,t,u,v,q,r)}function i(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix),a.matrixWorldInverse.getInverse(a.matrixWorld)}function k(b,c){if(null!==(q=c.getViewerPose(o))){var d=q.views,e=m.renderState.baseLayer;a.setFramebuffer(e.framebuffer);var f=!1;d.length!==w.cameras.length&&(w.cameras.length=0,f=!0);for(var g=0;g<d.length;g++){var h=d[g],i=e.getViewport(h),j=v[g];j.matrix.fromArray(h.transform.matrix),j.projectionMatrix.fromArray(h.projectionMatrix),j.viewport.set(i.x,i.y,i.width,i.height),0===g&&w.matrix.copy(j.matrix),!0===f&&w.cameras.push(j)}}for(var k=m.inputSources,l=0;l<r.length;l++){var n=r[l],p=k[l];n.update(p,c,o)}B&&B(b,c)}var l=this,m=null,n=1,o=null,p="local-floor",q=null,r=[],s=new Map,t=new X;t.layers.enable(1),t.viewport=new f;var u=new X;u.layers.enable(2),u.viewport=new f;var v=[t,u],w=new Xb;w.layers.enable(1),w.layers.enable(2);var x=null,y=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(a){var b=r[a];return void 0===b&&(b=new Zb,r[a]=b),b.getTargetRaySpace()},this.getControllerGrip=function(a){var b=r[a];return void 0===b&&(b=new Zb,r[a]=b),b.getGripSpace()},this.setFramebufferScaleFactor=function(a){n=a,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(a){p=a,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return m},this.setSession=function(a){if(null!==(m=a)){m.addEventListener("select",c),m.addEventListener("selectstart",c),m.addEventListener("selectend",c),m.addEventListener("squeeze",c),m.addEventListener("squeezestart",c),m.addEventListener("squeezeend",c),m.addEventListener("end",d);var f=b.getContextAttributes();!0!==f.xrCompatible&&b.makeXRCompatible();var h={antialias:f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n},i=new XRWebGLLayer(m,b,h);m.updateRenderState({baseLayer:i}),m.requestReferenceSpace(p).then(e),m.addEventListener("inputsourceschange",g)}};var z=new j,A=new j;this.getCamera=function(a){w.near=u.near=t.near=a.near,w.far=u.far=t.far=a.far,x===w.near&&y===w.far||(m.updateRenderState({depthNear:w.near,depthFar:w.far}),x=w.near,y=w.far);var b=a.parent,c=w.cameras;i(w,b);for(var d=0;d<c.length;d++)i(c[d],b);a.matrixWorld.copy(w.matrixWorld);for(var e=a.children,f=0,g=e.length;f<g;f++)e[f].updateMatrixWorld(!0);return 2===c.length?h(w,t,u):w.projectionMatrix.copy(t.projectionMatrix),w};var B=null,C=new aa;C.setAnimationLoop(k),this.setAnimationLoop=function(a){B=a},this.dispose=function(){}}function _b(a){function b(a,b){a.fogColor.value.copy(b.color),b.isFog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b.isFogExp2&&(a.fogDensity.value=b.density)}function c(a,b,c,r,s){b.isMeshBasicMaterial?d(a,b):b.isMeshLambertMaterial?(d(a,b),i(a,b)):b.isMeshToonMaterial?(d(a,b),k(a,b)):b.isMeshPhongMaterial?(d(a,b),j(a,b)):b.isMeshStandardMaterial?(d(a,b,c),b.isMeshPhysicalMaterial?m(a,b,c):l(a,b,c)):b.isMeshMatcapMaterial?(d(a,b),n(a,b)):b.isMeshDepthMaterial?(d(a,b),o(a,b)):b.isMeshDistanceMaterial?(d(a,b),p(a,b)):b.isMeshNormalMaterial?(d(a,b),q(a,b)):b.isLineBasicMaterial?(e(a,b),b.isLineDashedMaterial&&f(a,b)):b.isPointsMaterial?g(a,b,r,s):b.isSpriteMaterial?h(a,b):b.isShadowMaterial?(a.color.value.copy(b.color),a.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function d(b,c,d){b.opacity.value=c.opacity,c.color&&b.diffuse.value.copy(c.color),c.emissive&&b.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity),c.map&&(b.map.value=c.map),c.alphaMap&&(b.alphaMap.value=c.alphaMap),c.specularMap&&(b.specularMap.value=c.specularMap);var e=c.envMap||d;e&&(b.envMap.value=e,b.flipEnvMap.value=e.isCubeTexture?-1:1,b.reflectivity.value=c.reflectivity,b.refractionRatio.value=c.refractionRatio,b.maxMipLevel.value=a.get(e).__maxMipLevel),c.lightMap&&(b.lightMap.value=c.lightMap,b.lightMapIntensity.value=c.lightMapIntensity),c.aoMap&&(b.aoMap.value=c.aoMap,b.aoMapIntensity.value=c.aoMapIntensity);var f;c.map?f=c.map:c.specularMap?f=c.specularMap:c.displacementMap?f=c.displacementMap:c.normalMap?f=c.normalMap:c.bumpMap?f=c.bumpMap:c.roughnessMap?f=c.roughnessMap:c.metalnessMap?f=c.metalnessMap:c.alphaMap?f=c.alphaMap:c.emissiveMap&&(f=c.emissiveMap),void 0!==f&&(f.isWebGLRenderTarget&&(f=f.texture),!0===f.matrixAutoUpdate&&f.updateMatrix(),b.uvTransform.value.copy(f.matrix));var g;c.aoMap?g=c.aoMap:c.lightMap&&(g=c.lightMap),void 0!==g&&(g.isWebGLRenderTarget&&(g=g.texture),!0===g.matrixAutoUpdate&&g.updateMatrix(),b.uv2Transform.value.copy(g.matrix))}function e(a,b){a.diffuse.value.copy(b.color),a.opacity.value=b.opacity}function f(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function g(a,b,c,d){a.diffuse.value.copy(b.color),a.opacity.value=b.opacity,a.size.value=b.size*c,a.scale.value=.5*d,b.map&&(a.map.value=b.map),b.alphaMap&&(a.alphaMap.value=b.alphaMap);var e;b.map?e=b.map:b.alphaMap&&(e=b.alphaMap),void 0!==e&&(!0===e.matrixAutoUpdate&&e.updateMatrix(),a.uvTransform.value.copy(e.matrix))}function h(a,b){a.diffuse.value.copy(b.color),a.opacity.value=b.opacity,a.rotation.value=b.rotation,b.map&&(a.map.value=b.map),b.alphaMap&&(a.alphaMap.value=b.alphaMap);var c;b.map?c=b.map:b.alphaMap&&(c=b.alphaMap),void 0!==c&&(!0===c.matrixAutoUpdate&&c.updateMatrix(),a.uvTransform.value.copy(c.matrix))}function i(a,b){b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap)}function j(a,b){a.specular.value.copy(b.specular),a.shininess.value=Math.max(b.shininess,1e-4),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,b.side===lh&&(a.bumpScale.value*=-1)),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),b.side===lh&&a.normalScale.value.negate()),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function k(a,b){b.gradientMap&&(a.gradientMap.value=b.gradientMap),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,b.side===lh&&(a.bumpScale.value*=-1)),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),b.side===lh&&a.normalScale.value.negate()),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function l(a,b,c){a.roughness.value=b.roughness,a.metalness.value=b.metalness,b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap),b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,b.side===lh&&(a.bumpScale.value*=-1)),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),b.side===lh&&a.normalScale.value.negate()),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias),(b.envMap||c)&&(a.envMapIntensity.value=b.envMapIntensity)}function m(a,b,c){l(a,b,c),a.reflectivity.value=b.reflectivity,a.clearcoat.value=b.clearcoat,a.clearcoatRoughness.value=b.clearcoatRoughness,b.sheen&&a.sheen.value.copy(b.sheen),b.clearcoatMap&&(a.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(a.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),a.clearcoatNormalMap.value=b.clearcoatNormalMap,b.side===lh&&a.clearcoatNormalScale.value.negate()),a.transparency.value=b.transparency}function n(a,b){b.matcap&&(a.matcap.value=b.matcap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,b.side===lh&&(a.bumpScale.value*=-1)),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),b.side===lh&&a.normalScale.value.negate()),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function o(a,b){b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function p(a,b){b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias),a.referencePosition.value.copy(b.referencePosition),a.nearDistance.value=b.nearDistance,a.farDistance.value=b.farDistance}function q(a,b){b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,b.side===lh&&(a.bumpScale.value*=-1)),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),b.side===lh&&a.normalScale.value.negate()),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}return{refreshFogUniforms:b,refreshMaterialUniforms:c}}function ac(a){function b(){return null===N?X:1}function d(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=w.getContext(d,b);if(null!==e)return e}return null}function e(){Aa=new ja(xa),Ba=new ha(xa,Aa,a),!1===Ba.isWebGL2&&(Aa.get("WEBGL_depth_texture"),Aa.get("OES_texture_float"),Aa.get("OES_texture_half_float"),Aa.get("OES_texture_half_float_linear"),Aa.get("OES_standard_derivatives"),Aa.get("OES_element_index_uint"),Aa.get("OES_vertex_array_object"),Aa.get("ANGLE_instanced_arrays")),Aa.get("OES_texture_float_linear"),Ra=new Wb(xa,Aa,Ba),Ca=new Ub(xa,Aa,Ba),Ca.scissor(T.copy(da).multiplyScalar(X).floor()),Ca.viewport(S.copy(ca).multiplyScalar(X).floor()),Da=new ma(xa),Ea=new Gb,Fa=new Vb(xa,Aa,Ca,Ea,Ba,Ra,Da),Ga=new ba(xa,Ba),Sa=new fa(xa,Aa,Ga,Ba),Ha=new ka(xa,Ga,Da,Sa),Ia=new qa(xa,Ha,Ga,Da),Oa=new pa(xa),Ja=new Fb(I,Aa,Ba,Sa),Ka=new _b(Ea),La=new Kb,Ma=new Qb,Na=new ea(I,Ca,Ia,C),Pa=new ga(xa,Aa,Da,Ba),Qa=new la(xa,Aa,Da,Ba),Da.programs=Ja.programs,I.capabilities=Ba,I.extensions=Aa,I.properties=Ea,I.renderLists=La,I.state=Ca,I.info=Da}function g(a){a.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),J=!0}function h(){console.log("THREE.WebGLRenderer: Context Restored."),J=!1,e()}function i(a){var b=a.target;b.removeEventListener("dispose",i),l(b)}function l(a){m(a),Ea.remove(a)}function m(a){var b=Ea.get(a).program;a.program=void 0,void 0!==b&&Ja.releaseProgram(b)}function n(a,b){a.render(function(a){I.renderBufferImmediate(a,b)})}function o(a){Ta.isPresenting||Va&&Va(a)}function p(a,b,c,d){if(!1!==a.visible){if(a.layers.test(b.layers))if(a.isGroup)c=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(b);else if(a.isLight)H.pushLight(a),a.castShadow&&H.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||oa.intersectsSprite(a)){d&&va.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ua);var e=Ia.update(a),f=a.material;f.visible&&G.push(a,e,f,c,va.z,null)}}else if(a.isImmediateRenderObject)d&&va.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ua),G.push(a,null,a.material,c,va.z,null);else if((a.isMesh||a.isLine||a.isPoints)&&(a.isSkinnedMesh&&a.skeleton.frame!==Da.render.frame&&(a.skeleton.update(),a.skeleton.frame=Da.render.frame),!a.frustumCulled||oa.intersectsObject(a))){d&&va.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ua);var g=Ia.update(a),h=a.material;if(Array.isArray(h))for(var i=g.groups,j=0,k=i.length;j<k;j++){var l=i[j],m=h[l.materialIndex];m&&m.visible&&G.push(a,g,m,c,va.z,l)}else h.visible&&G.push(a,g,h,c,va.z,null)}for(var n=a.children,o=0,q=n.length;o<q;o++)p(n[o],b,c,d)}}function q(a,b,c){for(var d=!0===b.isScene?b.overrideMaterial:null,e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,i=g.geometry,j=null===d?g.material:d,k=g.group;if(c.isArrayCamera){R=c;for(var l=c.cameras,m=0,n=l.length;m<n;m++){var o=l[m];h.layers.test(o.layers)&&(Ca.viewport(S.copy(o.viewport)),H.setupLights(o),r(h,b,o,i,j,k))}}else R=null,r(h,b,c,i,j,k)}}function r(a,b,c,d,e,f){if(a.onBeforeRender(I,b,c,d,e,f),H=Ma.get(b,R||c),a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix),a.isImmediateRenderObject){var g=t(c,b,e,a);Ca.setMaterial(e),Sa.reset(),n(a,g)}else I.renderBufferDirect(c,b,d,e,a,f);a.onAfterRender(I,b,c,d,e,f),H=Ma.get(b,R||c)}function s(a,b,c){!0!==b.isScene&&(b=wa);var d=Ea.get(a),e=H.state.lights,f=H.state.shadowsArray,g=e.state.version,h=Ja.getParameters(a,e.state,f,b,ra.numPlanes,ra.numIntersection,c),j=Ja.getProgramCacheKey(h),k=d.program,l=!0;if(void 0===k)a.addEventListener("dispose",i);else if(k.cacheKey!==j)m(a);else if(d.lightsStateVersion!==g)d.lightsStateVersion=g,l=!1;else{if(void 0!==h.shaderID)return;l=!1}l&&(k=Ja.acquireProgram(h,j),d.program=k,d.uniforms=h.uniforms,d.outputEncoding=h.outputEncoding,a.program=k);var n=k.getAttributes();if(a.morphTargets){a.numSupportedMorphTargets=0;for(var o=0;o<I.maxMorphTargets;o++)n["morphTarget"+o]>=0&&a.numSupportedMorphTargets++}if(a.morphNormals){a.numSupportedMorphNormals=0;for(var p=0;p<I.maxMorphNormals;p++)n["morphNormal"+p]>=0&&a.numSupportedMorphNormals++}var q=d.uniforms;(a.isShaderMaterial||a.isRawShaderMaterial)&&!0!==a.clipping||(d.numClippingPlanes=ra.numPlanes,d.numIntersection=ra.numIntersection,q.clippingPlanes=ra.uniform),d.environment=a.isMeshStandardMaterial?b.environment:null,d.fog=b.fog,d.needsLights=v(a),d.lightsStateVersion=g,d.needsLights&&(q.ambientLightColor.value=e.state.ambient,q.lightProbe.value=e.state.probe,q.directionalLights.value=e.state.directional,q.directionalLightShadows.value=e.state.directionalShadow,q.spotLights.value=e.state.spot,q.spotLightShadows.value=e.state.spotShadow,q.rectAreaLights.value=e.state.rectArea,q.pointLights.value=e.state.point,q.pointLightShadows.value=e.state.pointShadow,q.hemisphereLights.value=e.state.hemi,q.directionalShadowMap.value=e.state.directionalShadowMap,q.directionalShadowMatrix.value=e.state.directionalShadowMatrix,q.spotShadowMap.value=e.state.spotShadowMap,q.spotShadowMatrix.value=e.state.spotShadowMatrix,q.pointShadowMap.value=e.state.pointShadowMap,q.pointShadowMatrix.value=e.state.pointShadowMatrix);var r=d.program.getUniforms(),s=gb.seqWithValue(r.seq,q);d.uniformsList=s}function t(a,b,c,d){!0!==b.isScene&&(b=wa),Fa.resetTextureUnits();var e=b.fog,f=c.isMeshStandardMaterial?b.environment:null,g=null===N?I.outputEncoding:N.texture.encoding,h=Ea.get(c),i=H.state.lights;if(!0===sa&&(!0===ta||a!==Q)){var j=a===Q&&c.id===P;ra.setState(c.clippingPlanes,c.clipIntersection,c.clipShadows,a,h,j)}c.version===h.__version?void 0===h.program?s(c,b,d):c.fog&&h.fog!==e?s(c,b,d):h.environment!==f?s(c,b,d):h.needsLights&&h.lightsStateVersion!==i.state.version?s(c,b,d):void 0===h.numClippingPlanes||h.numClippingPlanes===ra.numPlanes&&h.numIntersection===ra.numIntersection?h.outputEncoding!==g&&s(c,b,d):s(c,b,d):(s(c,b,d),h.__version=c.version);var k=!1,l=!1,m=!1,n=h.program,o=n.getUniforms(),p=h.uniforms;if(Ca.useProgram(n.program)&&(k=!0,l=!0,m=!0),c.id!==P&&(P=c.id,l=!0),k||Q!==a){if(o.setValue(xa,"projectionMatrix",a.projectionMatrix),Ba.logarithmicDepthBuffer&&o.setValue(xa,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2)),Q!==a&&(Q=a,l=!0,m=!0),c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshStandardMaterial||c.envMap){var q=o.map.cameraPosition;void 0!==q&&q.setValue(xa,va.setFromMatrixPosition(a.matrixWorld))}(c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial)&&o.setValue(xa,"isOrthographic",!0===a.isOrthographicCamera),(c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial||c.isShadowMaterial||c.skinning)&&o.setValue(xa,"viewMatrix",a.matrixWorldInverse)}if(c.skinning){o.setOptional(xa,d,"bindMatrix"),o.setOptional(xa,d,"bindMatrixInverse");var r=d.skeleton;if(r){var t=r.bones;if(Ba.floatVertexTextures){if(void 0===r.boneTexture){var v=Math.sqrt(4*t.length);v=Fk.ceilPowerOfTwo(v),v=Math.max(v,4);var w=new Float32Array(v*v*4);w.set(r.boneMatrices);var x=new $(w,v,v,Ii,Ai);r.boneMatrices=w,r.boneTexture=x,r.boneTextureSize=v}o.setValue(xa,"boneTexture",r.boneTexture,Fa),o.setValue(xa,"boneTextureSize",r.boneTextureSize)}else o.setOptional(xa,r,"boneMatrices")}}return(l||h.receiveShadow!==d.receiveShadow)&&(h.receiveShadow=d.receiveShadow,o.setValue(xa,"receiveShadow",d.receiveShadow)),l&&(o.setValue(xa,"toneMappingExposure",I.toneMappingExposure),h.needsLights&&u(p,m),e&&c.fog&&Ka.refreshFogUniforms(p,e),Ka.refreshMaterialUniforms(p,c,f,X,W),void 0!==p.ltc_1&&(p.ltc_1.value=Cm.LTC_1),void 0!==p.ltc_2&&(p.ltc_2.value=Cm.LTC_2),gb.upload(xa,h.uniformsList,p,Fa)),c.isShaderMaterial&&!0===c.uniformsNeedUpdate&&(gb.upload(xa,h.uniformsList,p,Fa),c.uniformsNeedUpdate=!1),c.isSpriteMaterial&&o.setValue(xa,"center",d.center),o.setValue(xa,"modelViewMatrix",d.modelViewMatrix),o.setValue(xa,"normalMatrix",d.normalMatrix),o.setValue(xa,"modelMatrix",d.matrixWorld),n}function u(a,b){a.ambientLightColor.needsUpdate=b,a.lightProbe.needsUpdate=b,a.directionalLights.needsUpdate=b,a.directionalLightShadows.needsUpdate=b,a.pointLights.needsUpdate=b,a.pointLightShadows.needsUpdate=b,a.spotLights.needsUpdate=b,a.spotLightShadows.needsUpdate=b,a.rectAreaLights.needsUpdate=b,a.hemisphereLights.needsUpdate=b}function v(a){return a.isMeshLambertMaterial||a.isMeshToonMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.isShadowMaterial||a.isShaderMaterial&&!0===a.lights}a=a||{};var w=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),x=void 0!==a.context?a.context:null,y=void 0!==a.alpha&&a.alpha,z=void 0===a.depth||a.depth,A=void 0===a.stencil||a.stencil,B=void 0!==a.antialias&&a.antialias,C=void 0===a.premultipliedAlpha||a.premultipliedAlpha,D=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,E=void 0!==a.powerPreference?a.powerPreference:"default",F=void 0!==a.failIfMajorPerformanceCaveat&&a.failIfMajorPerformanceCaveat,G=null,H=null;this.domElement=w,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Uj,this.physicallyCorrectLights=!1,this.toneMapping=Wh,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I=this,J=!1,K=null,L=0,M=0,N=null,O=null,P=-1,Q=null,R=null,S=new f,T=new f,U=null,V=w.width,W=w.height,X=1,Y=null,Z=null,ca=new f(0,0,V,W),da=new f(0,0,V,W),na=!1,oa=new _,ra=new ia,sa=!1,ta=!1,ua=new k,va=new j,wa={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},xa=x;try{var ya={alpha:y,depth:z,stencil:A,antialias:B,premultipliedAlpha:C,preserveDrawingBuffer:D,powerPreference:E,failIfMajorPerformanceCaveat:F};if(w.addEventListener("webglcontextlost",g,!1),w.addEventListener("webglcontextrestored",h,!1),null===xa){var za=["webgl2","webgl","experimental-webgl"];if(!0===I.isWebGL1Renderer&&za.shift(),null===(xa=d(za,ya)))throw d(za)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===xa.getShaderPrecisionFormat&&(xa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(a){throw console.error("THREE.WebGLRenderer: "+a.message),a}var Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa;e();var Ta=new $b(I,xa);this.xr=Ta;var Ua=new Tb(I,Ia,Ba.maxTextureSize);this.shadowMap=Ua,this.getContext=function(){return xa},this.getContextAttributes=function(){return xa.getContextAttributes()},this.forceContextLoss=function(){var a=Aa.get("WEBGL_lose_context");a&&a.loseContext()},this.forceContextRestore=function(){var a=Aa.get("WEBGL_lose_context");a&&a.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(a){void 0!==a&&(X=a,this.setSize(V,W,!1))},this.getSize=function(a){return void 0===a&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),a=new c),a.set(V,W)},this.setSize=function(a,b,c){if(Ta.isPresenting)return void console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");V=a,W=b,w.width=Math.floor(a*X),w.height=Math.floor(b*X),!1!==c&&(w.style.width=a+"px",w.style.height=b+"px"),this.setViewport(0,0,a,b)},this.getDrawingBufferSize=function(a){return void 0===a&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),a=new c),a.set(V*X,W*X).floor()},this.setDrawingBufferSize=function(a,b,c){V=a,W=b,X=c,w.width=Math.floor(a*c),w.height=Math.floor(b*c),this.setViewport(0,0,a,b)},this.getCurrentViewport=function(a){return void 0===a&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),a=new f),a.copy(S)},this.getViewport=function(a){return a.copy(ca)},this.setViewport=function(a,b,c,d){a.isVector4?ca.set(a.x,a.y,a.z,a.w):ca.set(a,b,c,d),Ca.viewport(S.copy(ca).multiplyScalar(X).floor())},this.getScissor=function(a){return a.copy(da)},this.setScissor=function(a,b,c,d){a.isVector4?da.set(a.x,a.y,a.z,a.w):da.set(a,b,c,d),Ca.scissor(T.copy(da).multiplyScalar(X).floor())},this.getScissorTest=function(){return na},this.setScissorTest=function(a){Ca.setScissorTest(na=a)},this.setOpaqueSort=function(a){Y=a},this.setTransparentSort=function(a){Z=a},this.getClearColor=function(){return Na.getClearColor()},this.setClearColor=function(){Na.setClearColor.apply(Na,arguments)},this.getClearAlpha=function(){return Na.getClearAlpha()},this.setClearAlpha=function(){Na.setClearAlpha.apply(Na,arguments)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=16384),(void 0===b||b)&&(d|=256),(void 0===c||c)&&(d|=1024),xa.clear(d)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){w.removeEventListener("webglcontextlost",g,!1),w.removeEventListener("webglcontextrestored",h,!1),La.dispose(),Ma.dispose(),Ea.dispose(),Ia.dispose(),Sa.dispose(),Ta.dispose(),Wa.stop()},this.renderBufferImmediate=function(a,b){Sa.initAttributes();var c=Ea.get(a);a.hasPositions&&!c.position&&(c.position=xa.createBuffer()),a.hasNormals&&!c.normal&&(c.normal=xa.createBuffer()),a.hasUvs&&!c.uv&&(c.uv=xa.createBuffer()),a.hasColors&&!c.color&&(c.color=xa.createBuffer());var d=b.getAttributes();a.hasPositions&&(xa.bindBuffer(34962,c.position),xa.bufferData(34962,a.positionArray,35048),Sa.enableAttribute(d.position),xa.vertexAttribPointer(d.position,3,5126,!1,0,0)),a.hasNormals&&(xa.bindBuffer(34962,c.normal),xa.bufferData(34962,a.normalArray,35048),Sa.enableAttribute(d.normal),xa.vertexAttribPointer(d.normal,3,5126,!1,0,0)),a.hasUvs&&(xa.bindBuffer(34962,c.uv),xa.bufferData(34962,a.uvArray,35048),Sa.enableAttribute(d.uv),xa.vertexAttribPointer(d.uv,2,5126,!1,0,0)),a.hasColors&&(xa.bindBuffer(34962,c.color),xa.bufferData(34962,a.colorArray,35048),Sa.enableAttribute(d.color),xa.vertexAttribPointer(d.color,3,5126,!1,0,0)),Sa.disableUnusedAttributes(),xa.drawArrays(4,0,a.count),a.count=0},this.renderBufferDirect=function(a,c,d,e,f,g){null===c&&(c=wa);var h=f.isMesh&&f.matrixWorld.determinant()<0,i=t(a,c,e,f);Ca.setMaterial(e,h);var j=d.index;if(!d.attributes)return void console.warn("------------------\n attributes is null: ",d,"\n------------------");var k=d.attributes.position;if(null===j){if(void 0===k||0===k.count)return}else if(0===j.count)return;var l=1;!0===e.wireframe&&(j=Ha.getWireframeAttribute(d),l=2),(e.morphTargets||e.morphNormals)&&Oa.update(f,d,e,i),Sa.setup(f,e,i,d,j);var m,n=Pa;null!==j&&(m=Ga.get(j),n=Qa,n.setIndex(m));var o=null!==j?j.count:k.count,p=d.drawRange.start*l,q=d.drawRange.count*l,r=null!==g?g.start*l:0,s=null!==g?g.count*l:1/0,u=Math.max(p,r),v=Math.min(o,p+q,r+s)-1,w=Math.max(0,v-u+1);if(0!==w){if(f.isMesh)!0===e.wireframe?(Ca.setLineWidth(e.wireframeLinewidth*b()),n.setMode(1)):n.setMode(4);else if(f.isLine){var x=e.linewidth;void 0===x&&(x=1),Ca.setLineWidth(x*b()),f.isLineSegments?n.setMode(1):f.isLineLoop?n.setMode(2):n.setMode(3)}else f.isPoints?n.setMode(0):f.isSprite&&n.setMode(4);if(f.isInstancedMesh)n.renderInstances(d,u,w,f.count);else if(d.isInstancedBufferGeometry){var y=Math.min(d.instanceCount,d._maxInstanceCount);n.renderInstances(d,u,w,y)}else n.render(u,w)}},this.compile=function(a,b){H=Ma.get(a,b),H.init(),a.traverse(function(a){a.isLight&&(H.pushLight(a),a.castShadow&&H.pushShadow(a))}),H.setupLights(b);var c=new WeakMap;a.traverse(function(b){var d=b.material;if(d)if(Array.isArray(d))for(var e=0;e<d.length;e++){var f=d[e];!1===c.has(f)&&(s(f,a,b),c.set(f))}else!1===c.has(d)&&(s(d,a,b),c.set(d))})};var Va=null,Wa=new aa;Wa.setAnimationLoop(o),"undefined"!=typeof window&&Wa.setContext(window),this.setAnimationLoop=function(a){Va=a,Ta.setAnimationLoop(a),null===a?Wa.stop():Wa.start()},this.render=function(a,b){var c,d;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),c=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),d=arguments[3]),void 0!==b&&!0!==b.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0!==J){Sa.resetDefaultState(),P=-1,Q=null,!0===a.autoUpdate&&a.updateMatrixWorld(),null===b.parent&&b.updateMatrixWorld(),!0===Ta.enabled&&!0===Ta.isPresenting&&(b=Ta.getCamera(b)),!0===a.isScene&&a.onBeforeRender(I,a,b,c||N),H=Ma.get(a,b),H.init(),ua.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),oa.setFromProjectionMatrix(ua),ta=this.localClippingEnabled,sa=ra.init(this.clippingPlanes,ta,b),G=La.get(a,b),G.init(),p(a,b,0,I.sortObjects),G.finish(),!0===I.sortObjects&&G.sort(Y,Z),!0===sa&&ra.beginShadows();var e=H.state.shadowsArray;Ua.render(e,a,b),H.setupLights(b),!0===sa&&ra.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==c&&this.setRenderTarget(c),Na.render(G,a,b,d);var f=G.opaque,g=G.transparent;f.length>0&&q(f,a,b),g.length>0&&q(g,a,b),!0===a.isScene&&a.onAfterRender(I,a,b),null!==N&&(Fa.updateRenderTargetMipmap(N),Fa.updateMultisampleRenderTarget(N)),Ca.buffers.depth.setTest(!0),Ca.buffers.depth.setMask(!0),Ca.buffers.color.setMask(!0),Ca.setPolygonOffset(!1),G=null,H=null}},this.setFramebuffer=function(a){K!==a&&null===N&&xa.bindFramebuffer(36160,a),K=a},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return N},this.setRenderTarget=function(a,b,c){N=a,L=b,M=c,a&&void 0===Ea.get(a).__webglFramebuffer&&Fa.setupRenderTarget(a);var d=K,e=!1;if(a){var f=Ea.get(a).__webglFramebuffer;a.isWebGLCubeRenderTarget?(d=f[b||0],e=!0):d=a.isWebGLMultisampleRenderTarget?Ea.get(a).__webglMultisampledFramebuffer:f,S.copy(a.viewport),T.copy(a.scissor),U=a.scissorTest}else S.copy(ca).multiplyScalar(X).floor(),T.copy(da).multiplyScalar(X).floor(),U=na;if(O!==d&&(xa.bindFramebuffer(36160,d),O=d),Ca.viewport(S),Ca.scissor(T),Ca.setScissorTest(U),e){var g=Ea.get(a.texture);xa.framebufferTexture2D(36160,36064,34069+(b||0),g.__webglTexture,c||0)}},this.readRenderTargetPixels=function(a,b,c,d,e,f,g){if(!a||!a.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var h=Ea.get(a).__webglFramebuffer;if(a.isWebGLCubeRenderTarget&&void 0!==g&&(h=h[g]),h){var i=!1;h!==O&&(xa.bindFramebuffer(36160,h),i=!0);try{var j=a.texture,k=j.format,l=j.type;if(k!==Ii&&Ra.convert(k)!==xa.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===ui||Ra.convert(l)===xa.getParameter(35738)||l===Ai&&(Ba.isWebGL2||Aa.get("OES_texture_float")||Aa.get("WEBGL_color_buffer_float"))||l===Bi&&(Ba.isWebGL2?Aa.get("EXT_color_buffer_float"):Aa.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===xa.checkFramebufferStatus(36160)?b>=0&&b<=a.width-d&&c>=0&&c<=a.height-e&&xa.readPixels(b,c,d,e,Ra.convert(k),Ra.convert(l),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{i&&xa.bindFramebuffer(36160,O)}}},this.copyFramebufferToTexture=function(a,b,c){void 0===c&&(c=0);var d=Math.pow(2,-c),e=Math.floor(b.image.width*d),f=Math.floor(b.image.height*d),g=Ra.convert(b.format);Fa.setTexture2D(b,0),xa.copyTexImage2D(3553,c,g,a.x,a.y,e,f,0),Ca.unbindTexture()},this.copyTextureToTexture=function(a,b,c,d){void 0===d&&(d=0);var e=b.image.width,f=b.image.height,g=Ra.convert(c.format),h=Ra.convert(c.type);Fa.setTexture2D(c,0),xa.pixelStorei(37440,c.flipY),xa.pixelStorei(37441,c.premultiplyAlpha),xa.pixelStorei(3317,c.unpackAlignment),b.isDataTexture?xa.texSubImage2D(3553,d,a.x,a.y,e,f,g,h,b.image.data):b.isCompressedTexture?xa.compressedTexSubImage2D(3553,d,a.x,a.y,b.mipmaps[0].width,b.mipmaps[0].height,g,b.mipmaps[0].data):xa.texSubImage2D(3553,d,a.x,a.y,g,h,b.image),0===d&&c.generateMipmaps&&xa.generateMipmap(3553),Ca.unbindTexture()},this.initTexture=function(a){Fa.setTexture2D(a,0),Ca.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function bc(a){ac.call(this,a)}function cc(a,b){this.name="",this.color=new v(a),this.density=void 0!==b?b:25e-5}function dc(a,b,c){this.name="",this.color=new v(a),this.near=void 0!==b?b:1,this.far=void 0!==c?c:1e3}function ec(a,b){this.array=a,this.stride=b,this.count=void 0!==a?a.length/b:0,this.usage=uk,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Fk.generateUUID()}function fc(a,b,c,d){this.name="",this.data=a,this.itemSize=b,this.offset=c,this.normalized=!0===d}function gc(a){A.call(this),this.type="SpriteMaterial",this.color=new v(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(a)}function hc(a){if(n.call(this),this.type="Sprite",void 0===qp){qp=new O;var b=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),d=new ec(b,5);qp.setIndex([0,1,2,0,2,3]),qp.setAttribute("position",new fc(d,3,0,!1)),qp.setAttribute("uv",new fc(d,2,3,!1))}this.geometry=qp,this.material=void 0!==a?a:new gc,this.center=new c(.5,.5),this.boundBox=new Float32Array(8)}function ic(a,b,d,e){var f=new c,g=.5*d,h=.5*e;return a.project(b),f.x=a.x*g+g,f.y=-a.y*h+h,{x:f.x,y:f.y}}function jc(a,b,c,d,e,f){up.subVectors(a,c).addScalar(.5).multiply(d),void 0!==e?(vp.x=f*up.x-e*up.y,vp.y=e*up.x+f*up.y):vp.copy(up),a.copy(b),a.x+=vp.x,a.y+=vp.y,a.applyMatrix4(wp)}function kc(){n.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function lc(a,b){a&&a.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),P.call(this,a,b),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new k,this.bindMatrixInverse=new k}function mc(a,b){if(a=a||[],this.bones=a.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var c=0,d=this.bones.length;c<d;c++)this.boneInverses.push(new k)}}function nc(){n.call(this),this.type="Bone"}function oc(a,b,c){P.call(this,a,b),this.instanceMatrix=new C(new Float32Array(16*c),16),this.instanceColor=null,this.count=c,this.frustumCulled=!1}function pc(a){A.call(this),this.type="LineBasicMaterial",this.color=new v(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(a)}function qc(a,b,c){1===c&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),n.call(this),this.type="Line",this.geometry=void 0!==a?a:new O,this.material=void 0!==b?b:new pc,this.updateMorphTargets()}function rc(a,b){qc.call(this,a,b),this.type="LineSegments"}function sc(a,b){qc.call(this,a,b),this.type="LineLoop"}function tc(a){A.call(this),this.type="PointsMaterial",this.color=new v(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(a)}function uc(a,b){n.call(this),this.type="Points",this.geometry=void 0!==a?a:new O,this.material=void 0!==b?b:new tc,this.updateMorphTargets()}function vc(a,b,c,d,e,f,g){var h=Up.distanceSqToPoint(a);if(h<c){var i=new j;Up.closestPointToPoint(a,i),i.applyMatrix4(d);var k=e.ray.origin.distanceTo(i);if(k<e.near||k>e.far)return;f.push({distance:k,distanceToRay:Math.sqrt(h),point:i,index:b,face:null,object:g})}}function wc(a,b,c,d,f,g,h,i,j){e.call(this,a,b,c,d,f,g,h,i,j),this.format=void 0!==h?h:Hi,this.minFilter=void 0!==g?g:pi,this.magFilter=void 0!==f?f:pi,this.generateMipmaps=!1}function xc(a,b,c,d,f,g,h,i,j,k,l,m){e.call(this,null,g,h,i,j,k,d,f,l,m),this.image={width:b,height:c},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1}function yc(a,b,c,d,f,g,h,i,j){e.call(this,a,b,c,d,f,g,h,i,j),this.needsUpdate=!0}function zc(a,b,c,d,f,g,h,i,j,k){if((k=void 0!==k?k:Mi)!==Mi&&k!==Ni)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&k===Mi&&(c=xi),void 0===c&&k===Ni&&(c=Fi),e.call(this,null,d,f,g,h,i,k,c,j),this.image={width:a,height:b},this.magFilter=void 0!==h?h:ki,this.minFilter=void 0!==i?i:ki,this.flipY=!1,this.generateMipmaps=!1}function Ac(a){O.call(this),this.type="WireframeGeometry";var b=[],c=[0,0],d={},e=["a","b","c"];if(a&&a.isGeometry){for(var f=a.faces,g=0,h=f.length;g<h;g++)for(var i=f[g],k=0;k<3;k++){var l=i[e[k]],m=i[e[(k+1)%3]];c[0]=Math.min(l,m),c[1]=Math.max(l,m);var n=c[0]+","+c[1];void 0===d[n]&&(d[n]={index1:c[0],index2:c[1]})}for(var o in d){var p=d[o],q=a.vertices[p.index1];b.push(q.x,q.y,q.z),q=a.vertices[p.index2],b.push(q.x,q.y,q.z)}}else if(a&&a.isBufferGeometry){var r=new j;if(null!==a.index){var s=a.attributes.position,t=a.index,u=a.groups;0===u.length&&(u=[{start:0,count:t.count,materialIndex:0}]);for(var v=0,w=u.length;v<w;++v)for(var x=u[v],y=x.start,z=x.count,A=y,B=y+z;A<B;A+=3)for(var C=0;C<3;C++){var D=t.getX(A+C),E=t.getX(A+(C+1)%3);c[0]=Math.min(D,E),c[1]=Math.max(D,E);var F=c[0]+","+c[1];void 0===d[F]&&(d[F]={index1:c[0],index2:c[1]})}for(var G in d){var H=d[G];r.fromBufferAttribute(s,H.index1),b.push(r.x,r.y,r.z),r.fromBufferAttribute(s,H.index2),b.push(r.x,r.y,r.z)}}else for(var I=a.attributes.position,J=0,L=I.count/3;J<L;J++)for(var M=0;M<3;M++){var N=3*J+M;r.fromBufferAttribute(I,N),b.push(r.x,r.y,r.z);var P=3*J+(M+1)%3;r.fromBufferAttribute(I,P),b.push(r.x,r.y,r.z)}}this.setAttribute("position",new K(b,3))}function Bc(a,b,c){S.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:b,stacks:c},this.fromBufferGeometry(new Cc(a,b,c)),this.mergeVertices()}function Cc(a,b,c){O.call(this),this.type="ParametricBufferGeometry",this.parameters={func:a,slices:b,stacks:c};var d=[],e=[],f=[],g=[],h=1e-5,i=new j,k=new j,l=new j,m=new j,n=new j;a.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var o=b+1,p=0;p<=c;p++)for(var q=p/c,r=0;r<=b;r++){var s=r/b;a(s,q,k),e.push(k.x,k.y,k.z),s-h>=0?(a(s-h,q,l),m.subVectors(k,l)):(a(s+h,q,l),m.subVectors(l,k)),q-h>=0?(a(s,q-h,l),n.subVectors(k,l)):(a(s,q+h,l),n.subVectors(l,k)),i.crossVectors(m,n).normalize(),f.push(i.x,i.y,i.z),g.push(s,q)}for(var t=0;t<c;t++)for(var u=0;u<b;u++){var v=t*o+u,w=t*o+u+1,x=(t+1)*o+u+1,y=(t+1)*o+u;d.push(v,w,y),d.push(w,x,y)}this.setIndex(d),this.setAttribute("position",new K(e,3)),this.setAttribute("normal",new K(f,3)),this.setAttribute("uv",new K(g,2))}function Dc(a,b,c,d){S.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:d},this.fromBufferGeometry(new Ec(a,b,c,d)),this.mergeVertices()}function Ec(a,b,d,e){function f(a){for(var c=new j,d=new j,e=new j,f=0;f<b.length;f+=3)m(b[f+0],c),m(b[f+1],d),m(b[f+2],e),g(c,d,e,a)}function g(a,b,c,d){for(var e=Math.pow(2,d),f=[],g=0;g<=e;g++){f[g]=[];for(var h=a.clone().lerp(c,g/e),i=b.clone().lerp(c,g/e),j=e-g,k=0;k<=j;k++)f[g][k]=0===k&&g===e?h:h.clone().lerp(i,k/j)}for(var m=0;m<e;m++)for(var n=0;n<2*(e-m)-1;n++){var o=Math.floor(n/2);n%2==0?(l(f[m][o+1]),l(f[m+1][o]),l(f[m][o])):(l(f[m][o+1]),l(f[m+1][o+1]),l(f[m+1][o]))}}function h(a){for(var b=new j,c=0;c<r.length;c+=3)b.x=r[c+0],b.y=r[c+1],b.z=r[c+2],b.normalize().multiplyScalar(a),r[c+0]=b.x,r[c+1]=b.y,r[c+2]=b.z}function i(){for(var a=new j,b=0;b<r.length;b+=3){a.x=r[b+0],a.y=r[b+1],a.z=r[b+2];var c=p(a)/2/Math.PI+.5,d=q(a)/Math.PI+.5;s.push(c,1-d)}n(),k()}function k(){for(var a=0;a<s.length;a+=6){var b=s[a+0],c=s[a+2],d=s[a+4],e=Math.max(b,c,d),f=Math.min(b,c,d);e>.9&&f<.1&&(b<.2&&(s[a+0]+=1),c<.2&&(s[a+2]+=1),d<.2&&(s[a+4]+=1))}}function l(a){r.push(a.x,a.y,a.z)}function m(b,c){var d=3*b;c.x=a[d+0],c.y=a[d+1],c.z=a[d+2]}function n(){for(var a=new j,b=new j,d=new j,e=new j,f=new c,g=new c,h=new c,i=0,k=0;i<r.length;i+=9,k+=6){a.set(r[i+0],r[i+1],r[i+2]),b.set(r[i+3],r[i+4],r[i+5]),d.set(r[i+6],r[i+7],r[i+8]),f.set(s[k+0],s[k+1]),g.set(s[k+2],s[k+3]),h.set(s[k+4],s[k+5]),e.copy(a).add(b).add(d).divideScalar(3);var l=p(e);o(f,k+0,a,l),o(g,k+2,b,l),o(h,k+4,d,l)}}function o(a,b,c,d){d<0&&1===a.x&&(s[b]=a.x-1),0===c.x&&0===c.z&&(s[b]=d/2/Math.PI+.5)}function p(a){return Math.atan2(a.z,-a.x)}function q(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}O.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:a,indices:b,radius:d,detail:e},d=d||1,e=e||0;var r=[],s=[];f(e),h(d),i(),this.setAttribute("position",new K(r,3)),this.setAttribute("normal",new K(r.slice(),3)),this.setAttribute("uv",new K(s,2)),0===e?this.computeVertexNormals():this.normalizeNormals()}function Fc(a,b){S.call(this),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:b},this.fromBufferGeometry(new Gc(a,b)),this.mergeVertices()}function Gc(a,b){var c=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],d=[2,1,0,0,3,2,1,3,0,2,3,1];Ec.call(this,c,d,a,b),this.type="TetrahedronBufferGeometry",this.parameters={radius:a,detail:b}}function Hc(a,b){S.call(this),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b},this.fromBufferGeometry(new Ic(a,b)),this.mergeVertices()}function Ic(a,b){var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Ec.call(this,c,d,a,b),this.type="OctahedronBufferGeometry",this.parameters={radius:a,detail:b}}function Jc(a,b){S.call(this),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:b},this.fromBufferGeometry(new Kc(a,b)),this.mergeVertices()}function Kc(a,b){var c=(1+Math.sqrt(5))/2,d=[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],e=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Ec.call(this,d,e,a,b),this.type="IcosahedronBufferGeometry",this.parameters={radius:a,detail:b}}function Lc(a,b){S.call(this),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:b},this.fromBufferGeometry(new Mc(a,b)),this.mergeVertices()}function Mc(a,b){var c=(1+Math.sqrt(5))/2,d=1/c,e=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],f=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Ec.call(this,e,f,a,b),this.type="DodecahedronBufferGeometry",this.parameters={radius:a,detail:b}}function Nc(a,b,c,d,e,f){S.call(this),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e},void 0!==f&&console.warn("THREE.TubeGeometry: taper has been removed.");var g=new Oc(a,b,c,d,e);this.tangents=g.tangents,this.normals=g.normals,this.binormals=g.binormals,this.fromBufferGeometry(g),this.mergeVertices()}function Oc(a,b,d,e,f){function g(){for(var a=0;a<b;a++)h(a);h(!1===f?b:0),k(),i()}function h(c){p=a.getPointAt(c/b,p);for(var f=l.normals[c],g=l.binormals[c],h=0;h<=e;h++){var i=h/e*Math.PI*2,j=Math.sin(i),k=-Math.cos(i);n.x=k*f.x+j*g.x,n.y=k*f.y+j*g.y,n.z=k*f.z+j*g.z,n.normalize(),r.push(n.x,n.y,n.z),m.x=p.x+d*n.x,m.y=p.y+d*n.y,m.z=p.z+d*n.z,q.push(m.x,m.y,m.z)}}function i(){for(var a=1;a<=b;a++)for(var c=1;c<=e;c++){var d=(e+1)*(a-1)+(c-1),f=(e+1)*a+(c-1),g=(e+1)*a+c,h=(e+1)*(a-1)+c;t.push(d,f,h),t.push(f,g,h)}}function k(){for(var a=0;a<=b;a++)for(var c=0;c<=e;c++)o.x=a/b,o.y=c/e,s.push(o.x,o.y)}O.call(this),this.type="TubeBufferGeometry",this.parameters={path:a,tubularSegments:b,radius:d,radialSegments:e,closed:f},b=b||64,d=d||1,e=e||8,f=f||!1;var l=a.computeFrenetFrames(b,f);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;var m=new j,n=new j,o=new c,p=new j,q=[],r=[],s=[],t=[];g(),this.setIndex(t),this.setAttribute("position",new K(q,3)),this.setAttribute("normal",new K(r,3)),this.setAttribute("uv",new K(s,2))}function Pc(a,b,c,d,e,f,g){S.call(this),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f},void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Qc(a,b,c,d,e,f)),this.mergeVertices()}function Qc(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a),h=c/b*a,i=Math.cos(h);e.x=d*(2+i)*.5*f,e.y=d*(2+i)*g*.5,e.z=d*Math.sin(h)*.5}O.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f},a=a||1,b=b||.4,c=Math.floor(c)||64,d=Math.floor(d)||8,e=e||2,f=f||3;for(var h=[],i=[],k=[],l=[],m=new j,n=new j,o=new j,p=new j,q=new j,r=new j,s=new j,t=0;t<=c;++t){var u=t/c*e*Math.PI*2;g(u,e,f,a,o),g(u+.01,e,f,a,p),r.subVectors(p,o),s.addVectors(p,o),q.crossVectors(r,s),s.crossVectors(q,r),q.normalize(),s.normalize();for(var v=0;v<=d;++v){var w=v/d*Math.PI*2,x=-b*Math.cos(w),y=b*Math.sin(w);m.x=o.x+(x*s.x+y*q.x),m.y=o.y+(x*s.y+y*q.y),m.z=o.z+(x*s.z+y*q.z),i.push(m.x,m.y,m.z),n.subVectors(m,o).normalize(),k.push(n.x,n.y,n.z),l.push(t/c),l.push(v/d)}}for(var z=1;z<=c;z++)for(var A=1;A<=d;A++){var B=(d+1)*(z-1)+(A-1),C=(d+1)*z+(A-1),D=(d+1)*z+A,E=(d+1)*(z-1)+A;h.push(B,C,E),h.push(C,D,E)}this.setIndex(h),this.setAttribute("position",new K(i,3)),this.setAttribute("normal",new K(k,3)),this.setAttribute("uv",new K(l,2))}function Rc(a,b,c,d,e){S.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},this.fromBufferGeometry(new Sc(a,b,c,d,e)),this.mergeVertices()}function Sc(a,b,c,d,e){O.call(this),this.type="TorusBufferGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||1,b=b||.4,c=Math.floor(c)||8,d=Math.floor(d)||6,e=e||2*Math.PI;for(var f=[],g=[],h=[],i=[],k=new j,l=new j,m=new j,n=0;n<=c;n++)for(var o=0;o<=d;o++){var p=o/d*e,q=n/c*Math.PI*2;l.x=(a+b*Math.cos(q))*Math.cos(p),l.y=(a+b*Math.cos(q))*Math.sin(p),l.z=b*Math.sin(q),g.push(l.x,l.y,l.z),k.x=a*Math.cos(p),k.y=a*Math.sin(p),m.subVectors(l,k).normalize(),h.push(m.x,m.y,m.z),i.push(o/d),i.push(n/c)}for(var r=1;r<=c;r++)for(var s=1;s<=d;s++){var t=(d+1)*r+s-1,u=(d+1)*(r-1)+s-1,v=(d+1)*(r-1)+s,w=(d+1)*r+s;f.push(t,u,w),f.push(u,v,w)}this.setIndex(f),this.setAttribute("position",new K(g,3)),this.setAttribute("normal",new K(h,3)),this.setAttribute("uv",new K(i,2))}function Tc(a,b,c,d,e){var f,g;if(e===vd(a,b,c,d)>0)for(f=b;f<c;f+=d)g=sd(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=sd(f,a[f],a[f+1],g);return g&&kd(g,g.next)&&(td(g),g=g.next),g}function Uc(a,b){if(!a)return a;b||(b=a);var c,d=a;do{if(c=!1,d.steiner||!kd(d,d.next)&&0!==jd(d.prev,d,d.next))d=d.next;else{if(td(d),(d=b=d.prev)===d.next)break;c=!0}}while(c||d!==b);return b}function Vc(a,b,c,d,e,f,g){if(a){!g&&f&&dd(a,d,e,f);for(var h,i,j=a;a.prev!==a.next;)if(h=a.prev,i=a.next,f?Xc(a,d,e,f):Wc(a))b.push(h.i/c),b.push(a.i/c),b.push(i.i/c),td(a),a=i.next,j=i.next;else if((a=i)===j){g?1===g?(a=Yc(Uc(a),b,c),Vc(a,b,c,d,e,f,2)):2===g&&Zc(a,b,c,d,e,f):Vc(Uc(a),b,c,d,e,f,1);break}}}function Wc(a){var b=a.prev,c=a,d=a.next;if(jd(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(hd(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&jd(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function Xc(a,b,c,d){var e=a.prev,f=a,g=a.next;if(jd(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=fd(h,i,b,c,d),m=fd(j,k,b,c,d),n=a.prevZ,o=a.nextZ;n&&n.z>=l&&o&&o.z<=m;){if(n!==a.prev&&n!==a.next&&hd(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&jd(n.prev,n,n.next)>=0)return!1;if(n=n.prevZ,o!==a.prev&&o!==a.next&&hd(e.x,e.y,f.x,f.y,g.x,g.y,o.x,o.y)&&jd(o.prev,o,o.next)>=0)return!1;o=o.nextZ}for(;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&hd(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&jd(n.prev,n,n.next)>=0)return!1;n=n.prevZ}for(;o&&o.z<=m;){if(o!==a.prev&&o!==a.next&&hd(e.x,e.y,f.x,f.y,g.x,g.y,o.x,o.y)&&jd(o.prev,o,o.next)>=0)return!1;o=o.nextZ}return!0}function Yc(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!kd(e,f)&&ld(e,d,d.next,f)&&pd(e,f)&&pd(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),td(d),td(d.next),d=a=f),d=d.next}while(d!==a);return Uc(d)}function Zc(a,b,c,d,e,f){var g=a;do{for(var h=g.next.next;h!==g.prev;){if(g.i!==h.i&&id(g,h)){var i=rd(g,h);return g=Uc(g,g.next),i=Uc(i,i.next),Vc(g,b,c,d,e,f),void Vc(i,b,c,d,e,f)}h=h.next}g=g.next}while(g!==a)}function $c(a,b,c,d){var e,f,g,h,i,j=[];for(e=0,f=b.length;e<f;e++)g=b[e]*d,h=e<f-1?b[e+1]*d:a.length,i=Tc(a,g,h,d,!1),i===i.next&&(i.steiner=!0),j.push(gd(i));for(j.sort(_c),e=0;e<j.length;e++)ad(j[e],c),c=Uc(c,c.next);return c}function _c(a,b){return a.x-b.x}function ad(a,b){if(b=bd(a,b)){var c=rd(b,a);Uc(b,b.next),Uc(c,c.next)}}function bd(a,b){var c,d=b,e=a.x,f=a.y,g=-1/0;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(h<=e&&h>g){if(g=h,h===e){if(f===d.y)return d;if(f===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c;var i,j=c,k=c.x,l=c.y,m=1/0;d=c;do{e>=d.x&&d.x>=k&&e!==d.x&&hd(f<l?e:g,f,k,l,f<l?g:e,f,d.x,d.y)&&(i=Math.abs(f-d.y)/(e-d.x),pd(d,a)&&(i<m||i===m&&(d.x>c.x||d.x===c.x&&cd(c,d)))&&(c=d,m=i)),d=d.next}while(d!==j);return c}function cd(a,b){return jd(a.prev,a,b.prev)<0&&jd(b.next,a,a.next)<0}function dd(a,b,c,d){var e=a;do{null===e.z&&(e.z=fd(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next}while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,ed(e)}function ed(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;b<j&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0!==h&&(0===i||!d||c.z<=d.z)?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function fd(a,b,c,d,e){return a=32767*(a-c)*e,b=32767*(b-d)*e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function gd(a){var b=a,c=a;do{(b.x<c.x||b.x===c.x&&b.y<c.y)&&(c=b),b=b.next}while(b!==a);return c}function hd(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function id(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!od(a,b)&&(pd(a,b)&&pd(b,a)&&qd(a,b)&&(jd(a.prev,a,b.prev)||jd(a,b.prev,b))||kd(a,b)&&jd(a.prev,a,a.next)>0&&jd(b.prev,b,b.next)>0)}function jd(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function kd(a,b){return a.x===b.x&&a.y===b.y}function ld(a,b,c,d){var e=nd(jd(a,b,c)),f=nd(jd(a,b,d)),g=nd(jd(c,d,a)),h=nd(jd(c,d,b));return e!==f&&g!==h||(!(0!==e||!md(a,c,b))||(!(0!==f||!md(a,d,b))||(!(0!==g||!md(c,a,d))||!(0!==h||!md(c,b,d)))))}function md(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function nd(a){return a>0?1:a<0?-1:0}function od(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&ld(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function pd(a,b){return jd(a.prev,a,a.next)<0?jd(a,b,a.next)>=0&&jd(a,a.prev,b)>=0:jd(a,b,a.prev)<0||jd(a,a.next,b)<0}function qd(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do{c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==a);return d}function rd(a,b){var c=new ud(a.i,a.x,a.y),d=new ud(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function sd(a,b,c,d){var e=new ud(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function td(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ud(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vd(a,b,c,d){for(var e=0,f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}function wd(a){var b=a.length;b>2&&a[b-1].equals(a[0])&&a.pop()}function xd(a,b){for(var c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}function yd(a,b){S.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:b},this.fromBufferGeometry(new zd(a,b)),this.mergeVertices()}function zd(a,b){function d(a){function d(a,b,c){return b||console.error("THREE.ExtrudeGeometry: vec does not exist"),b.clone().multiplyScalar(c).add(a)}function h(a,b,d){var e,f,g,h=a.x-b.x,i=a.y-b.y,j=d.x-a.x,k=d.y-a.y,l=h*h+i*i,m=h*k-i*j;if(Math.abs(m)>Number.EPSILON){var n=Math.sqrt(l),o=Math.sqrt(j*j+k*k),p=b.x-i/n,q=b.y+h/n,r=d.x-k/o,s=d.y+j/o,t=((r-p)*k-(s-q)*j)/(h*k-i*j);e=p+h*t-a.x,f=q+i*t-a.y;var u=e*e+f*f;if(u<=2)return new c(e,f);g=Math.sqrt(u/2)}else{var v=!1;h>Number.EPSILON?j>Number.EPSILON&&(v=!0):h<-Number.EPSILON?j<-Number.EPSILON&&(v=!0):Math.sign(i)===Math.sign(k)&&(v=!0),v?(e=-i,f=h,g=Math.sqrt(l)):(e=h,f=i,g=Math.sqrt(l/2))}return new c(e/g,f/g)}function i(){var a=f.length/3;if(v){for(var b=0,c=T*b,d=0;d<U;d++){var g=O[d];n(g[2]+c,g[1]+c,g[0]+c)}b=t+2*z,c=T*b;for(var h=0;h<U;h++){var i=O[h];n(i[0]+c,i[1]+c,i[2]+c)}}else{for(var j=0;j<U;j++){var k=O[j];n(k[2],k[1],k[0])}for(var l=0;l<U;l++){var m=O[l];n(m[0]+T*t,m[1]+T*t,m[2]+T*t)}}e.addGroup(a,f.length/3-a,0)}function k(){var a=f.length/3,b=0;l(P,b),b+=P.length;for(var c=0,d=K.length;c<d;c++){var g=K[c];l(g,b),b+=g.length}e.addGroup(a,f.length/3-a,1)}function l(a,b){for(var c=a.length;--c>=0;){var d=c,e=c-1;e<0&&(e=a.length-1);for(var f=0,g=t+2*z;f<g;f++){var h=T*f,i=T*(f+1);o(b+d+h,b+e+h,b+e+i,b+d+i)}}}function m(a,b,c){r.push(a),r.push(b),r.push(c)}function n(a,b,c){p(a),p(b),p(c);var d=f.length/3,g=B.generateTopUV(e,f,d-3,d-2,d-1);q(g[0]),q(g[1]),q(g[2])}function o(a,b,c,d){p(a),p(b),p(d),p(b),p(c),p(d);var g=f.length/3,h=B.generateSideWallUV(e,f,g-6,g-3,g-2,g-1);q(h[0]),q(h[1]),q(h[3]),q(h[1]),q(h[2]),q(h[3])}function p(a){f.push(r[3*a+0]),f.push(r[3*a+1]),f.push(r[3*a+2])}function q(a){g.push(a.x),g.push(a.y)}var r=[],s=void 0!==b.curveSegments?b.curveSegments:12,t=void 0!==b.steps?b.steps:1,u=void 0!==b.depth?b.depth:100,v=void 0===b.bevelEnabled||b.bevelEnabled,w=void 0!==b.bevelThickness?b.bevelThickness:6,x=void 0!==b.bevelSize?b.bevelSize:w-2,y=void 0!==b.bevelOffset?b.bevelOffset:0,z=void 0!==b.bevelSegments?b.bevelSegments:3,A=b.extrudePath,B=void 0!==b.UVGenerator?b.UVGenerator:Zp;void 0!==b.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=b.amount);var C,D,E,F,G,H=!1;A&&(C=A.getSpacedPoints(t),H=!0,v=!1,D=A.computeFrenetFrames(t,!1),E=new j,F=new j,G=new j),v||(z=0,w=0,x=0,y=0);var I=a.extractPoints(s),J=I.shape,K=I.holes;if(!Yp.isClockWise(J)){J=J.reverse();for(var L=0,M=K.length;L<M;L++){var N=K[L];Yp.isClockWise(N)&&(K[L]=N.reverse())}}for(var O=Yp.triangulateShape(J,K),P=J,Q=0,R=K.length;Q<R;Q++){var S=K[Q];J=J.concat(S)}for(var T=J.length,U=O.length,V=[],W=0,X=P.length,Y=X-1,Z=W+1;W<X;W++,Y++,Z++)Y===X&&(Y=0),Z===X&&(Z=0),V[W]=h(P[W],P[Y],P[Z]);for(var $,_=[],aa=V.concat(),ba=0,ca=K.length;ba<ca;ba++){var da=K[ba];$=[];for(var ea=0,fa=da.length,ga=fa-1,ha=ea+1;ea<fa;ea++,ga++,ha++)ga===fa&&(ga=0),ha===fa&&(ha=0),$[ea]=h(da[ea],da[ga],da[ha]);_.push($),aa=aa.concat($)}for(var ia=0;ia<z;ia++){for(var ja=ia/z,ka=w*Math.cos(ja*Math.PI/2),la=x*Math.sin(ja*Math.PI/2)+y,ma=0,na=P.length;ma<na;ma++){var oa=d(P[ma],V[ma],la);m(oa.x,oa.y,-ka)}for(var pa=0,qa=K.length;pa<qa;pa++){var ra=K[pa];$=_[pa];for(var sa=0,ta=ra.length;sa<ta;sa++){var ua=d(ra[sa],$[sa],la);m(ua.x,ua.y,-ka)}}}for(var va=x+y,wa=0;wa<T;wa++){var xa=v?d(J[wa],aa[wa],va):J[wa];H?(F.copy(D.normals[0]).multiplyScalar(xa.x),E.copy(D.binormals[0]).multiplyScalar(xa.y),G.copy(C[0]).add(F).add(E),m(G.x,G.y,G.z)):m(xa.x,xa.y,0)}for(var ya=1;ya<=t;ya++)for(var za=0;za<T;za++){var Aa=v?d(J[za],aa[za],va):J[za];H?(F.copy(D.normals[ya]).multiplyScalar(Aa.x),E.copy(D.binormals[ya]).multiplyScalar(Aa.y),G.copy(C[ya]).add(F).add(E),m(G.x,G.y,G.z)):m(Aa.x,Aa.y,u/t*ya)}for(var Ba=z-1;Ba>=0;Ba--){for(var Ca=Ba/z,Da=w*Math.cos(Ca*Math.PI/2),Ea=x*Math.sin(Ca*Math.PI/2)+y,Fa=0,Ga=P.length;Fa<Ga;Fa++){var Ha=d(P[Fa],V[Fa],Ea);m(Ha.x,Ha.y,u+Da)}for(var Ia=0,Ja=K.length;Ia<Ja;Ia++){var Ka=K[Ia];$=_[Ia];for(var La=0,Ma=Ka.length;La<Ma;La++){var Na=d(Ka[La],$[La],Ea);H?m(Na.x,Na.y+C[t-1].y,C[t-1].x+Da):m(Na.x,Na.y,u+Da)}}}i(),k()}O.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:a,options:b},a=Array.isArray(a)?a:[a];for(var e=this,f=[],g=[],h=0,i=a.length;h<i;h++){d(a[h])}this.setAttribute("position",new K(f,3)),this.setAttribute("uv",new K(g,2)),this.computeVertexNormals()}function Ad(a,b,c){if(c.shapes=[],Array.isArray(a))for(var d=0,e=a.length;d<e;d++){var f=a[d];c.shapes.push(f.uuid)}else c.shapes.push(a.uuid);return void 0!==b.extrudePath&&(c.options.extrudePath=b.extrudePath.toJSON()),c}function Bd(a,b){S.call(this),this.type="TextGeometry",this.parameters={text:a,parameters:b},this.fromBufferGeometry(new Cd(a,b)),this.mergeVertices()}function Cd(a,b){b=b||{};var c=b.font;if(!c||!c.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new S;var d=c.generateShapes(a,b.size);b.depth=void 0!==b.height?b.height:50,void 0===b.bevelThickness&&(b.bevelThickness=10),void 0===b.bevelSize&&(b.bevelSize=8),void 0===b.bevelEnabled&&(b.bevelEnabled=!1),zd.call(this,d,b),this.type="TextBufferGeometry"}function Dd(a,b,c,d,e,f,g){S.call(this),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g},this.fromBufferGeometry(new Ed(a,b,c,d,e,f,g)),this.mergeVertices()}function Ed(a,b,c,d,e,f,g){O.call(this),this.type="SphereBufferGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g},a=a||1,b=Math.max(3,Math.floor(b)||8),c=Math.max(2,Math.floor(c)||6),d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI,f=void 0!==f?f:0,g=void 0!==g?g:Math.PI;for(var h=Math.min(f+g,Math.PI),i=0,k=[],l=new j,m=new j,n=[],o=[],p=[],q=[],r=0;r<=c;r++){var s=[],t=r/c,u=0;0==r&&0==f?u=.5/b:r==c&&h==Math.PI&&(u=-.5/b);for(var v=0;v<=b;v++){var w=v/b;l.x=-a*Math.cos(d+w*e)*Math.sin(f+t*g),l.y=a*Math.cos(f+t*g),l.z=a*Math.sin(d+w*e)*Math.sin(f+t*g),o.push(l.x,l.y,l.z),m.copy(l).normalize(),p.push(m.x,m.y,m.z),q.push(w+u,1-t),s.push(i++)}k.push(s)}for(var x=0;x<c;x++)for(var y=0;y<b;y++){var z=k[x][y+1],A=k[x][y],B=k[x+1][y],C=k[x+1][y+1];(0!==x||f>0)&&n.push(z,A,C),(x!==c-1||h<Math.PI)&&n.push(A,B,C)}this.setIndex(n),this.setAttribute("position",new K(o,3)),this.setAttribute("normal",new K(p,3)),this.setAttribute("uv",new K(q,2))}function Fd(a,b,c,d,e,f){S.call(this),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f},this.fromBufferGeometry(new Gd(a,b,c,d,e,f)),this.mergeVertices()}function Gd(a,b,d,e,f,g){O.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:a,outerRadius:b,thetaSegments:d,phiSegments:e,thetaStart:f,thetaLength:g},a=a||.5,b=b||1,f=void 0!==f?f:0,g=void 0!==g?g:2*Math.PI,d=void 0!==d?Math.max(3,d):8,e=void 0!==e?Math.max(1,e):1;for(var h=[],i=[],k=[],l=[],m=a,n=(b-a)/e,o=new j,p=new c,q=0;q<=e;q++){for(var r=0;r<=d;r++){var s=f+r/d*g;o.x=m*Math.cos(s),o.y=m*Math.sin(s),i.push(o.x,o.y,o.z),k.push(0,0,1),p.x=(o.x/b+1)/2,p.y=(o.y/b+1)/2,l.push(p.x,p.y)}m+=n}for(var t=0;t<e;t++)for(var u=t*(d+1),v=0;v<d;v++){var w=v+u,x=w,y=w+d+1,z=w+d+2,A=w+1;h.push(x,y,A),h.push(y,z,A)}this.setIndex(h),this.setAttribute("position",new K(i,3)),this.setAttribute("normal",new K(k,3)),this.setAttribute("uv",new K(l,2))}function Hd(a,b,c,d){S.call(this),this.type="LatheGeometry",this.parameters={points:a,segments:b,phiStart:c,phiLength:d},this.fromBufferGeometry(new Id(a,b,c,d)),this.mergeVertices()}function Id(a,b,d,e){O.call(this),this.type="LatheBufferGeometry",this.parameters={points:a,segments:b,phiStart:d,phiLength:e},b=Math.floor(b)||12,d=d||0,e=e||2*Math.PI,e=Fk.clamp(e,0,2*Math.PI);for(var f=[],g=[],h=[],i=1/b,k=new j,l=new c,m=0;m<=b;m++)for(var n=d+m*i*e,o=Math.sin(n),p=Math.cos(n),q=0;q<=a.length-1;q++)k.x=a[q].x*o,k.y=a[q].y,k.z=a[q].x*p,g.push(k.x,k.y,k.z),l.x=m/b,l.y=q/(a.length-1),h.push(l.x,l.y);for(var r=0;r<b;r++)for(var s=0;s<a.length-1;s++){var t=s+r*a.length,u=t,v=t+a.length,w=t+a.length+1,x=t+1;f.push(u,v,x),f.push(v,w,x)}if(this.setIndex(f),this.setAttribute("position",new K(g,3)),this.setAttribute("uv",new K(h,2)),this.computeVertexNormals(),e===2*Math.PI)for(var y=this.attributes.normal.array,z=new j,A=new j,B=new j,C=b*a.length*3,D=0,E=0;D<a.length;D++,E+=3)z.x=y[E+0],z.y=y[E+1],z.z=y[E+2],A.x=y[C+E+0],A.y=y[C+E+1],A.z=y[C+E+2],B.addVectors(z,A).normalize(),y[E+0]=y[C+E+0]=B.x,y[E+1]=y[C+E+1]=B.y,y[E+2]=y[C+E+2]=B.z}function Jd(a,b){S.call(this),this.type="ShapeGeometry","object"==typeof b&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),b=b.curveSegments),this.parameters={shapes:a,curveSegments:b},this.fromBufferGeometry(new Kd(a,b)),this.mergeVertices()}function Kd(a,b){function c(a){var c=e.length/3,h=a.extractPoints(b),j=h.shape,k=h.holes;!1===Yp.isClockWise(j)&&(j=j.reverse());for(var l=0,m=k.length;l<m;l++){var n=k[l];!0===Yp.isClockWise(n)&&(k[l]=n.reverse())}for(var o=Yp.triangulateShape(j,k),p=0,q=k.length;p<q;p++){var r=k[p];j=j.concat(r)}for(var s=0,t=j.length;s<t;s++){var u=j[s];e.push(u.x,u.y,0),f.push(0,0,1),g.push(u.x,u.y)}for(var v=0,w=o.length;v<w;v++){var x=o[v],y=x[0]+c,z=x[1]+c,A=x[2]+c;d.push(y,z,A),i+=3}}O.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:a,curveSegments:b},b=b||12;var d=[],e=[],f=[],g=[],h=0,i=0;if(!1===Array.isArray(a))c(a);else for(var j=0;j<a.length;j++)c(a[j]),this.addGroup(h,i,j),h+=i,i=0;this.setIndex(d),this.setAttribute("position",new K(e,3)),this.setAttribute("normal",new K(f,3)),this.setAttribute("uv",new K(g,2))}function Ld(a,b){if(b.shapes=[],Array.isArray(a))for(var c=0,d=a.length;c<d;c++){var e=a[c];b.shapes.push(e.uuid)}else b.shapes.push(a.uuid);return b}function Md(a,b){O.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:b},b=void 0!==b?b:1;var c,d,e,f,g=[],h=Math.cos(Fk.DEG2RAD*b),i=[0,0],j={},k=["a","b","c"];a.isBufferGeometry?(f=new S,f.fromBufferGeometry(a)):f=a.clone(),f.mergeVertices(),f.computeFaceNormals();for(var l=f.vertices,m=f.faces,n=0,o=m.length;n<o;n++)for(var p=m[n],q=0;q<3;q++)c=p[k[q]],d=p[k[(q+1)%3]],i[0]=Math.min(c,d),i[1]=Math.max(c,d),e=i[0]+","+i[1],void 0===j[e]?j[e]={index1:i[0],index2:i[1],face1:n,face2:void 0}:j[e].face2=n;for(e in j){var r=j[e];if(void 0===r.face2||m[r.face1].normal.dot(m[r.face2].normal)<=h){var s=l[r.index1];g.push(s.x,s.y,s.z),s=l[r.index2],g.push(s.x,s.y,s.z)}}this.setAttribute("position",new K(g,3))}function Nd(a,b,c,d,e,f,g,h){S.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h},this.fromBufferGeometry(new Od(a,b,c,d,e,f,g,h)),this.mergeVertices()}function Od(a,b,d,e,f,g,h,i){function k(){for(var c=new j,g=new j,k=0,l=(b-a)/d,v=0;v<=f;v++){for(var w=[],x=v/f,y=x*(b-a)+a,z=0;z<=e;z++){var A=z/e,B=A*i+h,C=Math.sin(B),D=Math.cos(B);g.x=y*C,g.y=-x*d+t,g.z=y*D,o.push(g.x,g.y,g.z),c.set(C,l,D).normalize(),p.push(c.x,c.y,c.z),q.push(A,1-x),w.push(r++)}s.push(w)}for(var E=0;E<e;E++)for(var F=0;F<f;F++){var G=s[F][E],H=s[F+1][E],I=s[F+1][E+1],J=s[F][E+1];n.push(G,H,J),n.push(H,I,J),k+=6}m.addGroup(u,k,0),u+=k}function l(d){var f,g,k=new c,l=new j,s=0,v=!0===d?a:b,w=!0===d?1:-1;f=r;for(var x=1;x<=e;x++)o.push(0,t*w,0),p.push(0,w,0),q.push(.5,.5),r++;g=r;for(var y=0;y<=e;y++){var z=y/e,A=z*i+h,B=Math.cos(A),C=Math.sin(A);l.x=v*C,l.y=t*w,l.z=v*B,o.push(l.x,l.y,l.z),p.push(0,w,0),k.x=.5*B+.5,k.y=.5*C*w+.5,q.push(k.x,k.y),r++}for(var D=0;D<e;D++){var E=f+D,F=g+D;!0===d?n.push(F,F+1,E):n.push(F+1,F,E),s+=3}m.addGroup(u,s,!0===d?1:2),u+=s}O.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:d,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:i};var m=this;a=void 0!==a?a:1,b=void 0!==b?b:1,d=d||1,e=Math.floor(e)||8,f=Math.floor(f)||1,g=void 0!==g&&g,h=void 0!==h?h:0,i=void 0!==i?i:2*Math.PI;var n=[],o=[],p=[],q=[],r=0,s=[],t=d/2,u=0;k(),!1===g&&(a>0&&l(!0),b>0&&l(!1)),this.setIndex(n),this.setAttribute("position",new K(o,3)),this.setAttribute("normal",new K(p,3)),this.setAttribute("uv",new K(q,2))}function Pd(a,b,c,d,e,f,g){Nd.call(this,0,a,b,c,d,e,f,g),this.type="ConeGeometry",this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Qd(a,b,c,d,e,f,g){Od.call(this,0,a,b,c,d,e,f,g),this.type="ConeBufferGeometry",this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Rd(a,b,c,d){S.call(this),this.type="CircleGeometry",this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d},this.fromBufferGeometry(new Sd(a,b,c,d)),this.mergeVertices()}function Sd(a,b,d,e){O.call(this),this.type="CircleBufferGeometry",this.parameters={radius:a,segments:b,thetaStart:d,thetaLength:e},a=a||1,b=void 0!==b?Math.max(3,b):8,d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI;var f=[],g=[],h=[],i=[],k=new j,l=new c;g.push(0,0,0),h.push(0,0,1),i.push(.5,.5);for(var m=0,n=3;m<=b;m++,n+=3){var o=d+m/b*e;k.x=a*Math.cos(o),k.y=a*Math.sin(o),g.push(k.x,k.y,k.z),h.push(0,0,1),l.x=(g[n]/a+1)/2,l.y=(g[n+1]/a+1)/2,i.push(l.x,l.y)}for(var p=1;p<=b;p++)f.push(p,p+1,0);this.setIndex(f),this.setAttribute("position",new K(g,3)),this.setAttribute("normal",new K(h,3)),this.setAttribute("uv",new K(i,2))}function Td(a){A.call(this),this.type="ShadowMaterial",this.color=new v(0),this.transparent=!0,this.setValues(a)}function Ud(a){V.call(this,a),this.type="RawShaderMaterial"}function Vd(a){A.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new v(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ck,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(a)}function Wd(a){Vd.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new c(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(a)}function Xd(a){A.call(this),this.type="MeshPhongMaterial",this.color=new v(16777215),this.specular=new v(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ck,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Th,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function Yd(a){A.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new v(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ck,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function Zd(a){A.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ck,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function $d(a){A.call(this),this.type="MeshLambertMaterial",this.color=new v(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new v(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Th,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function _d(a){A.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new v(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ck,this.normalScale=new c(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)}function ae(a){pc.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}function be(a,b,c,d){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0!==d?d:new b.constructor(c),this.sampleValues=b,this.valueSize=c}function ce(a,b,c,d){be.call(this,a,b,c,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function de(a,b,c,d){be.call(this,a,b,c,d)}function ee(a,b,c,d){be.call(this,a,b,c,d)}function fe(a,b,c,d){if(void 0===a)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=aq.convertArray(b,this.TimeBufferType),this.values=aq.convertArray(c,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}function ge(a,b,c){fe.call(this,a,b,c)}function he(a,b,c,d){fe.call(this,a,b,c,d)}function ie(a,b,c,d){fe.call(this,a,b,c,d)}function je(a,b,c,d){be.call(this,a,b,c,d)}function ke(a,b,c,d){fe.call(this,a,b,c,d)}function le(a,b,c,d){fe.call(this,a,b,c,d)}function me(a,b,c,d){fe.call(this,a,b,c,d)}function ne(a,b,c,d){this.name=a,this.tracks=c,this.duration=void 0!==b?b:-1,this.blendMode=void 0!==d?d:Pj,this.uuid=Fk.generateUUID(),this.duration<0&&this.resetDuration()}function oe(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ie;case"vector":case"vector2":case"vector3":case"vector4":return me;case"color":return he;case"quaternion":return ke;case"bool":case"boolean":return ge;case"string":return le}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function pe(a){if(void 0===a.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var b=oe(a.type);if(void 0===a.times){var c=[],d=[];aq.flattenJSON(a.keys,c,d,"value"),a.times=c,a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)}function qe(a,b,c){var d=this,e=!1,f=0,g=0,h=void 0,i=[];this.onStart=void 0,this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){g++,!1===e&&void 0!==d.onStart&&d.onStart(a,f,g),e=!0},this.itemEnd=function(a){f++,void 0!==d.onProgress&&d.onProgress(a,f,g),f===g&&(e=!1,void 0!==d.onLoad&&d.onLoad())},this.itemError=function(a){void 0!==d.onError&&d.onError(a)},this.resolveURL=function(a){return h?h(a):a},this.setURLModifier=function(a){return h=a,this},this.addHandler=function(a,b){return i.push(a,b),this},this.removeHandler=function(a){var b=i.indexOf(a);return-1!==b&&i.splice(b,2),this},this.getHandler=function(a){for(var b=0,c=i.length;b<c;b+=2){var d=i[b],e=i[b+1];if(d.global&&(d.lastIndex=0),d.test(a))return e}return null}}function re(a){this.manager=void 0!==a?a:cq,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}function se(a){re.call(this,a)}function te(a){re.call(this,a)}function ue(a){re.call(this,a)}function ve(a){re.call(this,a)}function we(a){re.call(this,a)}function xe(a){re.call(this,a)}function ye(a){re.call(this,a)}function ze(){this.type="Curve",this.arcLengthDivisions=200}function Ae(a,b,c,d,e,f,g,h){ze.call(this),this.type="EllipseCurve",this.aX=a||0,this.aY=b||0,this.xRadius=c||1,this.yRadius=d||1,this.aStartAngle=e||0,this.aEndAngle=f||2*Math.PI,this.aClockwise=g||!1,this.aRotation=h||0}function Be(a,b,c,d,e,f){Ae.call(this,a,b,c,c,d,e,f),this.type="ArcCurve"}function Ce(){function a(a,f,g,h){b=a,c=g,d=-3*a+3*f-2*g-h,e=2*a-2*f+g+h}var b=0,c=0,d=0,e=0;return{initCatmullRom:function(b,c,d,e,f){a(c,d,f*(d-b),f*(e-c))},initNonuniformCatmullRom:function(b,c,d,e,f,g,h){var i=(c-b)/f-(d-b)/(f+g)+(d-c)/g,j=(d-c)/g-(e-c)/(g+h)+(e-d)/h;i*=g,j*=g,a(c,d,i,j)},calc:function(a){var f=a*a;return b+c*a+d*f+e*(f*a)}}}function De(a,b,c,d){ze.call(this),this.type="CatmullRomCurve3",this.points=a||[],this.closed=b||!1,this.curveType=c||"centripetal",this.tension=d||.5}function Ee(a,b,c,d,e){var f=.5*(d-b),g=.5*(e-c),h=a*a;return(2*c-2*d+f+g)*(a*h)+(-3*c+3*d-2*f-g)*h+f*a+c}function Fe(a,b){var c=1-a;return c*c*b}function Ge(a,b){return 2*(1-a)*a*b}function He(a,b){return a*a*b}function Ie(a,b,c,d){return Fe(a,b)+Ge(a,c)+He(a,d)}function Je(a,b){var c=1-a;return c*c*c*b}function Ke(a,b){var c=1-a;return 3*c*c*a*b}function Le(a,b){return 3*(1-a)*a*a*b}function Me(a,b){return a*a*a*b}function Ne(a,b,c,d,e){return Je(a,b)+Ke(a,c)+Le(a,d)+Me(a,e)}function Oe(a,b,d,e){ze.call(this),this.type="CubicBezierCurve",this.v0=a||new c,this.v1=b||new c,this.v2=d||new c,this.v3=e||new c}function Pe(a,b,c,d){ze.call(this),this.type="CubicBezierCurve3",this.v0=a||new j,this.v1=b||new j,this.v2=c||new j,this.v3=d||new j}function Qe(a,b){ze.call(this),this.type="LineCurve",this.v1=a||new c,this.v2=b||new c}function Re(a,b){ze.call(this),this.type="LineCurve3",this.v1=a||new j,this.v2=b||new j}function Se(a,b,d){ze.call(this),this.type="QuadraticBezierCurve",this.v0=a||new c,this.v1=b||new c,this.v2=d||new c}function Te(a,b,c){ze.call(this),this.type="QuadraticBezierCurve3",this.v0=a||new j,this.v1=b||new j,this.v2=c||new j}function Ue(a){ze.call(this),this.type="SplineCurve",this.points=a||[]}function Ve(){ze.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function We(a){Ve.call(this),this.type="Path",this.currentPoint=new c,a&&this.setFromPoints(a)}function Xe(a){We.call(this,a),this.uuid=Fk.generateUUID(),this.type="Shape",this.holes=[]}function Ye(a,b){n.call(this),this.type="Light",this.color=new v(a),this.intensity=void 0!==b?b:1,this.receiveShadow=void 0}function Ze(a,b,c){Ye.call(this,a,c),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(n.DefaultUp),this.updateMatrix(),this.groundColor=new v(b)}function $e(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new c(512,512),this.map=null,this.mapPass=null,this.matrix=new k,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new _,this._frameExtents=new c(1,1),this._viewportCount=1,this._viewports=[new f(0,0,1,1)]}function _e(){$e.call(this,new X(50,1,.5,500))}function af(a,b,c,d,e,f){Ye.call(this,a,b),this.type="SpotLight",this.position.copy(n.DefaultUp),this.updateMatrix(),this.target=new n,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}}),this.distance=void 0!==c?c:0,this.angle=void 0!==d?d:Math.PI/3,this.penumbra=void 0!==e?e:0,this.decay=void 0!==f?f:1,this.shadow=new _e}function bf(){$e.call(this,new X(90,1,.5,500)),this._frameExtents=new c(4,2),this._viewportCount=6,this._viewports=[new f(2,1,1,1),new f(0,1,1,1),new f(3,1,1,1),new f(1,1,1,1),new f(3,0,1,1),new f(1,0,1,1)],this._cubeDirections=[new j(1,0,0),new j(-1,0,0),new j(0,0,1),new j(0,0,-1),new j(0,1,0),new j(0,-1,0)],this._cubeUps=[new j(0,1,0),new j(0,1,0),new j(0,1,0),new j(0,1,0),new j(0,0,1),new j(0,0,-1)]}function cf(a,b,c,d){Ye.call(this,a,b),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}}),this.distance=void 0!==c?c:0,this.decay=void 0!==d?d:1,this.shadow=new bf}function df(a,b,c,d,e,f){W.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==a?a:-1,this.right=void 0!==b?b:1,this.top=void 0!==c?c:1,this.bottom=void 0!==d?d:-1,this.near=void 0!==e?e:.1,this.far=void 0!==f?f:2e3,this.updateProjectionMatrix()}function ef(){$e.call(this,new df(-5,5,5,-5,.5,500))}function ff(a,b){Ye.call(this,a,b),this.type="DirectionalLight",this.position.copy(n.DefaultUp),this.updateMatrix(),this.target=new n,this.shadow=new ef}function gf(a,b){Ye.call(this,a,b),this.type="AmbientLight",this.castShadow=void 0}function hf(a,b,c,d){Ye.call(this,a,b),this.type="RectAreaLight",this.width=void 0!==c?c:10,this.height=void 0!==d?d:10}function jf(){this.coefficients=[];for(var a=0;a<9;a++)this.coefficients.push(new j)}function kf(a,b){Ye.call(this,void 0,b),this.type="LightProbe",this.sh=void 0!==a?a:new jf}function lf(a){re.call(this,a),this.textures={}}function mf(){O.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function nf(a,b,c,d){"number"==typeof c&&(d=c,c=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),C.call(this,a,b,c),this.meshPerAttribute=d||1}function of(a){re.call(this,a)}function pf(a){re.call(this,a)}function qf(a){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),re.call(this,a),this.options={premultiplyAlpha:"none"}}function rf(){this.type="ShapePath",this.color=new v,this.subPaths=[],this.currentPath=null}function sf(a){this.type="Font",this.data=a}function tf(a,b,c){for(var d=Array.from?Array.from(a):String(a).split(""),e=b/c.resolution,f=(c.boundingBox.yMax-c.boundingBox.yMin+c.underlineThickness)*e,g=[],h=0,i=0,j=0;j<d.length;j++){var k=d[j];if("\n"===k)h=0,i-=f;else{var l=uf(k,e,h,i,c);h+=l.offsetX,g.push(l.path)}}return g}function uf(a,b,c,d,e){var f=e.glyphs[a]||e.glyphs["?"];if(!f)return void console.error('THREE.Font: character "'+a+'" does not exists in font family '+e.familyName+".");var g,h,i,j,k,l,m,n,o=new rf;if(f.o)for(var p=f._cachedOutline||(f._cachedOutline=f.o.split(" ")),q=0,r=p.length;q<r;){var s=p[q++];switch(s){case"m":g=p[q++]*b+c,h=p[q++]*b+d,o.moveTo(g,h);break;case"l":g=p[q++]*b+c,h=p[q++]*b+d,o.lineTo(g,h);break;case"q":i=p[q++]*b+c,j=p[q++]*b+d,k=p[q++]*b+c,l=p[q++]*b+d,o.quadraticCurveTo(k,l,i,j);break;case"b":i=p[q++]*b+c,j=p[q++]*b+d,k=p[q++]*b+c,l=p[q++]*b+d,m=p[q++]*b+c,n=p[q++]*b+d,o.bezierCurveTo(k,l,m,n,i,j)}}return{offsetX:f.ha*b,path:o}}function vf(a){re.call(this,a)}function wf(a){re.call(this,a)}function xf(a,b,c){kf.call(this,void 0,c);var d=(new v).set(a),e=(new v).set(b),f=new j(d.r,d.g,d.b),g=new j(e.r,e.g,e.b),h=Math.sqrt(Math.PI),i=h*Math.sqrt(.75);this.sh.coefficients[0].copy(f).add(g).multiplyScalar(h),this.sh.coefficients[1].copy(f).sub(g).multiplyScalar(i)}function yf(a,b){kf.call(this,void 0,b);var c=(new v).set(a);this.sh.coefficients[0].set(c.r,c.g,c.b).multiplyScalar(2*Math.sqrt(Math.PI))}function zf(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new X,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new X,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Af(a){this.autoStart=void 0===a||a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Bf(){n.call(this),this.type="AudioListener",this.context=pq.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Af}function Cf(a){n.call(this),this.type="Audio",this.listener=a,this.context=a.context,this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}function Df(a){Cf.call(this,a),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Ef(a,b){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=void 0!==b?b:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}function Ff(a,b,c){this.binding=a,this.valueSize=c;var d,e,f;switch(b){case"quaternion":d=this._slerp,e=this._slerpAdditive,f=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*c),this._workIndex=5;break;case"string":case"bool":d=this._select,e=this._select,f=this._setAdditiveIdentityOther,this.buffer=new Array(5*c);break;default:d=this._lerp,e=this._lerpAdditive,f=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*c)}this._mixBufferRegion=d,this._mixBufferRegionAdditive=e,this._setIdentity=f,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}function Gf(a,b,c){var d=c||Hf.parseTrackName(b);this._targetGroup=a,this._bindings=a.subscribe_(b,d)}function Hf(a,b,c){this.path=b,this.parsedPath=c||Hf.parseTrackName(b),this.node=Hf.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a}function If(){this.uuid=Fk.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var b=0,c=arguments.length;b!==c;++b)a[arguments[b].uuid]=b;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}function Jf(a,b,c,d){this._mixer=a,this._clip=b,this._localRoot=c||null,this.blendMode=d||b.blendMode;for(var e=b.tracks,f=e.length,g=new Array(f),h={endingStart:Mj,endingEnd:Mj},i=0;i!==f;++i){var j=e[i].createInterpolant(null);g[i]=j,j.settings=h}this._interpolantSettings=h,this._interpolants=g,this._propertyBindings=new Array(f),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Hj,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Kf(a){this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Lf(a){"string"==typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=arguments[1]),this.value=a}function Mf(a,b,c){ec.call(this,a,b),this.meshPerAttribute=c||1}function Nf(a,b,c,d){this.ray=new s(a,b),this.near=c||0,this.far=d||1/0,this.camera=null,this.layers=new m,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Of(a,b){return a.distance-b.distance}function Pf(a,b,c,d){if(a.layers.test(b.layers)&&a.raycast(b,c),!0===d)for(var e=a.children,f=0,g=e.length;f<g;f++)Pf(e[f],b,c,!0)}function Qf(a,b,c){return this.radius=void 0!==a?a:1,this.phi=void 0!==b?b:0,this.theta=void 0!==c?c:0,this}function Rf(a,b,c){return this.radius=void 0!==a?a:1,this.theta=void 0!==b?b:0,this.y=void 0!==c?c:0,this}function Sf(a,b){this.min=void 0!==a?a:new c(1/0,1/0),this.max=void 0!==b?b:new c(-1/0,-1/0)}function Tf(a,b){this.start=void 0!==a?a:new j,this.end=void 0!==b?b:new j}function Uf(a){n.call(this),this.material=a,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}function Vf(a,b){n.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=b;for(var c=new O,d=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],e=0,f=1,g=32;e<g;e++,f++){var h=e/g*Math.PI*2,i=f/g*Math.PI*2;d.push(Math.cos(h),Math.sin(h),1,Math.cos(i),Math.sin(i),1)}c.setAttribute("position",new K(d,3));var j=new pc({fog:!1,toneMapped:!1});this.cone=new rc(c,j),this.add(this.cone),this.update()}function Wf(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,Wf(a.children[c]));return b}function Xf(a){for(var b=Wf(a),c=new O,d=[],e=[],f=new v(0,0,1),g=new v(0,1,0),h=0;h<b.length;h++){var i=b[h];i.parent&&i.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),e.push(f.r,f.g,f.b),e.push(g.r,g.g,g.b))}c.setAttribute("position",new K(d,3)),c.setAttribute("color",new K(e,3));var j=new pc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});rc.call(this,c,j),this.type="SkeletonHelper",this.root=a,this.bones=b,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}function Yf(a,b,c){this.light=a,this.light.updateMatrixWorld(),this.color=c;var d=new Ed(b,4,2),e=new B({wireframe:!0,fog:!1,toneMapped:!1});P.call(this,d,e),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Zf(a,b,c){n.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;var d=new Ic(b);d.rotateY(.5*Math.PI),this.material=new B({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var e=d.getAttribute("position"),f=new Float32Array(3*e.count);d.setAttribute("color",new C(f,3)),this.add(new P(d,this.material)),this.update()}function $f(a,b,c,d){a=a||10,b=b||10,c=new v(void 0!==c?c:4473924),d=new v(void 0!==d?d:8947848);for(var e=b/2,f=a/b,g=a/2,h=[],i=[],j=0,k=0,l=-g;j<=b;j++,l+=f){h.push(-g,0,l,g,0,l),h.push(l,0,-g,l,0,g);var m=j===e?c:d;m.toArray(i,k),k+=3,m.toArray(i,k),k+=3,m.toArray(i,k),k+=3,m.toArray(i,k),k+=3}var n=new O;n.setAttribute("position",new K(h,3)),n.setAttribute("color",new K(i,3));var o=new pc({vertexColors:!0,toneMapped:!1});rc.call(this,n,o),this.type="GridHelper"}function _f(a,b,c,d,e,f){a=a||10,b=b||16,c=c||8,d=d||64,e=new v(void 0!==e?e:4473924),f=new v(void 0!==f?f:8947848);for(var g=[],h=[],i=0;i<=b;i++){var j=i/b*(2*Math.PI),k=Math.sin(j)*a,l=Math.cos(j)*a;g.push(0,0,0),g.push(k,0,l);var m=1&i?e:f;h.push(m.r,m.g,m.b),h.push(m.r,m.g,m.b)}for(var n=0;n<=c;n++)for(var o=1&n?e:f,p=a-a/c*n,q=0;q<d;q++){var r=q/d*(2*Math.PI),s=Math.sin(r)*p,t=Math.cos(r)*p;g.push(s,0,t),h.push(o.r,o.g,o.b),r=(q+1)/d*(2*Math.PI),s=Math.sin(r)*p,t=Math.cos(r)*p,g.push(s,0,t),h.push(o.r,o.g,o.b)}var u=new O;u.setAttribute("position",new K(g,3)),u.setAttribute("color",new K(h,3));var w=new pc({vertexColors:!0,toneMapped:!1});rc.call(this,u,w),this.type="PolarGridHelper"}function ag(a,b,c){n.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=c,void 0===b&&(b=1);var d=new O;d.setAttribute("position",new K([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var e=new pc({fog:!1,toneMapped:!1});this.lightPlane=new qc(d,e),this.add(this.lightPlane),d=new O,d.setAttribute("position",new K([0,0,0,0,0,1],3)),this.targetLine=new qc(d,e),this.add(this.targetLine),this.update()}function bg(a){function b(a,b,d){c(a,d),c(b,d)}function c(a,b){f.push(0,0,0),g.push(b.r,b.g,b.b),void 0===h[a]&&(h[a]=[]),h[a].push(f.length/3-1)}var d=new O,e=new pc({color:16777215,vertexColors:!0,toneMapped:!1}),f=[],g=[],h={},i=new v(16755200),j=new v(16711680),k=new v(43775),l=new v(16777215),m=new v(3355443);b("n1","n2",i),b("n2","n4",i),b("n4","n3",i),b("n3","n1",i),b("f1","f2",i),b("f2","f4",i),b("f4","f3",i),b("f3","f1",i),b("n1","f1",i),b("n2","f2",i),b("n3","f3",i),b("n4","f4",i),b("p","n1",j),b("p","n2",j),b("p","n3",j),b("p","n4",j),b("u1","u2",k),b("u2","u3",k),b("u3","u1",k),b("c","t",l),b("p","c",m),b("cn1","cn2",m),b("cn3","cn4",m),b("cf1","cf2",m),b("cf3","cf4",m),d.setAttribute("position",new K(f,3)),d.setAttribute("color",new K(g,3)),rc.call(this,d,e),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=h,this.update()}function cg(a,b,c,d,e,f,g){Xq.set(e,f,g).unproject(d);var h=b[a];if(void 0!==h)for(var i=c.getAttribute("position"),j=0,k=h.length;j<k;j++)i.setXYZ(h[j],Xq.x,Xq.y,Xq.z)}function dg(a,b){this.object=a,void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new O;e.setIndex(new C(c,1)),e.setAttribute("position",new C(d,3)),rc.call(this,e,new pc({color:b,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function eg(a,b){this.type="Box3Helper",this.box=a,b=b||16776960;var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],e=new O;e.setIndex(new C(c,1)),e.setAttribute("position",new K(d,3)),rc.call(this,e,new pc({color:b,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function fg(a,b,c){this.plane=a,this.size=void 0===b?1:b;var d=void 0!==c?c:16776960,e=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],f=new O;f.setAttribute("position",new K(e,3)),f.computeBoundingSphere(),qc.call(this,f,new pc({color:d,toneMapped:!1})),this.type="PlaneHelper";var g=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],h=new O;h.setAttribute("position",new K(g,3)),h.computeBoundingSphere(),this.add(new P(h,new B({color:d,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}function gg(a,b,c,d,e,f){n.call(this),this.type="ArrowHelper",void 0===a&&(a=new j(0,0,1)),void 0===b&&(b=new j(0,0,0)),void 0===c&&(c=1),void 0===d&&(d=16776960),void 0===e&&(e=.2*c),void 0===f&&(f=.2*e),void 0===$q&&($q=new O,$q.setAttribute("position",new K([0,0,0,0,1,0],3)),_q=new Od(0,.5,1,5,1),_q.translate(0,-.5,0)),this.position.copy(b),this.line=new qc($q,new pc({color:d,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new P(_q,new B({color:d,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(c,e,f)}function hg(a){a=a||1;var b=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a],c=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],d=new O;d.setAttribute("position",new K(b,3)),d.setAttribute("color",new K(c,3));var e=new pc({vertexColors:!0,toneMapped:!1});rc.call(this,d,e),this.type="AxesHelper"}function ig(a){this._renderer=a,this._pingPongRenderTarget=null,this._blurMaterial=ng(gr),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function jg(a){return void 0!==a&&a.type===ui&&(a.encoding===Uj||a.encoding===Vj||a.encoding===Wj)}function kg(){for(var a=[],b=[],c=[],d=cr,e=0;e<fr;e++){var f=Math.pow(2,d);b.push(f);var g=1/f;e>cr-br?g=er[e-cr+br-1]:0==e&&(g=0),c.push(g);for(var h=1/(f-1),i=-h/2,j=1+h/2,k=[i,i,j,i,j,j,i,i,j,j,i,j],l=6,m=6,n=3,o=2,p=1,q=new Float32Array(n*m*l),r=new Float32Array(o*m*l),s=new Float32Array(p*m*l),t=0;t<l;t++){var u=t%3*2/3-1,v=t>2?0:-1,w=[u,v,0,u+2/3,v,0,u+2/3,v+1,0,u,v,0,u+2/3,v+1,0,u,v+1,0];q.set(w,n*m*t),r.set(k,o*m*t);var x=[t,t,t,t,t,t];s.set(x,p*m*t)}var y=new O;y.setAttribute("position",new C(q,n)),y.setAttribute("uv",new C(r,o)),y.setAttribute("faceIndex",new C(s,p)),a.push(y),d>br&&d--}return{_lodPlanes:a,_sizeLods:b,_sigmas:c}}function lg(a){var b=new g(3*dr,3*dr,a);return b.texture.mapping=fi,b.texture.name="PMREM.cubeUv",b.scissorTest=!0,b}function mg(a,b,c,d,e){a.viewport.set(b,c,d,e),a.scissor.set(b,c,d,e)}function ng(a){return new Ud({name:"SphericalGaussianBlur",defines:{n:a},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(a)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new j(0,1,0)},inputEncoding:{value:hr[Uj]},outputEncoding:{value:hr[Uj]}},vertexShader:qg(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n"+rg()+"\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:ph,depthTest:!1,depthWrite:!1})}function og(){return new Ud({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new c(1,1)},inputEncoding:{value:hr[Uj]},outputEncoding:{value:hr[Uj]}},vertexShader:qg(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n"+rg()+"\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:ph,depthTest:!1,depthWrite:!1})}function pg(){return new Ud({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:hr[Uj]},outputEncoding:{value:hr[Uj]}},vertexShader:qg(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n"+rg()+"\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:ph,depthTest:!1,depthWrite:!1})}function qg(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function rg(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function sg(a,b,c,d,e,f,g){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new z(a,b,c,e,f,g)}function tg(a){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),a}function ug(a){return void 0===a&&(a=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),a.isMultiMaterial=!0,a.materials=a,a.clone=function(){return a.slice()},a}function vg(a,b){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new uc(a,b)}function wg(a){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new hc(a)}function xg(a,b){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new uc(a,b)}function yg(a){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new tc(a)}function zg(a){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new tc(a)}function Ag(a){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new tc(a)}function Bg(a,b,c){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new j(a,b,c)}function Cg(a,b){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new C(a,b).setUsage(vk)}function Dg(a,b){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new D(a,b)}function Eg(a,b){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new E(a,b)}function Fg(a,b){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new F(a,b)}function Gg(a,b){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new G(a,b)}function Hg(a,b){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new H(a,b)}function Ig(a,b){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new I(a,b)}function Jg(a,b){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new J(a,b)}function Kg(a,b){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new K(a,b)}function Lg(a,b){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new L(a,b)}function Mg(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),De.call(this,a),this.type="catmullrom",this.closed=!0}function Ng(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),De.call(this,a),this.type="catmullrom"}function Og(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),De.call(this,a),this.type="catmullrom"}function Pg(a){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new hg(a)}function Qg(a,b){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new dg(a,b)}function Rg(a,b){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new rc(new Md(a.geometry),new pc({color:void 0!==b?b:16777215}))}function Sg(a,b){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new rc(new Ac(a.geometry),new pc({color:void 0!==b?b:16777215}))}function Tg(a){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new se(a)}function Ug(a){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ve(a)}function Vg(a,b,c){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Z(a,c)}function Wg(){console.error("THREE.CanvasRenderer has been removed")}function Xg(){console.error("THREE.JSONLoader has been removed.")}function Yg(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a}),void 0===Math.sign&&(Math.sign=function(a){return a<0?-1:a>0?1:+a}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b});var Zg="118dev",$g={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_g={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ah=0,bh=1,ch=2,dh=3,eh=0,fh=1,gh=0,hh=1,ih=2,jh=3,kh=0,lh=1,mh=2,nh=1,oh=2,ph=0,qh=1,rh=2,sh=3,th=4,uh=5,vh=100,wh=101,xh=102,yh=103,zh=104,Ah=200,Bh=201,Ch=202,Dh=203,Eh=204,Fh=205,Gh=206,Hh=207,Ih=208,Jh=209,Kh=210,Lh=0,Mh=1,Nh=2,Oh=3,Ph=4,Qh=5,Rh=6,Sh=7,Th=0,Uh=1,Vh=2,Wh=0,Xh=1,Yh=2,Zh=3,$h=4,_h=5,ai=300,bi=301,ci=302,di=303,ei=304,fi=306,gi=307,hi=1e3,ii=1001,ji=1002,ki=1003,li=1004,mi=1004,ni=1005,oi=1005,pi=1006,qi=1007,ri=1007,si=1008,ti=1008,ui=1009,vi=1010,wi=1011,xi=1012,yi=1013,zi=1014,Ai=1015,Bi=1016,Ci=1017,Di=1018,Ei=1019,Fi=1020,Gi=1021,Hi=1022,Ii=1023,Ji=1024,Ki=1025,Li=Ii,Mi=1026,Ni=1027,Oi=1028,Pi=1029,Qi=1030,Ri=1031,Si=1032,Ti=1033,Ui=33776,Vi=33777,Wi=33778,Xi=33779,Yi=35840,Zi=35841,$i=35842,_i=35843,aj=36196,bj=37492,cj=37496,dj=37808,ej=37809,fj=37810,gj=37811,hj=37812,ij=37813,jj=37814,kj=37815,lj=37816,mj=37817,nj=37818,oj=37819,pj=37820,qj=37821,rj=36492,sj=37840,tj=37841,uj=37842,vj=37843,wj=37844,xj=37845,yj=37846,zj=37847,Aj=37848,Bj=37849,Cj=37850,Dj=37851,Ej=37852,Fj=37853,Gj=2200,Hj=2201,Ij=2202,Jj=2300,Kj=2301,Lj=2302,Mj=2400,Nj=2401,Oj=2402,Pj=2500,Qj=2501,Rj=0,Sj=1,Tj=2,Uj=3e3,Vj=3001,Wj=3007,Xj=3002,Yj=3003,Zj=3004,$j=3005,_j=3006,ak=3200,bk=3201,ck=0,dk=1,ek=0,fk=7680,gk=7681,hk=7682,ik=7683,jk=34055,kk=34056,lk=5386,mk=512,nk=513,ok=514,pk=515,qk=516,rk=517,sk=518,tk=519,uk=35044,vk=35048,wk=35040,xk=35045,yk=35049,zk=35041,Ak=35046,Bk=35050,Ck=35042;Object.assign(b.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a];if(void 0!==d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=c.slice(0),e=0,f=d.length;e<f;e++)d[e].call(this,a)}}}});for(var Dk=[],Ek=0;Ek<256;Ek++)Dk[Ek]=(Ek<16?"0":"")+Ek.toString(16);var Fk={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(Dk[255&a]+Dk[a>>8&255]+Dk[a>>16&255]+Dk[a>>24&255]+"-"+Dk[255&b]+Dk[b>>8&255]+"-"+Dk[b>>16&15|64]+Dk[b>>24&255]+"-"+Dk[63&c|128]+Dk[c>>8&255]+"-"+Dk[c>>16&255]+Dk[c>>24&255]+Dk[255&d]+Dk[d>>8&255]+Dk[d>>16&255]+Dk[d>>24&255]).toUpperCase()},clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},lerp:function(a,b,c){return(1-c)*a+c*b},smoothstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*(3-2*a)},smootherstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*a*(a*(6*a-15)+10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*Fk.DEG2RAD},radToDeg:function(a){return a*Fk.RAD2DEG},isPowerOfTwo:function(a){return 0==(a&a-1)&&0!==a},ceilPowerOfTwo:function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},floorPowerOfTwo:function(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},setQuaternionFromProperEuler:function(a,b,c,d,e){var f=Math.cos,g=Math.sin,h=f(c/2),i=g(c/2),j=f((b+d)/2),k=g((b+d)/2),l=f((b-d)/2),m=g((b-d)/2),n=f((d-b)/2),o=g((d-b)/2);switch(e){case"XYX":a.set(h*k,i*l,i*m,h*j);break;case"YZY":a.set(i*m,h*k,i*l,h*j);break;case"ZXZ":a.set(i*l,i*m,h*k,h*j);break;case"XZX":a.set(h*k,i*o,i*n,h*j);break;case"YXY":a.set(i*n,h*k,i*o,h*j);break;case"ZYZ":a.set(i*o,i*n,h*k,h*j);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}}};Object.defineProperties(c.prototype,{width:{get:function(){return this.x},set:function(a){this.x=a}},height:{get:function(){return this.y},set:function(a){this.y=a}}}),Object.assign(c.prototype,{isVector2:!0,set:function(a,b){return this.x=a,this.y=b,this},setScalar:function(a){return this.x=a,this.y=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this)},addScalar:function(a){return this.x+=a,this.y+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this)},subScalar:function(a){return this.x-=a,this.y-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a.x,this.y/=a.y,this},divideScalar:function(a){return this.multiplyScalar(1/a)},applyMatrix3:function(a){var b=this.x,c=this.y,d=a.elements;return this.x=d[0]*b+d[3]*c+d[6],this.y=d[1]*b+d[4]*c+d[7],this},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this},clampScalar:function(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},lerpVectors:function(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a},fromBufferAttribute:function(a,b,c){return void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(b),this.y=a.getY(b),this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(d.prototype,{isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){var b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this},extractBasis:function(a,b,c){return a.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this},setFromMatrix4:function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this},multiply:function(a){return this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[3],h=c[6],i=c[1],j=c[4],k=c[7],l=c[2],m=c[5],n=c[8],o=d[0],p=d[3],q=d[6],r=d[1],s=d[4],t=d[7],u=d[2],v=d[5],w=d[8];return e[0]=f*o+g*r+h*u,e[3]=f*p+g*s+h*v,e[6]=f*q+g*t+h*w,e[1]=i*o+j*r+k*u,e[4]=i*p+j*s+k*v,e[7]=i*q+j*t+k*w,e[2]=l*o+m*r+n*u,e[5]=l*p+m*s+n*v,e[8]=l*q+m*t+n*w,this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){void 0!==b&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=c[8],n=m*i-j*l,o=j*k-m*h,p=l*h-i*k,q=e*n+f*o+g*p;if(0===q)return this.set(0,0,0,0,0,0,0,0,0);var r=1/q;return d[0]=n*r,d[1]=(g*l-m*f)*r,d[2]=(j*f-g*i)*r,d[3]=o*r,d[4]=(m*e-g*k)*r,d[5]=(g*h-j*e)*r,d[6]=p*r,d[7]=(f*k-l*e)*r,d[8]=(i*e-f*h)*r,this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},setUvTransform:function(a,b,c,d,e,f,g){var h=Math.cos(e),i=Math.sin(e);this.set(c*h,c*i,-c*(h*f+i*g)+f+a,-d*i,d*h,-d*(-i*f+h*g)+g+b,0,0,1)},scale:function(a,b){var c=this.elements;return c[0]*=a,c[3]*=a,c[6]*=a,c[1]*=b,c[4]*=b,c[7]*=b,this},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.elements,e=d[0],f=d[3],g=d[6],h=d[1],i=d[4],j=d[7];return d[0]=b*e+c*h,d[3]=b*f+c*i,d[6]=b*g+c*j,d[1]=-c*e+b*h,d[4]=-c*f+b*i,d[7]=-c*g+b*j,this},translate:function(a,b){var c=this.elements;return c[0]+=a*c[2],c[3]+=a*c[5],c[6]+=a*c[8],c[1]+=b*c[2],c[4]+=b*c[5],c[7]+=b*c[8],this},equals:function(a){for(var b=this.elements,c=a.elements,d=0;d<9;d++)if(b[d]!==c[d])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;c<9;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]),void 0===b&&(b=0);var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a}});var Gk,Hk={getDataURL:function(a){if(/^data:/i.test(a.src))return a.src;if("undefined"==typeof HTMLCanvasElement)return a.src;var b;if(a instanceof HTMLCanvasElement)b=a;else{void 0===Gk&&(Gk=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Gk.width=a.width,Gk.height=a.height;var c=Gk.getContext("2d");a instanceof ImageData?c.putImageData(a,0,0):c.drawImage(a,0,0,a.width,a.height),b=Gk}return b.width>2048||b.height>2048?b.toDataURL("image/jpeg",.6):b.toDataURL("image/png")}},Ik=0;e.DEFAULT_IMAGE=void 0,e.DEFAULT_MAPPING=ai,e.prototype=Object.assign(Object.create(b.prototype),{constructor:e,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.name=a.name,this.image=a.image,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.encoding=a.encoding,this},toJSON:function(a){var b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var d=this.image;if(void 0===d.uuid&&(d.uuid=Fk.generateUUID()),!b&&void 0===a.images[d.uuid]){var e;if(Array.isArray(d)){e=[];for(var f=0,g=d.length;f<g;f++)e.push(Hk.getDataURL(d[f]))}else e=Hk.getDataURL(d);a.images[d.uuid]={uuid:d.uuid,url:e}}c.image=d.uuid}return b||(a.textures[this.uuid]=c),c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(this.mapping!==ai)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case hi:a.x=a.x-Math.floor(a.x);break;case ii:a.x=a.x<0?0:1;break;case ji:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case hi:a.y=a.y-Math.floor(a.y);break;case ii:a.y=a.y<0?0:1;break;case ji:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}}),Object.defineProperty(e.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}}),Object.defineProperties(f.prototype,{width:{get:function(){return this.z},set:function(a){this.z=a}},height:{get:function(){return this.w},set:function(a){this.w=a}}}),Object.assign(f.prototype,{isVector4:!0,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setScalar:function(a){return this.x=a,this.y=a,this.z=a,this.w=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?r<f?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?s<f?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):t<f?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this.x=(p-n)/x,this.y=(k-o)/x,this.z=(l-j)/x,this.w=Math.acos((i+m+q-1)/2),this},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this.w=Math.max(a.w,Math.min(b.w,this.w)),this},clampScalar:function(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this.z=Math.max(a,Math.min(b,this.z)),this.w=Math.max(a,Math.min(b,this.w)),this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},lerpVectors:function(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this.w=a.w+(b.w-a.w)*c,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a},fromBufferAttribute:function(a,b,c){return void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this.w=a.getW(b),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),g.prototype=Object.assign(Object.create(b.prototype),{constructor:g,isWebGLRenderTarget:!0,setSize:function(a,b){this.width===a&&this.height===b||(this.width=a,this.height=b,this.texture.image.width=a,this.texture.image.height=b,this.dispose()),this.viewport.set(0,0,a,b),this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.width=a.width,this.height=a.height,this.viewport.copy(a.viewport),this.texture=a.texture.clone(),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.depthTexture=a.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),h.prototype=Object.assign(Object.create(g.prototype),{constructor:h,isWebGLMultisampleRenderTarget:!0,copy:function(a){return g.prototype.copy.call(this,a),this.samples=a.samples,this}}),Object.assign(i,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(k!==o||h!==l||i!==m||j!==n){var p=1-g,q=h*l+i*m+j*n+k*o,r=q>=0?1:-1,s=1-q*q;if(s>Number.EPSILON){var t=Math.sqrt(s),u=Math.atan2(t,q*r);p=Math.sin(p*u)/t,g=Math.sin(g*u)/t}var v=g*r;if(h=h*p+l*v,i=i*p+m*v,j=j*p+n*v,k=k*p+o*v,p===1-g){var w=1/Math.sqrt(h*h+i*i+j*j+k*k);h*=w,i*=w,j*=w,k*=w}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k},multiplyQuaternionsFlat:function(a,b,c,d,e,f){var g=c[d],h=c[d+1],i=c[d+2],j=c[d+3],k=e[f],l=e[f+1],m=e[f+2],n=e[f+3];return a[b]=g*n+j*k+h*m-i*l,a[b+1]=h*n+j*l+i*k-g*m,a[b+2]=i*n+j*m+g*l-h*k,a[b+3]=j*n-g*k-h*l-i*m,a}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(a){this._w=a,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this},setFromEuler:function(a,b){if(!a||!a.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c=a._x,d=a._y,e=a._z,f=a.order,g=Math.cos,h=Math.sin,i=g(c/2),j=g(d/2),k=g(e/2),l=h(c/2),m=h(d/2),n=h(e/2);switch(f){case"XYZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"YXZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"ZXY":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"ZYX":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"YZX":this._x=l*j*k+i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k-l*m*n;break;case"XZY":this._x=l*j*k-i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k+l*m*n;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!1!==b&&this._onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k;if(l>0){var m=.5/Math.sqrt(l+1);this._w=.25/m,this._x=(j-h)*m,this._y=(e-i)*m,this._z=(f-d)*m}else if(c>g&&c>k){var n=2*Math.sqrt(1+c-g-k);this._w=(j-h)/n,this._x=.25*n,this._y=(d+f)/n,this._z=(e+i)/n}else if(g>k){var o=2*Math.sqrt(1+g-c-k);this._w=(e-i)/o,this._x=(d+f)/o,this._y=.25*o,this._z=(h+j)/o}else{var p=2*Math.sqrt(1+k-c-g);this._w=(f-d)/p,this._x=(e+i)/p,this._y=(h+j)/p,this._z=.25*p}return this._onChangeCallback(),this},setFromUnitVectors:function(a,b){var c=a.dot(b)+1;return c<1e-6?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=c):(this._x=0,this._y=-a.z,this._z=a.y,this._w=c)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x,this._w=c),this.normalize()},angleTo:function(a){return 2*Math.acos(Math.abs(Fk.clamp(this.dot(a),-1,1)))},rotateTowards:function(a,b){var c=this.angleTo(a);if(0===c)return this;var d=Math.min(1,b/c);return this.slerp(a,d),this},inverse:function(){return this.conjugate()},invert:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(g<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=1-g*g;if(h<=Number.EPSILON){var i=1-b;return this._w=i*f+b*this._w,this._x=i*c+b*this._x,this._y=i*d+b*this._y,this._z=i*e+b*this._z,this.normalize(),this._onChangeCallback(),this}var j=Math.sqrt(h),k=Math.atan2(j,g),l=Math.sin((1-b)*k)/j,m=Math.sin(b*k)/j;return this._w=f*l+this._w*m,this._x=c*l+this._x*m,this._y=d*l+this._y*m,this._z=e*l+this._z*m,this._onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){return void 0===b&&(b=0),this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this._onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a},fromBufferAttribute:function(a,b){return this._x=a.getX(b),this._y=a.getY(b),this._z=a.getZ(b),this._w=a.getW(b),this},_onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){}});var Jk=new j,Kk=new i;Object.assign(j.prototype,{isVector3:!0,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setScalar:function(a){return this.x=a,this.y=a,this.z=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(a){return a&&a.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Kk.setFromEuler(a))},applyAxisAngle:function(a,b){return this.applyQuaternion(Kk.setFromAxisAngle(a,b))},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyNormalMatrix:function(a){return this.applyMatrix3(a).normalize()},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},project:function(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)},unproject:function(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize()},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this},clampScalar:function(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this.z=Math.max(a,Math.min(b,this.z)),this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this},cross:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b)):this.crossVectors(this,a)},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(a){var b=a.lengthSq();if(0===b)return this.set(0,0,0);var c=a.dot(this)/b;return this.copy(a).multiplyScalar(c)},projectOnPlane:function(a){return Jk.copy(this).projectOnVector(a),this.sub(Jk)},reflect:function(a){return this.sub(Jk.copy(a).multiplyScalar(2*this.dot(a)))},angleTo:function(a){var b=Math.sqrt(this.lengthSq()*a.lengthSq());if(0===b)return Math.PI/2;var c=this.dot(a)/b;return Math.acos(Fk.clamp(c,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)},setFromSphericalCoords:function(a,b,c){var d=Math.sin(b)*a;return this.x=d*Math.sin(c),this.y=Math.cos(b)*a,this.z=d*Math.cos(c),this},setFromCylindrical:function(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)},setFromCylindricalCoords:function(a,b,c){return this.x=a*Math.sin(b),this.y=c,this.z=a*Math.cos(b),this},setFromMatrixPosition:function(a){var b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){return this.fromArray(a.elements,4*b)},setFromMatrix3Column:function(a,b){return this.fromArray(a.elements,3*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromBufferAttribute:function(a,b,c){return void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var Lk=new j,Mk=new k,Nk=new j(0,0,0),Ok=new j(1,1,1),Pk=new j,Qk=new j,Rk=new j;Object.assign(k.prototype,{isMatrix4:!0,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new k).fromArray(this.elements)},copy:function(a){var b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this},copyPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractBasis:function(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this},makeBasis:function(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this},extractRotation:function(a){var b=this.elements,c=a.elements,d=1/Lk.setFromMatrixColumn(a,0).length(),e=1/Lk.setFromMatrixColumn(a,1).length(),f=1/Lk.setFromMatrixColumn(a,2).length();return b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d,b[3]=0,b[4]=c[4]*e,b[5]=c[5]*e,b[6]=c[6]*e,b[7]=0,b[8]=c[8]*f,b[9]=c[9]*f,b[10]=c[10]*f,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},makeRotationFromEuler:function(a){a&&a.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=m+n*i,b[5]=l-o*i,b[9]=-g*h,b[2]=o-l*i,b[6]=n+m*i,b[10]=f*h}else if("YXZ"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p+s*g,b[4]=r*g-q,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=q*g-r,b[6]=s+p*g,b[10]=f*h}else if("ZXY"===a.order){var t=h*j,u=h*k,v=i*j,w=i*k;b[0]=t-w*g,b[4]=-f*k,b[8]=v+u*g,b[1]=u+v*g,b[5]=f*j,b[9]=w-t*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){var x=f*j,y=f*k,z=g*j,A=g*k;b[0]=h*j,b[4]=z*i-y,b[8]=x*i+A,b[1]=h*k,b[5]=A*i+x,b[9]=y*i-z,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){var B=f*h,C=f*i,D=g*h,E=g*i;b[0]=h*j,b[4]=E-B*k,b[8]=D*k+C,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=C*k+D,b[10]=B-E*k}else if("XZY"===a.order){var F=f*h,G=f*i,H=g*h,I=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=F*k+I,b[5]=f*j,b[9]=G*k-H,b[2]=H*k-G,b[6]=g*j,b[10]=I*k+F}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},makeRotationFromQuaternion:function(a){return this.compose(Nk,a,Ok)},lookAt:function(a,b,c){var d=this.elements;return Rk.subVectors(a,b),0===Rk.lengthSq()&&(Rk.z=1),Rk.normalize(),Pk.crossVectors(c,Rk),0===Pk.lengthSq()&&(1===Math.abs(c.z)?Rk.x+=1e-4:Rk.z+=1e-4,Rk.normalize(),Pk.crossVectors(c,Rk)),Pk.normalize(),Qk.crossVectors(Rk,Pk),d[0]=Pk.x,d[4]=Qk.x,d[8]=Rk.x,d[1]=Pk.y,d[5]=Qk.y,d[9]=Rk.y,d[2]=Pk.z,d[6]=Qk.z,d[10]=Rk.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},setPosition:function(a,b,c){var d=this.elements;return a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c),this},getInverse:function(a,b){void 0!==b&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15],u=n*s*l-r*o*l+r*k*p-j*s*p-n*k*t+j*o*t,v=q*o*l-m*s*l-q*k*p+i*s*p+m*k*t-i*o*t,w=m*r*l-q*n*l+q*j*p-i*r*p-m*j*t+i*n*t,x=q*n*k-m*r*k-q*j*o+i*r*o+m*j*s-i*n*s,y=e*u+f*v+g*w+h*x;if(0===y)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var z=1/y;return c[0]=u*z,c[1]=(r*o*h-n*s*h-r*g*p+f*s*p+n*g*t-f*o*t)*z,c[2]=(j*s*h-r*k*h+r*g*l-f*s*l-j*g*t+f*k*t)*z,c[3]=(n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p)*z,c[4]=v*z,c[5]=(m*s*h-q*o*h+q*g*p-e*s*p-m*g*t+e*o*t)*z,c[6]=(q*k*h-i*s*h-q*g*l+e*s*l+i*g*t-e*k*t)*z,c[7]=(i*o*h-m*k*h+m*g*l-e*o*l-i*g*p+e*k*p)*z,c[8]=w*z,c[9]=(q*n*h-m*r*h-q*f*p+e*r*p+m*f*t-e*n*t)*z,c[10]=(i*r*h-q*j*h+q*f*l-e*r*l-i*f*t+e*j*t)*z,c[11]=(m*j*h-i*n*h-m*f*l+e*n*l+i*f*p-e*j*p)*z,c[12]=x*z,c[13]=(m*r*g-q*n*g+q*f*o-e*r*o-m*f*s+e*n*s)*z,c[14]=(q*j*g-i*r*g-q*f*k+e*r*k+i*f*s-e*j*s)*z,c[15]=(i*n*g-m*j*g+m*f*k-e*n*k-i*f*o+e*j*o)*z,this},invert:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=k*p*i-o*l*i+o*h*m-g*p*m-k*h*q+g*l*q,s=n*l*i-j*p*i-n*h*m+f*p*m+j*h*q-f*l*q,t=j*o*i-n*k*i+n*g*m-f*o*m-j*g*q+f*k*q,u=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,v=b*r+c*s+d*t+e*u;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/v;return a[0]=r*w,a[1]=(o*l*e-k*p*e-o*d*m+c*p*m+k*d*q-c*l*q)*w,a[2]=(g*p*e-o*h*e+o*d*i-c*p*i-g*d*q+c*h*q)*w,a[3]=(k*h*e-g*l*e-k*d*i+c*l*i+g*d*m-c*h*m)*w,a[4]=s*w,a[5]=(j*p*e-n*l*e+n*d*m-b*p*m-j*d*q+b*l*q)*w,a[6]=(n*h*e-f*p*e-n*d*i+b*p*i+f*d*q-b*h*q)*w,a[7]=(f*l*e-j*h*e+j*d*i-b*l*i-f*d*m+b*h*m)*w,a[8]=t*w,a[9]=(n*k*e-j*o*e-n*c*m+b*o*m+j*c*q-b*k*q)*w,a[10]=(f*o*e-n*g*e+n*c*i-b*o*i-f*c*q+b*g*q)*w,a[11]=(j*g*e-f*k*e-j*c*i+b*k*i+f*c*m-b*g*m)*w,a[12]=u*w,a[13]=(j*o*d-n*k*d+n*c*l-b*o*l-j*c*p+b*k*p)*w,a[14]=(n*g*d-f*o*d-n*c*h+b*o*h+f*c*p-b*g*p)*w,a[15]=(f*k*d-j*g*d+j*c*h-b*k*h-f*c*l+b*g*l)*w,this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,c,d))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},makeShear:function(a,b,c){return this.set(1,b,c,0,a,1,c,0,a,b,1,0,0,0,0,1),this},compose:function(a,b,c){var d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c.x,v=c.y,w=c.z;return d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a.x,d[13]=a.y,d[14]=a.z,d[15]=1,this},decompose:function(a,b,c){var d=this.elements,e=Lk.set(d[0],d[1],d[2]).length(),f=Lk.set(d[4],d[5],d[6]).length(),g=Lk.set(d[8],d[9],d[10]).length();this.determinant()<0&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],Mk.copy(this);var h=1/e,i=1/f,j=1/g;return Mk.elements[0]*=h,Mk.elements[1]*=h,Mk.elements[2]*=h,Mk.elements[4]*=i,Mk.elements[5]*=i,Mk.elements[6]*=i,Mk.elements[8]*=j,Mk.elements[9]*=j,Mk.elements[10]*=j,b.setFromRotationMatrix(Mk),c.x=e,c.y=f,c.z=g,this},makePerspective:function(a,b,c,d,e,f){void 0===f&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var g=this.elements,h=2*e/(b-a),i=2*e/(c-d),j=(b+a)/(b-a),k=(c+d)/(c-d),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),i=1/(c-d),j=1/(f-e),k=(b+a)*h,l=(c+d)*i,m=(f+e)*j;return g[0]=2*h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2*i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2*j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},equals:function(a){for(var b=this.elements,c=a.elements,d=0;d<16;d++)if(b[d]!==c[d])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;c<16;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]),void 0===b&&(b=0);var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a}});var Sk=new k,Tk=new i;l.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],l.DefaultOrder="XYZ",Object.defineProperties(l.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(a){this._order=a,this._onChangeCallback()}}}),Object.assign(l.prototype,{isEuler:!0,set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this},setFromRotationMatrix:function(a,b,c){var d=Fk.clamp,e=a.elements,f=e[0],g=e[4],h=e[8],i=e[1],j=e[5],k=e[9],l=e[2],m=e[6],n=e[10];switch(b=b||this._order){case"XYZ":this._y=Math.asin(d(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-k,n),this._z=Math.atan2(-g,f)):(this._x=Math.atan2(m,j),this._z=0);break;case"YXZ":this._x=Math.asin(-d(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(h,n),this._z=Math.atan2(i,j)):(this._y=Math.atan2(-l,f),this._z=0);break;case"ZXY":this._x=Math.asin(d(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-l,n),this._z=Math.atan2(-g,j)):(this._y=0,this._z=Math.atan2(i,f));break;case"ZYX":this._y=Math.asin(-d(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,n),this._z=Math.atan2(i,f)):(this._x=0,this._z=Math.atan2(-g,j));break;case"YZX":this._z=Math.asin(d(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(-k,j),this._y=Math.atan2(-l,f)):(this._x=0,this._y=Math.atan2(h,n));break;case"XZY":this._z=Math.asin(-d(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(m,j),this._y=Math.atan2(h,f)):(this._x=Math.atan2(-k,n),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}return this._order=b,!1!==c&&this._onChangeCallback(),this},setFromQuaternion:function(a,b,c){return Sk.makeRotationFromQuaternion(a),this.setFromRotationMatrix(Sk,b,c)},setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(a){return Tk.setFromEuler(this),this.setFromQuaternion(Tk,a)},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this._onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new j(this._x,this._y,this._z)},_onChange:function(a){return this._onChangeCallback=a,this},_onChangeCallback:function(){}}),Object.assign(m.prototype,{set:function(a){this.mask=1<<a|0},enable:function(a){this.mask|=1<<a|0},enableAll:function(){this.mask=-1},toggle:function(a){this.mask^=1<<a|0},disable:function(a){this.mask&=~(1<<a|0)},disableAll:function(){this.mask=0},test:function(a){return 0!=(this.mask&a.mask)}});var Uk=0,Vk=new j,Wk=new i,Xk=new k,Yk=new j,Zk=new j,$k=new j,_k=new i,al=new j(1,0,0),bl=new j(0,1,0),cl=new j(0,0,1),dl={type:"added"},el={type:"removed"};n.DefaultUp=new j(0,1,0),n.DefaultMatrixAutoUpdate=!0,n.prototype=Object.assign(Object.create(b.prototype),{constructor:n,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(a){return this.quaternion.premultiply(a),this},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(a,b){return Wk.setFromAxisAngle(a,b),this.quaternion.multiply(Wk),this},rotateOnWorldAxis:function(a,b){return Wk.setFromAxisAngle(a,b),this.quaternion.premultiply(Wk),this},rotateX:function(a){return this.rotateOnAxis(al,a)},rotateY:function(a){return this.rotateOnAxis(bl,a)},rotateZ:function(a){return this.rotateOnAxis(cl,a)},translateOnAxis:function(a,b){return Vk.copy(a).applyQuaternion(this.quaternion),this.position.add(Vk.multiplyScalar(b)),this},translateX:function(a){return this.translateOnAxis(al,a)},translateY:function(a){return this.translateOnAxis(bl,a)},translateZ:function(a){return this.translateOnAxis(cl,a)},localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(a){return a.applyMatrix4(Xk.getInverse(this.matrixWorld))},lookAt:function(a,b,c){a.isVector3?Yk.copy(a):Yk.set(a,b,c);var d=this.parent;this.updateWorldMatrix(!0,!1),Zk.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xk.lookAt(Zk,Yk,this.up):Xk.lookAt(Yk,Zk,this.up),this.quaternion.setFromRotationMatrix(Xk),d&&(Xk.extractRotation(d.matrixWorld),Wk.setFromRotationMatrix(Xk),this.quaternion.premultiply(Wk.inverse()))},add:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(null!==a.parent&&"floorContainer"!=a.name&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(dl)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)},remove:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);return this}var c=this.children.indexOf(a);return-1!==c&&(a.parent=null,this.children.splice(c,1),a.dispatchEvent(el)),this},attach:function(a){return this.updateWorldMatrix(!0,!1),Xk.getInverse(this.matrixWorld),null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),Xk.multiply(a.parent.matrixWorld)),a.applyMatrix4(Xk),a.updateWorldMatrix(!1,!1),this.add(a),this},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c],f=e.getObjectByProperty(a,b);if(void 0!==f)return f}},getWorldPosition:function(a){return void 0===a&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),a=new j),this.updateMatrixWorld(!0),a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(a){return void 0===a&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),a=new i),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Zk,a,$k),a},getWorldScale:function(a){return void 0===a&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),a=new j),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Zk,_k,a),a},getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),a=new j),this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()},raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},updateWorldMatrix:function(a,b){var c=this.parent;if(!0===a&&null!==c&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===b)for(var d=this.children,e=0,f=d.length;e<f;e++)d[e].updateWorldMatrix(!1,!0)},toJSON:function(a){function b(b,c){return void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a)),c.uuid}function c(a){var b=[];for(var c in a){var d=a[c];delete d.metadata,b.push(d)}return b}var d=void 0===a||"string"==typeof a,e={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var f={};if(f.uuid=this.uuid,f.type=this.type,""!==this.name&&(f.name=this.name),!0===this.castShadow&&(f.castShadow=!0),!0===this.receiveShadow&&(f.receiveShadow=!0),!1===this.visible&&(f.visible=!1),!1===this.frustumCulled&&(f.frustumCulled=!1),0!==this.renderOrder&&(f.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(f.userData=this.userData),f.layers=this.layers.mask,f.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(f.matrixAutoUpdate=!1),this.isInstancedMesh&&(f.type="InstancedMesh",f.count=this.count,f.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){f.geometry=b(a.geometries,this.geometry);var g=this.geometry.parameters;if(void 0!==g&&void 0!==g.shapes){var h=g.shapes;if(Array.isArray(h))for(var i=0,j=h.length;i<j;i++){var k=h[i];b(a.shapes,k)}else b(a.shapes,h)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],m=0,n=this.material.length;m<n;m++)l.push(b(a.materials,this.material[m]));f.material=l}else f.material=b(a.materials,this.material);if(this.children.length>0){f.children=[];for(var o=0;o<this.children.length;o++)f.children.push(this.children[o].toJSON(a).object)}if(d){var p=c(a.geometries),q=c(a.materials),r=c(a.textures),s=c(a.images),t=c(a.shapes);p.length>0&&(e.geometries=p),q.length>0&&(e.materials=q),r.length>0&&(e.textures=r),s.length>0&&(e.images=s),t.length>0&&(e.shapes=t)}return e.object=f,e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){if(void 0===b&&(b=!0),this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(var c=0;c<a.children.length;c++){var d=a.children[c];this.add(d.clone())}return this}}),o.prototype=Object.assign(Object.create(n.prototype),{constructor:o,isScene:!0,copy:function(a,b){return n.prototype.copy.call(this,a,b),null!==a.background&&(this.background=a.background.clone()),null!==a.environment&&(this.environment=a.environment.clone()),null!==a.fog&&(this.fog=a.fog.clone()),null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone()),this.autoUpdate=a.autoUpdate,this.matrixAutoUpdate=a.matrixAutoUpdate,this},toJSON:function(a){var b=n.prototype.toJSON.call(this,a);return null!==this.background&&(b.object.background=this.background.toJSON(a)),null!==this.environment&&(b.object.environment=this.environment.toJSON(a)),null!==this.fog&&(b.object.fog=this.fog.toJSON()),b},dispose:function(){this.dispatchEvent({type:"dispose"})}});var fl=[new j,new j,new j,new j,new j,new j,new j,new j],gl=new j,hl=new p,il=new j,jl=new j,kl=new j,ll=new j,ml=new j,nl=new j,ol=new j,pl=new j,ql=new j,rl=new j;Object.assign(p.prototype,{isBox3:!0,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromArray:function(a){for(var b=1/0,c=1/0,d=1/0,e=-1/0,f=-1/0,g=-1/0,h=0,i=a.length;h<i;h+=3){var j=a[h],k=a[h+1],l=a[h+2];j<b&&(b=j),k<c&&(c=k),l<d&&(d=l),j>e&&(e=j),k>f&&(f=k),l>g&&(g=l)}return this.min.set(b,c,d),this.max.set(e,f,g),this},setFromBufferAttribute:function(a){for(var b=1/0,c=1/0,d=1/0,e=-1/0,f=-1/0,g=-1/0,h=0,i=a.count;h<i;h++){var j=a.getX(h),k=a.getY(h),l=a.getZ(h);j<b&&(b=j),k<c&&(c=k),l<d&&(d=l),j>e&&(e=j),k>f&&(f=k),l>g&&(g=l)}return this.min.set(b,c,d),this.max.set(e,f,g),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(a,b){var c=gl.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this},setFromObject:function(a){return this.makeEmpty(),this.expandByObject(a)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){return void 0===a&&(console.warn("THREE.Box3: .getCenter() target is now required"),a=new j),this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){return void 0===a&&(console.warn("THREE.Box3: .getSize() target is now required"),a=new j),this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},expandByObject:function(a){a.updateWorldMatrix(!1,!1);var b=a.geometry;void 0!==b&&(null===b.boundingBox&&b.computeBoundingBox(),hl.copy(b.boundingBox),hl.applyMatrix4(a.matrixWorld),this.union(hl));for(var c=a.children,d=0,e=c.length;d<e;d++)this.expandByObject(c[d]);return this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return void 0===b&&(console.warn("THREE.Box3: .getParameter() target is now required"),b=new j),b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},intersectsSphere:function(a){return this.clampPoint(a.center,gl),gl.distanceToSquared(a.center)<=a.radius*a.radius},intersectsPlane:function(a){var b,c;return a.normal.x>0?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),a.normal.y>0?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),a.normal.z>0?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=-a.constant&&c>=-a.constant},intersectsTriangle:function(a){if(this.isEmpty())return!1;this.getCenter(ol),pl.subVectors(this.max,ol),il.subVectors(a.a,ol),jl.subVectors(a.b,ol),kl.subVectors(a.c,ol),ll.subVectors(jl,il),ml.subVectors(kl,jl),nl.subVectors(il,kl);var b=[0,-ll.z,ll.y,0,-ml.z,ml.y,0,-nl.z,nl.y,ll.z,0,-ll.x,ml.z,0,-ml.x,nl.z,0,-nl.x,-ll.y,ll.x,0,-ml.y,ml.x,0,-nl.y,nl.x,0];return!!q(b,il,jl,kl,pl)&&(b=[1,0,0,0,1,0,0,0,1],!!q(b,il,jl,kl,pl)&&(ql.crossVectors(ll,ml),b=[ql.x,ql.y,ql.z],q(b,il,jl,kl,pl)))},clampPoint:function(a,b){return void 0===b&&(console.warn("THREE.Box3: .clampPoint() target is now required"),b=new j),b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(a){return gl.copy(a).clamp(this.min,this.max).sub(a).length()},getBoundingSphere:function(a){return void 0===a&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(a.center),a.radius=.5*this.getSize(gl).length(),a},intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(a){return this.isEmpty()?this:(fl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),fl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),fl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),fl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),fl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),fl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),fl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),fl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(fl),this)},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});var sl=new p;Object.assign(r.prototype,{set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromPoints:function(a,b){var c=this.center;void 0!==b?c.copy(b):sl.setFromPoints(a).getCenter(c);for(var d=0,e=0,f=a.length;e<f;e++)d=Math.max(d,c.distanceToSquared(a[e]));return this.radius=Math.sqrt(d),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);return void 0===b&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),b=new j),b.copy(a),c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center)),b},getBoundingBox:function(a){return void 0===a&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),a=new p),this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}});var tl=new j,ul=new j,vl=new j,wl=new j,xl=new j,yl=new j,zl=new j;Object.assign(s.prototype,{set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){return void 0===b&&(console.warn("THREE.Ray: .at() target is now required"),b=new j),b.copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){return this.direction.copy(a).sub(this.origin).normalize(),this},recast:function(a){return this.origin.copy(this.at(a,tl)),this},closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),b=new j),b.subVectors(a,this.origin);var c=b.dot(this.direction);return c<0?b.copy(this.origin):b.copy(this.direction).multiplyScalar(c).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(a){var b=tl.subVectors(a,this.origin).dot(this.direction);return b<0?this.origin.distanceToSquared(a):(tl.copy(this.direction).multiplyScalar(b).add(this.origin),tl.distanceToSquared(a))},distanceSqToSegment:function(a,b,c,d){ul.copy(a).add(b).multiplyScalar(.5),vl.copy(b).sub(a).normalize(),wl.copy(this.origin).sub(ul);var e,f,g,h,i=.5*a.distanceTo(b),j=-this.direction.dot(vl),k=wl.dot(this.direction),l=-wl.dot(vl),m=wl.lengthSq(),n=Math.abs(1-j*j);if(n>0)if(e=j*l-k,f=j*k-l,h=i*n,e>=0)if(f>=-h)if(f<=h){var o=1/n;e*=o,f*=o,g=e*(e+j*f+2*k)+f*(j*e+f+2*l)+m}else f=i,e=Math.max(0,-(j*f+k)),g=-e*e+f*(f+2*l)+m;else f=-i,e=Math.max(0,-(j*f+k)),g=-e*e+f*(f+2*l)+m;else f<=-h?(e=Math.max(0,-(-j*i+k)),f=e>0?-i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m):f<=h?(e=0,f=Math.min(Math.max(-i,-l),i),g=f*(f+2*l)+m):(e=Math.max(0,-(j*i+k)),f=e>0?i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m);else f=j>0?-i:i,e=Math.max(0,-(j*f+k)),g=-e*e+f*(f+2*l)+m;return c&&c.copy(this.direction).multiplyScalar(e).add(this.origin),d&&d.copy(vl).multiplyScalar(f).add(ul),g},intersectSphere:function(a,b){tl.subVectors(a.center,this.origin);var c=tl.dot(this.direction),d=tl.dot(tl)-c*c,e=a.radius*a.radius;if(d>e)return null;var f=Math.sqrt(e-d),g=c-f,h=c+f;return g<0&&h<0?null:g<0?this.at(h,b):this.at(g,b)},intersectsSphere:function(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;var c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||a.normal.dot(this.direction)*b<0},intersectBox:function(a,b){var c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d?null:((e>c||c!==c)&&(c=e),(f<d||d!==d)&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d?null:((g>c||c!==c)&&(c=g),(h<d||d!==d)&&(d=h),d<0?null:this.at(c>=0?c:d,b)))},intersectsBox:function(a){return null!==this.intersectBox(a,tl)},intersectTriangle:function(a,b,c,d,e){xl.subVectors(b,a),yl.subVectors(c,a),zl.crossVectors(xl,yl);var f,g=this.direction.dot(zl);if(g>0){if(d)return null;f=1}else{if(!(g<0))return null;f=-1,g=-g}wl.subVectors(this.origin,a);var h=f*this.direction.dot(yl.crossVectors(wl,yl));if(h<0)return null;var i=f*this.direction.dot(xl.cross(wl));if(i<0)return null;if(h+i>g)return null;var j=-f*wl.dot(zl);return j<0?null:this.at(j/g,e)},applyMatrix4:function(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}});var Al=new j,Bl=new j,Cl=new d;Object.assign(t.prototype,{isPlane:!0,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(a,b,c){var d=Al.subVectors(c,b).cross(Bl.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(d,a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return void 0===b&&(console.warn("THREE.Plane: .projectPoint() target is now required"),b=new j),b.copy(this.normal).multiplyScalar(-this.distanceToPoint(a)).add(a)},intersectLine:function(a,b){void 0===b&&(console.warn("THREE.Plane: .intersectLine() target is now required"),b=new j);var c=a.delta(Al),d=this.normal.dot(c);if(0!==d){var e=-(a.start.dot(this.normal)+this.constant)/d;if(!(e<0||e>1))return b.copy(c).multiplyScalar(e).add(a.start)}else if(0===this.distanceToPoint(a.start))return b.copy(a.start)},intersectsLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return void 0===a&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),a=new j),a.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(a,b){var c=b||Cl.getNormalMatrix(a),d=this.coplanarPoint(Al).applyMatrix4(a),e=this.normal.applyMatrix3(c).normalize();return this.constant=-d.dot(e),this},translate:function(a){return this.constant-=a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}});var Dl=new j,El=new j,Fl=new j,Gl=new j,Hl=new j,Il=new j,Jl=new j,Kl=new j,Ll=new j,Ml=new j;Object.assign(u,{getNormal:function(a,b,c,d){void 0===d&&(console.warn("THREE.Triangle: .getNormal() target is now required"),d=new j),d.subVectors(c,b),Dl.subVectors(a,b),d.cross(Dl);var e=d.lengthSq();return e>0?d.multiplyScalar(1/Math.sqrt(e)):d.set(0,0,0)},getBarycoord:function(a,b,c,d,e){Dl.subVectors(d,b),El.subVectors(c,b),Fl.subVectors(a,b);var f=Dl.dot(Dl),g=Dl.dot(El),h=Dl.dot(Fl),i=El.dot(El),k=El.dot(Fl),l=f*i-g*g;if(void 0===e&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),e=new j),0===l)return e.set(-2,-1,-1);var m=1/l,n=(i*h-g*k)*m,o=(f*k-g*h)*m;return e.set(1-n-o,o,n)},containsPoint:function(a,b,c,d){return u.getBarycoord(a,b,c,d,Gl),Gl.x>=0&&Gl.y>=0&&Gl.x+Gl.y<=1},getUV:function(a,b,c,d,e,f,g,h){return this.getBarycoord(a,b,c,d,Gl),h.set(0,0),h.addScaledVector(e,Gl.x),h.addScaledVector(f,Gl.y),h.addScaledVector(g,Gl.z),h},isFrontFacing:function(a,b,c,d){return Dl.subVectors(c,b),El.subVectors(a,b),Dl.cross(El).dot(d)<0}}),Object.assign(u.prototype,{set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},getArea:function(){return Dl.subVectors(this.c,this.b),El.subVectors(this.a,this.b),.5*Dl.cross(El).length()},getMidpoint:function(a){return void 0===a&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),a=new j),a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(a){return u.getNormal(this.a,this.b,this.c,a)},getPlane:function(a){return void 0===a&&(console.warn("THREE.Triangle: .getPlane() target is now required"),a=new t),a.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(a,b){return u.getBarycoord(a,this.a,this.b,this.c,b)},getUV:function(a,b,c,d,e){return u.getUV(a,this.a,this.b,this.c,b,c,d,e)},containsPoint:function(a){return u.containsPoint(a,this.a,this.b,this.c)},isFrontFacing:function(a){return u.isFrontFacing(this.a,this.b,this.c,a)},intersectsBox:function(a){return a.intersectsTriangle(this)},closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),b=new j);var c,d,e=this.a,f=this.b,g=this.c;Hl.subVectors(f,e),Il.subVectors(g,e),Kl.subVectors(a,e);var h=Hl.dot(Kl),i=Il.dot(Kl);if(h<=0&&i<=0)return b.copy(e);Ll.subVectors(a,f);var k=Hl.dot(Ll),l=Il.dot(Ll);if(k>=0&&l<=k)return b.copy(f);var m=h*l-k*i;if(m<=0&&h>=0&&k<=0)return c=h/(h-k),b.copy(e).addScaledVector(Hl,c);Ml.subVectors(a,g);var n=Hl.dot(Ml),o=Il.dot(Ml);if(o>=0&&n<=o)return b.copy(g);var p=n*i-h*o;if(p<=0&&i>=0&&o<=0)return d=i/(i-o),b.copy(e).addScaledVector(Il,d);var q=k*o-n*l;if(q<=0&&l-k>=0&&n-o>=0)return Jl.subVectors(g,f),d=(l-k)/(l-k+(n-o)),b.copy(f).addScaledVector(Jl,d);var r=1/(q+p+m);return c=p*r,d=m*r,b.copy(e).addScaledVector(Hl,c).addScaledVector(Il,d)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}});var Nl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ol={h:0,s:0,l:0},Pl={h:0,s:0,l:0};Object.assign(v.prototype,{isColor:!0,r:1,g:1,b:1,set:function(a){return a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this},setScalar:function(a){return this.r=a,this.g=a,this.b=a,this},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSL:function(a,b,c){if(a=Fk.euclideanModulo(a,1),b=Fk.clamp(b,0,1),c=Fk.clamp(c,0,1),0===b)this.r=this.g=this.b=c;else{var d=c<=.5?c*(1+b):c+b-c*b,e=2*c-d;this.r=w(e,d,a+1/3),this.g=w(e,d,a),this.b=w(e,d,a-1/3)}return this},setStyle:function(a){function b(b){void 0!==b&&parseFloat(b)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d,e=c[1],f=c[2];switch(e){case"rgb":case"rgba":if(d=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(f))return this.r=Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,b(d[5]),this;if(d=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(f))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,b(d[5]),this;break;case"hsl":case"hsla":if(d=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(f)){var g=parseFloat(d[1])/360,h=parseInt(d[2],10)/100,i=parseInt(d[3],10)/100;return b(d[5]),this.setHSL(g,h,i)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){var j=c[1],k=j.length;if(3===k)return this.r=parseInt(j.charAt(0)+j.charAt(0),16)/255,this.g=parseInt(j.charAt(1)+j.charAt(1),16)/255,this.b=parseInt(j.charAt(2)+j.charAt(2),16)/255,this;if(6===k)return this.r=parseInt(j.charAt(0)+j.charAt(1),16)/255,this.g=parseInt(j.charAt(2)+j.charAt(3),16)/255,this.b=parseInt(j.charAt(4)+j.charAt(5),16)/255,this}return a&&a.length>0?this.setColorName(a):this},setColorName:function(a){var b=Nl[a];return void 0!==b?this.setHex(b):console.warn("THREE.Color: Unknown color "+a),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a,b){return void 0===b&&(b=2),this.r=Math.pow(a.r,b),this.g=Math.pow(a.g,b),this.b=Math.pow(a.b,b),this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=b>0?1/b:1;return this.r=Math.pow(a.r,c),this.g=Math.pow(a.g,c),this.b=Math.pow(a.b,c),this},convertGammaToLinear:function(a){return this.copyGammaToLinear(this,a),this},convertLinearToGamma:function(a){return this.copyLinearToGamma(this,a),this},copySRGBToLinear:function(a){return this.r=x(a.r),this.g=x(a.g),this.b=x(a.b),this},copyLinearToSRGB:function(a){return this.r=y(a.r),this.g=y(a.g),this.b=y(a.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){void 0===a&&(console.warn("THREE.Color: .getHSL() target is now required"),a={h:0,s:0,l:0});var b,c,d=this.r,e=this.g,f=this.b,g=Math.max(d,e,f),h=Math.min(d,e,f),i=(h+g)/2;if(h===g)b=0,c=0;else{var j=g-h;switch(c=i<=.5?j/(g+h):j/(2-g-h),g){case d:b=(e-f)/j+(e<f?6:0);break;case e:b=(f-d)/j+2;break;case f:b=(d-e)/j+4}b/=6}return a.h=b,a.s=c,a.l=i,a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){return this.getHSL(Ol),Ol.h+=a,Ol.s+=b,Ol.l+=c,this.setHSL(Ol.h,Ol.s,Ol.l),this},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},sub:function(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},lerpHSL:function(a,b){this.getHSL(Ol),a.getHSL(Pl);var c=Fk.lerp(Ol.h,Pl.h,b),d=Fk.lerp(Ol.s,Pl.s,b),e=Fk.lerp(Ol.l,Pl.l,b);return this.setHSL(c,d,e),this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){return void 0===b&&(b=0),this.r=a[b],this.g=a[b+1],this.b=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a},fromBufferAttribute:function(a,b){return this.r=a.getX(b),this.g=a.getY(b),this.b=a.getZ(b),!0===a.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),v.NAMES=Nl,Object.assign(z.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a,this.b=a.b,this.c=a.c,this.normal.copy(a.normal),this.color.copy(a.color),this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();for(var d=0,e=a.vertexColors.length;d<e;d++)this.vertexColors[d]=a.vertexColors[d].clone();return this}});var Ql=0;A.prototype=Object.assign(Object.create(b.prototype),{constructor:A,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0!==c)if("shading"!==b){var d=this[b];void 0!==d?d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c:console.warn("THREE."+this.type+": '"+b+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=c===nh;else console.warn("THREE.Material: '"+b+"' parameter is undefined.")}},toJSON:function(a){function b(a){var b=[];for(var c in a){var d=a[c];delete d.metadata,b.push(d)}return b}var c=void 0===a||"string"==typeof a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(d.uuid=this.uuid,d.type=this.type,""!==this.name&&(d.name=this.name),this.color&&this.color.isColor&&(d.color=this.color.getHex()),void 0!==this.roughness&&(d.roughness=this.roughness),void 0!==this.metalness&&(d.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(d.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex()),void 0!==this.shininess&&(d.shininess=this.shininess),void 0!==this.clearcoat&&(d.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(d.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid),this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(a).uuid,d.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity,d.refractionRatio=this.refractionRatio,void 0!==this.combine&&(d.combine=this.combine),void 0!==this.envMapIntensity&&(d.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid),void 0!==this.size&&(d.size=this.size),void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation),this.blending!==qh&&(d.blending=this.blending),!0===this.flatShading&&(d.flatShading=this.flatShading),this.side!==kh&&(d.side=this.side),this.vertexColors&&(d.vertexColors=!0),this.opacity<1&&(d.opacity=this.opacity),!0===this.transparent&&(d.transparent=this.transparent),d.depthFunc=this.depthFunc,d.depthTest=this.depthTest,d.depthWrite=this.depthWrite,d.stencilWrite=this.stencilWrite,d.stencilWriteMask=this.stencilWriteMask,d.stencilFunc=this.stencilFunc,d.stencilRef=this.stencilRef,d.stencilFuncMask=this.stencilFuncMask,d.stencilFail=this.stencilFail,d.stencilZFail=this.stencilZFail,d.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(d.rotation=this.rotation),!0===this.polygonOffset&&(d.polygonOffset=!0),0!==this.polygonOffsetFactor&&(d.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(d.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(d.linewidth=this.linewidth),void 0!==this.dashSize&&(d.dashSize=this.dashSize),void 0!==this.gapSize&&(d.gapSize=this.gapSize),void 0!==this.scale&&(d.scale=this.scale),!0===this.dithering&&(d.dithering=!0),this.alphaTest>0&&(d.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(d.wireframe=this.wireframe),this.wireframeLinewidth>1&&(d.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(d.morphTargets=!0),!0===this.morphNormals&&(d.morphNormals=!0),!0===this.skinning&&(d.skinning=!0),!1===this.visible&&(d.visible=!1),!1===this.toneMapped&&(d.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(d.userData=this.userData),c){var e=b(a.textures),f=b(a.images);e.length>0&&(d.textures=e),f.length>0&&(d.images=f)}return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name,this.fog=a.fog,this.blending=a.blending,this.side=a.side,this.flatShading=a.flatShading,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;var b=a.clippingPlanes,c=null;if(null!==b){var d=b.length;c=new Array(d);for(var e=0;e!==d;++e)c[e]=b[e].clone()}return this.clippingPlanes=c,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.premultipliedAlpha=a.premultipliedAlpha,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(A.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}}),B.prototype=Object.create(A.prototype),B.prototype.constructor=B,B.prototype.isMeshBasicMaterial=!0,B.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this};var Rl=new j,Sl=new c;Object.defineProperty(C.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}}),Object.assign(C.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(a){return this.usage=a,this},copy:function(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this},copyAt:function(a,b,c){a*=this.itemSize,c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){return this.array.set(a),this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new v),b[c++]=f.r,b[c++]=f.g,b[c++]=f.b}return this},copyVector2sArray:function(a){for(var b=this.array,d=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),g=new c),b[d++]=g.x,b[d++]=g.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new j),b[c++]=f.x,b[c++]=f.y,b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var g=a[d];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),g=new f),b[c++]=g.x,b[c++]=g.y,b[c++]=g.z,b[c++]=g.w}return this},applyMatrix3:function(a){if(2===this.itemSize)for(var b=0,c=this.count;b<c;b++)Sl.fromBufferAttribute(this,b),Sl.applyMatrix3(a),this.setXY(b,Sl.x,Sl.y);else if(3===this.itemSize)for(var d=0,e=this.count;d<e;d++)Rl.fromBufferAttribute(this,d),Rl.applyMatrix3(a),this.setXYZ(d,Rl.x,Rl.y,Rl.z);return this},applyMatrix4:function(a){for(var b=0,c=this.count;b<c;b++)Rl.x=this.getX(b),Rl.y=this.getY(b),Rl.z=this.getZ(b),Rl.applyMatrix4(a),this.setXYZ(b,Rl.x,Rl.y,Rl.z);return this},applyNormalMatrix:function(a){for(var b=0,c=this.count;b<c;b++)Rl.x=this.getX(b),Rl.y=this.getY(b),Rl.z=this.getZ(b),Rl.applyNormalMatrix(a),this.setXYZ(b,Rl.x,Rl.y,Rl.z);return this},transformDirection:function(a){for(var b=0,c=this.count;b<c;b++)Rl.x=this.getX(b),Rl.y=this.getY(b),Rl.z=this.getZ(b),Rl.transformDirection(a),this.setXYZ(b,Rl.x,Rl.y,Rl.z);return this},set:function(a,b){return void 0===b&&(b=0),this.array.set(a,b),this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){return this.array[a*this.itemSize]=b,this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){return this.array[a*this.itemSize+1]=b,this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){return this.array[a*this.itemSize+2]=b,this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){return this.array[a*this.itemSize+3]=b,this},setXY:function(a,b,c){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this},setXYZ:function(a,b,c,d){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this},setXYZW:function(a,b,c,d,e){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this},onUpload:function(a){return this.onUploadCallback=a,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),D.prototype=Object.create(C.prototype),D.prototype.constructor=D,E.prototype=Object.create(C.prototype),E.prototype.constructor=E,F.prototype=Object.create(C.prototype),F.prototype.constructor=F,G.prototype=Object.create(C.prototype),G.prototype.constructor=G,H.prototype=Object.create(C.prototype),H.prototype.constructor=H,I.prototype=Object.create(C.prototype),I.prototype.constructor=I,J.prototype=Object.create(C.prototype),J.prototype.constructor=J,K.prototype=Object.create(C.prototype),K.prototype.constructor=K,L.prototype=Object.create(C.prototype),L.prototype.constructor=L,Object.assign(M.prototype,{computeGroups:function(a){var b,c,d=[],e=void 0,f=a.faces;for(c=0;c<f.length;c++){var g=f[c];g.materialIndex!==e&&(e=g.materialIndex,void 0!==b&&(b.count=3*c-b.start,d.push(b)),b={start:3*c,materialIndex:e})}void 0!==b&&(b.count=3*c-b.start,d.push(b)),this.groups=d},fromGeometry:function(a){var b,d=a.faces,e=a.vertices,f=a.faceVertexUvs,g=f[0]&&f[0].length>0,h=f[1]&&f[1].length>0,i=a.morphTargets,j=i.length;if(j>0){b=[];for(var k=0;k<j;k++)b[k]={name:i[k].name,data:[]};this.morphTargets.position=b}var l,m=a.morphNormals,n=m.length;if(n>0){l=[];for(var o=0;o<n;o++)l[o]={name:m[o].name,data:[]};this.morphTargets.normal=l}var p=a.skinIndices,q=a.skinWeights,r=p.length===e.length,s=q.length===e.length;e.length>0&&0===d.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var t=0;t<d.length;t++){var u=d[t];this.vertices.push(e[u.a],e[u.b],e[u.c]);var v=u.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var w=u.normal;this.normals.push(w,w,w)}var x=u.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var y=u.color;this.colors.push(y,y,y)}if(!0===g){var z=f[0][t];void 0!==z?this.uvs.push(z[0],z[1],z[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new c,new c,new c))}if(!0===h){var A=f[1][t];void 0!==A?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new c,new c,new c))}for(var B=0;B<j;B++){var C=i[B].vertices;b[B].data.push(C[u.a],C[u.b],C[u.c])}for(var D=0;D<n;D++){var E=m[D].vertexNormals[t];l[D].data.push(E.a,E.b,E.c)}r&&this.skinIndices.push(p[u.a],p[u.b],p[u.c]),s&&this.skinWeights.push(q[u.a],q[u.b],q[u.c])}return this.computeGroups(a),this.verticesNeedUpdate=a.verticesNeedUpdate,this.normalsNeedUpdate=a.normalsNeedUpdate,this.colorsNeedUpdate=a.colorsNeedUpdate,this.uvsNeedUpdate=a.uvsNeedUpdate,this.groupsNeedUpdate=a.groupsNeedUpdate,null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),this}});var Tl=1,Ul=new k,Vl=new n,Wl=new j,Xl=new p,Yl=new p,Zl=new j;O.prototype=Object.assign(Object.create(b.prototype),{constructor:O,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){Array.isArray(a)?this.index=new(N(a)>65535?J:H)(a,1):this.index=a},getAttribute:function(a){return this.attributes[a]},setAttribute:function(a,b){return this.attributes[a]=b,this},deleteAttribute:function(a){return delete this.attributes[a],this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a,this.drawRange.count=b},applyMatrix4:function(a){var b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);var c=this.attributes.normal;if(void 0!==c){var e=(new d).getNormalMatrix(a);c.applyNormalMatrix(e),c.needsUpdate=!0}var f=this.attributes.tangent;return void 0!==f&&(f.transformDirection(a),f.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(a){return Ul.makeRotationX(a),this.applyMatrix4(Ul),this},rotateY:function(a){return Ul.makeRotationY(a),this.applyMatrix4(Ul),this},rotateZ:function(a){return Ul.makeRotationZ(a),this.applyMatrix4(Ul),this},translate:function(a,b,c){return Ul.makeTranslation(a,b,c),this.applyMatrix4(Ul),this},scale:function(a,b,c){return Ul.makeScale(a,b,c),this.applyMatrix4(Ul),this},lookAt:function(a){return Vl.lookAt(a),Vl.updateMatrix(),this.applyMatrix4(Vl.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wl).negate(),this.translate(Wl.x,Wl.y,Wl.z),this},setFromObject:function(a){var b=a.geometry;if(a.isPoints||a.isLine){var c=new K(3*b.vertices.length,3),d=new K(3*b.colors.length,3);if(this.setAttribute("position",c.copyVector3sArray(b.vertices)),this.setAttribute("color",d.copyColorsArray(b.colors)),b.lineDistances&&b.lineDistances.length===b.vertices.length){var e=new K(b.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(b.lineDistances))}null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone()),null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},setFromPoints:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(e.x,e.y,e.z||0)}return this.setAttribute("position",new K(b,3)),this},updateFromObject:function(a){var b=a.geometry;if(a.isMesh){var c=b.__directGeometry;if(!0===b.elementsNeedUpdate&&(c=void 0,b.elementsNeedUpdate=!1),void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate,c.normalsNeedUpdate=b.normalsNeedUpdate,c.colorsNeedUpdate=b.colorsNeedUpdate,c.uvsNeedUpdate=b.uvsNeedUpdate,c.groupsNeedUpdate=b.groupsNeedUpdate,b.verticesNeedUpdate=!1,b.normalsNeedUpdate=!1,b.colorsNeedUpdate=!1,b.uvsNeedUpdate=!1,b.groupsNeedUpdate=!1,b=c}if(!0===b.verticesNeedUpdate){var d=this.attributes.position;void 0!==d&&(d.copyVector3sArray(b.vertices),d.needsUpdate=!0),b.verticesNeedUpdate=!1}if(!0===b.normalsNeedUpdate){var e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(b.normals),e.needsUpdate=!0),b.normalsNeedUpdate=!1}if(!0===b.colorsNeedUpdate){var f=this.attributes.color;void 0!==f&&(f.copyColorsArray(b.colors),f.needsUpdate=!0),b.colorsNeedUpdate=!1}if(b.uvsNeedUpdate){var g=this.attributes.uv;void 0!==g&&(g.copyVector2sArray(b.uvs),g.needsUpdate=!0),b.uvsNeedUpdate=!1}if(b.lineDistancesNeedUpdate){var h=this.attributes.lineDistance;void 0!==h&&(h.copyArray(b.lineDistances),h.needsUpdate=!0),b.lineDistancesNeedUpdate=!1}return b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1),this},fromGeometry:function(a){return a.__directGeometry=(new M).fromGeometry(a),this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);if(this.setAttribute("position",new C(b,3).copyVector3sArray(a.vertices)),a.normals.length>0){var c=new Float32Array(3*a.normals.length);this.setAttribute("normal",new C(c,3).copyVector3sArray(a.normals))}if(a.colors.length>0){var d=new Float32Array(3*a.colors.length);this.setAttribute("color",new C(d,3).copyColorsArray(a.colors))}if(a.uvs.length>0){var e=new Float32Array(2*a.uvs.length);this.setAttribute("uv",new C(e,2).copyVector2sArray(a.uvs))}if(a.uvs2.length>0){var f=new Float32Array(2*a.uvs2.length);this.setAttribute("uv2",new C(f,2).copyVector2sArray(a.uvs2))}this.groups=a.groups;for(var g in a.morphTargets){for(var h=[],i=a.morphTargets[g],j=0,k=i.length;j<k;j++){var l=i[j],m=new K(3*l.data.length,3);m.name=l.name,h.push(m.copyVector3sArray(l.data))}this.morphAttributes[g]=h}if(a.skinIndices.length>0){var n=new K(4*a.skinIndices.length,4);this.setAttribute("skinIndex",n.copyVector4sArray(a.skinIndices))}if(a.skinWeights.length>0){var o=new K(4*a.skinWeights.length,4);this.setAttribute("skinWeight",o.copyVector4sArray(a.skinWeights))}return null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p);var a=this.attributes.position,b=this.morphAttributes.position;if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b)for(var c=0,d=b.length;c<d;c++){var e=b[c];Xl.setFromBufferAttribute(e),this.morphTargetsRelative?(Zl.addVectors(this.boundingBox.min,Xl.min),this.boundingBox.expandByPoint(Zl),Zl.addVectors(this.boundingBox.max,Xl.max),this.boundingBox.expandByPoint(Zl)):(this.boundingBox.expandByPoint(Xl.min),this.boundingBox.expandByPoint(Xl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new r);var a=this.attributes.position,b=this.morphAttributes.position;if(a){var c=this.boundingSphere.center;if(Xl.setFromBufferAttribute(a),b)for(var d=0,e=b.length;d<e;d++){var f=b[d];Yl.setFromBufferAttribute(f),this.morphTargetsRelative?(Zl.addVectors(Xl.min,Yl.min),Xl.expandByPoint(Zl),Zl.addVectors(Xl.max,Yl.max),Xl.expandByPoint(Zl)):(Xl.expandByPoint(Yl.min),Xl.expandByPoint(Yl.max))}Xl.getCenter(c);for(var g=0,h=0,i=a.count;h<i;h++)Zl.fromBufferAttribute(a,h),g=Math.max(g,c.distanceToSquared(Zl));if(b)for(var j=0,k=b.length;j<k;j++)for(var l=b[j],m=this.morphTargetsRelative,n=0,o=l.count;n<o;n++)Zl.fromBufferAttribute(l,n),m&&(Wl.fromBufferAttribute(a,n),Zl.add(Wl)),g=Math.max(g,c.distanceToSquared(Zl));this.boundingSphere.radius=Math.sqrt(g),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.getAttribute("position");if(void 0!==b){var c=this.getAttribute("normal");if(void 0===c)c=new C(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(var d=0,e=c.count;d<e;d++)c.setXYZ(d,0,0,0);var f=new j,g=new j,h=new j,i=new j,k=new j,l=new j,m=new j,n=new j;if(a)for(var o=0,p=a.count;o<p;o+=3){var q=a.getX(o+0),r=a.getX(o+1),s=a.getX(o+2);f.fromBufferAttribute(b,q),g.fromBufferAttribute(b,r),h.fromBufferAttribute(b,s),m.subVectors(h,g),n.subVectors(f,g),m.cross(n),i.fromBufferAttribute(c,q),k.fromBufferAttribute(c,r),l.fromBufferAttribute(c,s),i.add(m),k.add(m),l.add(m),c.setXYZ(q,i.x,i.y,i.z),c.setXYZ(r,k.x,k.y,k.z),c.setXYZ(s,l.x,l.y,l.z)}else for(var t=0,u=b.count;t<u;t+=3)f.fromBufferAttribute(b,t+0),g.fromBufferAttribute(b,t+1),h.fromBufferAttribute(b,t+2),m.subVectors(h,g),n.subVectors(f,g),m.cross(n),c.setXYZ(t+0,m.x,m.y,m.z),c.setXYZ(t+1,m.x,m.y,m.z),c.setXYZ(t+2,m.x,m.y,m.z);this.normalizeNormals(),c.needsUpdate=!0}},merge:function(a,b){if(!a||!a.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);void 0===b&&(b=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var c=this.attributes;for(var d in c)if(void 0!==a.attributes[d])for(var e=c[d],f=e.array,g=a.attributes[d],h=g.array,i=g.itemSize*b,j=Math.min(h.length,f.length-i),k=0,l=i;k<j;k++,l++)f[l]=h[k];return this},normalizeNormals:function(){for(var a=this.attributes.normal,b=0,c=a.count;b<c;b++)Zl.fromBufferAttribute(a,b),Zl.normalize(),a.setXYZ(b,Zl.x,Zl.y,Zl.z)},toNonIndexed:function(){function a(a,b){for(var c=a.array,d=a.itemSize,e=a.normalized,f=new c.constructor(b.length*d),g=0,h=0,i=0,j=b.length;i<j;i++){g=b[i]*d;for(var k=0;k<d;k++)f[h++]=c[g++]}return new C(f,d,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var b=new O,c=this.index.array,d=this.attributes;for(var e in d){var f=d[e],g=a(f,c);b.setAttribute(e,g)}var h=this.morphAttributes;for(var i in h){for(var j=[],k=h[i],l=0,m=k.length;l<m;l++){var n=k[l],o=a(n,c);j.push(o)}b.morphAttributes[i]=j}b.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,q=0,r=p.length;q<r;q++){var s=p[q];b.addGroup(s.start,s.count,s.materialIndex)}return b},toJSON:function(){var a={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),void 0!==this.parameters){var b=this.parameters;for(var c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(a.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});var e=this.attributes;for(var f in e){var g=e[f],h=g.toJSON(a.data);""!==g.name&&(h.name=g.name),a.data.attributes[f]=h}var i={},j=!1;for(var k in this.morphAttributes){for(var l=this.morphAttributes[k],m=[],n=0,o=l.length;n<o;n++){var p=l[n],q=p.toJSON(a.data);""!==p.name&&(q.name=p.name),m.push(q)}m.length>0&&(i[k]=m,j=!0)}j&&(a.data.morphAttributes=i,a.data.morphTargetsRelative=this.morphTargetsRelative);var r=this.groups;r.length>0&&(a.data.groups=JSON.parse(JSON.stringify(r)));var s=this.boundingSphere;return null!==s&&(a.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),a},clone:function(){return(new O).copy(this)},copy:function(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var b={};this.name=a.name;var c=a.index;null!==c&&this.setIndex(c.clone(b));var d=a.attributes;for(var e in d){var f=d[e];this.setAttribute(e,f.clone(b))}var g=a.morphAttributes;for(var h in g){for(var i=[],j=g[h],k=0,l=j.length;k<l;k++)i.push(j[k].clone(b));this.morphAttributes[h]=i}this.morphTargetsRelative=a.morphTargetsRelative;for(var m=a.groups,n=0,o=m.length;n<o;n++){var p=m[n];this.addGroup(p.start,p.count,p.materialIndex)}var q=a.boundingBox;null!==q&&(this.boundingBox=q.clone());var r=a.boundingSphere;return null!==r&&(this.boundingSphere=r.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var $l=new k,_l=new s,am=new r,bm=new j,cm=new j,dm=new j,em=new j,fm=new j,gm=new j,hm=new j,im=new j,jm=new j,km=new c,lm=new c,mm=new c,nm=new j,om=new j;P.prototype=Object.assign(Object.create(n.prototype),{constructor:P,isMesh:!0,copy:function(a){return n.prototype.copy.call(this,a),void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=a.material,this.geometry=a.geometry,this},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){var b=a.morphAttributes,c=Object.keys(b);if(c.length>0){var d=b[c[0]];if(void 0!==d){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,f=d.length;e<f;e++){var g=d[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=e}}}}else{var h=a.morphTargets;void 0!==h&&h.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(a,b){var d=this.geometry,e=this.material,f=this.matrixWorld;if(void 0!==e&&(null===d.boundingSphere&&d.computeBoundingSphere(),am.copy(d.boundingSphere),am.applyMatrix4(f),!1!==a.ray.intersectsSphere(am)&&($l.getInverse(f),_l.copy(a.ray).applyMatrix4($l),null===d.boundingBox||!1!==_l.intersectsBox(d.boundingBox)))){var g;if(d.isBufferGeometry){var h=d.index,i=d.attributes.position,j=d.morphAttributes.position,k=d.morphTargetsRelative,l=d.attributes.uv,m=d.attributes.uv2,n=d.groups,o=d.drawRange;if(null!==h)if(Array.isArray(e))for(var p=0,q=n.length;p<q;p++)for(var r=n[p],s=e[r.materialIndex],t=Math.max(r.start,o.start),v=Math.min(r.start+r.count,o.start+o.count),w=t,x=v;w<x;w+=3){var y=h.getX(w),z=h.getX(w+1),A=h.getX(w+2);g=R(this,s,a,_l,i,j,k,l,m,y,z,A),g&&(g.faceIndex=Math.floor(w/3),g.face.materialIndex=r.materialIndex,b.push(g))}else for(var B=Math.max(0,o.start),C=Math.min(h.count,o.start+o.count),D=B,E=C;D<E;D+=3){var F=h.getX(D),G=h.getX(D+1),H=h.getX(D+2);g=R(this,e,a,_l,i,j,k,l,m,F,G,H),g&&(g.faceIndex=Math.floor(D/3),b.push(g))}else if(void 0!==i)if(Array.isArray(e))for(var I=0,J=n.length;I<J;I++)for(var K=n[I],L=e[K.materialIndex],M=Math.max(K.start,o.start),N=Math.min(K.start+K.count,o.start+o.count),O=M,P=N;O<P;O+=3){var S=O,T=O+1,U=O+2;g=R(this,L,a,_l,i,j,k,l,m,S,T,U),g&&(g.faceIndex=Math.floor(O/3),g.face.materialIndex=K.materialIndex,b.push(g))}else for(var V=Math.max(0,o.start),W=Math.min(i.count,o.start+o.count),X=V,Y=W;X<Y;X+=3){var Z=X,$=X+1,_=X+2;g=R(this,e,a,_l,i,j,k,l,m,Z,$,_),g&&(g.faceIndex=Math.floor(X/3),b.push(g))}}else if(d.isGeometry){var aa,ba=Array.isArray(e),ca=d.vertices,da=d.faces,ea=d.faceVertexUvs[0];ea.length>0&&(aa=ea);for(var fa=0,ga=da.length;fa<ga;fa++){var ha=da[fa],ia=ba?e[ha.materialIndex]:e;if(void 0!==ia){var ja=ca[ha.a],ka=ca[ha.b],la=ca[ha.c];if(g=Q(this,ia,a,_l,ja,ka,la,nm)){if(aa&&aa[fa]){var ma=aa[fa];km.copy(ma[0]),lm.copy(ma[1]),mm.copy(ma[2]),g.uv=u.getUV(nm,ja,ka,la,km,lm,mm,new c)}g.face=ha,g.faceIndex=fa,b.push(g)}}}}}}});var pm=0,qm=new k,rm=new n,sm=new j;S.prototype=Object.assign(Object.create(b.prototype),{constructor:S,isGeometry:!0,applyMatrix4:function(a){for(var b=(new d).getNormalMatrix(a),c=0,e=this.vertices.length;c<e;c++){this.vertices[c].applyMatrix4(a)}for(var f=0,g=this.faces.length;f<g;f++){var h=this.faces[f];h.normal.applyMatrix3(b).normalize();for(var i=0,j=h.vertexNormals.length;i<j;i++)h.vertexNormals[i].applyMatrix3(b).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(a){return qm.makeRotationX(a),this.applyMatrix4(qm),this},rotateY:function(a){return qm.makeRotationY(a),this.applyMatrix4(qm),this},rotateZ:function(a){return qm.makeRotationZ(a),this.applyMatrix4(qm),this},translate:function(a,b,c){return qm.makeTranslation(a,b,c),this.applyMatrix4(qm),this},scale:function(a,b,c){return qm.makeScale(a,b,c),this.applyMatrix4(qm),this},lookAt:function(a){return rm.lookAt(a),rm.updateMatrix(),this.applyMatrix4(rm.matrix),this},fromBufferGeometry:function(a){function b(a,b,e,f){var g=void 0===i?[]:[d.colors[a].clone(),d.colors[b].clone(),d.colors[e].clone()],m=void 0===h?[]:[(new j).fromBufferAttribute(h,a),(new j).fromBufferAttribute(h,b),(new j).fromBufferAttribute(h,e)],n=new z(a,b,e,m,g,f);d.faces.push(n),void 0!==k&&d.faceVertexUvs[0].push([(new c).fromBufferAttribute(k,a),(new c).fromBufferAttribute(k,b),(new c).fromBufferAttribute(k,e)]),void 0!==l&&d.faceVertexUvs[1].push([(new c).fromBufferAttribute(l,a),(new c).fromBufferAttribute(l,b),(new c).fromBufferAttribute(l,e)])}var d=this,e=null!==a.index?a.index:void 0,f=a.attributes;if(void 0===f.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var g=f.position,h=f.normal,i=f.color,k=f.uv,l=f.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var m=0;m<g.count;m++)d.vertices.push((new j).fromBufferAttribute(g,m)),void 0!==i&&d.colors.push((new v).fromBufferAttribute(i,m));var n=a.groups;if(n.length>0)for(var o=0;o<n.length;o++)for(var p=n[o],q=p.start,r=p.count,s=q,t=q+r;s<t;s+=3)void 0!==e?b(e.getX(s),e.getX(s+1),e.getX(s+2),p.materialIndex):b(s,s+1,s+2,p.materialIndex);else if(void 0!==e)for(var u=0;u<e.count;u+=3)b(e.getX(u),e.getX(u+1),e.getX(u+2));else for(var w=0;w<g.count;w+=3)b(w,w+1,w+2);return this.computeFaceNormals(),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(sm).negate(),this.translate(sm.x,sm.y,sm.z),this},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,c=0===b?1:1/b,d=new k;return d.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1),this.applyMatrix4(d),this},computeFaceNormals:function(){for(var a=new j,b=new j,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b],h=this.vertices[e.c];a.subVectors(h,g),b.subVectors(f,g),a.cross(b),a.normalize(),e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);for(var b=new Array(this.vertices.length),c=0,d=this.vertices.length;c<d;c++)b[c]=new j;if(a)for(var e=new j,f=new j,g=0,h=this.faces.length;g<h;g++){var i=this.faces[g],k=this.vertices[i.a],l=this.vertices[i.b],m=this.vertices[i.c];e.subVectors(m,l),f.subVectors(k,l),e.cross(f),b[i.a].add(e),b[i.b].add(e),b[i.c].add(e)}else{this.computeFaceNormals();for(var n=0,o=this.faces.length;n<o;n++){var p=this.faces[n];b[p.a].add(p.normal),b[p.b].add(p.normal),b[p.c].add(p.normal)}}for(var q=0,r=this.vertices.length;q<r;q++)b[q].normalize();for(var s=0,t=this.faces.length;s<t;s++){var u=this.faces[s],v=u.vertexNormals;3===v.length?(v[0].copy(b[u.a]),v[1].copy(b[u.b]),v[2].copy(b[u.c])):(v[0]=b[u.a].clone(),v[1]=b[u.b].clone(),v[2]=b[u.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var a=0,b=this.faces.length;a<b;a++){var c=this.faces[a],d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var a=0,b=this.faces.length;a<b;a++){var c=this.faces[a];c.__originalFaceNormal?c.__originalFaceNormal.copy(c.normal):c.__originalFaceNormal=c.normal.clone(),c.__originalVertexNormals||(c.__originalVertexNormals=[]);for(var d=0,e=c.vertexNormals.length;d<e;d++)c.__originalVertexNormals[d]?c.__originalVertexNormals[d].copy(c.vertexNormals[d]):c.__originalVertexNormals[d]=c.vertexNormals[d].clone()}var f=new S;f.faces=this.faces;for(var g=0,h=this.morphTargets.length;g<h;g++){if(!this.morphNormals[g]){this.morphNormals[g]={},this.morphNormals[g].faceNormals=[],this.morphNormals[g].vertexNormals=[];for(var i=this.morphNormals[g].faceNormals,k=this.morphNormals[g].vertexNormals,l=0,m=this.faces.length;l<m;l++){var n=new j,o={a:new j,b:new j,c:new j};i.push(n),k.push(o)}}var p=this.morphNormals[g];f.vertices=this.morphTargets[g].vertices,f.computeFaceNormals(),f.computeVertexNormals();for(var q=0,r=this.faces.length;q<r;q++){var s=this.faces[q],t=p.faceNormals[q],u=p.vertexNormals[q];t.copy(s.normal),u.a.copy(s.vertexNormals[0]),u.b.copy(s.vertexNormals[1]),u.c.copy(s.vertexNormals[2])}}for(var v=0,w=this.faces.length;v<w;v++){var x=this.faces[v];x.normal=x.__originalFaceNormal,x.vertexNormals=x.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new r),this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!a||!a.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);var e,f=this.vertices.length,g=this.vertices,h=a.vertices,i=this.faces,j=a.faces,k=this.colors,l=a.colors;void 0===c&&(c=0),void 0!==b&&(e=(new d).getNormalMatrix(b));for(var m=0,n=h.length;m<n;m++){var o=h[m],p=o.clone();void 0!==b&&p.applyMatrix4(b),g.push(p)}for(var q=0,r=l.length;q<r;q++)k.push(l[q].clone());for(var s=0,t=j.length;s<t;s++){var u=j[s],v=void 0,w=void 0,x=void 0,y=u.vertexNormals,A=u.vertexColors;v=new z(u.a+f,u.b+f,u.c+f),v.normal.copy(u.normal),void 0!==e&&v.normal.applyMatrix3(e).normalize();for(var B=0,C=y.length;B<C;B++)w=y[B].clone(),void 0!==e&&w.applyMatrix3(e).normalize(),v.vertexNormals.push(w);v.color.copy(u.color);for(var D=0,E=A.length;D<E;D++)x=A[D],v.vertexColors.push(x.clone());v.materialIndex=u.materialIndex+c,v.nodeId=u.nodeId,i.push(v)}for(var F=0,G=a.faceVertexUvs.length;F<G;F++){var H=a.faceVertexUvs[F];void 0===this.faceVertexUvs[F]&&(this.faceVertexUvs[F]=[]);for(var I=0,J=H.length;I<J;I++){for(var K=H[I],L=[],M=0,N=K.length;M<N;M++)L.push(K[M].clone());this.faceVertexUvs[F].push(L)}}},mergeMesh:function(a){if(!a||!a.isMesh)return void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a);a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)},mergeVertices:function(){for(var a={},b=[],c=[],d=4,e=Math.pow(10,d),f=0,g=this.vertices.length;f<g;f++){var h=this.vertices[f],i=Math.round(h.x*e)+"_"+Math.round(h.y*e)+"_"+Math.round(h.z*e);void 0===a[i]?(a[i]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[i]]}for(var j=[],k=0,l=this.faces.length;k<l;k++){var m=this.faces[k];m.a=c[m.a],m.b=c[m.b],m.c=c[m.c];for(var n=[m.a,m.b,m.c],o=0;o<3;o++)if(n[o]===n[(o+1)%3]){j.push(k);break}}for(var p=j.length-1;p>=0;p--){var q=j[p];this.faces.splice(q,1);for(var r=0,s=this.faceVertexUvs.length;r<s;r++)this.faceVertexUvs[r].splice(q,1)}var t=this.vertices.length-b.length;return this.vertices=b,t},setFromPoints:function(a){this.vertices=[];for(var b=0,c=a.length;b<c;b++){var d=a[b];this.vertices.push(new j(d.x,d.y,d.z||0))}return this},sortFacesByMaterialIndex:function(){function a(a,b){return a.materialIndex-b.materialIndex}for(var b=this.faces,c=b.length,d=0;d<c;d++)b[d]._id=d;b.sort(a);var e,f,g=this.faceVertexUvs[0],h=this.faceVertexUvs[1];g&&g.length===c&&(e=[]),h&&h.length===c&&(f=[]);for(var i=0;i<c;i++){var j=b[i]._id;e&&e.push(g[j]),f&&f.push(h[j])}e&&(this.faceVertexUvs[0]=e),f&&(this.faceVertexUvs[1]=f)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();return void 0!==m[b]?m[b]:(m[b]=l.length/3,l.push(a.x,a.y,a.z),m[b])}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();return void 0!==o[b]?o[b]:(o[b]=n.length,n.push(a.getHex()),o[b])}function d(a){var b=a.x.toString()+a.y.toString();return void 0!==q[b]?q[b]:(q[b]=p.length/2,p.push(a.x,a.y),q[b])}var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var f=this.parameters;for(var g in f)void 0!==f[g]&&(e[g]=f[g]);return e}for(var h=[],i=0;i<this.vertices.length;i++){var j=this.vertices[i];h.push(j.x,j.y,j.z)}for(var k=[],l=[],m={},n=[],o={},p=[],q={},r=0;r<this.faces.length;r++){var s=this.faces[r],t=void 0!==this.faceVertexUvs[0][r],u=s.normal.length()>0,v=s.vertexNormals.length>0,w=1!==s.color.r||1!==s.color.g||1!==s.color.b,x=s.vertexColors.length>0,y=0;if(y=a(y,0,0),y=a(y,1,!0),y=a(y,2,!1),y=a(y,3,t),y=a(y,4,u),y=a(y,5,v),y=a(y,6,w),y=a(y,7,x),k.push(y),k.push(s.a,s.b,s.c),k.push(s.materialIndex),t){var z=this.faceVertexUvs[0][r];k.push(d(z[0]),d(z[1]),d(z[2]))}if(u&&k.push(b(s.normal)),v){var A=s.vertexNormals;k.push(b(A[0]),b(A[1]),b(A[2]))}if(w&&k.push(c(s.color)),x){var B=s.vertexColors;k.push(c(B[0]),c(B[1]),c(B[2]))}}return e.data={},e.data.vertices=h,e.data.normals=l,n.length>0&&(e.data.colors=n),p.length>0&&(e.data.uvs=[p]),e.data.faces=k,e},clone:function(){return(new S).copy(this)},copy:function(a){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=a.name;for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());for(var e=a.colors,f=0,g=e.length;f<g;f++)this.colors.push(e[f].clone());for(var h=a.faces,i=0,j=h.length;i<j;i++)this.faces.push(h[i].clone());for(var k=0,l=a.faceVertexUvs.length;k<l;k++){var m=a.faceVertexUvs[k];void 0===this.faceVertexUvs[k]&&(this.faceVertexUvs[k]=[]);for(var n=0,o=m.length;n<o;n++){for(var p=m[n],q=[],r=0,s=p.length;r<s;r++){var t=p[r];q.push(t.clone())}this.faceVertexUvs[k].push(q)}}for(var u=a.morphTargets,v=0,w=u.length;v<w;v++){var x={};if(x.name=u[v].name,void 0!==u[v].vertices){x.vertices=[];for(var y=0,z=u[v].vertices.length;y<z;y++)x.vertices.push(u[v].vertices[y].clone())}if(void 0!==u[v].normals){x.normals=[];for(var A=0,B=u[v].normals.length;A<B;A++)x.normals.push(u[v].normals[A].clone())}this.morphTargets.push(x)}for(var C=a.morphNormals,D=0,E=C.length;D<E;D++){var F={};if(void 0!==C[D].vertexNormals){F.vertexNormals=[];for(var G=0,H=C[D].vertexNormals.length;G<H;G++){var I=C[D].vertexNormals[G],J={};J.a=I.a.clone(),J.b=I.b.clone(),J.c=I.c.clone(),F.vertexNormals.push(J)}}if(void 0!==C[D].faceNormals){F.faceNormals=[];for(var K=0,L=C[D].faceNormals.length;K<L;K++)F.faceNormals.push(C[D].faceNormals[K].clone())}this.morphNormals.push(F)}for(var M=a.skinWeights,N=0,O=M.length;N<O;N++)this.skinWeights.push(M[N].clone());for(var P=a.skinIndices,Q=0,R=P.length;Q<R;Q++)this.skinIndices.push(P[Q].clone());for(var S=a.lineDistances,T=0,U=S.length;T<U;T++)this.lineDistances.push(S[T]);var V=a.boundingBox;null!==V&&(this.boundingBox=V.clone());var W=a.boundingSphere;return null!==W&&(this.boundingSphere=W.clone()),this.elementsNeedUpdate=a.elementsNeedUpdate,this.verticesNeedUpdate=a.verticesNeedUpdate,this.uvsNeedUpdate=a.uvsNeedUpdate,this.normalsNeedUpdate=a.normalsNeedUpdate,this.colorsNeedUpdate=a.colorsNeedUpdate,this.lineDistancesNeedUpdate=a.lineDistancesNeedUpdate,this.groupsNeedUpdate=a.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var tm=function(a){function b(b,c,d,e,f,g){a.call(this),this.type="BoxGeometry",this.parameters={width:b,height:c,depth:d,widthSegments:e,heightSegments:f,depthSegments:g},this.fromBufferGeometry(new um(b,c,d,e,f,g)),this.mergeVertices()}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b}(S),um=function(a){function b(b,c,d,e,f,g){function h(a,b,c,d,e,f,g,h,q,r,s){for(var t=f/q,u=g/r,v=f/2,w=g/2,x=h/2,y=q+1,z=r+1,A=0,B=0,C=new j,D=0;D<z;D++)for(var E=D*u-w,F=0;F<y;F++){var G=F*t-v;C[a]=G*d,C[b]=E*e,C[c]=x,l.push(C.x,C.y,C.z),C[a]=0,C[b]=0,C[c]=h>0?1:-1,m.push(C.x,C.y,C.z),n.push(F/q),n.push(1-D/r),A+=1}for(var H=0;H<r;H++)for(var I=0;I<q;I++){var J=o+I+y*H,K=o+I+y*(H+1),L=o+(I+1)+y*(H+1),M=o+(I+1)+y*H;k.push(J,K,M),k.push(K,L,M),B+=6}i.addGroup(p,B,s),p+=B,o+=A}a.call(this),this.type="BoxBufferGeometry",this.parameters={width:b,height:c,depth:d,widthSegments:e,heightSegments:f,depthSegments:g};var i=this;b=b||1,c=c||1,d=d||1,e=Math.floor(e)||1,f=Math.floor(f)||1,g=Math.floor(g)||1;var k=[],l=[],m=[],n=[],o=0,p=0;h("z","y","x",-1,-1,d,c,b,g,f,0),h("z","y","x",1,-1,d,c,-b,g,f,1),h("x","z","y",1,1,b,d,c,e,g,2),h("x","z","y",1,-1,b,d,-c,e,g,3),h("x","y","z",1,-1,b,c,d,e,f,4),h("x","y","z",-1,-1,b,c,-d,e,f,5),this.setIndex(k),this.setAttribute("position",new K(l,3)),this.setAttribute("normal",new K(m,3)),this.setAttribute("uv",new K(n,2))}return a&&(b.__proto__=a),b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b}(O),vm={clone:T,merge:U},wm="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",xm="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";V.prototype=Object.create(A.prototype),V.prototype.constructor=V,V.prototype.isShaderMaterial=!0,V.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=T(a.uniforms),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.lights=a.lights,this.clipping=a.clipping,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.extensions=Object.assign({},a.extensions),this},V.prototype.toJSON=function(a){var b=A.prototype.toJSON.call(this,a);b.uniforms={};for(var c in this.uniforms){var d=this.uniforms[c],e=d.value;e&&e.isTexture?b.uniforms[c]={type:"t",value:e.toJSON(a).uuid}:e&&e.isColor?b.uniforms[c]={type:"c",value:e.getHex()}:e&&e.isVector2?b.uniforms[c]={type:"v2",value:e.toArray()}:e&&e.isVector3?b.uniforms[c]={type:"v3",value:e.toArray()}:e&&e.isVector4?b.uniforms[c]={type:"v4",value:e.toArray()}:e&&e.isMatrix3?b.uniforms[c]={type:"m3",value:e.toArray()}:e&&e.isMatrix4?b.uniforms[c]={type:"m4",value:e.toArray()}:b.uniforms[c]={value:e}}Object.keys(this.defines).length>0&&(b.defines=this.defines),b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader;var f={};for(var g in this.extensions)!0===this.extensions[g]&&(f[g]=!0);return Object.keys(f).length>0&&(b.extensions=f),b},W.prototype=Object.assign(Object.create(n.prototype),{constructor:W,isCamera:!0,copy:function(a,b){return n.prototype.copy.call(this,a,b),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this},getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),a=new j),this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(-b[8],-b[9],-b[10]).normalize()},updateMatrixWorld:function(a){n.prototype.updateMatrixWorld.call(this,a),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(a,b){n.prototype.updateWorldMatrix.call(this,a,b),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),X.prototype=Object.assign(Object.create(W.prototype),{constructor:X,isPerspectiveCamera:!0,copy:function(a,b){return W.prototype.copy.call(this,a,b),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=null===a.view?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this},setFocalLength:function(a){var b=.5*this.getFilmHeight()/a;this.fov=2*Fk.RAD2DEG*Math.atan(b),this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*Fk.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*Fk.RAD2DEG*Math.atan(Math.tan(.5*Fk.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*Fk.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){var g=f.fullWidth,h=f.fullHeight;e+=f.offsetX*d/g,b-=f.offsetY*c/h,d*=f.width/g,c*=f.height/h}var i=this.filmOffset;0!==i&&(e+=a*i/this.getFilmWidth()),this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(a){var b=n.prototype.toJSON.call(this,a);return b.object.fov=this.fov,b.object.zoom=this.zoom,b.object.near=this.near,b.object.far=this.far,b.object.focus=this.focus,b.object.aspect=this.aspect,null!==this.view&&(b.object.view=Object.assign({},this.view)),b.object.filmGauge=this.filmGauge,b.object.filmOffset=this.filmOffset,b}});var ym=90,zm=1;Y.prototype=Object.create(n.prototype),Y.prototype.constructor=Y,Z.prototype=Object.create(g.prototype),Z.prototype.constructor=Z,Z.prototype.isWebGLCubeRenderTarget=!0,Z.prototype.fromEquirectangularTexture=function(a,b){this.texture.type=b.type,this.texture.format=b.format,this.texture.encoding=b.encoding;var c=new o,d={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},e=new V({name:"CubemapFromEquirect",uniforms:T(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,side:lh,blending:ph});e.uniforms.tEquirect.value=b;var f=new P(new um(5,5,5),e);return c.add(f),new Y(1,10,this).update(a,c),f.geometry.dispose(),f.material.dispose(),this},$.prototype=Object.create(e.prototype),$.prototype.constructor=$,$.prototype.isDataTexture=!0;var Am=new r,Bm=new j;Object.assign(_.prototype,{set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;c<6;c++)b[c].copy(a.planes[c]);return this},setFromProjectionMatrix:function(a){var b=this.planes,c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];return b[0].setComponents(g-d,k-h,o-l,s-p).normalize(),b[1].setComponents(g+d,k+h,o+l,s+p).normalize(),b[2].setComponents(g+e,k+i,o+m,s+q).normalize(),b[3].setComponents(g-e,k-i,o-m,s-q).normalize(),b[4].setComponents(g-f,k-j,o-n,s-r).normalize(),b[5].setComponents(g+f,k+j,o+n,s+r).normalize(),this},intersectsObject:function(a){var b=a.geometry;return null===b.boundingSphere&&b.computeBoundingSphere(),Am.copy(b.boundingSphere).applyMatrix4(a.matrixWorld),this.intersectsSphere(Am)},intersectsSprite:function(a){return Am.center.set(0,0,0),Am.radius=.7071067811865476,Am.applyMatrix4(a.matrixWorld),this.intersectsSphere(Am)},intersectsSphere:function(a){for(var b=this.planes,c=a.center,d=-a.radius,e=0;e<6;e++){if(b[e].distanceToPoint(c)<d)return!1}return!0},intersectsBox:function(a){for(var b=this.planes,c=0;c<6;c++){var d=b[c];if(Bm.x=d.normal.x>0?a.max.x:a.min.x,Bm.y=d.normal.y>0?a.max.y:a.min.y,Bm.z=d.normal.z>0?a.max.z:a.min.z,d.distanceToPoint(Bm)<0)return!1}return!0},containsPoint:function(a){for(var b=this.planes,c=0;c<6;c++)if(b[c].distanceToPoint(a)<0)return!1;return!0}});var Cm={common:{diffuse:{value:new v(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new d},uv2Transform:{value:new d},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new c(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new v(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new v(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new d}},sprite:{diffuse:{value:new v(15658734)},opacity:{value:1},center:{value:new c(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new d}}};ca.prototype=Object.create(S.prototype),ca.prototype.constructor=ca,da.prototype=Object.create(O.prototype),da.prototype.constructor=da;var Dm="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",Em="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Fm="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",Gm="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",Hm="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Im="vec3 transformed = vec3( position );",Jm="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Km="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",Lm="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Mm="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",Nm="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Om="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Pm="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",Qm="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",Rm="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Sm="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Tm="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",Um="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",Vm="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",Wm="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",Xm="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",Ym="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",Zm="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",$m="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",_m="gl_FragColor = linearToOutputTexel( gl_FragColor );",an="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",bn="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",cn="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",dn="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",en="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",fn="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",gn="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",hn="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",jn="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",kn="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",ln="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",mn="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",nn="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",on="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",pn="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",qn="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",rn="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",sn="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",tn="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",un="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",vn="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",wn="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",xn="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",yn="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",zn="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",An="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Bn="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Cn="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",Dn="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",En="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",Fn="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Gn="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Hn="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",In="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Jn="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Kn="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",Ln="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",Mn="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",Nn="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",On="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",Pn="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",Qn="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",Rn="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",Sn="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",Tn="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",Un="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",Vn="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",Wn="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",Xn="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",Yn="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",Zn="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",$n="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",_n="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",ao="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",bo="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",co="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",eo="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",fo="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",go="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",ho="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",io="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",jo="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",ko="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",lo="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",mo="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",no="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",oo="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",po="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",qo="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",ro="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",so="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",to="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",uo="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",vo="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",wo="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",xo="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",yo="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",zo="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Ao="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Bo="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",Co="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Do="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Eo="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Fo="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Go="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ho="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Io="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Jo="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Ko="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Lo="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Mo="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",No="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Oo="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Po="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Qo="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",Ro="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",So="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",To="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Uo="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Vo="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Wo="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Xo="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Yo={alphamap_fragment:Dm,alphamap_pars_fragment:Em,alphatest_fragment:Fm,aomap_fragment:Gm,aomap_pars_fragment:Hm,begin_vertex:Im,beginnormal_vertex:Jm,bsdfs:Km,bumpmap_pars_fragment:Lm,clipping_planes_fragment:Mm,clipping_planes_pars_fragment:Nm,clipping_planes_pars_vertex:Om,clipping_planes_vertex:Pm,color_fragment:Qm,color_pars_fragment:Rm,color_pars_vertex:Sm,color_vertex:Tm,common:Um,cube_uv_reflection_fragment:Vm,defaultnormal_vertex:Wm,displacementmap_pars_vertex:Xm,displacementmap_vertex:Ym,emissivemap_fragment:Zm,emissivemap_pars_fragment:$m,encodings_fragment:_m,encodings_pars_fragment:an,envmap_fragment:bn,envmap_common_pars_fragment:cn,envmap_pars_fragment:dn,envmap_pars_vertex:en,envmap_physical_pars_fragment:qn,envmap_vertex:fn,fog_vertex:gn,fog_pars_vertex:hn,fog_fragment:jn,fog_pars_fragment:kn,gradientmap_pars_fragment:ln,lightmap_fragment:mn,lightmap_pars_fragment:nn,lights_lambert_vertex:on,lights_pars_begin:pn,lights_toon_fragment:rn,lights_toon_pars_fragment:sn,lights_phong_fragment:tn,lights_phong_pars_fragment:un,lights_physical_fragment:vn,lights_physical_pars_fragment:wn,lights_fragment_begin:xn,lights_fragment_maps:yn,lights_fragment_end:zn,logdepthbuf_fragment:An,logdepthbuf_pars_fragment:Bn,logdepthbuf_pars_vertex:Cn,logdepthbuf_vertex:Dn,map_fragment:En,map_pars_fragment:Fn,map_particle_fragment:Gn,map_particle_pars_fragment:Hn,metalnessmap_fragment:In,metalnessmap_pars_fragment:Jn,morphnormal_vertex:Kn,morphtarget_pars_vertex:Ln,morphtarget_vertex:Mn,normal_fragment_begin:Nn,normal_fragment_maps:On,normalmap_pars_fragment:Pn,clearcoat_normal_fragment_begin:Qn,clearcoat_normal_fragment_maps:Rn,clearcoat_pars_fragment:Sn,packing:Tn,premultiplied_alpha_fragment:Un,project_vertex:Vn,dithering_fragment:Wn,dithering_pars_fragment:Xn,roughnessmap_fragment:Yn,roughnessmap_pars_fragment:Zn,shadowmap_pars_fragment:$n,shadowmap_pars_vertex:_n,shadowmap_vertex:ao,shadowmask_pars_fragment:bo,skinbase_vertex:co,skinning_pars_vertex:eo,skinning_vertex:fo,skinnormal_vertex:go,specularmap_fragment:ho,specularmap_pars_fragment:io,tonemapping_fragment:jo,tonemapping_pars_fragment:ko,uv_pars_fragment:lo,uv_pars_vertex:mo,uv_vertex:no,uv2_pars_fragment:oo,uv2_pars_vertex:po,uv2_vertex:qo,worldpos_vertex:ro,background_frag:so,background_vert:to,cube_frag:uo,cube_vert:vo,depth_frag:wo,depth_vert:xo,distanceRGBA_frag:yo,distanceRGBA_vert:zo,equirect_frag:Ao,equirect_vert:Bo,linedashed_frag:Co,linedashed_vert:Do,meshbasic_frag:Eo,meshbasic_vert:Fo,meshlambert_frag:Go,meshlambert_vert:Ho,meshmatcap_frag:Io,meshmatcap_vert:Jo,meshtoon_frag:Ko,meshtoon_vert:Lo,meshphong_frag:Mo,meshphong_vert:No,meshphysical_frag:Oo,meshphysical_vert:Po,normal_frag:Qo,normal_vert:Ro,points_frag:So,points_vert:To,shadow_frag:Uo,shadow_vert:Vo,sprite_frag:Wo,sprite_vert:Xo},Zo={basic:{uniforms:U([Cm.common,Cm.specularmap,Cm.envmap,Cm.aomap,Cm.lightmap,Cm.fog]),vertexShader:Yo.meshbasic_vert,fragmentShader:Yo.meshbasic_frag},lambert:{uniforms:U([Cm.common,Cm.specularmap,Cm.envmap,Cm.aomap,Cm.lightmap,Cm.emissivemap,Cm.fog,Cm.lights,{emissive:{value:new v(0)}}]),vertexShader:Yo.meshlambert_vert,fragmentShader:Yo.meshlambert_frag},phong:{uniforms:U([Cm.common,Cm.specularmap,Cm.envmap,Cm.aomap,Cm.lightmap,Cm.emissivemap,Cm.bumpmap,Cm.normalmap,Cm.displacementmap,Cm.fog,Cm.lights,{emissive:{value:new v(0)},specular:{value:new v(1118481)},shininess:{value:30}}]),vertexShader:Yo.meshphong_vert,fragmentShader:Yo.meshphong_frag},standard:{uniforms:U([Cm.common,Cm.envmap,Cm.aomap,Cm.lightmap,Cm.emissivemap,Cm.bumpmap,Cm.normalmap,Cm.displacementmap,Cm.roughnessmap,Cm.metalnessmap,Cm.fog,Cm.lights,{emissive:{value:new v(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Yo.meshphysical_vert,fragmentShader:Yo.meshphysical_frag},toon:{uniforms:U([Cm.common,Cm.aomap,Cm.lightmap,Cm.emissivemap,Cm.bumpmap,Cm.normalmap,Cm.displacementmap,Cm.gradientmap,Cm.fog,Cm.lights,{emissive:{value:new v(0)}}]),vertexShader:Yo.meshtoon_vert,fragmentShader:Yo.meshtoon_frag},matcap:{uniforms:U([Cm.common,Cm.bumpmap,Cm.normalmap,Cm.displacementmap,Cm.fog,{matcap:{value:null}}]),vertexShader:Yo.meshmatcap_vert,fragmentShader:Yo.meshmatcap_frag},points:{uniforms:U([Cm.points,Cm.fog]),vertexShader:Yo.points_vert,fragmentShader:Yo.points_frag},dashed:{uniforms:U([Cm.common,Cm.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yo.linedashed_vert,fragmentShader:Yo.linedashed_frag},depth:{uniforms:U([Cm.common,Cm.displacementmap]),vertexShader:Yo.depth_vert,fragmentShader:Yo.depth_frag},normal:{uniforms:U([Cm.common,Cm.bumpmap,Cm.normalmap,Cm.displacementmap,{opacity:{value:1}}]),vertexShader:Yo.normal_vert,fragmentShader:Yo.normal_frag},sprite:{uniforms:U([Cm.sprite,Cm.fog]),vertexShader:Yo.sprite_vert,fragmentShader:Yo.sprite_frag},background:{uniforms:{uvTransform:{value:new d},t2D:{value:null}},vertexShader:Yo.background_vert,fragmentShader:Yo.background_frag},cube:{uniforms:U([Cm.envmap,{opacity:{value:1}}]),vertexShader:Yo.cube_vert,fragmentShader:Yo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Yo.equirect_vert,fragmentShader:Yo.equirect_frag},distanceRGBA:{uniforms:U([Cm.common,Cm.displacementmap,{referencePosition:{value:new j},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Yo.distanceRGBA_vert,fragmentShader:Yo.distanceRGBA_frag},shadow:{uniforms:U([Cm.lights,Cm.fog,{color:{value:new v(0)},opacity:{value:1}}]),vertexShader:Yo.shadow_vert,fragmentShader:Yo.shadow_frag}};Zo.physical={uniforms:U([Zo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new c(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new v(0)},transparency:{value:0}}]),vertexShader:Yo.meshphysical_vert,fragmentShader:Yo.meshphysical_frag},ra.prototype=Object.create(e.prototype),ra.prototype.constructor=ra,ra.prototype.isCubeTexture=!0,Object.defineProperty(ra.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}}),sa.prototype=Object.create(e.prototype),sa.prototype.constructor=sa,sa.prototype.isDataTexture2DArray=!0,ta.prototype=Object.create(e.prototype),ta.prototype.constructor=ta,ta.prototype.isDataTexture3D=!0;var $o=new e,_o=new sa,ap=new ta,bp=new ra,cp=[],dp=[],ep=new Float32Array(16),fp=new Float32Array(9),gp=new Float32Array(4);cb.prototype.updateCache=function(a){var b=this.cache;a instanceof Float32Array&&b.length!==a.length&&(this.cache=new Float32Array(a.length)),wa(b,a)},db.prototype.setValue=function(a,b,c){for(var d=this.seq,e=0,f=d.length;e!==f;++e){var g=d[e];g.setValue(a,b[g.id],c)}};var hp=/([\w\d_]+)(\])?(\[|\.)?/g;gb.prototype.setValue=function(a,b,c,d){var e=this.map[b];void 0!==e&&e.setValue(a,c,d)},gb.prototype.setOptional=function(a,b,c){var d=b[c];void 0!==d&&this.setValue(a,c,d)},gb.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}},gb.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};var ip=0,jp=/^[ \t]*#include +<([\w\d./]+)>/gm,kp=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,lp=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g,mp=0;Rb.prototype=Object.create(A.prototype),Rb.prototype.constructor=Rb,Rb.prototype.isMeshDepthMaterial=!0,Rb.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.depthPacking=a.depthPacking,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this},Sb.prototype=Object.create(A.prototype),Sb.prototype.constructor=Sb,Sb.prototype.isMeshDistanceMaterial=!0,Sb.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.referencePosition.copy(a.referencePosition),this.nearDistance=a.nearDistance,this.farDistance=a.farDistance,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this};var np="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",op="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";Xb.prototype=Object.assign(Object.create(X.prototype),{constructor:Xb,isArrayCamera:!0}),Yb.prototype=Object.assign(Object.create(n.prototype),{constructor:Yb,isGroup:!0}),Object.assign(Zb.prototype,{constructor:Zb,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Yb,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Yb,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(a){return null!==this._targetRay&&this._targetRay.dispatchEvent(a),null!==this._grip&&this._grip.dispatchEvent(a),this},disconnect:function(a){return this.dispatchEvent({type:"disconnected",data:a}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(a,b,c){var d=null,e=null,f=this._targetRay,g=this._grip;return a&&(null!==f&&null!==(d=b.getPose(a.targetRaySpace,c))&&(f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale)),null!==g&&a.gripSpace&&null!==(e=b.getPose(a.gripSpace,c))&&(g.matrix.fromArray(e.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale))),null!==f&&(f.visible=null!==d),null!==g&&(g.visible=null!==e),this}}),Object.assign($b.prototype,b.prototype),bc.prototype=Object.assign(Object.create(ac.prototype),{constructor:bc,isWebGL1Renderer:!0}),Object.assign(cc.prototype,{isFogExp2:!0,clone:function(){return new cc(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(dc.prototype,{isFog:!0,clone:function(){return new dc(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(ec.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}}),Object.assign(ec.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(a){return this.usage=a,this},copy:function(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this},copyAt:function(a,b,c){a*=this.stride,c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){return void 0===b&&(b=0),this.array.set(a,b),this},clone:function(a){void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fk.generateUUID()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var b=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),c=new ec(b,this.stride);return c.setUsage(this.usage),c},onUpload:function(a){return this.onUploadCallback=a,this},toJSON:function(a){return void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fk.generateUUID()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var pp=new j;Object.defineProperties(fc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(fc.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(a){for(var b=0,c=this.data.count;b<c;b++)pp.x=this.getX(b),pp.y=this.getY(b),pp.z=this.getZ(b),pp.applyMatrix4(a),this.setXYZ(b,pp.x,pp.y,pp.z);return this},setX:function(a,b){return this.data.array[a*this.data.stride+this.offset]=b,this},setY:function(a,b){return this.data.array[a*this.data.stride+this.offset+1]=b,this},setZ:function(a,b){return this.data.array[a*this.data.stride+this.offset+2]=b,this},setW:function(a,b){return this.data.array[a*this.data.stride+this.offset+3]=b,this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this},setXYZ:function(a,b,c,d){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this},setXYZW:function(a,b,c,d,e){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this.data.array[a+3]=e,this},clone:function(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var b=[],c=0;c<this.count;c++)for(var d=c*this.data.stride+this.offset,e=0;e<this.itemSize;e++)b.push(this.data.array[d+e]);return new C(new this.array.constructor(b),this.itemSize,this.normalized)}return void 0===a.interleavedBuffers&&(a.interleavedBuffers={}),void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a)),new fc(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var b=[],c=0;c<this.count;c++)for(var d=c*this.data.stride+this.offset,e=0;e<this.itemSize;e++)b.push(this.data.array[d+e]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:b,normalized:this.normalized}}return void 0===a.interleavedBuffers&&(a.interleavedBuffers={}),void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),gc.prototype=Object.create(A.prototype),gc.prototype.constructor=gc,gc.prototype.isSpriteMaterial=!0,gc.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this};var qp,rp=new j,sp=new j,tp=new j,up=new c,vp=new c,wp=new k,xp=new j,yp=new j,zp=new j,Ap=new c,Bp=new c,Cp=new c,Dp=new j;hc.prototype=Object.assign(Object.create(n.prototype),{constructor:hc,isSprite:!0,raycast:function(a,b){null===a.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),sp.setFromMatrixScale(this.matrixWorld),wp.copy(a.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld),tp.setFromMatrixPosition(this.modelViewMatrix),a.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&sp.multiplyScalar(-tp.z);var d,e,f=this.material.rotation;0!==f&&(e=Math.cos(f),d=Math.sin(f));var g=this.center;jc(xp.set(-.5,-.5,0),tp,g,sp,d,e),jc(yp.set(.5,-.5,0),tp,g,sp,d,e),jc(zp.set(.5,.5,0),tp,g,sp,d,e),Ap.set(0,0),Bp.set(1,0),Cp.set(1,1);var h=a.ray.intersectTriangle(xp,yp,zp,!1,rp);if(null!==h||(jc(yp.set(-.5,.5,0),tp,g,sp,d,e),Bp.set(0,1),null!==(h=a.ray.intersectTriangle(xp,zp,yp,!1,rp)))){var i=a.ray.origin.distanceTo(rp);i<a.near||i>a.far||b.push({distance:i,point:rp.clone(),uv:u.getUV(rp,xp,yp,zp,Ap,Bp,Cp,new c),face:null,object:this})}},copy:function(a){return n.prototype.copy.call(this,a),void 0!==a.center&&this.center.copy(a.center),this.material=a.material,this},GetBox:function(a,b,c){if(null===a)return console.error('THREE.Sprite: "BoundBox camera" needs to be set in order to calcualte Box.'),null;sp.setFromMatrixScale(this.matrixWorld),wp.copy(a.matrixWorld),this.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,this.matrixWorld),tp.setFromMatrixPosition(this.modelViewMatrix),a.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&sp.multiplyScalar(-tp.z);const d=this.material.rotation;var e,f;0!==d&&(f=Math.cos(d),e=Math.sin(d));const g=this.center;jc(Dp.set(-.5,-.5,0),tp,g,sp,e,f);var h=ic(Dp,a,b,c);return this.boundBox[0]=h.x,this.boundBox[1]=h.y,jc(Dp.set(.5,-.5,0),tp,g,sp,e,f),h=ic(Dp,a,b,c),this.boundBox[2]=h.x,this.boundBox[3]=h.y,jc(Dp.set(.5,.5,0),tp,g,sp,e,f),h=ic(Dp,a,b,c),this.boundBox[4]=h.x,this.boundBox[5]=h.y,jc(Dp.set(-.5,.5,0),tp,g,sp,e,f),h=ic(Dp,a,b,c),this.boundBox[6]=h.x,this.boundBox[7]=h.y,this.boundBox}});var Ep=new j,Fp=new j;kc.prototype=Object.assign(Object.create(n.prototype),{constructor:kc,isLOD:!0,copy:function(a){n.prototype.copy.call(this,a,!1);for(var b=a.levels,c=0,d=b.length;c<d;c++){var e=b[c];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=a.autoUpdate,this},addLevel:function(a,b){void 0===b&&(b=0),b=Math.abs(b);var c,d=this.levels;for(c=0;c<d.length&&!(b<d[c].distance);c++);return d.splice(c,0,{distance:b,object:a}),this.add(a),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(a){var b=this.levels;if(b.length>0){var c,d;for(c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-1].object}return null},raycast:function(a,b){if(this.levels.length>0){Ep.setFromMatrixPosition(this.matrixWorld);var c=a.ray.origin.distanceTo(Ep);this.getObjectForDistance(c).raycast(a,b)}},update:function(a){var b=this.levels;if(b.length>1){Ep.setFromMatrixPosition(a.matrixWorld),Fp.setFromMatrixPosition(this.matrixWorld);var c=Ep.distanceTo(Fp)/a.zoom;b[0].object.visible=!0;var d,e;for(d=1,e=b.length;d<e&&c>=b[d].distance;d++)b[d-1].object.visible=!1,b[d].object.visible=!0;for(this._currentLevel=d-1;d<e;d++)b[d].object.visible=!1}},toJSON:function(a){var b=n.prototype.toJSON.call(this,a);!1===this.autoUpdate&&(b.object.autoUpdate=!1),b.object.levels=[];for(var c=this.levels,d=0,e=c.length;d<e;d++){var f=c[d];b.object.levels.push({object:f.object.uuid,distance:f.distance})}return b}}),lc.prototype=Object.assign(Object.create(P.prototype),{constructor:lc,isSkinnedMesh:!0,copy:function(a){return P.prototype.copy.call(this,a),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,this},bind:function(a,b){this.skeleton=a,void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld),this.bindMatrix.copy(b),this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var a=new f,b=this.geometry.attributes.skinWeight,c=0,d=b.count;c<d;c++){a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.w=b.getW(c);var e=1/a.manhattanLength();e!==1/0?a.multiplyScalar(e):a.set(1,0,0,0),b.setXYZW(c,a.x,a.y,a.z,a.w)}},updateMatrixWorld:function(a){P.prototype.updateMatrixWorld.call(this,a),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){var a=new j,b=new f,c=new f,d=new j,e=new k;return function(f,g){var h=this.skeleton,i=this.geometry;b.fromBufferAttribute(i.attributes.skinIndex,f),c.fromBufferAttribute(i.attributes.skinWeight,f),a.fromBufferAttribute(i.attributes.position,f).applyMatrix4(this.bindMatrix),g.set(0,0,0);for(var j=0;j<4;j++){var k=c.getComponent(j);if(0!==k){var l=b.getComponent(j);e.multiplyMatrices(h.bones[l].matrixWorld,h.boneInverses[l]),g.addScaledVector(d.copy(a).applyMatrix4(e),k)}}return g.applyMatrix4(this.bindMatrixInverse)}}()});var Gp=new k,Hp=new k;Object.assign(mc.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new k;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld),this.boneInverses.push(c)}},pose:function(){for(var a=0,b=this.bones.length;a<b;a++){var c=this.bones[a];c&&c.matrixWorld.getInverse(this.boneInverses[a])}for(var d=0,e=this.bones.length;d<e;d++){var f=this.bones[d];f&&(f.parent&&f.parent.isBone?(f.matrix.getInverse(f.parent.matrixWorld),f.matrix.multiply(f.matrixWorld)):f.matrix.copy(f.matrixWorld),f.matrix.decompose(f.position,f.quaternion,f.scale))}},update:function(){for(var a=this.bones,b=this.boneInverses,c=this.boneMatrices,d=this.boneTexture,e=0,f=a.length;e<f;e++){var g=a[e]?a[e].matrixWorld:Hp;Gp.multiplyMatrices(g,b[e]),Gp.toArray(c,16*e)}void 0!==d&&(d.needsUpdate=!0)},clone:function(){return new mc(this.bones,this.boneInverses)},getBoneByName:function(a){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b];if(d.name===a)return d}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),nc.prototype=Object.assign(Object.create(n.prototype),{constructor:nc,isBone:!0});var Ip=new k,Jp=new k,Kp=[],Lp=new P;oc.prototype=Object.assign(Object.create(P.prototype),{constructor:oc,isInstancedMesh:!0,copy:function(a){return P.prototype.copy.call(this,a),this.instanceMatrix.copy(a.instanceMatrix),this.count=a.count,null!==a.instanceColor&&(this.instanceColor=a.instanceColor.clone()),this},getMatrixAt:function(a,b){b.fromArray(this.instanceMatrix.array,16*a)},raycast:function(a,b){var c=this.matrixWorld,d=this.count;if(Lp.geometry=this.geometry,Lp.material=this.material,void 0!==Lp.material)for(var e=0;e<d;e++){this.getMatrixAt(e,Ip),Jp.multiplyMatrices(c,Ip),Lp.matrixWorld=Jp,Lp.raycast(a,Kp);for(var f=0,g=Kp.length;f<g;f++){var h=Kp[f];h.instanceId=e,h.object=this,b.push(h)}Kp.length=0}},setMatrixAt:function(a,b){b.toArray(this.instanceMatrix.array,16*a)},getColorAt:function(a,b){b.fromArray(this.instanceColor.array,3*a)},setColorAt:function(a,b){null===this.instanceColor&&(this.instanceColor=new C(new Float32Array(3*this.count),3)),b.toArray(this.instanceColor.array,3*a)},updateMorphTargets:function(){}}),pc.prototype=Object.create(A.prototype),pc.prototype.constructor=pc,pc.prototype.isLineBasicMaterial=!0,pc.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.morphTargets=a.morphTargets,this};var Mp=new j,Np=new j,Op=new k,Pp=new s,Qp=new r;qc.prototype=Object.assign(Object.create(n.prototype),{constructor:qc,isLine:!0,copy:function(a){return n.prototype.copy.call(this,a),this.material=a.material,this.geometry=a.geometry,this},computeLineDistances:function(){var a=this.geometry;if(a.isBufferGeometry)if(null===a.index){for(var b=a.attributes.position,c=[0],d=1,e=b.count;d<e;d++)Mp.fromBufferAttribute(b,d-1),Np.fromBufferAttribute(b,d),c[d]=c[d-1],c[d]+=Mp.distanceTo(Np);a.setAttribute("lineDistance",new K(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(a.isGeometry){var f=a.vertices,g=a.lineDistances;g[0]=0;for(var h=1,i=f.length;h<i;h++)g[h]=g[h-1],g[h]+=f[h-1].distanceTo(f[h])}return this},raycast:function(a,b){var c=this.geometry,d=this.matrixWorld,e=a.params.Line.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),Qp.copy(c.boundingSphere),Qp.applyMatrix4(d),Qp.radius+=e,!1!==a.ray.intersectsSphere(Qp)){Op.getInverse(d),Pp.copy(a.ray).applyMatrix4(Op);var f=e/((this.scale.x+this.scale.y+this.scale.z)/3),g=f*f,h=new j,i=new j,k=new j,l=new j,m=this&&this.isLineSegments?2:1;if(c.isBufferGeometry){var n=c.index,o=c.attributes,p=o.position.array;if(null!==n)for(var q=n.array,r=0,s=q.length-1;r<s;r+=m){var t=q[r],u=q[r+1];h.fromArray(p,3*t),i.fromArray(p,3*u);var v=Pp.distanceSqToSegment(h,i,l,k);if(!(v>g)){l.applyMatrix4(this.matrixWorld);var w=a.ray.origin.distanceTo(l);w<a.near||w>a.far||b.push({distance:w,point:k.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else for(var x=0,y=p.length/3-1;x<y;x+=m){h.fromArray(p,3*x),i.fromArray(p,3*x+3);var z=Pp.distanceSqToSegment(h,i,l,k);if(!(z>g)){l.applyMatrix4(this.matrixWorld);var A=a.ray.origin.distanceTo(l);A<a.near||A>a.far||b.push({distance:A,point:k.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(c.isGeometry)for(var B=c.vertices,C=B.length,D=0;D<C-1;D+=m){var E=Pp.distanceSqToSegment(B[D],B[D+1],l,k);if(!(E>g)){l.applyMatrix4(this.matrixWorld);var F=a.ray.origin.distanceTo(l);F<a.near||F>a.far||b.push({distance:F,point:k.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){var b=a.morphAttributes,c=Object.keys(b);if(c.length>0){var d=b[c[0]];if(void 0!==d){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,f=d.length;e<f;e++){var g=d[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=e}}}}else{var h=a.morphTargets;void 0!==h&&h.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var Rp=new j,Sp=new j;rc.prototype=Object.assign(Object.create(qc.prototype),{constructor:rc,isLineSegments:!0,computeLineDistances:function(){var a=this.geometry;if(a.isBufferGeometry)if(null===a.index){for(var b=a.attributes.position,c=[],d=0,e=b.count;d<e;d+=2)Rp.fromBufferAttribute(b,d),Sp.fromBufferAttribute(b,d+1),c[d]=0===d?0:c[d-1],c[d+1]=c[d]+Rp.distanceTo(Sp);a.setAttribute("lineDistance",new K(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(a.isGeometry)for(var f=a.vertices,g=a.lineDistances,h=0,i=f.length;h<i;h+=2)Rp.copy(f[h]),Sp.copy(f[h+1]),g[h]=0===h?0:g[h-1],g[h+1]=g[h]+Rp.distanceTo(Sp);return this}}),sc.prototype=Object.assign(Object.create(qc.prototype),{constructor:sc,isLineLoop:!0}),tc.prototype=Object.create(A.prototype),tc.prototype.constructor=tc,tc.prototype.isPointsMaterial=!0,tc.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.morphTargets=a.morphTargets,this};var Tp=new k,Up=new s,Vp=new r,Wp=new j;uc.prototype=Object.assign(Object.create(n.prototype),{constructor:uc,isPoints:!0,copy:function(a){return n.prototype.copy.call(this,a),this.material=a.material,this.geometry=a.geometry,this},raycast:function(a,b){var c=this.geometry,d=this.matrixWorld,e=a.params.Points.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),Vp.copy(c.boundingSphere),Vp.applyMatrix4(d),Vp.radius+=e,!1!==a.ray.intersectsSphere(Vp)){Tp.getInverse(d),Up.copy(a.ray).applyMatrix4(Tp);var f=e/((this.scale.x+this.scale.y+this.scale.z)/3),g=f*f;if(c.isBufferGeometry){var h=c.index,i=c.attributes,j=i.position.array;if(null!==h)for(var k=h.array,l=0,m=k.length;l<m;l++){var n=k[l];Wp.fromArray(j,3*n),vc(Wp,n,g,d,a,b,this)}else for(var o=0,p=j.length/3;o<p;o++)Wp.fromArray(j,3*o),vc(Wp,o,g,d,a,b,this)}else for(var q=c.vertices,r=0,s=q.length;r<s;r++)vc(q[r],r,g,d,a,b,this)}},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){var b=a.morphAttributes,c=Object.keys(b);if(c.length>0){var d=b[c[0]];if(void 0!==d){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,f=d.length;e<f;e++){var g=d[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=e}}}}else{var h=a.morphTargets;void 0!==h&&h.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),wc.prototype=Object.assign(Object.create(e.prototype),{constructor:wc,isVideoTexture:!0,update:function(){var a=this.image;a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),xc.prototype=Object.create(e.prototype),xc.prototype.constructor=xc,xc.prototype.isCompressedTexture=!0,yc.prototype=Object.create(e.prototype),yc.prototype.constructor=yc,yc.prototype.isCanvasTexture=!0,zc.prototype=Object.create(e.prototype),zc.prototype.constructor=zc,zc.prototype.isDepthTexture=!0,Ac.prototype=Object.create(O.prototype),Ac.prototype.constructor=Ac,Bc.prototype=Object.create(S.prototype),Bc.prototype.constructor=Bc,Cc.prototype=Object.create(O.prototype),Cc.prototype.constructor=Cc,Dc.prototype=Object.create(S.prototype),Dc.prototype.constructor=Dc,Ec.prototype=Object.create(O.prototype),Ec.prototype.constructor=Ec,Fc.prototype=Object.create(S.prototype),Fc.prototype.constructor=Fc,Gc.prototype=Object.create(Ec.prototype),Gc.prototype.constructor=Gc,Hc.prototype=Object.create(S.prototype),Hc.prototype.constructor=Hc,Ic.prototype=Object.create(Ec.prototype),Ic.prototype.constructor=Ic,Jc.prototype=Object.create(S.prototype),Jc.prototype.constructor=Jc,Kc.prototype=Object.create(Ec.prototype),Kc.prototype.constructor=Kc,Lc.prototype=Object.create(S.prototype),Lc.prototype.constructor=Lc,Mc.prototype=Object.create(Ec.prototype),Mc.prototype.constructor=Mc,Nc.prototype=Object.create(S.prototype),Nc.prototype.constructor=Nc,Oc.prototype=Object.create(O.prototype),Oc.prototype.constructor=Oc,Oc.prototype.toJSON=function(){var a=O.prototype.toJSON.call(this);return a.path=this.parameters.path.toJSON(),a},Pc.prototype=Object.create(S.prototype),Pc.prototype.constructor=Pc,Qc.prototype=Object.create(O.prototype),Qc.prototype.constructor=Qc,Rc.prototype=Object.create(S.prototype),Rc.prototype.constructor=Rc,Sc.prototype=Object.create(O.prototype),Sc.prototype.constructor=Sc;var Xp={triangulate:function(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=Tc(a,0,e,c,!0),g=[];if(!f||f.next===f.prev)return g;var h,i,j,k,l,m,n;if(d&&(f=$c(a,b,f,c)),a.length>80*c){h=j=a[0],i=k=a[1];for(var o=c;o<e;o+=c)l=a[o],m=a[o+1],l<h&&(h=l),m<i&&(i=m),l>j&&(j=l),m>k&&(k=m);n=Math.max(j-h,k-i),n=0!==n?1/n:0}return Vc(f,g,c,h,i,n),g}},Yp={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},isClockWise:function(a){return Yp.area(a)<0},triangulateShape:function(a,b){var c=[],d=[],e=[];wd(a),xd(c,a);var f=a.length;b.forEach(wd);for(var g=0;g<b.length;g++)d.push(f),f+=b[g].length,xd(c,b[g]);for(var h=Xp.triangulate(c,d),i=0;i<h.length;i+=3)e.push(h.slice(i,i+3));return e}};yd.prototype=Object.create(S.prototype),yd.prototype.constructor=yd,yd.prototype.toJSON=function(){var a=S.prototype.toJSON.call(this);return Ad(this.parameters.shapes,this.parameters.options,a)},zd.prototype=Object.create(O.prototype),zd.prototype.constructor=zd,zd.prototype.toJSON=function(){var a=O.prototype.toJSON.call(this);return Ad(this.parameters.shapes,this.parameters.options,a)};var Zp={generateTopUV:function(a,b,d,e,f){var g=b[3*d],h=b[3*d+1],i=b[3*e],j=b[3*e+1],k=b[3*f],l=b[3*f+1];return[new c(g,h),new c(i,j),new c(k,l)]},generateSideWallUV:function(a,b,d,e,f,g){var h=b[3*d],i=b[3*d+1],j=b[3*d+2],k=b[3*e],l=b[3*e+1],m=b[3*e+2],n=b[3*f],o=b[3*f+1],p=b[3*f+2],q=b[3*g],r=b[3*g+1],s=b[3*g+2];return Math.abs(i-l)<.01?[new c(h,1-j),new c(k,1-m),new c(n,1-p),new c(q,1-s)]:[new c(i,1-j),new c(l,1-m),new c(o,1-p),new c(r,1-s)]}};Bd.prototype=Object.create(S.prototype),Bd.prototype.constructor=Bd,Cd.prototype=Object.create(zd.prototype),Cd.prototype.constructor=Cd,Dd.prototype=Object.create(S.prototype),Dd.prototype.constructor=Dd,Ed.prototype=Object.create(O.prototype),Ed.prototype.constructor=Ed,Fd.prototype=Object.create(S.prototype),Fd.prototype.constructor=Fd,Gd.prototype=Object.create(O.prototype),Gd.prototype.constructor=Gd,Hd.prototype=Object.create(S.prototype),Hd.prototype.constructor=Hd,Id.prototype=Object.create(O.prototype),Id.prototype.constructor=Id,Jd.prototype=Object.create(S.prototype),Jd.prototype.constructor=Jd,Jd.prototype.toJSON=function(){var a=S.prototype.toJSON.call(this);return Ld(this.parameters.shapes,a)},Kd.prototype=Object.create(O.prototype),Kd.prototype.constructor=Kd,Kd.prototype.toJSON=function(){var a=O.prototype.toJSON.call(this);return Ld(this.parameters.shapes,a)},Md.prototype=Object.create(O.prototype),Md.prototype.constructor=Md,Nd.prototype=Object.create(S.prototype),Nd.prototype.constructor=Nd,Od.prototype=Object.create(O.prototype),Od.prototype.constructor=Od,Pd.prototype=Object.create(Nd.prototype),Pd.prototype.constructor=Pd,Qd.prototype=Object.create(Od.prototype),Qd.prototype.constructor=Qd,Rd.prototype=Object.create(S.prototype),Rd.prototype.constructor=Rd,Sd.prototype=Object.create(O.prototype),Sd.prototype.constructor=Sd;var $p=Object.freeze({__proto__:null,WireframeGeometry:Ac,ParametricGeometry:Bc,ParametricBufferGeometry:Cc,TetrahedronGeometry:Fc,TetrahedronBufferGeometry:Gc,OctahedronGeometry:Hc,OctahedronBufferGeometry:Ic,IcosahedronGeometry:Jc,IcosahedronBufferGeometry:Kc,DodecahedronGeometry:Lc,DodecahedronBufferGeometry:Mc,PolyhedronGeometry:Dc,PolyhedronBufferGeometry:Ec,TubeGeometry:Nc,TubeBufferGeometry:Oc,TorusKnotGeometry:Pc,TorusKnotBufferGeometry:Qc,TorusGeometry:Rc,TorusBufferGeometry:Sc,TextGeometry:Bd,TextBufferGeometry:Cd,SphereGeometry:Dd,SphereBufferGeometry:Ed,RingGeometry:Fd,RingBufferGeometry:Gd,PlaneGeometry:ca,PlaneBufferGeometry:da,LatheGeometry:Hd,LatheBufferGeometry:Id,ShapeGeometry:Jd,ShapeBufferGeometry:Kd,ExtrudeGeometry:yd,ExtrudeBufferGeometry:zd,EdgesGeometry:Md,ConeGeometry:Pd,ConeBufferGeometry:Qd,CylinderGeometry:Nd,CylinderBufferGeometry:Od,CircleGeometry:Rd,CircleBufferGeometry:Sd,BoxGeometry:tm,BoxBufferGeometry:um});Td.prototype=Object.create(A.prototype),Td.prototype.constructor=Td,Td.prototype.isShadowMaterial=!0,Td.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this},Ud.prototype=Object.create(V.prototype),Ud.prototype.constructor=Ud,Ud.prototype.isRawShaderMaterial=!0,Vd.prototype=Object.create(A.prototype),Vd.prototype.constructor=Vd,Vd.prototype.isMeshStandardMaterial=!0,Vd.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.vertexTangents=a.vertexTangents,this},Wd.prototype=Object.create(Vd.prototype),Wd.prototype.constructor=Wd,Wd.prototype.isMeshPhysicalMaterial=!0,Wd.prototype.copy=function(a){return Vd.prototype.copy.call(this,a),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.reflectivity=a.reflectivity,a.sheen?this.sheen=(this.sheen||new v).copy(a.sheen):this.sheen=null,this.transparency=a.transparency,this},Xd.prototype=Object.create(A.prototype),Xd.prototype.constructor=Xd,Xd.prototype.isMeshPhongMaterial=!0,Xd.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},Yd.prototype=Object.create(A.prototype),Yd.prototype.constructor=Yd,Yd.prototype.isMeshToonMaterial=!0,Yd.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},Zd.prototype=Object.create(A.prototype),Zd.prototype.constructor=Zd,Zd.prototype.isMeshNormalMaterial=!0,Zd.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},$d.prototype=Object.create(A.prototype),$d.prototype.constructor=$d,$d.prototype.isMeshLambertMaterial=!0,$d.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},_d.prototype=Object.create(A.prototype),_d.prototype.constructor=_d,_d.prototype.isMeshMatcapMaterial=!0,_d.prototype.copy=function(a){return A.prototype.copy.call(this,a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},ae.prototype=Object.create(pc.prototype),ae.prototype.constructor=ae,ae.prototype.isLineDashedMaterial=!0,ae.prototype.copy=function(a){return pc.prototype.copy.call(this,a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this};var _p=Object.freeze({__proto__:null,ShadowMaterial:Td,SpriteMaterial:gc,RawShaderMaterial:Ud,ShaderMaterial:V,PointsMaterial:tc,MeshPhysicalMaterial:Wd,MeshStandardMaterial:Vd,MeshPhongMaterial:Xd,MeshToonMaterial:Yd,MeshNormalMaterial:Zd,MeshLambertMaterial:$d,MeshDepthMaterial:Rb,MeshDistanceMaterial:Sb,MeshBasicMaterial:B,MeshMatcapMaterial:_d,LineDashedMaterial:ae,LineBasicMaterial:pc,Material:A}),aq={arraySlice:function(a,b,c){return aq.isTypedArray(a)?new a.constructor(a.subarray(b,void 0!==c?c:a.length)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"==typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){function b(b,c){return a[b]-a[c]}for(var c=a.length,d=new Array(c),e=0;e!==c;++e)d[e]=e;return d.sort(b),d},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,i=0;i!==b;++i)e[g++]=a[h+i];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g))do{g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++]}while(void 0!==f);else if(void 0!==g.toArray)do{g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++]}while(void 0!==f);else do{g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++]}while(void 0!==f)}},subclip:function(a,b,c,d,e){e=e||30;var f=a.clone();f.name=b;for(var g=[],h=0;h<f.tracks.length;++h){for(var i=f.tracks[h],j=i.getValueSize(),k=[],l=[],m=0;m<i.times.length;++m){var n=i.times[m]*e;if(!(n<c||n>=d)){k.push(i.times[m]);for(var o=0;o<j;++o)l.push(i.values[m*j+o])}}0!==k.length&&(i.times=aq.convertArray(k,i.times.constructor),i.values=aq.convertArray(l,i.values.constructor),g.push(i))}f.tracks=g;for(var p=1/0,q=0;q<f.tracks.length;++q)p>f.tracks[q].times[0]&&(p=f.tracks[q].times[0]);for(var r=0;r<f.tracks.length;++r)f.tracks[r].shift(-1*p);return f.resetDuration(),f},makeClipAdditive:function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=a),(void 0===d||d<=0)&&(d=30);for(var e=a.tracks.length,f=b/d,g=function(b){var d=c.tracks[b],e=d.ValueTypeName;if("bool"!==e&&"string"!==e){var g=a.tracks.find(function(a){return a.name===d.name&&a.ValueTypeName===e});if(void 0!==g){var h=d.getValueSize(),j=d.times.length-1,k=void 0;if(f<=d.times[0])k=aq.arraySlice(d.values,0,d.valueSize);else if(f>=d.times[j]){var l=j*h;k=aq.arraySlice(d.values,l)}else{var m=d.createInterpolant();m.evaluate(f),k=m.resultBuffer}if("quaternion"===e){new i(k[0],k[1],k[2],k[3]).normalize().conjugate().toArray(k)}for(var n=g.times.length,o=0;o<n;++o){var p=o*h;if("quaternion"===e)i.multiplyQuaternionsFlat(g.values,p,k,0,g.values,p);else for(var q=0;q<h;++q)g.values[p+q]-=k[q]}}}},h=0;h<e;++h)g(h);return a.blendMode=Qj,a}};Object.assign(be.prototype,{evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{var f;c:{d:if(!(a<d)){for(var g=c+2;;){if(void 0===d){if(a<e)break d;return c=b.length,this._cachedIndex=c,this.afterEnd_(c-1,a,e)}if(c===g)break;if(e=d,d=b[++c],a<d)break b}f=b.length;break c}{if(a>=e)break a;var h=b[1];a<h&&(c=2,e=h);for(var i=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===i)break;if(d=e,e=b[--c-1],a>=e)break b}f=c,c=0}}for(;c<f;){var j=c+f>>>1;a<b[j]?f=j:c=j+1}if(d=b[c],void 0===(e=b[c-1]))return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return c=b.length,this._cachedIndex=c,this.afterEnd_(c-1,e,a)}this._cachedIndex=c,this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){for(var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d,f=0;f!==d;++f)b[f]=c[e+f];return b},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(be.prototype,{beforeStart_:be.prototype.copySampleValue_,afterEnd_:be.prototype.copySampleValue_}),ce.prototype=Object.assign(Object.create(be.prototype),{constructor:ce,DefaultSettings_:{endingStart:Mj,endingEnd:Mj},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case Nj:e=a,g=2*b-c;break;case Oj:e=d.length-2,g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case Nj:f=a,h=2*c-b;break;case Oj:f=1,h=c+d[1]-d[0];break;default:f=a-1,h=b}var i=.5*(c-b),j=this.valueSize;this._weightPrev=i/(b-g),this._weightNext=i/(h-c),this._offsetPrev=e*j,this._offsetNext=f*j},interpolate_:function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=this._offsetPrev,k=this._offsetNext,l=this._weightPrev,m=this._weightNext,n=(c-b)/(d-b),o=n*n,p=o*n,q=-l*p+2*l*o-l*n,r=(1+l)*p+(-1.5-2*l)*o+(-.5+l)*n+1,s=(-1-m)*p+(1.5+m)*o+.5*n,t=m*p-m*o,u=0;u!==g;++u)e[u]=q*f[j+u]+r*f[i+u]+s*f[h+u]+t*f[k+u];return e}}),de.prototype=Object.assign(Object.create(be.prototype),{constructor:de,interpolate_:function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=(c-b)/(d-b),k=1-j,l=0;l!==g;++l)e[l]=f[i+l]*k+f[h+l]*j;return e}}),ee.prototype=Object.assign(Object.create(be.prototype),{constructor:ee,interpolate_:function(a){return this.copySampleValue_(a-1)}}),Object.assign(fe,{toJSON:function(a){var b,c=a.constructor;if(void 0!==c.toJSON)b=c.toJSON(a);else{b={name:a.name,times:aq.convertArray(a.times,Array),values:aq.convertArray(a.values,Array)};var d=a.getInterpolation();d!==a.DefaultInterpolation&&(b.interpolation=d)}return b.type=a.ValueTypeName,b}}),Object.assign(fe.prototype,{constructor:fe,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Kj,InterpolantFactoryMethodDiscrete:function(a){return new ee(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new de(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new ce(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case Jj:b=this.InterpolantFactoryMethodDiscrete;break;case Kj:b=this.InterpolantFactoryMethodLinear;break;case Lj:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){var c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(a===this.DefaultInterpolation)throw new Error(c);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",c),this}return this.createInterpolant=b,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Jj;case this.InterpolantFactoryMethodLinear:return Kj;case this.InterpolantFactoryMethodSmooth:return Lj}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;if(++f,0!==e||f!==d){e>=f&&(f=Math.max(f,1),e=f-1);var g=this.getValueSize();this.times=aq.arraySlice(c,e,f),this.values=aq.arraySlice(this.values,e*g,f*g)}return this},validate:function(){var a=!0,b=this.getValueSize();b-Math.floor(b)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);var c=this.times,d=this.values,e=c.length;0===e&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);for(var f=null,g=0;g!==e;g++){var h=c[g];if("number"==typeof h&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,h),a=!1;break}if(null!==f&&f>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,h,f),a=!1;break}f=h}if(void 0!==d&&aq.isTypedArray(d))for(var i=0,j=d.length;i!==j;++i){var k=d[i];if(isNaN(k)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,k),a=!1;break}}return a},optimize:function(){for(var a=aq.arraySlice(this.times),b=aq.arraySlice(this.values),c=this.getValueSize(),d=this.getInterpolation()===Lj,e=a.length-1,f=1,g=1;g<e;++g){var h=!1,i=a[g];if(i!==a[g+1]&&(1!==g||i!==i[0]))if(d)h=!0;else for(var j=g*c,k=j-c,l=j+c,m=0;m!==c;++m){var n=b[j+m];if(n!==b[k+m]||n!==b[l+m]){h=!0;break}}if(h){if(g!==f){a[f]=a[g];for(var o=g*c,p=f*c,q=0;q!==c;++q)b[p+q]=b[o+q]}++f}}if(e>0){a[f]=a[e];for(var r=e*c,s=f*c,t=0;t!==c;++t)b[s+t]=b[r+t];++f}return f!==a.length?(this.times=aq.arraySlice(a,0,f),this.values=aq.arraySlice(b,0,f*c)):(this.times=a,this.values=b),this},clone:function(){var a=aq.arraySlice(this.times,0),b=aq.arraySlice(this.values,0),c=this.constructor,d=new c(this.name,a,b);return d.createInterpolant=this.createInterpolant,d}}),ge.prototype=Object.assign(Object.create(fe.prototype),{constructor:ge,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Jj,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),he.prototype=Object.assign(Object.create(fe.prototype),{constructor:he,ValueTypeName:"color"}),ie.prototype=Object.assign(Object.create(fe.prototype),{constructor:ie,ValueTypeName:"number"}),je.prototype=Object.assign(Object.create(be.prototype),{constructor:je,interpolate_:function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=(c-b)/(d-b),j=a*g,k=j+g;j!==k;j+=4)i.slerpFlat(e,0,f,j-g,f,j,h);return e}}),ke.prototype=Object.assign(Object.create(fe.prototype),{constructor:ke,ValueTypeName:"quaternion",DefaultInterpolation:Kj,InterpolantFactoryMethodLinear:function(a){return new je(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0}),le.prototype=Object.assign(Object.create(fe.prototype),{constructor:le,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Jj,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),me.prototype=Object.assign(Object.create(fe.prototype),{constructor:me,ValueTypeName:"vector"}),Object.assign(ne,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(pe(c[e]).scale(d));return new ne(a.name,a.duration,b,a.blendMode)},toJSON:function(a){for(var b=[],c=a.tracks,d={name:a.name,duration:a.duration,tracks:b,uuid:a.uuid,blendMode:a.blendMode},e=0,f=c.length;e!==f;++e)b.push(fe.toJSON(c[e]));return d},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],i=[];h.push((g+e-1)%e,g,(g+1)%e),i.push(0,1,0);var j=aq.getKeyframeOrder(h);h=aq.sortedArray(h,1,j),i=aq.sortedArray(i,1,j),d||0!==h[0]||(h.push(e),i.push(i[0])),f.push(new ie(".morphTargetInfluences["+b[g].name+"]",h,i).scale(1/c))}return new ne(a,-1,f)},findByName:function(a,b){var c=a;if(!Array.isArray(a)){var d=a;c=d.geometry&&d.geometry.animations||d.animations}for(var e=0;e<c.length;e++)if(c[e].name===b)return c[e];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],i=h.name.match(e);if(i&&i.length>1){var j=i[1],k=d[j];k||(d[j]=k=[]),k.push(h)}}var l=[];for(var m in d)l.push(ne.CreateFromMorphTargetSequence(m,d[m],b,c));return l},parseAnimation:function(a,b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];aq.flattenJSON(c,f,g,d),0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.fps||30,g=a.blendMode,h=a.length||-1,i=a.hierarchy||[],j=0;j<i.length;j++){var k=i[j].keys;if(k&&0!==k.length)if(k[0].morphTargets){var l={},m=void 0;for(m=0;m<k.length;m++)if(k[m].morphTargets)for(var n=0;n<k[m].morphTargets.length;n++)l[k[m].morphTargets[n]]=-1;for(var o in l){for(var p=[],q=[],r=0;r!==k[m].morphTargets.length;++r){var s=k[m];p.push(s.time),q.push(s.morphTarget===o?1:0)}d.push(new ie(".morphTargetInfluence["+o+"]",p,q))}h=l.length*(f||1)}else{var t=".bones["+b[j].name+"]";c(me,t+".position",k,"pos",d),c(ke,t+".quaternion",k,"rot",d),c(me,t+".scale",k,"scl",d)}}return 0===d.length?null:new ne(e,h,d,g)}}),Object.assign(ne.prototype,{resetDuration:function(){for(var a=this.tracks,b=0,c=0,d=a.length;c!==d;++c){var e=this.tracks[c];b=Math.max(b,e.times[e.times.length-1])}return this.duration=b,this},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},validate:function(){for(var a=!0,b=0;b<this.tracks.length;b++)a=a&&this.tracks[b].validate();return a},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this},clone:function(){for(var a=[],b=0;b<this.tracks.length;b++)a.push(this.tracks[b].clone());return new ne(this.name,this.duration,a,this.blendMode)}});var bq={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},cq=new qe;Object.assign(re.prototype,{load:function(){},loadAsync:function(a,b){var c=this;return new Promise(function(d,e){c.load(a,d,b,e)})},parse:function(){},setCrossOrigin:function(a){return this.crossOrigin=a,this},setPath:function(a){return this.path=a,this},setResourcePath:function(a){return this.resourcePath=a,this},setRequestHeader:function(a){return this.requestHeader=a,this}});var dq={};se.prototype=Object.assign(Object.create(re.prototype),{constructor:se,load:function(a,b,c,d){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var e=this,f=bq.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f),e.manager.itemEnd(a)},0),f;if(void 0!==dq[a])return void dq[a].push({onLoad:b,onProgress:c,onError:d});var g,h=/^data:(.*?)(;base64)?,(.*)$/,i=a.match(h);if(i){var j=i[1],k=!!i[2],l=i[3];l=decodeURIComponent(l),k&&(l=atob(l));try{var m,n=(this.responseType||"").toLowerCase();switch(n){case"arraybuffer":case"blob":for(var o=new Uint8Array(l.length),p=0;p<l.length;p++)o[p]=l.charCodeAt(p);m="blob"===n?new Blob([o.buffer],{type:j}):o.buffer;break;case"document":var q=new DOMParser;m=q.parseFromString(l,j);break;case"json":m=JSON.parse(l);break;default:m=l}setTimeout(function(){b&&b(m),e.manager.itemEnd(a)},0)}catch(b){setTimeout(function(){d&&d(b),e.manager.itemError(a),e.manager.itemEnd(a)},0)}}else{dq[a]=[],dq[a].push({onLoad:b,onProgress:c,onError:d}),g=new XMLHttpRequest,g.open("GET",a,!0),g.addEventListener("load",function(b){var c=this.response,d=dq[a];if(delete dq[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bq.add(a,c);for(var f=0,g=d.length;f<g;f++){var h=d[f];h.onLoad&&h.onLoad(c)}e.manager.itemEnd(a)}else{for(var i=0,j=d.length;i<j;i++){var k=d[i];k.onError&&k.onError(b)}e.manager.itemError(a),e.manager.itemEnd(a)}},!1),g.addEventListener("progress",function(b){for(var c=dq[a],d=0,e=c.length;d<e;d++){var f=c[d];f.onProgress&&f.onProgress(b)}},!1),g.addEventListener("error",function(b){var c=dq[a];delete dq[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];g.onError&&g.onError(b)}e.manager.itemError(a),e.manager.itemEnd(a)},!1),g.addEventListener("abort",function(b){var c=dq[a];delete dq[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];g.onError&&g.onError(b)}e.manager.itemError(a),e.manager.itemEnd(a)},!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var r in this.requestHeader)g.setRequestHeader(r,this.requestHeader[r]);g.send(null)}return e.manager.itemStart(a),g},setResponseType:function(a){return this.responseType=a,this},setWithCredentials:function(a){return this.withCredentials=a,this},setMimeType:function(a){return this.mimeType=a,this}}),te.prototype=Object.assign(Object.create(re.prototype),{constructor:te,load:function(a,b,c,d){var e=this,f=new se(e.manager);f.setPath(e.path),f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)},parse:function(a){for(var b=[],c=0;c<a.length;c++){var d=ne.parse(a[c]);b.push(d)}return b}}),ue.prototype=Object.assign(Object.create(re.prototype),{constructor:ue,load:function(a,b,c,d){function e(e){i.load(a[e],function(a){var c=f.parse(a,!0);g[e]={width:c.width,height:c.height,format:c.format,mipmaps:c.mipmaps},6===(j+=1)&&(1===c.mipmapCount&&(h.minFilter=pi),h.format=c.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new xc;h.image=g;var i=new se(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer");var j=0;if(Array.isArray(a))for(var k=0,l=a.length;k<l;++k)e(k);else i.load(a,function(a){var c=f.parse(a,!0);if(c.isCubemap)for(var d=c.mipmaps.length/c.mipmapCount,e=0;e<d;e++){g[e]={mipmaps:[]};for(var i=0;i<c.mipmapCount;i++)g[e].mipmaps.push(c.mipmaps[e*c.mipmapCount+i]),g[e].format=c.format,g[e].width=c.width,g[e].height=c.height}else h.image.width=c.width,h.image.height=c.height,h.mipmaps=c.mipmaps;1===c.mipmapCount&&(h.minFilter=pi),h.format=c.format,h.needsUpdate=!0,b&&b(h)},c,d);return h}}),ve.prototype=Object.assign(Object.create(re.prototype),{constructor:ve,load:function(a,b,c,d){var e=this,f=new $,g=new se(this.manager);return g.setResponseType("arraybuffer"),g.setPath(this.path),g.load(a,function(a){var c=e.parse(a);c&&(void 0!==c.image?f.image=c.image:void 0!==c.data&&(f.image.width=c.width,f.image.height=c.height,f.image.data=c.data),f.wrapS=void 0!==c.wrapS?c.wrapS:ii,f.wrapT=void 0!==c.wrapT?c.wrapT:ii,f.magFilter=void 0!==c.magFilter?c.magFilter:pi,f.minFilter=void 0!==c.minFilter?c.minFilter:pi,f.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,void 0!==c.format&&(f.format=c.format),void 0!==c.type&&(f.type=c.type),void 0!==c.mipmaps&&(f.mipmaps=c.mipmaps,f.minFilter=si),1===c.mipmapCount&&(f.minFilter=pi),f.needsUpdate=!0,b&&b(f,c))},c,d),f}}),we.prototype=Object.assign(Object.create(re.prototype),{constructor:we,load:function(a,b,c,d){function e(){i.removeEventListener("load",e,!1),i.removeEventListener("error",f,!1),bq.add(a,this),b&&b(this),g.manager.itemEnd(a)}function f(b){i.removeEventListener("load",e,!1),i.removeEventListener("error",f,!1),d&&d(b),g.manager.itemError(a),g.manager.itemEnd(a)}void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var g=this,h=bq.get(a);if(void 0!==h)return g.manager.itemStart(a),setTimeout(function(){b&&b(h),g.manager.itemEnd(a)},0),h;var i=document.createElementNS("http://www.w3.org/1999/xhtml","img");return i.addEventListener("load",e,!1),i.addEventListener("error",f,!1),"data:"!==a.substr(0,5)&&void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),g.manager.itemStart(a),i.src=a,i}}),xe.prototype=Object.assign(Object.create(re.prototype),{constructor:xe,load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a,6===++h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new ra,g=new we(this.manager);g.setCrossOrigin(this.crossOrigin),g.setPath(this.path);for(var h=0,i=0;i<a.length;++i)e(i);return f}}),ye.prototype=Object.assign(Object.create(re.prototype),{constructor:ye,load:function(a,b,c,d){var f=new e,g=new we(this.manager);return g.setCrossOrigin(this.crossOrigin),g.setPath(this.path),g.load(a,function(c){f.image=c;var d=a.search(/\.jpe?g($|\?)/i)>0||0===a.search(/^data\:image\/jpeg/);f.format=d?Hi:Ii,f.needsUpdate=!0,void 0!==b&&b(f)},c,d),f}}),Object.assign(ze.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(a,b){var c=this.getUtoTmapping(a);return this.getPoint(c,b)},getPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){if(void 0===a&&(a=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c=[],d=this.getPoint(0),e=0;c.push(0);for(var f=1;f<=a;f++)b=this.getPoint(f/a),e+=b.distanceTo(d),c.push(e),d=b;return this.cacheArcLengths=c,c},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b||a*d[f-1];for(var g,h=0,i=f-1;h<=i;)if(e=Math.floor(h+(i-h)/2),(g=d[e]-c)<0)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}if(e=i,d[e]===c)return e/(f-1);var j=d[e];return(e+(c-j)/(d[e+1]-j))/(f-1)},getTangent:function(a,b){var d=1e-4,e=a-d,f=a+d;e<0&&(e=0),f>1&&(f=1);var g=this.getPoint(e),h=this.getPoint(f),i=b||(g.isVector2?new c:new j);return i.copy(h).sub(g).normalize(),i},getTangentAt:function(a,b){var c=this.getUtoTmapping(a);return this.getTangent(c,b)},computeFrenetFrames:function(a,b){for(var c=new j,d=[],e=[],f=[],g=new j,h=new k,i=0;i<=a;i++){var l=i/a;d[i]=this.getTangentAt(l,new j),d[i].normalize()}e[0]=new j,f[0]=new j;var m=Number.MAX_VALUE,n=Math.abs(d[0].x),o=Math.abs(d[0].y),p=Math.abs(d[0].z);n<=m&&(m=n,c.set(1,0,0)),o<=m&&(m=o,c.set(0,1,0)),p<=m&&c.set(0,0,1),g.crossVectors(d[0],c).normalize(),e[0].crossVectors(d[0],g),f[0].crossVectors(d[0],e[0]);for(var q=1;q<=a;q++){if(e[q]=e[q-1].clone(),f[q]=f[q-1].clone(),g.crossVectors(d[q-1],d[q]),g.length()>Number.EPSILON){g.normalize();var r=Math.acos(Fk.clamp(d[q-1].dot(d[q]),-1,1));e[q].applyMatrix4(h.makeRotationAxis(g,r))}f[q].crossVectors(d[q],e[q])}if(!0===b){var s=Math.acos(Fk.clamp(e[0].dot(e[a]),-1,1));s/=a,d[0].dot(g.crossVectors(e[0],e[a]))>0&&(s=-s);for(var t=1;t<=a;t++)e[t].applyMatrix4(h.makeRotationAxis(d[t],s*t)),f[t].crossVectors(d[t],e[t])}return{tangents:d,normals:e,binormals:f}},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.arcLengthDivisions=a.arcLengthDivisions,this},toJSON:function(){var a={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a},fromJSON:function(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}),Ae.prototype=Object.create(ze.prototype),Ae.prototype.constructor=Ae,Ae.prototype.isEllipseCurve=!0,Ae.prototype.getPoint=function(a,b){for(var d=b||new c,e=2*Math.PI,f=this.aEndAngle-this.aStartAngle,g=Math.abs(f)<Number.EPSILON;f<0;)f+=e;for(;f>e;)f-=e;f<Number.EPSILON&&(f=g?0:e),!0!==this.aClockwise||g||(f===e?f=-e:f-=e);var h=this.aStartAngle+a*f,i=this.aX+this.xRadius*Math.cos(h),j=this.aY+this.yRadius*Math.sin(h);if(0!==this.aRotation){var k=Math.cos(this.aRotation),l=Math.sin(this.aRotation),m=i-this.aX,n=j-this.aY;i=m*k-n*l+this.aX,j=m*l+n*k+this.aY}return d.set(i,j)},Ae.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this},Ae.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a},Ae.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this},Be.prototype=Object.create(Ae.prototype),Be.prototype.constructor=Be,Be.prototype.isArcCurve=!0;var eq=new j,fq=new Ce,gq=new Ce,hq=new Ce;De.prototype=Object.create(ze.prototype),De.prototype.constructor=De,De.prototype.isCatmullRomCurve3=!0,De.prototype.getPoint=function(a,b){var c=b||new j,d=this.points,e=d.length,f=(e-(this.closed?0:1))*a,g=Math.floor(f),h=f-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/e)+1)*e:0===h&&g===e-1&&(g=e-2,h=1);var i,k,l,m;if(this.closed||g>0?i=d[(g-1)%e]:(eq.subVectors(d[0],d[1]).add(d[0]),i=eq),k=d[g%e],l=d[(g+1)%e],this.closed||g+2<e?m=d[(g+2)%e]:(eq.subVectors(d[e-1],d[e-2]).add(d[e-1]),m=eq),"centripetal"===this.curveType||"chordal"===this.curveType){var n="chordal"===this.curveType?.5:.25,o=Math.pow(i.distanceToSquared(k),n),p=Math.pow(k.distanceToSquared(l),n),q=Math.pow(l.distanceToSquared(m),n);p<1e-4&&(p=1),o<1e-4&&(o=p),q<1e-4&&(q=p),fq.initNonuniformCatmullRom(i.x,k.x,l.x,m.x,o,p,q),gq.initNonuniformCatmullRom(i.y,k.y,l.y,m.y,o,p,q),hq.initNonuniformCatmullRom(i.z,k.z,l.z,m.z,o,p,q)}else"catmullrom"===this.curveType&&(fq.initCatmullRom(i.x,k.x,l.x,m.x,this.tension),gq.initCatmullRom(i.y,k.y,l.y,m.y,this.tension),hq.initCatmullRom(i.z,k.z,l.z,m.z,this.tension));return c.set(fq.calc(h),gq.calc(h),hq.calc(h)),c},De.prototype.copy=function(a){ze.prototype.copy.call(this,a),this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push(d.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this},De.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++){var d=this.points[b];a.points.push(d.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a},De.prototype.fromJSON=function(a){ze.prototype.fromJSON.call(this,a),this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new j).fromArray(d))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this},Oe.prototype=Object.create(ze.prototype),Oe.prototype.constructor=Oe,Oe.prototype.isCubicBezierCurve=!0,Oe.prototype.getPoint=function(a,b){var d=b||new c,e=this.v0,f=this.v1,g=this.v2,h=this.v3;return d.set(Ne(a,e.x,f.x,g.x,h.x),Ne(a,e.y,f.y,g.y,h.y)),d},Oe.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this},Oe.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a},Oe.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this},Pe.prototype=Object.create(ze.prototype),Pe.prototype.constructor=Pe,Pe.prototype.isCubicBezierCurve3=!0,Pe.prototype.getPoint=function(a,b){var c=b||new j,d=this.v0,e=this.v1,f=this.v2,g=this.v3;return c.set(Ne(a,d.x,e.x,f.x,g.x),Ne(a,d.y,e.y,f.y,g.y),Ne(a,d.z,e.z,f.z,g.z)),c},Pe.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this},Pe.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a},Pe.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this},Qe.prototype=Object.create(ze.prototype),Qe.prototype.constructor=Qe,Qe.prototype.isLineCurve=!0,Qe.prototype.getPoint=function(a,b){var d=b||new c;return 1===a?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(a).add(this.v1)),d},Qe.prototype.getPointAt=function(a,b){return this.getPoint(a,b)},Qe.prototype.getTangent=function(a,b){var d=b||new c;return d.copy(this.v2).sub(this.v1).normalize(),d},Qe.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Qe.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Qe.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},Re.prototype=Object.create(ze.prototype),Re.prototype.constructor=Re,Re.prototype.isLineCurve3=!0,Re.prototype.getPoint=function(a,b){var c=b||new j;return 1===a?c.copy(this.v2):(c.copy(this.v2).sub(this.v1),c.multiplyScalar(a).add(this.v1)),c},Re.prototype.getPointAt=function(a,b){return this.getPoint(a,b)},Re.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Re.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Re.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},Se.prototype=Object.create(ze.prototype),Se.prototype.constructor=Se,Se.prototype.isQuadraticBezierCurve=!0,Se.prototype.getPoint=function(a,b){var d=b||new c,e=this.v0,f=this.v1,g=this.v2;return d.set(Ie(a,e.x,f.x,g.x),Ie(a,e.y,f.y,g.y)),d},Se.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Se.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Se.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},Te.prototype=Object.create(ze.prototype),Te.prototype.constructor=Te,Te.prototype.isQuadraticBezierCurve3=!0,Te.prototype.getPoint=function(a,b){var c=b||new j,d=this.v0,e=this.v1,f=this.v2;return c.set(Ie(a,d.x,e.x,f.x),Ie(a,d.y,e.y,f.y),Ie(a,d.z,e.z,f.z)),c},Te.prototype.copy=function(a){return ze.prototype.copy.call(this,a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this},Te.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a},Te.prototype.fromJSON=function(a){return ze.prototype.fromJSON.call(this,a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this},Ue.prototype=Object.create(ze.prototype),Ue.prototype.constructor=Ue,Ue.prototype.isSplineCurve=!0,Ue.prototype.getPoint=function(a,b){var d=b||new c,e=this.points,f=(e.length-1)*a,g=Math.floor(f),h=f-g,i=e[0===g?g:g-1],j=e[g],k=e[g>e.length-2?e.length-1:g+1],l=e[g>e.length-3?e.length-1:g+2];return d.set(Ee(h,i.x,j.x,k.x,l.x),Ee(h,i.y,j.y,k.y,l.y)),d},Ue.prototype.copy=function(a){ze.prototype.copy.call(this,a),this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push(d.clone())}return this},Ue.prototype.toJSON=function(){var a=ze.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++){var d=this.points[b];a.points.push(d.toArray())}return a},Ue.prototype.fromJSON=function(a){ze.prototype.fromJSON.call(this,a),this.points=[];for(var b=0,d=a.points.length;b<d;b++){var e=a.points[b];this.points.push((new c).fromArray(e))}return this};var iq=Object.freeze({__proto__:null,ArcCurve:Be,CatmullRomCurve3:De,CubicBezierCurve:Oe,CubicBezierCurve3:Pe,EllipseCurve:Ae,LineCurve:Qe,LineCurve3:Re,QuadraticBezierCurve:Se,QuadraticBezierCurve3:Te,SplineCurve:Ue});Ve.prototype=Object.assign(Object.create(ze.prototype),{constructor:Ve,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new Qe(b,a))},getPoint:function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]>=b){var e=c[d]-b,f=this.curves[d],g=f.getLength(),h=0===g?0:1-e/g;return f.getPointAt(h)}d++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a,a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return this.autoClose&&b.push(b[0]),b},getPoints:function(a){a=a||12;for(var b,c=[],d=0,e=this.curves;d<e.length;d++)for(var f=e[d],g=f&&f.isEllipseCurve?2*a:f&&(f.isLineCurve||f.isLineCurve3)?1:f&&f.isSplineCurve?a*f.points.length:a,h=f.getPoints(g),i=0;i<h.length;i++){var j=h[i];b&&b.equals(j)||(c.push(j),b=j)}return this.autoClose&&c.length>1&&!c[c.length-1].equals(c[0])&&c.push(c[0]),c},copy:function(a){ze.prototype.copy.call(this,a),this.curves=[];for(var b=0,c=a.curves.length;b<c;b++){var d=a.curves[b];this.curves.push(d.clone())}return this.autoClose=a.autoClose,this},toJSON:function(){var a=ze.prototype.toJSON.call(this);a.autoClose=this.autoClose,a.curves=[];for(var b=0,c=this.curves.length;b<c;b++){var d=this.curves[b];a.curves.push(d.toJSON())}return a},fromJSON:function(a){ze.prototype.fromJSON.call(this,a),this.autoClose=a.autoClose,this.curves=[];for(var b=0,c=a.curves.length;b<c;b++){var d=a.curves[b];this.curves.push((new iq[d.type]).fromJSON(d))}return this}}),We.prototype=Object.assign(Object.create(Ve.prototype),{constructor:We,setFromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y);return this},moveTo:function(a,b){return this.currentPoint.set(a,b),this},lineTo:function(a,b){var d=new Qe(this.currentPoint.clone(),new c(a,b));return this.curves.push(d),this.currentPoint.set(a,b),this},quadraticCurveTo:function(a,b,d,e){var f=new Se(this.currentPoint.clone(),new c(a,b),new c(d,e));return this.curves.push(f),this.currentPoint.set(d,e),this},bezierCurveTo:function(a,b,d,e,f,g){var h=new Oe(this.currentPoint.clone(),new c(a,b),new c(d,e),new c(f,g));return this.curves.push(h),this.currentPoint.set(f,g),this},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),c=new Ue(b);return this.curves.push(c),this.currentPoint.copy(a[a.length-1]),this},arc:function(a,b,c,d,e,f){var g=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(a+g,b+h,c,d,e,f),this},absarc:function(a,b,c,d,e,f){return this.absellipse(a,b,c,c,d,e,f),this},ellipse:function(a,b,c,d,e,f,g,h){var i=this.currentPoint.x,j=this.currentPoint.y;return this.absellipse(a+i,b+j,c,d,e,f,g,h),this},absellipse:function(a,b,c,d,e,f,g,h){var i=new Ae(a,b,c,d,e,f,g,h);if(this.curves.length>0){var j=i.getPoint(0);j.equals(this.currentPoint)||this.lineTo(j.x,j.y)}this.curves.push(i);var k=i.getPoint(1);return this.currentPoint.copy(k),this},copy:function(a){return Ve.prototype.copy.call(this,a),this.currentPoint.copy(a.currentPoint),this},toJSON:function(){var a=Ve.prototype.toJSON.call(this);return a.currentPoint=this.currentPoint.toArray(),a},fromJSON:function(a){return Ve.prototype.fromJSON.call(this,a),this.currentPoint.fromArray(a.currentPoint),this}}),Xe.prototype=Object.assign(Object.create(We.prototype),{constructor:Xe,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},copy:function(a){We.prototype.copy.call(this,a),this.holes=[];for(var b=0,c=a.holes.length;b<c;b++){var d=a.holes[b];this.holes.push(d.clone())}return this},toJSON:function(){var a=We.prototype.toJSON.call(this);a.uuid=this.uuid,a.holes=[];for(var b=0,c=this.holes.length;b<c;b++){var d=this.holes[b];a.holes.push(d.toJSON())}return a},fromJSON:function(a){We.prototype.fromJSON.call(this,a),this.uuid=a.uuid,this.holes=[];for(var b=0,c=a.holes.length;b<c;b++){var d=a.holes[b];this.holes.push((new We).fromJSON(d))}return this}}),Ye.prototype=Object.assign(Object.create(n.prototype),{constructor:Ye,isLight:!0,copy:function(a){return n.prototype.copy.call(this,a),this.color.copy(a.color),this.intensity=a.intensity,this},toJSON:function(a){var b=n.prototype.toJSON.call(this,a);return b.object.color=this.color.getHex(),b.object.intensity=this.intensity,void 0!==this.groundColor&&(b.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(b.object.distance=this.distance),void 0!==this.angle&&(b.object.angle=this.angle),void 0!==this.decay&&(b.object.decay=this.decay),void 0!==this.penumbra&&(b.object.penumbra=this.penumbra),void 0!==this.shadow&&(b.object.shadow=this.shadow.toJSON()),b}}),Ze.prototype=Object.assign(Object.create(Ye.prototype),{constructor:Ze,isHemisphereLight:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.groundColor.copy(a.groundColor),this}}),Object.assign($e.prototype,{_projScreenMatrix:new k,_lightPositionWorld:new j,_lookTarget:new j,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(a){var b=this.camera,c=this.matrix,d=this._projScreenMatrix,e=this._lookTarget,f=this._lightPositionWorld;f.setFromMatrixPosition(a.matrixWorld),b.position.copy(f),e.setFromMatrixPosition(a.target.matrixWorld),b.lookAt(e),b.updateMatrixWorld(),d.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d),c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(b.projectionMatrix),c.multiply(b.matrixWorldInverse)},getViewport:function(a){return this._viewports[a]},getFrameExtents:function(){return this._frameExtents},copy:function(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};return 0!==this.bias&&(a.bias=this.bias),0!==this.normalBias&&(a.normalBias=this.normalBias),1!==this.radius&&(a.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}),_e.prototype=Object.assign(Object.create($e.prototype),{constructor:_e,isSpotLightShadow:!0,updateMatrices:function(a){var b=this.camera,c=2*Fk.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height,e=a.distance||b.far;c===b.fov&&d===b.aspect&&e===b.far||(b.fov=c,b.aspect=d,b.far=e,b.updateProjectionMatrix()),$e.prototype.updateMatrices.call(this,a)}}),af.prototype=Object.assign(Object.create(Ye.prototype),{constructor:af,isSpotLight:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}),bf.prototype=Object.assign(Object.create($e.prototype),{constructor:bf,isPointLightShadow:!0,updateMatrices:function(a,b){void 0===b&&(b=0);var c=this.camera,d=this.matrix,e=this._lightPositionWorld,f=this._lookTarget,g=this._projScreenMatrix;e.setFromMatrixPosition(a.matrixWorld),c.position.copy(e),f.copy(c.position),f.add(this._cubeDirections[b]),c.up.copy(this._cubeUps[b]),c.lookAt(f),c.updateMatrixWorld(),d.makeTranslation(-e.x,-e.y,-e.z),g.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(g)}}),cf.prototype=Object.assign(Object.create(Ye.prototype),{constructor:cf,isPointLight:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}),df.prototype=Object.assign(Object.create(W.prototype),{constructor:df,isOrthographicCamera:!0,copy:function(a,b){return W.prototype.copy.call(this,a,b),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=null===a.view?null:Object.assign({},a.view),this},setViewOffset:function(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,f=c+a,g=d+b,h=d-b;if(null!==this.view&&this.view.enabled){var i=(this.right-this.left)/this.view.fullWidth/this.zoom,j=(this.top-this.bottom)/this.view.fullHeight/this.zoom;e+=i*this.view.offsetX,f=e+i*this.view.width,g-=j*this.view.offsetY,h=g-j*this.view.height}this.projectionMatrix.makeOrthographic(e,f,g,h,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(a){var b=n.prototype.toJSON.call(this,a);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,null!==this.view&&(b.object.view=Object.assign({},this.view)),b}}),ef.prototype=Object.assign(Object.create($e.prototype),{constructor:ef,isDirectionalLightShadow:!0,updateMatrices:function(a){$e.prototype.updateMatrices.call(this,a)}}),ff.prototype=Object.assign(Object.create(Ye.prototype),{constructor:ff,isDirectionalLight:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}),gf.prototype=Object.assign(Object.create(Ye.prototype),{constructor:gf,isAmbientLight:!0}),hf.prototype=Object.assign(Object.create(Ye.prototype),{constructor:hf,isRectAreaLight:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.width=a.width,this.height=a.height,this},toJSON:function(a){var b=Ye.prototype.toJSON.call(this,a);return b.object.width=this.width,b.object.height=this.height,b}}),Object.assign(jf.prototype,{isSphericalHarmonics3:!0,set:function(a){for(var b=0;b<9;b++)this.coefficients[b].copy(a[b]);return this},zero:function(){for(var a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this},getAt:function(a,b){var c=a.x,d=a.y,e=a.z,f=this.coefficients;return b.copy(f[0]).multiplyScalar(.282095),b.addScaledVector(f[1],.488603*d),b.addScaledVector(f[2],.488603*e),b.addScaledVector(f[3],.488603*c),b.addScaledVector(f[4],c*d*1.092548),b.addScaledVector(f[5],d*e*1.092548),b.addScaledVector(f[6],.315392*(3*e*e-1)),b.addScaledVector(f[7],c*e*1.092548),b.addScaledVector(f[8],.546274*(c*c-d*d)),b},getIrradianceAt:function(a,b){var c=a.x,d=a.y,e=a.z,f=this.coefficients;return b.copy(f[0]).multiplyScalar(.886227),b.addScaledVector(f[1],1.023328*d),b.addScaledVector(f[2],1.023328*e),b.addScaledVector(f[3],1.023328*c),b.addScaledVector(f[4],.858086*c*d),b.addScaledVector(f[5],.858086*d*e),b.addScaledVector(f[6],.743125*e*e-.247708),b.addScaledVector(f[7],.858086*c*e),b.addScaledVector(f[8],.429043*(c*c-d*d)),b},add:function(a){for(var b=0;b<9;b++)this.coefficients[b].add(a.coefficients[b]);return this},addScaledSH:function(a,b){for(var c=0;c<9;c++)this.coefficients[c].addScaledVector(a.coefficients[c],b);return this},scale:function(a){for(var b=0;b<9;b++)this.coefficients[b].multiplyScalar(a);return this},lerp:function(a,b){for(var c=0;c<9;c++)this.coefficients[c].lerp(a.coefficients[c],b);return this},equals:function(a){for(var b=0;b<9;b++)if(!this.coefficients[b].equals(a.coefficients[b]))return!1;return!0},copy:function(a){return this.set(a.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(a,b){void 0===b&&(b=0);for(var c=this.coefficients,d=0;d<9;d++)c[d].fromArray(a,b+3*d);return this},toArray:function(a,b){void 0===a&&(a=[]),void 0===b&&(b=0);for(var c=this.coefficients,d=0;d<9;d++)c[d].toArray(a,b+3*d);return a}}),Object.assign(jf,{getBasisAt:function(a,b){var c=a.x,d=a.y,e=a.z;b[0]=.282095,b[1]=.488603*d,b[2]=.488603*e,b[3]=.488603*c,b[4]=1.092548*c*d,b[5]=1.092548*d*e,b[6]=.315392*(3*e*e-1),b[7]=1.092548*c*e,b[8]=.546274*(c*c-d*d)}}),kf.prototype=Object.assign(Object.create(Ye.prototype),{constructor:kf,isLightProbe:!0,copy:function(a){return Ye.prototype.copy.call(this,a),this.sh.copy(a.sh),this},fromJSON:function(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this},toJSON:function(a){var b=Ye.prototype.toJSON.call(this,a);return b.object.sh=this.sh.toArray(),b}}),lf.prototype=Object.assign(Object.create(re.prototype),{constructor:lf,load:function(a,b,c,d){var e=this,f=new se(e.manager);f.setPath(e.path),f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)},parse:function(a){function b(a){return void 0===e[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a),e[a]}var e=this.textures,g=new _p[a.type];if(void 0!==a.uuid&&(g.uuid=a.uuid),void 0!==a.name&&(g.name=a.name),void 0!==a.color&&g.color.setHex(a.color),void 0!==a.roughness&&(g.roughness=a.roughness),void 0!==a.metalness&&(g.metalness=a.metalness),void 0!==a.sheen&&(g.sheen=(new v).setHex(a.sheen)),void 0!==a.emissive&&g.emissive.setHex(a.emissive),void 0!==a.specular&&g.specular.setHex(a.specular),void 0!==a.shininess&&(g.shininess=a.shininess),void 0!==a.clearcoat&&(g.clearcoat=a.clearcoat),void 0!==a.clearcoatRoughness&&(g.clearcoatRoughness=a.clearcoatRoughness),void 0!==a.fog&&(g.fog=a.fog),void 0!==a.flatShading&&(g.flatShading=a.flatShading),void 0!==a.blending&&(g.blending=a.blending),void 0!==a.combine&&(g.combine=a.combine),void 0!==a.side&&(g.side=a.side),void 0!==a.opacity&&(g.opacity=a.opacity),void 0!==a.transparent&&(g.transparent=a.transparent),void 0!==a.alphaTest&&(g.alphaTest=a.alphaTest),void 0!==a.depthTest&&(g.depthTest=a.depthTest),void 0!==a.depthWrite&&(g.depthWrite=a.depthWrite),void 0!==a.colorWrite&&(g.colorWrite=a.colorWrite),void 0!==a.stencilWrite&&(g.stencilWrite=a.stencilWrite),void 0!==a.stencilWriteMask&&(g.stencilWriteMask=a.stencilWriteMask),void 0!==a.stencilFunc&&(g.stencilFunc=a.stencilFunc),void 0!==a.stencilRef&&(g.stencilRef=a.stencilRef),void 0!==a.stencilFuncMask&&(g.stencilFuncMask=a.stencilFuncMask),void 0!==a.stencilFail&&(g.stencilFail=a.stencilFail),void 0!==a.stencilZFail&&(g.stencilZFail=a.stencilZFail),void 0!==a.stencilZPass&&(g.stencilZPass=a.stencilZPass),void 0!==a.wireframe&&(g.wireframe=a.wireframe),void 0!==a.wireframeLinewidth&&(g.wireframeLinewidth=a.wireframeLinewidth),void 0!==a.wireframeLinecap&&(g.wireframeLinecap=a.wireframeLinecap),void 0!==a.wireframeLinejoin&&(g.wireframeLinejoin=a.wireframeLinejoin),void 0!==a.rotation&&(g.rotation=a.rotation),1!==a.linewidth&&(g.linewidth=a.linewidth),void 0!==a.dashSize&&(g.dashSize=a.dashSize),void 0!==a.gapSize&&(g.gapSize=a.gapSize),void 0!==a.scale&&(g.scale=a.scale),void 0!==a.polygonOffset&&(g.polygonOffset=a.polygonOffset),void 0!==a.polygonOffsetFactor&&(g.polygonOffsetFactor=a.polygonOffsetFactor),void 0!==a.polygonOffsetUnits&&(g.polygonOffsetUnits=a.polygonOffsetUnits),void 0!==a.skinning&&(g.skinning=a.skinning),void 0!==a.morphTargets&&(g.morphTargets=a.morphTargets),void 0!==a.morphNormals&&(g.morphNormals=a.morphNormals),void 0!==a.dithering&&(g.dithering=a.dithering),void 0!==a.vertexTangents&&(g.vertexTangents=a.vertexTangents),void 0!==a.visible&&(g.visible=a.visible),void 0!==a.toneMapped&&(g.toneMapped=a.toneMapped),void 0!==a.userData&&(g.userData=a.userData),void 0!==a.vertexColors&&("number"==typeof a.vertexColors?g.vertexColors=a.vertexColors>0:g.vertexColors=a.vertexColors),void 0!==a.uniforms)for(var h in a.uniforms){var i=a.uniforms[h];switch(g.uniforms[h]={},i.type){case"t":g.uniforms[h].value=b(i.value);break;case"c":g.uniforms[h].value=(new v).setHex(i.value);break;case"v2":g.uniforms[h].value=(new c).fromArray(i.value);break;case"v3":g.uniforms[h].value=(new j).fromArray(i.value);break;case"v4":g.uniforms[h].value=(new f).fromArray(i.value);break;case"m3":g.uniforms[h].value=(new d).fromArray(i.value);case"m4":g.uniforms[h].value=(new k).fromArray(i.value);break;default:g.uniforms[h].value=i.value}}if(void 0!==a.defines&&(g.defines=a.defines),void 0!==a.vertexShader&&(g.vertexShader=a.vertexShader),void 0!==a.fragmentShader&&(g.fragmentShader=a.fragmentShader),void 0!==a.extensions)for(var l in a.extensions)g.extensions[l]=a.extensions[l];if(void 0!==a.shading&&(g.flatShading=1===a.shading),void 0!==a.size&&(g.size=a.size),void 0!==a.sizeAttenuation&&(g.sizeAttenuation=a.sizeAttenuation),void 0!==a.map&&(g.map=b(a.map)),void 0!==a.matcap&&(g.matcap=b(a.matcap)),void 0!==a.alphaMap&&(g.alphaMap=b(a.alphaMap)),void 0!==a.bumpMap&&(g.bumpMap=b(a.bumpMap)),void 0!==a.bumpScale&&(g.bumpScale=a.bumpScale),void 0!==a.normalMap&&(g.normalMap=b(a.normalMap)),void 0!==a.normalMapType&&(g.normalMapType=a.normalMapType),void 0!==a.normalScale){var m=a.normalScale;!1===Array.isArray(m)&&(m=[m,m]),g.normalScale=(new c).fromArray(m)}return void 0!==a.displacementMap&&(g.displacementMap=b(a.displacementMap)),void 0!==a.displacementScale&&(g.displacementScale=a.displacementScale),void 0!==a.displacementBias&&(g.displacementBias=a.displacementBias),void 0!==a.roughnessMap&&(g.roughnessMap=b(a.roughnessMap)),void 0!==a.metalnessMap&&(g.metalnessMap=b(a.metalnessMap)),void 0!==a.emissiveMap&&(g.emissiveMap=b(a.emissiveMap)),void 0!==a.emissiveIntensity&&(g.emissiveIntensity=a.emissiveIntensity),void 0!==a.specularMap&&(g.specularMap=b(a.specularMap)),void 0!==a.envMap&&(g.envMap=b(a.envMap)),void 0!==a.envMapIntensity&&(g.envMapIntensity=a.envMapIntensity),void 0!==a.reflectivity&&(g.reflectivity=a.reflectivity),void 0!==a.refractionRatio&&(g.refractionRatio=a.refractionRatio),void 0!==a.lightMap&&(g.lightMap=b(a.lightMap)),void 0!==a.lightMapIntensity&&(g.lightMapIntensity=a.lightMapIntensity),void 0!==a.aoMap&&(g.aoMap=b(a.aoMap)),void 0!==a.aoMapIntensity&&(g.aoMapIntensity=a.aoMapIntensity),void 0!==a.gradientMap&&(g.gradientMap=b(a.gradientMap)),void 0!==a.clearcoatMap&&(g.clearcoatMap=b(a.clearcoatMap)),void 0!==a.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap=b(a.clearcoatRoughnessMap)),void 0!==a.clearcoatNormalMap&&(g.clearcoatNormalMap=b(a.clearcoatNormalMap)),void 0!==a.clearcoatNormalScale&&(g.clearcoatNormalScale=(new c).fromArray(a.clearcoatNormalScale)),g},setTextures:function(a){return this.textures=a,this}});var jq={decodeText:function(a){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);try{return decodeURIComponent(escape(b))}catch(a){return b}},extractUrlBase:function(a){var b=a.lastIndexOf("/");return-1===b?"./":a.substr(0,b+1)}};mf.prototype=Object.assign(Object.create(O.prototype),{constructor:mf,isInstancedBufferGeometry:!0,copy:function(a){return O.prototype.copy.call(this,a),this.instanceCount=a.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a=O.prototype.toJSON.call(this);return a.instanceCount=this.instanceCount,a.isInstancedBufferGeometry=!0,a}}),nf.prototype=Object.assign(Object.create(C.prototype),{constructor:nf,isInstancedBufferAttribute:!0,copy:function(a){return C.prototype.copy.call(this,a),this.meshPerAttribute=a.meshPerAttribute,this},toJSON:function(){var a=C.prototype.toJSON.call(this);return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}),of.prototype=Object.assign(Object.create(re.prototype),{constructor:of,load:function(a,b,c,d){var e=this,f=new se(e.manager);f.setPath(e.path),f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)},parse:function(a){function b(a,b){if(void 0!==d[b])return d[b];var e=a.interleavedBuffers,f=e[b],g=c(a,f.buffer),h=new kq[f.type](g),i=new ec(h,f.stride);return i.uuid=f.uuid,d[b]=i,i}function c(a,b){if(void 0!==e[b])return e[b];var c=a.arrayBuffers,d=c[b],f=new Uint32Array(d).buffer;return e[b]=f,f}var d={},e={},f=a.isInstancedBufferGeometry?new mf:new O,g=a.data.index;if(void 0!==g){var h=new kq[g.type](g.array);f.setIndex(new C(h,1))}var i=a.data.attributes;for(var k in i){var l=i[k],m=void 0;if(l.isInterleavedBufferAttribute){m=new fc(b(a.data,l.data),l.itemSize,l.offset,l.normalized)}else{var n=new kq[l.type](l.array);m=new(l.isInstancedBufferAttribute?nf:C)(n,l.itemSize,l.normalized)}void 0!==l.name&&(m.name=l.name),f.setAttribute(k,m)}var o=a.data.morphAttributes;if(o)for(var p in o){for(var q=o[p],s=[],t=0,u=q.length;t<u;t++){var v=q[t],w=void 0;if(v.isInterleavedBufferAttribute){var x=b(a.data,v.data);w=new fc(x,v.itemSize,v.offset,v.normalized)}else{var y=new kq[v.type](v.array);w=new C(y,v.itemSize,v.normalized)}void 0!==v.name&&(w.name=v.name),s.push(w)}f.morphAttributes[p]=s}a.data.morphTargetsRelative&&(f.morphTargetsRelative=!0);var z=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==z)for(var A=0,B=z.length;A!==B;++A){var D=z[A];f.addGroup(D.start,D.count,D.materialIndex)}var E=a.data.boundingSphere;if(void 0!==E){var F=new j;void 0!==E.center&&F.fromArray(E.center),f.boundingSphere=new r(F,E.radius)}return a.name&&(f.name=a.name),a.userData&&(f.userData=a.userData),f}});var kq={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};pf.prototype=Object.assign(Object.create(re.prototype),{constructor:pf,load:function(a,b,c,d){var e=this,f=""===this.path?jq.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||f;var g=new se(e.manager);g.setPath(this.path),g.load(a,function(c){var f=null;try{f=JSON.parse(c)}catch(b){return void 0!==d&&d(b),void console.error("THREE:ObjectLoader: Can't parse "+a+".",b.message)}var g=f.metadata;if(void 0===g||void 0===g.type||"geometry"===g.type.toLowerCase())return void console.error("THREE.ObjectLoader: Can't load "+a);e.parse(f,b)},c,d)},parse:function(a,b){var c=this.parseShape(a.shapes),d=this.parseGeometries(a.geometries,c),e=this.parseImages(a.images,function(){void 0!==b&&b(h)}),f=this.parseTextures(a.textures,e),g=this.parseMaterials(a.materials,f),h=this.parseObject(a.object,d,g);return a.animations&&(h.animations=this.parseAnimations(a.animations)),void 0!==a.images&&0!==a.images.length||void 0!==b&&b(h),h},parseShape:function(a){var b={};if(void 0!==a)for(var c=0,d=a.length;c<d;c++){var e=(new Xe).fromJSON(a[c]);b[e.uuid]=e}return b},parseGeometries:function(a,b){var c,d={};if(void 0!==a)for(var e=new of,f=0,g=a.length;f<g;f++){var h=void 0,i=a[f];switch(i.type){case"PlaneGeometry":case"PlaneBufferGeometry":h=new $p[i.type](i.width,i.height,i.widthSegments,i.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":h=new $p[i.type](i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":h=new $p[i.type](i.radius,i.segments,i.thetaStart,i.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":h=new $p[i.type](i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":h=new $p[i.type](i.radius,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":h=new $p[i.type](i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":h=new $p[i.type](i.radius,i.detail);break;case"RingGeometry":case"RingBufferGeometry":h=new $p[i.type](i.innerRadius,i.outerRadius,i.thetaSegments,i.phiSegments,i.thetaStart,i.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":h=new $p[i.type](i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":h=new $p[i.type](i.radius,i.tube,i.tubularSegments,i.radialSegments,i.p,i.q);break;case"TubeGeometry":case"TubeBufferGeometry":h=new $p[i.type]((new iq[i.path.type]).fromJSON(i.path),i.tubularSegments,i.radius,i.radialSegments,i.closed);break;case"LatheGeometry":case"LatheBufferGeometry":h=new $p[i.type](i.points,i.segments,i.phiStart,i.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":h=new $p[i.type](i.vertices,i.indices,i.radius,i.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":c=[];for(var j=0,k=i.shapes.length;j<k;j++){var l=b[i.shapes[j]];c.push(l)}h=new $p[i.type](c,i.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":c=[];for(var m=0,n=i.shapes.length;m<n;m++){var o=b[i.shapes[m]];c.push(o)}var p=i.options.extrudePath;void 0!==p&&(i.options.extrudePath=(new iq[p.type]).fromJSON(p)),h=new $p[i.type](c,i.options);break;case"BufferGeometry":case"InstancedBufferGeometry":h=e.parse(i);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+i.type+'"');continue}h.uuid=i.uuid,void 0!==i.name&&(h.name=i.name),!0===h.isBufferGeometry&&void 0!==i.userData&&(h.userData=i.userData),d[i.uuid]=h}return d},parseMaterials:function(a,b){var c={},d={};if(void 0!==a){var e=new lf;e.setTextures(b);for(var f=0,g=a.length;f<g;f++){var h=a[f];if("MultiMaterial"===h.type){for(var i=[],j=0;j<h.materials.length;j++){var k=h.materials[j];void 0===c[k.uuid]&&(c[k.uuid]=e.parse(k)),i.push(c[k.uuid])}d[h.uuid]=i}else void 0===c[h.uuid]&&(c[h.uuid]=e.parse(h)),d[h.uuid]=c[h.uuid]}}return d},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=ne.parse(d);void 0!==d.uuid&&(e.uuid=d.uuid),b.push(e)}return b},parseImages:function(a,b){function c(a){return e.manager.itemStart(a),d.load(a,function(){e.manager.itemEnd(a)},void 0,function(){e.manager.itemError(a),e.manager.itemEnd(a)})}var d,e=this,f={};if(void 0!==a&&a.length>0){var g=new qe(b);d=new we(g),d.setCrossOrigin(this.crossOrigin);for(var h=0,i=a.length;h<i;h++){var j=a[h],k=j.url;if(Array.isArray(k)){f[j.uuid]=[];for(var l=0,m=k.length;l<m;l++){var n=k[l],o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;f[j.uuid].push(c(o))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(j.url)?j.url:e.resourcePath+j.url;f[j.uuid]=c(p)}}}return f},parseTextures:function(a,b){function c(a,b){return"number"==typeof a?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),b[a])}var d={};if(void 0!==a)for(var f=0,g=a.length;f<g;f++){var h=a[f];void 0===h.image&&console.warn('THREE.ObjectLoader: No "image" specified for',h.uuid),void 0===b[h.image]&&console.warn("THREE.ObjectLoader: Undefined image",h.image);var i=void 0;i=Array.isArray(b[h.image])?new ra(b[h.image]):new e(b[h.image]),i.needsUpdate=!0,i.uuid=h.uuid,void 0!==h.name&&(i.name=h.name),void 0!==h.mapping&&(i.mapping=c(h.mapping,lq)),void 0!==h.offset&&i.offset.fromArray(h.offset),void 0!==h.repeat&&i.repeat.fromArray(h.repeat),void 0!==h.center&&i.center.fromArray(h.center),void 0!==h.rotation&&(i.rotation=h.rotation),void 0!==h.wrap&&(i.wrapS=c(h.wrap[0],mq),i.wrapT=c(h.wrap[1],mq)),void 0!==h.format&&(i.format=h.format),void 0!==h.type&&(i.type=h.type),void 0!==h.encoding&&(i.encoding=h.encoding),void 0!==h.minFilter&&(i.minFilter=c(h.minFilter,nq)),void 0!==h.magFilter&&(i.magFilter=c(h.magFilter,nq)),void 0!==h.anisotropy&&(i.anisotropy=h.anisotropy),void 0!==h.flipY&&(i.flipY=h.flipY),void 0!==h.premultiplyAlpha&&(i.premultiplyAlpha=h.premultiplyAlpha),void 0!==h.unpackAlignment&&(i.unpackAlignment=h.unpackAlignment),d[h.uuid]=i}return d},parseObject:function(a,b,c){function d(a){return void 0===b[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a),b[a]}function e(a){if(void 0!==a){if(Array.isArray(a)){for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d];void 0===c[f]&&console.warn("THREE.ObjectLoader: Undefined material",f),b.push(c[f])}return b}return void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),c[a]}}var f,g,h;switch(a.type){case"Scene":f=new o,void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new v(a.background)),void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new dc(a.fog.color,a.fog.near,a.fog.far):"FogExp2"===a.fog.type&&(f.fog=new cc(a.fog.color,a.fog.density)));break;case"PerspectiveCamera":f=new X(a.fov,a.aspect,a.near,a.far),void 0!==a.focus&&(f.focus=a.focus),void 0!==a.zoom&&(f.zoom=a.zoom),void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge),void 0!==a.filmOffset&&(f.filmOffset=a.filmOffset),void 0!==a.view&&(f.view=Object.assign({},a.view));break;case"OrthographicCamera":f=new df(a.left,a.right,a.top,a.bottom,a.near,a.far),void 0!==a.zoom&&(f.zoom=a.zoom),void 0!==a.view&&(f.view=Object.assign({},a.view));break;case"AmbientLight":f=new gf(a.color,a.intensity);break;case"DirectionalLight":f=new ff(a.color,a.intensity);break;case"PointLight":f=new cf(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":f=new hf(a.color,a.intensity,a.width,a.height);break;case"SpotLight":f=new af(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":f=new Ze(a.color,a.groundColor,a.intensity);break;case"LightProbe":f=(new kf).fromJSON(a);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":g=d(a.geometry),h=e(a.material),f=new P(g,h);break;case"InstancedMesh":g=d(a.geometry),h=e(a.material);var i=a.count,j=a.instanceMatrix;f=new oc(g,h,i),f.instanceMatrix=new C(new Float32Array(j.array),16);break;case"LOD":f=new kc;break;case"Line":f=new qc(d(a.geometry),e(a.material),a.mode);break;case"LineLoop":f=new sc(d(a.geometry),e(a.material));break;case"LineSegments":f=new rc(d(a.geometry),e(a.material));break;case"PointCloud":case"Points":f=new uc(d(a.geometry),e(a.material));break;case"Sprite":f=new hc(e(a.material));break;case"Group":f=new Yb;break;default:f=new n}if(f.uuid=a.uuid,void 0!==a.name&&(f.name=a.name),void 0!==a.matrix?(f.matrix.fromArray(a.matrix),void 0!==a.matrixAutoUpdate&&(f.matrixAutoUpdate=a.matrixAutoUpdate),f.matrixAutoUpdate&&f.matrix.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale)),void 0!==a.castShadow&&(f.castShadow=a.castShadow),void 0!==a.receiveShadow&&(f.receiveShadow=a.receiveShadow),a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.normalBias&&(f.shadow.normalBias=a.shadow.normalBias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera))),void 0!==a.visible&&(f.visible=a.visible),void 0!==a.frustumCulled&&(f.frustumCulled=a.frustumCulled),void 0!==a.renderOrder&&(f.renderOrder=a.renderOrder),void 0!==a.userData&&(f.userData=a.userData),void 0!==a.layers&&(f.layers.mask=a.layers),void 0!==a.children)for(var k=a.children,l=0;l<k.length;l++)f.add(this.parseObject(k[l],b,c));if("LOD"===a.type){void 0!==a.autoUpdate&&(f.autoUpdate=a.autoUpdate);for(var m=a.levels,p=0;p<m.length;p++){var q=m[p],r=f.getObjectByProperty("uuid",q.object);void 0!==r&&f.addLevel(r,q.distance)}}return f}});var lq={UVMapping:ai,CubeReflectionMapping:bi,CubeRefractionMapping:ci,EquirectangularReflectionMapping:di,EquirectangularRefractionMapping:ei,CubeUVReflectionMapping:fi,CubeUVRefractionMapping:gi},mq={RepeatWrapping:hi,ClampToEdgeWrapping:ii,MirroredRepeatWrapping:ji},nq={NearestFilter:ki,NearestMipmapNearestFilter:li,NearestMipmapLinearFilter:ni,LinearFilter:pi,LinearMipmapNearestFilter:qi,LinearMipmapLinearFilter:si};qf.prototype=Object.assign(Object.create(re.prototype),{constructor:qf,setOptions:function(a){return this.options=a,this},load:function(a,b,c,d){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var e=this,f=bq.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f),e.manager.itemEnd(a)},0),f;fetch(a).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,e.options)}).then(function(c){bq.add(a,c),b&&b(c),e.manager.itemEnd(a)}).catch(function(b){d&&d(b),e.manager.itemError(a),e.manager.itemEnd(a)}),e.manager.itemStart(a)}}),Object.assign(rf.prototype,{moveTo:function(a,b){return this.currentPath=new We,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,b),this},lineTo:function(a,b){return this.currentPath.lineTo(a,b),this},quadraticCurveTo:function(a,b,c,d){return this.currentPath.quadraticCurveTo(a,b,c,d),this},bezierCurveTo:function(a,b,c,d,e,f){return this.currentPath.bezierCurveTo(a,b,c,d,e,f),this},splineThru:function(a){return this.currentPath.splineThru(a),this},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new Xe;f.curves=e.curves,b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],i=h.x-g.x,j=h.y-g.y;if(Math.abs(j)>Number.EPSILON){if(j<0&&(g=b[f],i=-i,h=b[e],j=-j),a.y<g.y||a.y>h.y)continue;if(a.y===g.y){if(a.x===g.x)return!0}else{var k=j*(a.x-g.x)-i*(a.y-g.y);if(0===k)return!0;if(k<0)continue;d=!d}}else{if(a.y!==g.y)continue;if(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x)return!0}}return d}var e=Yp.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);var g,h,i,j=[];if(1===f.length)return h=f[0],i=new Xe,i.curves=h.curves,j.push(i),j;var k=!e(f[0].getPoints());k=a?!k:k;var l,m=[],n=[],o=[],p=0;n[p]=void 0,o[p]=[];for(var q=0,r=f.length;q<r;q++)h=f[q],l=h.getPoints(),g=e(l),g=a?!g:g,g?(!k&&n[p]&&p++,n[p]={s:new Xe,p:l},n[p].s.curves=h.curves,k&&p++,o[p]=[]):o[p].push({h:h,p:l[0]});if(!n[0])return c(f);if(n.length>1){for(var s=!1,t=[],u=0,v=n.length;u<v;u++)m[u]=[];for(var w=0,x=n.length;w<x;w++)for(var y=o[w],z=0;z<y.length;z++){for(var A=y[z],B=!0,C=0;C<n.length;C++)d(A.p,n[C].p)&&(w!==C&&t.push({froms:w,tos:C,hole:z}),B?(B=!1,m[C].push(A)):s=!0);B&&m[w].push(A)}t.length>0&&(s||(o=m))}for(var D,E=0,F=n.length;E<F;E++){i=n[E].s,j.push(i),D=o[E];for(var G=0,H=D.length;G<H;G++)i.holes.push(D[G].h)}return j}}),Object.assign(sf.prototype,{isFont:!0,generateShapes:function(a,b){void 0===b&&(b=100);for(var c=[],d=tf(a,b,this.data),e=0,f=d.length;e<f;e++)Array.prototype.push.apply(c,d[e].toShapes());return c}}),vf.prototype=Object.assign(Object.create(re.prototype),{constructor:vf,load:function(a,b,c,d){var e=this,f=new se(this.manager);f.setPath(this.path),f.load(a,function(a){var c;try{c=JSON.parse(a)}catch(b){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}var d=e.parse(c);b&&b(d)},c,d)},parse:function(a){return new sf(a)}});var oq,pq={getContext:function(){return void 0===oq&&(oq=new(window.AudioContext||window.webkitAudioContext)),oq},setContext:function(a){oq=a}};wf.prototype=Object.assign(Object.create(re.prototype),{constructor:wf,load:function(a,b,c,d){var e=this,f=new se(e.manager);f.setResponseType("arraybuffer"),f.setPath(e.path),f.load(a,function(c){try{var f=c.slice(0);pq.getContext().decodeAudioData(f,function(a){b(a)})}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)}}),xf.prototype=Object.assign(Object.create(kf.prototype),{constructor:xf,isHemisphereLightProbe:!0,copy:function(a){return kf.prototype.copy.call(this,a),this},toJSON:function(a){return kf.prototype.toJSON.call(this,a)}}),yf.prototype=Object.assign(Object.create(kf.prototype),{constructor:yf,isAmbientLightProbe:!0,copy:function(a){return kf.prototype.copy.call(this,a),this},toJSON:function(a){return kf.prototype.toJSON.call(this,a)}});var qq=new k,rq=new k;Object.assign(zf.prototype,{update:function(a){var b=this._cache;if(b.focus!==a.focus||b.fov!==a.fov||b.aspect!==a.aspect*this.aspect||b.near!==a.near||b.far!==a.far||b.zoom!==a.zoom||b.eyeSep!==this.eyeSep){b.focus=a.focus,b.fov=a.fov,b.aspect=a.aspect*this.aspect,b.near=a.near,b.far=a.far,b.zoom=a.zoom,b.eyeSep=this.eyeSep;var c,d,e=a.projectionMatrix.clone(),f=b.eyeSep/2,g=f*b.near/b.focus,h=b.near*Math.tan(Fk.DEG2RAD*b.fov*.5)/b.zoom;rq.elements[12]=-f,qq.elements[12]=f,c=-h*b.aspect+g,d=h*b.aspect+g,e.elements[0]=2*b.near/(d-c),e.elements[8]=(d+c)/(d-c),this.cameraL.projectionMatrix.copy(e),c=-h*b.aspect-g,d=h*b.aspect-g,e.elements[0]=2*b.near/(d-c),e.elements[8]=(d+c)/(d-c),this.cameraR.projectionMatrix.copy(e)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(rq),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(qq)}}),Object.assign(Af.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var b=("undefined"==typeof performance?Date:performance).now();a=(b-this.oldTime)/1e3,this.oldTime=b,this.elapsedTime+=a}return a}});var sq=new j,tq=new i,uq=new j,vq=new j;Bf.prototype=Object.assign(Object.create(n.prototype),{constructor:Bf,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(a){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this},updateMatrixWorld:function(a){n.prototype.updateMatrixWorld.call(this,a);var b=this.context.listener,c=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(sq,tq,uq),vq.set(0,0,-1).applyQuaternion(tq),b.positionX){var d=this.context.currentTime+this.timeDelta;b.positionX.linearRampToValueAtTime(sq.x,d),b.positionY.linearRampToValueAtTime(sq.y,d),b.positionZ.linearRampToValueAtTime(sq.z,d),b.forwardX.linearRampToValueAtTime(vq.x,d),b.forwardY.linearRampToValueAtTime(vq.y,d),b.forwardZ.linearRampToValueAtTime(vq.z,d),b.upX.linearRampToValueAtTime(c.x,d),b.upY.linearRampToValueAtTime(c.y,d),b.upZ.linearRampToValueAtTime(c.z,d)}else b.setPosition(sq.x,sq.y,sq.z),b.setOrientation(vq.x,vq.y,vq.z,c.x,c.y,c.z)}}),Cf.prototype=Object.assign(Object.create(n.prototype),{constructor:Cf,getOutput:function(){return this.gain},setNodeSource:function(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this},setMediaElementSource:function(a){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(a),this.connect(),this},setMediaStreamSource:function(a){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(a),this.connect(),this},setBuffer:function(a){return this.buffer=a,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(a){if(void 0===a&&(a=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+a;var b=this.context.createBufferSource();return b.buffer=this.buffer,b.loop=this.loop,b.loopStart=this.loopStart,b.loopEnd=this.loopEnd,b.onended=this.onEnded.bind(this),b.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=b,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this)},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){return a||(a=[]),!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a,this},setDetune:function(a){if(this.detune=a,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this)},setLoopStart:function(a){return this.loopStart=a,this},setLoopEnd:function(a){return this.loopEnd=a,this},getVolume:function(){return this.gain.gain.value},setVolume:function(a){return this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01),this}});var wq=new j,xq=new i,yq=new j,zq=new j;Df.prototype=Object.assign(Object.create(Cf.prototype),{constructor:Df,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){return this.panner.refDistance=a,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){return this.panner.rolloffFactor=a,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){return this.panner.distanceModel=a,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){return this.panner.maxDistance=a,this},setDirectionalCone:function(a,b,c){return this.panner.coneInnerAngle=a,this.panner.coneOuterAngle=b,this.panner.coneOuterGain=c,this},updateMatrixWorld:function(a){if(n.prototype.updateMatrixWorld.call(this,a),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(wq,xq,yq),zq.set(0,0,1).applyQuaternion(xq);var b=this.panner;if(b.positionX){var c=this.context.currentTime+this.listener.timeDelta;b.positionX.linearRampToValueAtTime(wq.x,c),b.positionY.linearRampToValueAtTime(wq.y,c),b.positionZ.linearRampToValueAtTime(wq.z,c),b.orientationX.linearRampToValueAtTime(zq.x,c),b.orientationY.linearRampToValueAtTime(zq.y,c),b.orientationZ.linearRampToValueAtTime(zq.z,c)}else b.setPosition(wq.x,wq.y,wq.z),b.setOrientation(zq.x,zq.y,zq.z)}}}),Object.assign(Ef.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}}),Object.assign(Ff.prototype,{accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(var g=0;g!==d;++g)c[e+g]=c[g];f=b}else{f+=b;var h=b/f;this._mixBufferRegion(c,e,0,h,d)}this.cumulativeWeight=f},accumulateAdditive:function(a){var b=this.buffer,c=this.valueSize,d=c*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(b,d,0,a,c),this.cumulativeWeightAdditive+=a},apply:function(a){var b=this.valueSize,c=this.buffer,d=a*b+b,e=this.cumulativeWeight,f=this.cumulativeWeightAdditive,g=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,e<1){var h=b*this._origIndex;this._mixBufferRegion(c,d,h,1-e,b)}f>0&&this._mixBufferRegionAdditive(c,d,this._addIndex*b,1,b);for(var i=b,j=b+b;i!==j;++i)if(c[i]!==c[i+b]){g.setValue(c,d);break}},saveOriginalState:function(){var a=this.binding,b=this.buffer,c=this.valueSize,d=c*this._origIndex;a.getValue(b,d);for(var e=c,f=d;e!==f;++e)b[e]=b[d+e%c];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var a=3*this.valueSize;this.binding.setValue(this.buffer,a)},_setAdditiveIdentityNumeric:function(){for(var a=this._addIndex*this.valueSize,b=a+this.valueSize,c=a;c<b;c++)this.buffer[c]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var a=this._origIndex*this.valueSize,b=this._addIndex*this.valueSize,c=0;c<this.valueSize;c++)this.buffer[b+c]=this.buffer[a+c]},_select:function(a,b,c,d,e){if(d>=.5)for(var f=0;f!==e;++f)a[b+f]=a[c+f]},_slerp:function(a,b,c,d){i.slerpFlat(a,b,a,b,a,c,d)},_slerpAdditive:function(a,b,c,d,e){var f=this._workIndex*e;i.multiplyQuaternionsFlat(a,f,a,b,a,c),i.slerpFlat(a,b,a,b,a,f,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}},_lerpAdditive:function(a,b,c,d,e){for(var f=0;f!==e;++f){var g=b+f;a[g]=a[g]+a[c+f]*d}}});var Aq="\\[\\]\\.:\\/",Bq=new RegExp("["+Aq+"]","g"),Cq="[^"+Aq+"]",Dq="[^"+Aq.replace("\\.","")+"]",Eq=/((?:WC+[\/:])*)/.source.replace("WC",Cq),Fq=/(WCOD+)?/.source.replace("WCOD",Dq),Gq=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Cq),Hq=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Cq),Iq=new RegExp("^"+Eq+Fq+Gq+Hq+"$"),Jq=["material","materials","bones"];Object.assign(Gf.prototype,{getValue:function(a,b){this.bind();var c=this._targetGroup.nCachedObjects_,d=this._bindings[c];void 0!==d&&d.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}}),Object.assign(Hf,{Composite:Gf,create:function(a,b,c){return a&&a.isAnimationObjectGroup?new Hf.Composite(a,b,c):new Hf(a,b,c)},sanitizeNodeName:function(a){return a.replace(/\s/g,"_").replace(Bq,"")},parseTrackName:function(a){var b=Iq.exec(a);if(!b)throw new Error("PropertyBinding: Cannot parse trackName: "+a);var c={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]},d=c.nodeName&&c.nodeName.lastIndexOf(".");if(void 0!==d&&-1!==d){var e=c.nodeName.substring(d+1);-1!==Jq.indexOf(e)&&(c.nodeName=c.nodeName.substring(0,d),c.objectName=e)}if(null===c.propertyName||0===c.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return c},findNode:function(a,b){if(!b||""===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===b||e.uuid===b)return e;var f=d(e.children);if(f)return f}return null},e=d(a.children);if(e)return e}return null}}),Object.assign(Hf.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.targetObject[this.propertyName]=a[b]},function(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,b){this.bind(),this.getValue(a,b)},setValue:function(a,b){this.bind(),this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;if(a||(a=Hf.findNode(this.rootNode,b.nodeName)||this.rootNode,this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(c){var f=b.objectIndex;switch(c){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(var g=0;g<a.length;g++)if(a[g].name===f){f=g;break}break;default:if(void 0===a[c])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[c]}if(void 0!==f){if(void 0===a[f])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[f]}}var h=a[d];if(void 0===h){var i=b.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+d+" but it wasn't found.",a)}var j=this.Versioning.None;this.targetObject=a,void 0!==a.needsUpdate?j=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(j=this.Versioning.MatrixWorldNeedsUpdate);var k=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==a.morphTargetDictionary[e]&&(e=a.morphTargetDictionary[e])}k=this.BindingType.ArrayElement,this.resolvedProperty=h,this.propertyIndex=e}else void 0!==h.fromArray&&void 0!==h.toArray?(k=this.BindingType.HasFromToArray,this.resolvedProperty=h):Array.isArray(h)?(k=this.BindingType.EntireArray,this.resolvedProperty=h):this.propertyName=d;this.getValue=this.GetterByBindingType[k],this.setValue=this.SetterByBindingTypeAndVersioning[k][j]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Hf.prototype,{_getValue_unbound:Hf.prototype.getValue,_setValue_unbound:Hf.prototype.setValue}),Object.assign(If.prototype,{isAnimationObjectGroup:!0,add:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._paths,d=this._parsedPaths,e=this._bindings,f=e.length,g=void 0,h=a.length,i=this.nCachedObjects_,j=0,k=arguments.length;j!==k;++j){var l=arguments[j],m=l.uuid,n=b[m];if(void 0===n){n=h++,b[m]=n,a.push(l);for(var o=0,p=f;o!==p;++o)e[o].push(new Hf(l,c[o],d[o]))}else if(n<i){g=a[n];var q=--i,r=a[q];b[r.uuid]=n,a[n]=r,b[m]=q,a[q]=l;for(var s=0,t=f;s!==t;++s){var u=e[s],v=u[q],w=u[n];u[n]=v,void 0===w&&(w=new Hf(l,c[s],d[s])),u[q]=w}}else a[n]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length,e=this.nCachedObjects_,f=0,g=arguments.length;f!==g;++f){var h=arguments[f],i=h.uuid,j=b[i];if(void 0!==j&&j>=e){var k=e++,l=a[k];b[l.uuid]=j,a[j]=l,b[i]=k,a[k]=h;for(var m=0,n=d;m!==n;++m){var o=c[m],p=o[k],q=o[j];o[j]=p,o[k]=q}}}this.nCachedObjects_=e},uncache:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length,e=this.nCachedObjects_,f=a.length,g=0,h=arguments.length;g!==h;++g){var i=arguments[g],j=i.uuid,k=b[j];if(void 0!==k)if(delete b[j],k<e){var l=--e,m=a[l],n=--f,o=a[n];b[m.uuid]=k,a[k]=m,b[o.uuid]=l,a[l]=o,a.pop();for(var p=0,q=d;p!==q;++p){var r=c[p],s=r[l],t=r[n];r[k]=s,r[l]=t,r.pop()}}else{var u=--f,v=a[u];b[v.uuid]=k,a[k]=v,a.pop();for(var w=0,x=d;w!==x;++w){var y=c[w];y[k]=y[u],y.pop()}}}this.nCachedObjects_=e},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,i=h.length,j=this.nCachedObjects_,k=new Array(i);d=e.length,c[a]=d,f.push(a),g.push(b),e.push(k);for(var l=j,m=h.length;l!==m;++l){var n=h[l];k[l]=new Hf(n,a,b)}return k},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c,f[c]=h,f.pop(),e[c]=e[g],e.pop(),d[c]=d[g],d.pop()}}}),Object.assign(Jf.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){return this._startTime=a,this},setLoop:function(a,b){return this.loop=a,this.repetitions=b,this},setEffectiveWeight:function(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){if(a.fadeOut(b),this.fadeIn(b),c){var d=this._clip.duration,e=a._clip.duration,f=e/d,g=d/e;a.warp(1,f,b),this.warp(g,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;return null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this},setEffectiveTimeScale:function(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){return this.timeScale=this._clip.duration/a,this.stopWarping()},syncWith:function(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this.timeScale,g=this._timeScaleInterpolant;null===g&&(g=d._lendControlInterpolant(),this._timeScaleInterpolant=g);var h=g.parameterPositions,i=g.sampleValues;return h[0]=e,h[1]=e+c,i[0]=a/f,i[1]=b/f,this},stopWarping:function(){var a=this._timeScaleInterpolant;return null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){if(!this.enabled)return void this._updateWeight(a);var e=this._startTime;if(null!==e){var f=(a-e)*c;if(f<0||0===c)return;this._startTime=null,b=c*f}b*=this._updateTimeScale(a);var g=this._updateTime(b),h=this._updateWeight(a);if(h>0){var i=this._interpolants,j=this._propertyBindings;switch(this.blendMode){case Qj:for(var k=0,l=i.length;k!==l;++k)i[k].evaluate(g),j[k].accumulateAdditive(h);break;case Pj:default:for(var m=0,n=i.length;m!==n;++m)i[m].evaluate(g),j[m].accumulate(d,h)}}},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d,a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b,b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var c=this._timeScaleInterpolant;if(null!==c){b*=c.evaluate(a)[0],a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b,b},_updateTime:function(a){var b=this._clip.duration,c=this.loop,d=this.time+a,e=this._loopCount,f=c===Ij;if(0===a)return-1===e?d:f&&1==(1&e)?b-d:d;if(c===Gj){-1===e&&(this._loopCount=0,this._setEndings(!0,!0,!1));a:{if(d>=b)d=b;else{if(!(d<0)){this.time=d;break a}d=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1})}}else{if(-1===e&&(a>=0?(e=0,this._setEndings(!0,0===this.repetitions,f)):this._setEndings(0===this.repetitions,!0,f)),d>=b||d<0){var g=Math.floor(d/b);d-=b*g,e+=Math.abs(g);var h=this.repetitions-e;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,d=a>0?b:0,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});else{if(1===h){var i=a<0;this._setEndings(i,!i,f)}else this._setEndings(!1,!1,f);this._loopCount=e,this.time=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=d;if(f&&1==(1&e))return b-d}return d},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=Nj,d.endingEnd=Nj):(d.endingStart=a?this.zeroSlopeAtStart?Nj:Mj:Oj,d.endingEnd=b?this.zeroSlopeAtEnd?Nj:Mj:Oj)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(f=d._lendControlInterpolant(),this._weightInterpolant=f);var g=f.parameterPositions,h=f.sampleValues;return g[0]=e,h[0]=b,g[1]=e+a,h[1]=c,this}}),Kf.prototype=Object.assign(Object.create(b.prototype),{constructor:Kf,_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=c.uuid,i=this._bindingsByRootAndName,j=i[h];void 0===j&&(j={},i[h]=j);for(var k=0;k!==e;++k){var l=d[k],m=l.name,n=j[m];if(void 0!==n)f[k]=n;else{if(void 0!==(n=f[k])){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,h,m));continue}var o=b&&b._propertyBindings[k].binding.parsedPath;n=new Ff(Hf.create(c,m,o),l.ValueTypeName,l.getValueSize()),++n.referenceCount,this._addInactiveBinding(n,h,m),f[k]=n}g[k].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]),this._addInactiveAction(a,c,b)}for(var e=a._propertyBindings,f=0,g=e.length;f!==g;++f){var h=e[f];0==h.useCount++&&(this._lendBinding(h),h.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0==--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){var b=a._cacheIndex;return null!==b&&b<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];if(void 0===f)f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f;else{var g=f.knownActions;a._byClipCacheIndex=g.length,g.push(a)}a._cacheIndex=d.length,d.push(a),f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d,b[d]=c,b.pop(),a._cacheIndex=null;var e=a._clip.uuid,f=this._actionsByClip,g=f[e],h=g.knownActions,i=h[h.length-1],j=a._byClipCacheIndex;i._byClipCacheIndex=j,h[j]=i,h.pop(),a._byClipCacheIndex=null,delete g.actionByRoot[(a._localRoot||this._root).uuid],0===h.length&&delete f[e],this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0==--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=this._bindings,f=d[b];void 0===f&&(f={},d[b]=f),f[c]=a,a._cacheIndex=e.length,e.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,e=c.path,f=this._bindingsByRootAndName,g=f[d],h=b[b.length-1],i=a._cacheIndex;h._cacheIndex=i,b[i]=h,b.pop(),delete g[e],0===Object.keys(g).length&&delete f[d]},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];return void 0===c&&(c=new de(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c),c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d,b[d]=a,e.__cacheIndex=c,b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(a,b,c){var d=b||this._root,e=d.uuid,f="string"==typeof a?ne.findByName(d,a):a,g=null!==f?f.uuid:a,h=this._actionsByClip[g],i=null;if(void 0===c&&(c=null!==f?f.blendMode:Pj),void 0!==h){var j=h.actionByRoot[e];if(void 0!==j&&j.blendMode===c)return j;i=h.knownActions[0],null===f&&(f=i._clip)}if(null===f)return null;var k=new Jf(this,f,b,c);return this._bindAction(k,i),this._addInactiveAction(k,g,e),k},existingAction:function(a,b){var c=b||this._root,d=c.uuid,e="string"==typeof a?ne.findByName(c,a):a,f=e?e.uuid:a,g=this._actionsByClip[f];return void 0!==g?g.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=b-1;c>=0;--c)a[c].stop();return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){b[g]._update(d,a,e,f)}for(var h=this._bindings,i=this._nActiveBindings,j=0;j!==i;++j)h[j].apply(f);return this},setTime:function(a){this.time=0;for(var b=0;b<this._actions.length;b++)this._actions[b].time=0;return this.update(a)},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions,c=a.uuid,d=this._actionsByClip,e=d[c];if(void 0!==e){for(var f=e.knownActions,g=0,h=f.length;g!==h;++g){var i=f[g];this._deactivateAction(i);var j=i._cacheIndex,k=b[b.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,k._cacheIndex=j,b[j]=k,b.pop(),this._removeInactiveBindingsForAction(i)}delete d[c]}},uncacheRoot:function(a){var b=a.uuid,c=this._actionsByClip;for(var d in c){var e=c[d].actionByRoot,f=e[b];void 0!==f&&(this._deactivateAction(f),this._removeInactiveAction(f))}var g=this._bindingsByRootAndName,h=g[b];if(void 0!==h)for(var i in h){var j=h[i];j.restoreOriginalState(),this._removeInactiveBinding(j)}},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}}),Lf.prototype.clone=function(){return new Lf(void 0===this.value.clone?this.value:this.value.clone())},Mf.prototype=Object.assign(Object.create(ec.prototype),{constructor:Mf,isInstancedInterleavedBuffer:!0,copy:function(a){return ec.prototype.copy.call(this,a),this.meshPerAttribute=a.meshPerAttribute,this},clone:function(a){var b=ec.prototype.clone.call(this,a);return b.meshPerAttribute=this.meshPerAttribute,b},toJSON:function(a){var b=ec.prototype.toJSON.call(this,a);return b.isInstancedInterleavedBuffer=!0,b.meshPerAttribute=this.meshPerAttribute,b}}),Object.assign(Nf.prototype,{set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize(),this.camera=b):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld),this.camera=b):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b,c){var d=c||[];return Pf(a,this,d,b),d.sort(Of),d},intersectObjects:function(a,b,c){var d=c||[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),d;for(var e=0,f=a.length;e<f;e++)Pf(a[e],this,d,b);return d.sort(Of),d}}),Object.assign(Qf.prototype,{set:function(a,b,c){return this.radius=a,this.phi=b,this.theta=c,this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.radius=a.radius,this.phi=a.phi,this.theta=a.theta,this},makeSafe:function(){var a=1e-6;return this.phi=Math.max(a,Math.min(Math.PI-a,this.phi)),this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){return this.radius=Math.sqrt(a*a+b*b+c*c),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a,c),this.phi=Math.acos(Fk.clamp(b/this.radius,-1,1))),this}}),Object.assign(Rf.prototype,{set:function(a,b,c){return this.radius=a,this.theta=b,this.y=c,this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.radius=a.radius,this.theta=a.theta,this.y=a.y,this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){return this.radius=Math.sqrt(a*a+c*c),this.theta=Math.atan2(a,c),this.y=b,this}});var Kq=new c;Object.assign(Sf.prototype,{set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(a,b){var c=Kq.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){return void 0===a&&(console.warn("THREE.Box2: .getCenter() target is now required"),a=new c),this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){return void 0===a&&(console.warn("THREE.Box2: .getSize() target is now required"),a=new c),this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){return void 0===b&&(console.warn("THREE.Box2: .getParameter() target is now required"),b=new c),b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)},clampPoint:function(a,b){return void 0===b&&(console.warn("THREE.Box2: .clampPoint() target is now required"),b=new c),b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(a){return Kq.copy(a).clamp(this.min,this.max).sub(a).length()},intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});var Lq=new j,Mq=new j;Object.assign(Tf.prototype,{set:function(a,b){return this.start.copy(a),this.end.copy(b),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},getCenter:function(a){return void 0===a&&(console.warn("THREE.Line3: .getCenter() target is now required"),a=new j),a.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return void 0===a&&(console.warn("THREE.Line3: .delta() target is now required"),a=new j),a.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){return void 0===b&&(console.warn("THREE.Line3: .at() target is now required"),b=new j),this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(a,b){Lq.subVectors(a,this.start),Mq.subVectors(this.end,this.start);var c=Mq.dot(Mq),d=Mq.dot(Lq),e=d/c;return b&&(e=Fk.clamp(e,0,1)),e},closestPointToPoint:function(a,b,c){var d=this.closestPointToPointParameter(a,b);return void 0===c&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),c=new j),this.delta(c).multiplyScalar(d).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}}),Uf.prototype=Object.create(n.prototype),Uf.prototype.constructor=Uf,Uf.prototype.isImmediateRenderObject=!0;var Nq=new j;Vf.prototype=Object.create(n.prototype),Vf.prototype.constructor=Vf,Vf.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Vf.prototype.update=function(){this.light.updateMatrixWorld();var a=this.light.distance?this.light.distance:1e3,b=a*Math.tan(this.light.angle);this.cone.scale.set(b,b,a),Nq.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Nq),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Oq=new j,Pq=new k,Qq=new k;Xf.prototype=Object.create(rc.prototype),Xf.prototype.constructor=Xf,Xf.prototype.isSkeletonHelper=!0,Xf.prototype.updateMatrixWorld=function(a){var b=this.bones,c=this.geometry,d=c.getAttribute("position");Qq.getInverse(this.root.matrixWorld);for(var e=0,f=0;e<b.length;e++){var g=b[e];g.parent&&g.parent.isBone&&(Pq.multiplyMatrices(Qq,g.matrixWorld),Oq.setFromMatrixPosition(Pq),d.setXYZ(f,Oq.x,Oq.y,Oq.z),Pq.multiplyMatrices(Qq,g.parent.matrixWorld),Oq.setFromMatrixPosition(Pq),d.setXYZ(f+1,Oq.x,Oq.y,Oq.z),f+=2)}c.getAttribute("position").needsUpdate=!0,n.prototype.updateMatrixWorld.call(this,a)},Yf.prototype=Object.create(P.prototype),Yf.prototype.constructor=Yf,Yf.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Yf.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Rq=new j,Sq=new v,Tq=new v;Zf.prototype=Object.create(n.prototype),Zf.prototype.constructor=Zf,Zf.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Zf.prototype.update=function(){var a=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var b=a.geometry.getAttribute("color");Sq.copy(this.light.color),Tq.copy(this.light.groundColor);for(var c=0,d=b.count;c<d;c++){var e=c<d/2?Sq:Tq;b.setXYZ(c,e.r,e.g,e.b)}b.needsUpdate=!0}a.lookAt(Rq.setFromMatrixPosition(this.light.matrixWorld).negate())},$f.prototype=Object.assign(Object.create(rc.prototype),{constructor:$f,copy:function(a){return rc.prototype.copy.call(this,a),this.geometry.copy(a.geometry),this.material.copy(a.material),this},clone:function(){return(new this.constructor).copy(this)}}),_f.prototype=Object.create(rc.prototype),_f.prototype.constructor=_f;var Uq=new j,Vq=new j,Wq=new j;ag.prototype=Object.create(n.prototype),ag.prototype.constructor=ag,ag.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},ag.prototype.update=function(){Uq.setFromMatrixPosition(this.light.matrixWorld),Vq.setFromMatrixPosition(this.light.target.matrixWorld),Wq.subVectors(Vq,Uq),this.lightPlane.lookAt(Vq),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Vq),this.targetLine.scale.z=Wq.length()};var Xq=new j,Yq=new W;bg.prototype=Object.create(rc.prototype),bg.prototype.constructor=bg,bg.prototype.update=function(){var a=this.geometry,b=this.pointMap,c=1,d=1;Yq.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cg("c",b,a,Yq,0,0,-1),cg("t",b,a,Yq,0,0,1),cg("n1",b,a,Yq,-c,-d,-1),cg("n2",b,a,Yq,c,-d,-1),cg("n3",b,a,Yq,-c,d,-1),cg("n4",b,a,Yq,c,d,-1),cg("f1",b,a,Yq,-c,-d,1),cg("f2",b,a,Yq,c,-d,1),cg("f3",b,a,Yq,-c,d,1),cg("f4",b,a,Yq,c,d,1),cg("u1",b,a,Yq,.7*c,1.1*d,-1),cg("u2",b,a,Yq,.7*-c,1.1*d,-1),cg("u3",b,a,Yq,0,2*d,-1),cg("cf1",b,a,Yq,-c,0,1),cg("cf2",b,a,Yq,c,0,1),cg("cf3",b,a,Yq,0,-d,1),cg("cf4",b,a,Yq,0,d,1),cg("cn1",b,a,Yq,-c,0,-1),cg("cn2",b,a,Yq,c,0,-1),cg("cn3",b,a,Yq,0,-d,-1),cg("cn4",b,a,Yq,0,d,-1),a.getAttribute("position").needsUpdate=!0};var Zq=new p;dg.prototype=Object.create(rc.prototype),dg.prototype.constructor=dg,dg.prototype.update=function(a){if(void 0!==a&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Zq.setFromObject(this.object),!Zq.isEmpty()){var b=Zq.min,c=Zq.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x,e[1]=c.y,e[2]=c.z,e[3]=b.x,e[4]=c.y,e[5]=c.z,e[6]=b.x,e[7]=b.y,e[8]=c.z,e[9]=c.x,e[10]=b.y,e[11]=c.z,e[12]=c.x,e[13]=c.y,e[14]=b.z,e[15]=b.x,e[16]=c.y,e[17]=b.z,e[18]=b.x,e[19]=b.y,e[20]=b.z,e[21]=c.x,e[22]=b.y,e[23]=b.z,d.needsUpdate=!0,this.geometry.computeBoundingSphere()}},dg.prototype.setFromObject=function(a){return this.object=a,this.update(),this},dg.prototype.copy=function(a){return rc.prototype.copy.call(this,a),this.object=a.object,this},dg.prototype.clone=function(){return(new this.constructor).copy(this)},eg.prototype=Object.create(rc.prototype),eg.prototype.constructor=eg,eg.prototype.updateMatrixWorld=function(a){var b=this.box;b.isEmpty()||(b.getCenter(this.position),b.getSize(this.scale),this.scale.multiplyScalar(.5),n.prototype.updateMatrixWorld.call(this,a))},fg.prototype=Object.create(qc.prototype),fg.prototype.constructor=fg,fg.prototype.updateMatrixWorld=function(a){var b=-this.plane.constant;Math.abs(b)<1e-8&&(b=1e-8),this.scale.set(.5*this.size,.5*this.size,b),this.children[0].material.side=b<0?lh:kh,this.lookAt(this.plane.normal),n.prototype.updateMatrixWorld.call(this,a)};var $q,_q,ar=new j;gg.prototype=Object.create(n.prototype),gg.prototype.constructor=gg,gg.prototype.setDirection=function(a){if(a.y>.99999)this.quaternion.set(0,0,0,1);else if(a.y<-.99999)this.quaternion.set(1,0,0,0);else{ar.set(a.z,0,-a.x).normalize();var b=Math.acos(a.y);this.quaternion.setFromAxisAngle(ar,b)}},gg.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a),void 0===c&&(c=.2*b),this.line.scale.set(1,Math.max(1e-4,a-b),1),this.line.updateMatrix(),this.cone.scale.set(c,b,c),this.cone.position.y=a,this.cone.updateMatrix()},gg.prototype.setColor=function(a){this.line.material.color.set(a),this.cone.material.color.set(a)},gg.prototype.copy=function(a){return n.prototype.copy.call(this,a,!1),this.line.copy(a.line),this.cone.copy(a.cone),this},gg.prototype.clone=function(){return(new this.constructor).copy(this)},hg.prototype=Object.create(rc.prototype),hg.prototype.constructor=hg;var br=4,cr=8,dr=Math.pow(2,cr),er=[.125,.215,.35,.446,.526,.582],fr=cr-br+1+er.length,gr=20,hr={};hr[Uj]=0,hr[Vj]=1,hr[Xj]=2,hr[Zj]=3,hr[$j]=4,hr[_j]=5,hr[Wj]=6;var ir=new df,jr=kg(),kr=jr._lodPlanes,lr=jr._sizeLods,mr=jr._sigmas,nr=null,or=(1+Math.sqrt(5))/2,pr=1/or,qr=[new j(1,1,1),new j(-1,1,1),new j(1,1,-1),new j(-1,1,-1),new j(0,or,pr),new j(0,or,-pr),new j(pr,0,or),new j(-pr,0,or),new j(or,pr,0),new j(-or,pr,0)];ig.prototype={constructor:ig,fromScene:function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=.1),void 0===d&&(d=100),nr=this._renderer.getRenderTarget();var e=this._allocateTargets();return this._sceneToCubeUV(a,c,d,e),b>0&&this._blur(e,0,0,b),this._applyPMREM(e),this._cleanup(e),e},fromEquirectangular:function(a){return this._fromTexture(a)},fromCubemap:function(a){return this._fromTexture(a)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=pg(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=og(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var a=0;a<kr.length;a++)kr[a].dispose()},_cleanup:function(a){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(nr),a.scissorTest=!1,mg(a,0,0,a.width,a.height)},_fromTexture:function(a){nr=this._renderer.getRenderTarget();var b=this._allocateTargets(a);return this._textureToCubeUV(a,b),this._applyPMREM(b),this._cleanup(b),b},_allocateTargets:function(a){var b={magFilter:ki,minFilter:ki,generateMipmaps:!1,type:ui,format:Li,encoding:jg(a)?a.encoding:Xj,depthBuffer:!1,stencilBuffer:!1},c=lg(b);return c.depthBuffer=!a,this._pingPongRenderTarget=lg(b),c},_compileMaterial:function(a){var b=new P(kr[0],a);this._renderer.compile(b,ir)},_sceneToCubeUV:function(a,b,c,d){var e=90,f=1,g=new X(e,f,b,c),h=[1,-1,1,1,1,1],i=[1,1,1,-1,-1,-1],j=this._renderer,k=j.outputEncoding,l=j.toneMapping,m=j.getClearColor(),n=j.getClearAlpha();j.toneMapping=Wh,j.outputEncoding=Uj;var o=a.background;if(o&&o.isColor){o.convertSRGBToLinear();var p=Math.max(o.r,o.g,o.b),q=Math.min(Math.max(Math.ceil(Math.log2(p)),-128),127);o=o.multiplyScalar(Math.pow(2,-q));var r=(q+128)/255;j.setClearColor(o,r),a.background=null}for(var s=0;s<6;s++){var t=s%3;0==t?(g.up.set(0,h[s],0),g.lookAt(i[s],0,0)):1==t?(g.up.set(0,0,h[s]),g.lookAt(0,i[s],0)):(g.up.set(0,h[s],0),g.lookAt(0,0,i[s])),mg(d,t*dr,s>2?dr:0,dr,dr),j.setRenderTarget(d),j.render(a,g)}j.toneMapping=l,j.outputEncoding=k,j.setClearColor(m,n)},_textureToCubeUV:function(a,b){var c=this._renderer;a.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=pg()):null==this._equirectShader&&(this._equirectShader=og());var d=a.isCubeTexture?this._cubemapShader:this._equirectShader,e=new P(kr[0],d),f=d.uniforms;f.envMap.value=a,a.isCubeTexture||f.texelSize.value.set(1/a.image.width,1/a.image.height),f.inputEncoding.value=hr[a.encoding],f.outputEncoding.value=hr[b.texture.encoding],mg(b,0,0,3*dr,2*dr),c.setRenderTarget(b),c.render(e,ir)},_applyPMREM:function(a){var b=this._renderer,c=b.autoClear;b.autoClear=!1;for(var d=1;d<fr;d++){var e=Math.sqrt(mr[d]*mr[d]-mr[d-1]*mr[d-1]),f=qr[(d-1)%qr.length];this._blur(a,d-1,d,e,f)}b.autoClear=c},_blur:function(a,b,c,d,e){var f=this._pingPongRenderTarget;this._halfBlur(a,f,b,c,d,"latitudinal",e),this._halfBlur(f,a,c,c,d,"longitudinal",e)},_halfBlur:function(a,b,c,d,e,f,g){var h=this._renderer,i=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&console.error("blur direction must be either latitudinal or longitudinal!");var j=3,k=new P(kr[d],i),l=i.uniforms,m=lr[c]-1,n=isFinite(e)?Math.PI/(2*m):2*Math.PI/(2*gr-1),o=e/n,p=isFinite(e)?1+Math.floor(j*o):gr;p>gr&&console.warn("sigmaRadians, "+e+", is too large and will clip, as it requested "+p+" samples when the maximum is set to "+gr);for(var q=[],r=0,s=0;s<gr;++s){var t=s/o,u=Math.exp(-t*t/2);q.push(u),0==s?r+=u:s<p&&(r+=2*u)}for(var v=0;v<q.length;v++)q[v]=q[v]/r;l.envMap.value=a.texture,l.samples.value=p,l.weights.value=q,l.latitudinal.value="latitudinal"===f,g&&(l.poleAxis.value=g),l.dTheta.value=n,l.mipInt.value=cr-c,l.inputEncoding.value=hr[a.texture.encoding],l.outputEncoding.value=hr[a.texture.encoding];var w=lr[d];mg(b,3*Math.max(0,dr-2*w),(0===d?0:2*dr)+2*w*(d>cr-br?d-cr+br:0),3*w,2*w),h.setRenderTarget(b),h.render(k,ir)}};var rr=0,sr=1,tr=0,ur=1,vr=2;ze.create=function(a,b){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(ze.prototype),a.prototype.constructor=a,a.prototype.getPoint=b,a},Object.assign(Ve.prototype,{createPointsGeometry:function(a){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var b=this.getPoints(a);return this.createGeometry(b)},createSpacedPointsGeometry:function(a){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var b=this.getSpacedPoints(a);return this.createGeometry(b)},createGeometry:function(a){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var b=new S,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new j(e.x,e.y,e.z||0))}return b}}),Object.assign(We.prototype,{fromPoints:function(a){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(a)}}),Mg.prototype=Object.create(De.prototype),Ng.prototype=Object.create(De.prototype),Og.prototype=Object.create(De.prototype),Object.assign(Og.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),$f.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Xf.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(re.prototype,{extractUrlBase:function(a){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),jq.extractUrlBase(a)}}),re.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(pf.prototype,{setTexturePath:function(a){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(a)}}),Object.assign(Sf.prototype,{center:function(a){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(a)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(a){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},size:function(a){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(a)}}),Object.assign(p.prototype,{center:function(a){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(a)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(a){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},isIntersectionSphere:function(a){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)},size:function(a){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(a)}}),Object.assign(r.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),_.prototype.setFromMatrix=function(a){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(a)},Tf.prototype.center=function(a){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(a)},Object.assign(Fk,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(a){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Fk.floorPowerOfTwo(a)},nextPowerOfTwo:function(a){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Fk.ceilPowerOfTwo(a)}}),Object.assign(d.prototype,{flattenToArrayOffset:function(a,b){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,b)},multiplyVector3:function(a){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(a){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(k.prototype,{extractPosition:function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)},flattenToArrayOffset:function(a,b){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,b)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new j).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector4:function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)},crossVector:function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(a){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,b,c,d,e,f){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(a,b,d,c,e,f)}}),t.prototype.isIntersectionLine=function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)},i.prototype.multiplyVector3=function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},Object.assign(s.prototype,{isIntersectionBox:function(a){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)},isIntersectionPlane:function(a){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(a)},isIntersectionSphere:function(a){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)}}),Object.assign(u.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(a,b){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(a,b)},midpoint:function(a){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(a)},normal:function(a){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(a)},plane:function(a){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(a)}}),Object.assign(u,{barycoordFromPoint:function(a,b,c,d,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),u.getBarycoord(a,b,c,d,e)},normal:function(a,b,c,d){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),u.getNormal(a,b,c,d)}}),Object.assign(Xe.prototype,{extractAllPoints:function(a){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(a)},extrude:function(a){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new yd(this,a)},makeGeometry:function(a){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jd(this,a)}}),Object.assign(c.prototype,{fromAttribute:function(a,b,c){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(j.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(b,a)},applyProjection:function(a){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(a)},fromAttribute:function(a,b,c){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(f.prototype,{fromAttribute:function(a,b,c){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,b,c)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(S.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(a){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)}}),Object.assign(n.prototype,{getChildByName:function(a){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(b,a)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(a){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)}}),Object.defineProperties(n.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(P.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(P.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Rj},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(kc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(mc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),lc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(ze.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(a){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=a}}),X.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==b&&(this.filmGauge=b),this.setFocalLength(a)},Object.defineProperties(Ye.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=a}}}),Object.defineProperties(C.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===vk},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(vk)}}}),Object.assign(C.prototype,{setDynamic:function(a){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===a?vk:uk),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(O.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(a)},addAttribute:function(a,b){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),b&&b.isBufferAttribute||b&&b.isInterleavedBufferAttribute?"index"===a?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b),this):this.setAttribute(a,b):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(a,new C(arguments[1],arguments[2])))},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(a){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(a)},applyMatrix:function(a){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)}}),Object.defineProperties(O.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(mf.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(a){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=a}}}),Object.defineProperties(Nf.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(a){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=a}}}),Object.defineProperties(ec.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===vk},set:function(a){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(a)}}}),Object.assign(ec.prototype,{setDynamic:function(a){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===a?vk:uk),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(zd.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Lf.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(A.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new v}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=a===nh}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(a){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=a}}}),Object.defineProperties(Xd.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(V.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=a}}}),Object.assign(ac.prototype,{clearTarget:function(a,b,c,d){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(a),this.clear(b,c,d)},animate:function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(a)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ac.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=a}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return!1},set:function(a){this.outputEncoding=!0===a?Vj:Uj}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Tb.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(g.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=a}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=a}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=a}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=a}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=a}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=a}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=a}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=a}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=a}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=a}}}),Object.defineProperties(Cf.prototype,{load:{value:function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var b=this;return(new wf).load(a,function(a){b.setBuffer(a)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Ef.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Y.prototype.updateCubeMap=function(a,b){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,b)};var wr={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b.isMesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry),a.merge(b,d,c)},center:function(a){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),a.center()}};Hk.crossOrigin=void 0,Hk.loadTexture=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new ye;e.setCrossOrigin(this.crossOrigin);var f=e.load(a,c,void 0,d);return b&&(f.mapping=b),f},Hk.loadTextureCube=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new xe;e.setCrossOrigin(this.crossOrigin);var f=e.load(a,c,void 0,d);return b&&(f.mapping=b),f},Hk.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Hk.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var xr={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Zg}})),a.ACESFilmicToneMapping=$h,a.AddEquation=vh,a.AddOperation=Vh,a.AdditiveAnimationBlendMode=Qj,a.AdditiveBlending=rh,a.AlphaFormat=Gi,a.AlwaysDepth=Mh,a.AlwaysStencilFunc=tk,a.AmbientLight=gf,a.AmbientLightProbe=yf,a.AnimationClip=ne,a.AnimationLoader=te,a.AnimationMixer=Kf,a.AnimationObjectGroup=If,a.AnimationUtils=aq,a.ArcCurve=Be,a.ArrayCamera=Xb,a.ArrowHelper=gg,a.Audio=Cf,a.AudioAnalyser=Ef,a.AudioContext=pq,a.AudioListener=Bf,a.AudioLoader=wf,a.AxesHelper=hg,a.AxisHelper=Pg,a.BackSide=lh,a.BasicDepthPacking=ak,a.BasicShadowMap=gh,a.BinaryTextureLoader=Ug,a.Bone=nc,a.BooleanKeyframeTrack=ge,a.BoundingBoxHelper=Qg,a.Box2=Sf,a.Box3=p,a.Box3Helper=eg,a.BoxBufferGeometry=um,a.BoxGeometry=tm,a.BoxHelper=dg,a.BufferAttribute=C,a.BufferGeometry=O,a.BufferGeometryLoader=of,a.ByteType=vi,a.Cache=bq,a.Camera=W,a.CameraHelper=bg,a.CanvasRenderer=Wg,a.CanvasTexture=yc,a.CatmullRomCurve3=De,a.CineonToneMapping=Zh,a.CircleBufferGeometry=Sd,a.CircleGeometry=Rd,a.ClampToEdgeWrapping=ii,a.Clock=Af,a.ClosedSplineCurve3=Mg,a.Color=v,a.ColorKeyframeTrack=he,a.CompressedTexture=xc,a.CompressedTextureLoader=ue,a.ConeBufferGeometry=Qd,a.ConeGeometry=Pd,a.CubeCamera=Y,a.CubeGeometry=tm,a.CubeReflectionMapping=bi,a.CubeRefractionMapping=ci,a.CubeTexture=ra,a.CubeTextureLoader=xe,a.CubeUVReflectionMapping=fi,a.CubeUVRefractionMapping=gi,a.CubicBezierCurve=Oe,a.CubicBezierCurve3=Pe,a.CubicInterpolant=ce,a.CullFaceBack=bh,a.CullFaceFront=ch,a.CullFaceFrontBack=dh,a.CullFaceNone=ah,a.Curve=ze,a.CurvePath=Ve,a.CustomBlending=uh,a.CustomToneMapping=_h,a.CylinderBufferGeometry=Od,a.CylinderGeometry=Nd,a.Cylindrical=Rf,a.DataTexture=$,a.DataTexture2DArray=sa,a.DataTexture3D=ta,a.DataTextureLoader=ve,a.DecrementStencilOp=ik,a.DecrementWrapStencilOp=kk,a.DefaultLoadingManager=cq,a.DepthFormat=Mi,a.DepthStencilFormat=Ni,a.DepthTexture=zc,a.DirectionalLight=ff,a.DirectionalLightHelper=ag,a.DirectionalLightShadow=ef,a.DiscreteInterpolant=ee,a.DodecahedronBufferGeometry=Mc,a.DodecahedronGeometry=Lc,a.DoubleSide=mh,a.DstAlphaFactor=Gh,a.DstColorFactor=Ih,a.DynamicBufferAttribute=Cg,a.DynamicCopyUsage=Bk,a.DynamicDrawUsage=vk,a.DynamicReadUsage=yk,a.EdgesGeometry=Md,a.EdgesHelper=Rg,a.EllipseCurve=Ae,a.EqualDepth=Ph,a.EqualStencilFunc=ok,a.EquirectangularReflectionMapping=di,a.EquirectangularRefractionMapping=ei,a.Euler=l,a.EventDispatcher=b,a.ExtrudeBufferGeometry=zd,a.ExtrudeGeometry=yd,a.Face3=z,a.Face4=sg,a.FaceColors=ur,a.FileLoader=se,a.FlatShading=nh,a.Float32Attribute=Kg,a.Float32BufferAttribute=K,a.Float64Attribute=Lg,a.Float64BufferAttribute=L,a.FloatType=Ai,a.Fog=dc,a.FogExp2=cc,a.Font=sf,a.FontLoader=vf,a.FrontFaceDirectionCCW=fh,a.FrontFaceDirectionCW=eh,a.FrontSide=kh,a.Frustum=_,a.GammaEncoding=Wj,a.Geometry=S,a.GeometryUtils=wr,a.GreaterDepth=Rh,a.GreaterEqualDepth=Qh,a.GreaterEqualStencilFunc=sk,a.GreaterStencilFunc=qk,a.GridHelper=$f,a.Group=Yb,a.HalfFloatType=Bi,a.HemisphereLight=Ze,a.HemisphereLightHelper=Zf,a.HemisphereLightProbe=xf,a.IcosahedronBufferGeometry=Kc,a.IcosahedronGeometry=Jc,a.ImageBitmapLoader=qf,a.ImageLoader=we,a.ImageUtils=Hk,a.ImmediateRenderObject=Uf,a.IncrementStencilOp=hk,a.IncrementWrapStencilOp=jk,a.InstancedBufferAttribute=nf,a.InstancedBufferGeometry=mf,a.InstancedInterleavedBuffer=Mf,a.InstancedMesh=oc,a.Int16Attribute=Gg,a.Int16BufferAttribute=G,a.Int32Attribute=Ig,a.Int32BufferAttribute=I,a.Int8Attribute=Dg,a.Int8BufferAttribute=D,a.IntType=yi,a.InterleavedBuffer=ec,a.InterleavedBufferAttribute=fc,a.Interpolant=be,a.InterpolateDiscrete=Jj,a.InterpolateLinear=Kj,a.InterpolateSmooth=Lj,a.InvertStencilOp=lk,a.JSONLoader=Xg,a.KeepStencilOp=fk,a.KeyframeTrack=fe,a.LOD=kc,a.LatheBufferGeometry=Id,a.LatheGeometry=Hd,a.Layers=m,a.LensFlare=Yg,a.LessDepth=Nh,a.LessEqualDepth=Oh,a.LessEqualStencilFunc=pk,a.LessStencilFunc=nk,a.Light=Ye,a.LightProbe=kf,a.LightShadow=$e,a.Line=qc,a.Line3=Tf,a.LineBasicMaterial=pc,a.LineCurve=Qe,a.LineCurve3=Re,a.LineDashedMaterial=ae,a.LineLoop=sc,a.LinePieces=sr,a.LineSegments=rc,a.LineStrip=rr,a.LinearEncoding=Uj;a.LinearFilter=pi,a.LinearInterpolant=de,a.LinearMipMapLinearFilter=ti,a.LinearMipMapNearestFilter=ri,a.LinearMipmapLinearFilter=si,a.LinearMipmapNearestFilter=qi,a.LinearToneMapping=Xh,a.Loader=re,a.LoaderUtils=jq,a.LoadingManager=qe,a.LogLuvEncoding=Yj,a.LoopOnce=Gj,a.LoopPingPong=Ij,a.LoopRepeat=Hj,a.LuminanceAlphaFormat=Ki,a.LuminanceFormat=Ji,a.MOUSE=$g,a.Material=A,a.MaterialLoader=lf,a.Math=Fk,a.MathUtils=Fk,a.Matrix3=d,a.Matrix4=k,a.MaxEquation=zh,a.Mesh=P,a.MeshBasicMaterial=B,a.MeshDepthMaterial=Rb,a.MeshDistanceMaterial=Sb,a.MeshFaceMaterial=tg,a.MeshLambertMaterial=$d,a.MeshMatcapMaterial=_d,a.MeshNormalMaterial=Zd,a.MeshPhongMaterial=Xd,a.MeshPhysicalMaterial=Wd,a.MeshStandardMaterial=Vd,a.MeshToonMaterial=Yd,a.MinEquation=yh,a.MirroredRepeatWrapping=ji,a.MixOperation=Uh,a.MultiMaterial=ug,a.MultiplyBlending=th,a.MultiplyOperation=Th,a.NearestFilter=ki,a.NearestMipMapLinearFilter=oi,a.NearestMipMapNearestFilter=mi,a.NearestMipmapLinearFilter=ni,a.NearestMipmapNearestFilter=li,a.NeverDepth=Lh,a.NeverStencilFunc=mk,a.NoBlending=ph,a.NoColors=tr,a.NoToneMapping=Wh,a.NormalAnimationBlendMode=Pj,a.NormalBlending=qh,a.NotEqualDepth=Sh,a.NotEqualStencilFunc=rk,a.NumberKeyframeTrack=ie,a.Object3D=n,a.ObjectLoader=pf,a.ObjectSpaceNormalMap=dk,a.OctahedronBufferGeometry=Ic,a.OctahedronGeometry=Hc,a.OneFactor=Bh,a.OneMinusDstAlphaFactor=Hh,a.OneMinusDstColorFactor=Jh,a.OneMinusSrcAlphaFactor=Fh,a.OneMinusSrcColorFactor=Dh,a.OrthographicCamera=df,a.PCFShadowMap=hh,a.PCFSoftShadowMap=ih,a.PMREMGenerator=ig,a.ParametricBufferGeometry=Cc,a.ParametricGeometry=Bc,a.Particle=wg,a.ParticleBasicMaterial=zg,a.ParticleSystem=xg,a.ParticleSystemMaterial=Ag,a.Path=We,a.PerspectiveCamera=X,a.Plane=t,a.PlaneBufferGeometry=da,a.PlaneGeometry=ca,a.PlaneHelper=fg,a.PointCloud=vg,a.PointCloudMaterial=yg,a.PointLight=cf,a.PointLightHelper=Yf,a.Points=uc,a.PointsMaterial=tc,a.PolarGridHelper=_f,a.PolyhedronBufferGeometry=Ec,a.PolyhedronGeometry=Dc,a.PositionalAudio=Df,a.PropertyBinding=Hf,a.PropertyMixer=Ff,a.QuadraticBezierCurve=Se,a.QuadraticBezierCurve3=Te,a.Quaternion=i,a.QuaternionKeyframeTrack=ke,a.QuaternionLinearInterpolant=je,a.REVISION=Zg,a.RGBADepthPacking=bk,a.RGBAFormat=Ii,a.RGBAIntegerFormat=Ti,a.RGBA_ASTC_10x10_Format=oj,a.RGBA_ASTC_10x5_Format=lj,a.RGBA_ASTC_10x6_Format=mj,a.RGBA_ASTC_10x8_Format=nj,a.RGBA_ASTC_12x10_Format=pj,a.RGBA_ASTC_12x12_Format=qj,a.RGBA_ASTC_4x4_Format=dj,a.RGBA_ASTC_5x4_Format=ej,a.RGBA_ASTC_5x5_Format=fj,a.RGBA_ASTC_6x5_Format=gj,a.RGBA_ASTC_6x6_Format=hj,a.RGBA_ASTC_8x5_Format=ij,a.RGBA_ASTC_8x6_Format=jj,a.RGBA_ASTC_8x8_Format=kj,a.RGBA_BPTC_Format=rj,a.RGBA_ETC2_EAC_Format=cj,a.RGBA_PVRTC_2BPPV1_Format=_i,a.RGBA_PVRTC_4BPPV1_Format=$i,a.RGBA_S3TC_DXT1_Format=Vi,a.RGBA_S3TC_DXT3_Format=Wi,a.RGBA_S3TC_DXT5_Format=Xi,a.RGBDEncoding=_j,a.RGBEEncoding=Xj,a.RGBEFormat=Li,a.RGBFormat=Hi,a.RGBIntegerFormat=Si,a.RGBM16Encoding=$j,a.RGBM7Encoding=Zj,a.RGB_ETC1_Format=aj,a.RGB_ETC2_Format=bj,a.RGB_PVRTC_2BPPV1_Format=Zi,a.RGB_PVRTC_4BPPV1_Format=Yi,a.RGB_S3TC_DXT1_Format=Ui,a.RGFormat=Qi,a.RGIntegerFormat=Ri,a.RawShaderMaterial=Ud,a.Ray=s,a.Raycaster=Nf,a.RectAreaLight=hf,a.RedFormat=Oi,a.RedIntegerFormat=Pi,a.ReinhardToneMapping=Yh,a.RepeatWrapping=hi,a.ReplaceStencilOp=gk,a.ReverseSubtractEquation=xh,a.RingBufferGeometry=Gd,a.RingGeometry=Fd,a.SRGB8_ALPHA8_ASTC_10x10_Format=Dj,a.SRGB8_ALPHA8_ASTC_10x5_Format=Aj,a.SRGB8_ALPHA8_ASTC_10x6_Format=Bj,a.SRGB8_ALPHA8_ASTC_10x8_Format=Cj,a.SRGB8_ALPHA8_ASTC_12x10_Format=Ej,a.SRGB8_ALPHA8_ASTC_12x12_Format=Fj,a.SRGB8_ALPHA8_ASTC_4x4_Format=sj,a.SRGB8_ALPHA8_ASTC_5x4_Format=tj,a.SRGB8_ALPHA8_ASTC_5x5_Format=uj,a.SRGB8_ALPHA8_ASTC_6x5_Format=vj,a.SRGB8_ALPHA8_ASTC_6x6_Format=wj,a.SRGB8_ALPHA8_ASTC_8x5_Format=xj,a.SRGB8_ALPHA8_ASTC_8x6_Format=yj,a.SRGB8_ALPHA8_ASTC_8x8_Format=zj,a.Scene=o,a.SceneUtils=xr,a.ShaderChunk=Yo,a.ShaderLib=Zo,a.ShaderMaterial=V,a.ShadowMaterial=Td,a.Shape=Xe,a.ShapeBufferGeometry=Kd,a.ShapeGeometry=Jd,a.ShapePath=rf,a.ShapeUtils=Yp,a.ShortType=wi,a.Skeleton=mc,a.SkeletonHelper=Xf,a.SkinnedMesh=lc,a.SmoothShading=oh,a.Sphere=r,a.SphereBufferGeometry=Ed,a.SphereGeometry=Dd,a.Spherical=Qf,a.SphericalHarmonics3=jf,a.Spline=Og,a.SplineCurve=Ue,a.SplineCurve3=Ng,a.SpotLight=af,a.SpotLightHelper=Vf,a.SpotLightShadow=_e,a.Sprite=hc,a.SpriteMaterial=gc,a.SrcAlphaFactor=Eh,a.SrcAlphaSaturateFactor=Kh,a.SrcColorFactor=Ch,a.StaticCopyUsage=Ak,a.StaticDrawUsage=uk,a.StaticReadUsage=xk;a.StereoCamera=zf,a.StreamCopyUsage=Ck,a.StreamDrawUsage=wk,a.StreamReadUsage=zk,a.StringKeyframeTrack=le,a.SubtractEquation=wh,a.SubtractiveBlending=sh,a.TOUCH=_g,a.TangentSpaceNormalMap=ck,a.TetrahedronBufferGeometry=Gc,a.TetrahedronGeometry=Fc,a.TextBufferGeometry=Cd,a.TextGeometry=Bd,a.Texture=e,a.TextureLoader=ye,a.TorusBufferGeometry=Sc,a.TorusGeometry=Rc,a.TorusKnotBufferGeometry=Qc,a.TorusKnotGeometry=Pc,a.Triangle=u,a.TriangleFanDrawMode=Tj,a.TriangleStripDrawMode=Sj,a.TrianglesDrawMode=Rj,a.TubeBufferGeometry=Oc,a.TubeGeometry=Nc,a.UVMapping=ai,a.Uint16Attribute=Hg,a.Uint16BufferAttribute=H,a.Uint32Attribute=Jg,a.Uint32BufferAttribute=J,a.Uint8Attribute=Eg,a.Uint8BufferAttribute=E,a.Uint8ClampedAttribute=Fg,a.Uint8ClampedBufferAttribute=F,a.Uniform=Lf,a.UniformsLib=Cm,a.UniformsUtils=vm,a.UnsignedByteType=ui,a.UnsignedInt248Type=Fi,a.UnsignedIntType=zi,a.UnsignedShort4444Type=Ci,a.UnsignedShort5551Type=Di,a.UnsignedShort565Type=Ei,a.UnsignedShortType=xi,a.VSMShadowMap=jh,a.Vector2=c,a.Vector3=j,a.Vector4=f,a.VectorKeyframeTrack=me,a.Vertex=Bg,a.VertexColors=vr,a.VideoTexture=wc,a.WebGL1Renderer=bc,a.WebGLCubeRenderTarget=Z,a.WebGLMultisampleRenderTarget=h,a.WebGLRenderTarget=g,a.WebGLRenderTargetCube=Vg,a.WebGLRenderer=ac,a.WebGLUtils=Wb,a.WireframeGeometry=Ac,a.WireframeHelper=Sg,a.WrapAroundEnding=Oj,a.XHRLoader=Tg,a.ZeroCurvatureEnding=Mj,a.ZeroFactor=Ah,a.ZeroSlopeEnding=Nj,a.ZeroStencilOp=ek,a.sRGBEncoding=Vj,Object.defineProperty(a,"__esModule",{value:!0})}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("three")):"function"==typeof define&&define.amd?define(["three"],b):(a=a||self,a.THREE=a.THREE||{},a.THREE.TextTexture=b(a.THREE))}(this,function(a){"use strict";function b(a){return a.reduce(function(a,b){return Math.max(a,b)})}function c(a,b,c,d,e){return[c,d,e,b+"px",a].join(" ")}function d(){if(this.needsRedraw){var a=this,b=a.image;if(b){var d=this,e=d.fontSize,f=d.height,g=d.width,h=b.getContext("2d");if(h.clearRect(0,0,b.width,b.height),g*=e,f*=e,g&&f){b.width=g,b.height=f;var i=this,j=i.align,k=i.fillStyle,l=i.fontFamily,m=i.fontStyle,n=i.fontVariant,o=i.fontWeight,p=i.lineGap,q=i.lines,r=i.padding,s=i.strokeStyle,t=i.strokeWidth,u=i.src,v=i.bgColor,w=(i.areaType,0);if(u&&MapConfigX.embedTextIcon){w=(f-r)/q.length,b.width+=w;var x=new Image;x.onload=function(){h.drawImage(x,0,0,x.width,x.height,0,(f-w)/2,w,w),d.needsUpdate=!0},MapConfigX.imageCache.has(u)?x.src=MapConfigX.imageCache.get(u):(x.src=u+"?"+Math.random(),MapConfigX.imageCache.set(u,x.src))}r+=t/2,t*=e,p*=e,r*=e,h.font=c(l,e,m,n,o);var y;switch(j){case"left":h.textAlign="left",y=r;break;case"right":h.textAlign="right",y=g-r;break;case"center":h.textAlign="center",y=g/2}h.textBaseline="alphabetic";var z=r/2+e;y+=w,v?(h.fillStyle=v,h.roundRect(0,0,g+w,f,8),h.globalAlpha=.7,h.fill()):(h.fillStyle="rgba(255,255,255,+0.005)",h.fillRect(0,0,g+w,f)),h.globalAlpha=1,h.fillStyle=k,h.miterLimit=1,h.lineWidth=t,h.strokeStyle=s,q.forEach(function(a){t&&h.strokeText(a,y,z),h.fillText(a,y,z),z+=e+p})}else b.width=b.height=1;this.needsRedraw=!1,this.needsUpdate=!0}}}var e=function(d){function e(b){void 0===b&&(b={});var c=b.align;void 0===c&&(c="center");var e=b.fillStyle;void 0===e&&(e="#fff");var f=b.fontFamily;void 0===f&&(f="sans-serif");var g=b.fontSize;void 0===g&&(g=16);var h=b.fontStyle;void 0===h&&(h="normal");var i=b.fontVariant;void 0===i&&(i="normal");var j=b.fontWeight;void 0===j&&(j="normal");var k=b.lineGap;void 0===k&&(k=.15);var l=b.padding;void 0===l&&(l=.25);var m=b.strokeStyle;void 0===m&&(m="#000");var n=b.strokeWidth;void 0===n&&(n=0);var o=b.text;void 0===o&&(o="");var p=b.src;void 0===p&&(o=null);var q=b.bgColor,r=b.areaType;d.call(this,document.createElement("canvas"),void 0,void 0,void 0,a.LinearFilter,a.LinearFilter),Object.assign(this,{_align:c,_fillStyle:e,_fontFamily:f,_fontSize:g,_fontStyle:h,_fontVariant:i,_fontWeight:j,_lineGap:k,_padding:l,_strokeStyle:m,_strokeWidth:n,_text:o,_src:p,_areaType:r,_bgColor:q,needsRedraw:!0})}d&&(e.__proto__=d),e.prototype=Object.create(d&&d.prototype),e.prototype.constructor=e;var f={lines:{configurable:!0},textWidth:{configurable:!0},textHeight:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return f.lines.get=function(){var a=this,b=a.text;return b?b.split("\n"):[]},f.textWidth.get=function(){var a=this,d=a.fontFamily,e=a.fontStyle,f=a.fontVariant,g=a.fontWeight,h=a.lines;if(h.length){var i=document.createElement("canvas"),j=i.getContext("2d");return j.font=c(d,1,e,f,g),b(h.map(function(a){return j.measureText(a).width}))}return 0},f.textHeight.get=function(){var a=this,b=a.lineGap,c=a.lines;return c.length?c.length+b*(c.length-1):0},f.width.get=function(){var a=this,b=a.padding,c=a.strokeWidth,d=a.textWidth;return a.text?((a.textWidth/a.text.length?a.textWidth/a.text.length:1)>1.5&&(d=a.textWidth/8),2*(b+=c/2)+d):0},f.height.get=function(){var a=this,b=a.padding,c=a.strokeWidth,d=a.textHeight;return 2*(b+=c/2)+d},Object.defineProperties(e.prototype,f),e}(a.Texture),f=(new a.Vector3,new a.Vector3,new a.Vector3,!0),g={isTextTexture:f,redraw:d};Object.entries||(Object.entries=function(a){for(var b=Object.keys(a),c=b.length,d=new Array(c);c--;)d[c]=[b[c],a[b[c]]];return d});var h=e.prototype;return Object.entries({_align:"align",_fillStyle:"fillStyle",_fontFamily:"fontFamily",_fontSize:"fontSize",_fontStyle:"fontStyle",_fontVariant:"fontVariant",_fontWeight:"fontWeight",_lineGap:"lineGap",_padding:"padding",_strokeStyle:"strokeStyle",_strokeWidth:"strokeWidth",_text:"text",_src:"src",_bgColor:"bgColor",_areaType:"areaType"}).forEach(function(a){var b=a[0],c=a[1];Object.defineProperty(h,c,{get:function(){return this[b]},set:function(a){this[b]!==a&&(this[b]=a,this.needsRedraw=!0)}})}),Object.assign(h,g),e});var GIM={VERSION:"56.0.0",DATE:"2021年5月14日",INFO:"Author Simon wood"},mapgl=GIM,styles=["color: #FFFFFF","background: #3e458c","font-size: 20px","border: 1px solid #FFFFFF","text-shadow: 2px 2px black","padding: 10px"].join(";");console.log("%c[MAP] Map Version: "+GIM.VERSION,styles),GIM.floorOrders={},GIM.imgPool={},GIM.DEBUG_MODE=!1,GIM.showLabelType="No.",GIM.PID="0DCD37C5-F691-4F83-A840-AFC2029B57ED",GIM.NODE_TYPE_ASTAR="0",GIM.NODE_TYPE_GROUND="ground",GIM.NODE_TYPE_SHOP="shop",GIM.NODE_TYPE_ESCALATOR="escalator",GIM.NODE_TYPE_LIFT="lifts",GIM.NODE_TYPE_STAIR="stair",GIM.NODE_TYPE_CARPARK="carport",GIM.NODE_TYPE_TOILET="toilets",GIM.NODE_TYPE_ENTRANCE="entrance",GIM.NODE_TYPE_BULID="bulid",GIM.NODE_TYPE_TEXTMARK="textmark",GIM.NODE_TYPE_SECTION="section",GIM.NODE_TYPE_ROADMARK="roadmark",GIM.NODE_TYPE_DIRMARK="dir",GIM.NODE_TYPE_ELEVATION="elevation",GIM.NODE_TYPE_FLOORLABEL="yzz",GIM.NODE_TYPE_MACHINE="Your location".toLocaleLowerCase(),GIM.SHOW_SPRITE_LENGTH=8e4,GIM.SHOW_Facility_LENGTH=8e4,GIM.INIT_FLOORID="",GIM.NODE_TYPE_STAIRS="6",GIM.NODE_TYPE_SERVICE="8",GIM.NODE_TYPE_ATM="9",GIM.MACHINE_CODE="",GIM.REMOTE_SERVER="https://map.ckiosk.cn/WebAPI/ClientService.asmx/Command?callback&",GIM.UNIT_HEIGHT_SCALE=1.5,GIM.FLOOR_GAP=600,GIM.PATH_POINT_GAP=10,GIM.PATH_COLOR="#00b81F",GIM.SELECT_COLOR=14053231,GIM.MAP_OFFSET_Y=200,GIM.FONT_NAME="Microsoft Yahei ,微软雅黑,Tahoma,Arial",GIM.SHADOW_MAP_SIZE=2048,GIM.near=1e3,GIM.far=8e3,GIM.pathWidth=40,GIM.OFFSET=0,GIM.CLICK_FOCUS=!0,GIM.maxFlatHeight=1,GIM.normalFirst="normal",GIM.liftFirst="liftsFirst",GIM.stairFirst="stairsFirst",GIM.escalatorFirst="escalatorsFirst",GIM.pathPriority=GIM.liftFirst,GIM.isTextColorWrite=!1,GIM.MAP_CONFIG={near:1,fov:35,far:28e3,minDistance:1200,maxDistance:1e4,minX:-13e3,maxX:13e3,minY:-15e3,maxY:12500,minFloorPositionZ:-1e4,maxFloorPositionZ:1e4},GIM.buildCurvePoints=function(a,b,c){if(a.length>=3){var d=Math.PI/10,e=Math.PI-d,f=c||1,g=void 0==b?8:b;if(0==g)return a;var h=1/g;a.push(a[a.length-1]);for(var i=[],j=0;j<a.length-2;){var k=a[j].clone(),l=a[j+1].clone(),m=a[j+2].clone(),n=k.clone().sub(l),o=m.clone().sub(l),p=n.angleTo(o),q=n.length(),r=o.length();if(i.push(k),p>d&&p<e&&q>f&&r>f){var s=l.clone().lerp(k,f/q),t=l.clone().lerp(m,f/r);i.push(s);for(var u=h;u<.999999;u+=h){var v=u,w=s.clone().lerp(l,v),x=l.clone().lerp(t,v);i.push(w.lerp(x,v))}a[j+1]=t,j++}else j++;j==a.length-2&&i.push(m)}return i}var y={};return y.segments=a.length,y.pathVertices=a,creatPathVertices(a)},GIM.Math={clamp:function(a,b,c){return Math.max(b,Math.min(c,a))}},GIM.Calc3PAngel=function(a,b,c){var d=180*Math.atan2(parseFloat(a.y-b.y),parseFloat(a.x-b.x))/Math.PI,e=180*Math.atan2(parseFloat(b.y-c.y),parseFloat(b.x-c.x))/Math.PI,f=parseInt(d-e)%360,g={};return f=-f,f<-180&&(f+=360),f>180&&(f-=360),g.turn=f>67.5?"Left":f>22.5&&f<=67.5?"LeftFront":f<-67.5?"Right":f>=-67.5&&f<-22.5?"RightFront":"Straight",g.corners=f,g},GIM.OS=function(){var a=navigator.userAgent,b=/(?:Windows Phone)/.test(a),c=/(?:SymbianOS)/.test(a)||b,d=/(?:Android)/.test(a),e=/(?:Firefox)/.test(a),f=(/(?:Chrome|CriOS)/.test(a),/(?:iPad|PlayBook)/.test(a)||d&&!/(?:Mobile)/.test(a)||e&&/(?:Tablet)/.test(a)),g=/(?:iPhone)/.test(a)&&!f;return{isTablet:f,isPhone:g,isAndroid:d,isPc:!g&&!d&&!c}}(),GIM.bgScale=GIM.OS.isPhone||GIM.OS.isAndroid?2:1,GIM.codeToText=function(a){var b=a.code.toLocaleLowerCase(),c="";switch(b){case GIM.NODE_TYPE_ESCALATOR:case"escalator up":case"escalator down":switch(c="乘扶梯至",MapConfigX.lang){case"en":c="Take Escalator to ";break;case"zh-hant":c="乘扶梯至"}break;case GIM.NODE_TYPE_LIFT:switch(c="乘直梯至",MapConfigX.lang){case"en":c="Take Lift to ";break;case"zh-hant":c="乘直梯至"}break;case GIM.NODE_TYPE_STAIR:switch(c="走楼梯至",MapConfigX.lang){case"en":c="Take Stairs to ";break;case"zh-hant":c="走樓梯至"}}return c},GIM.roundedCornerLine=function(a,b,c,d){if(b=void 0!==b?b:.1,c=void 0!==c?Math.floor(c):3,d=void 0!==d&&d,void 0===a)return console.log("RoundedCornerLine: 'points' is undefined"),a;if(a.length<3)return console.log("RoundedCornerLine: 'points' has insufficient length (should be equal or greater than 3)"),a;for(var e=new THREE.Vector3,f=e.subVectors(a[0],a[1]).length(),g=1;g<a.length-1;g++)f=Math.min(f,e.subVectors(a[g],a[g+1]).length());d&&(f=Math.min(f,e.subVectors(a[a.length-1],a[0]).length())),b=b>.5*f?.5*f:b;var h=1,i=a.length-2;d&&(h=0,i=a.length-1);var j=[];d||j.push(a[0].clone());for(var k=h;k<=i;k++){var l=k-1<0?a.length-1:k-1,m=k,n=k+1>a.length-1?0:k+1,o=a[l],p=a[m],q=a[n],r=(new THREE.Vector3).subVectors(o,p).normalize(),s=(new THREE.Vector3).subVectors(q,p).normalize(),t=(new THREE.Vector3).subVectors(s,r).divideScalar(2).add(r).normalize(),u=r.angleTo(s),v=.5*u,w=b/Math.tan(v),x=Math.sqrt(w*w+b*b),y=r.multiplyScalar(w),z=t.multiplyScalar(x),A=s.multiplyScalar(w),B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3;B.subVectors(z,A),C.subVectors(y,A),B.cross(C),D.copy(B).normalize();var E=(new THREE.Vector3).subVectors(y,z),F=(new THREE.Vector3).subVectors(A,z),G=E.angleTo(F),H=G/c,I=new THREE.Vector3;if(Math.abs(Math.abs(THREE.Math.radToDeg(u))-180)<35)I.copy(E).applyAxisAngle(D,2*H).add(p).add(z),j.push(I.clone());else for(var J=0;J<c+1;J++)I.copy(E).applyAxisAngle(D,H*J).add(p).add(z),j.push(I.clone())}return d?j.push(j[0].clone()):j.push(a[a.length-1].clone()),j},Array.prototype.remove=function(a){var b=this.indexOf(a);b>-1&&this.splice(b,1)},CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return c<2*e&&(e=c/2),d<2*e&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},THREE.OrbitControls=function(a,b,c,d,e,f){function g(){return 2*Math.PI/60/60*K.autoRotateSpeed}function h(){return Math.pow(.95,K.zoomSpeed)}function i(a){T.theta-=a}function j(a){T.phi-=a}function k(a){if(K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera)U/=a;else if(K.object instanceof THREE.OrthographicCamera||K.object.isOrthographicCamera){var b=K.object.cameraO.zoom*a,c=K.object.cameraO.top,d=c/b;d<K.maxTop&&(K.object.cameraO.zoom=b,K.object.cameraO.updateProjectionMatrix(),W=!0)}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),K.enableZoom=!1}function l(a){if(K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera)U*=a;else if(K.object instanceof THREE.OrthographicCamera||K.object.isOrthographicCamera){var b=K.object.cameraO.zoom/a,c=K.object.cameraO.top,d=c/b;d>K.minTop&&(K.object.cameraO.zoom=b,K.object.cameraO.updateProjectionMatrix(),W=!0)}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),K.enableZoom=!1}function m(a){X.set(a.clientX,a.clientY)}function n(a){ba.set(a.clientX,a.clientY)}function o(a){$.set(a.clientX,a.clientY)}function p(a){Y.set(a.clientX,a.clientY),Z.subVectors(Y,X);var b=K.domElement===document?K.domElement.body:K.domElement;i(2*Math.PI*Z.x/b.clientWidth*K.rotateSpeed),(K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera)&&j(2*Math.PI*Z.y/b.clientHeight*K.rotateSpeed),X.copy(Y),K.update()}function q(a){ca.set(a.clientX,a.clientY),da.subVectors(ca,ba),da.y>0?k(h()):da.y<0&&l(h()),ba.copy(ca),K.update()}function r(a){K.dispatchEvent(M),_.set(a.clientX,a.clientY),aa.subVectors(_,$),ga(aa.x,aa.y),$.copy(_),K.update()}function s(a){}function t(a){void 0!==K.mouseHookStart&&K.mouseHookStart(),K.zoomRadius=-100,a.deltaY<0?l(h()):a.deltaY>0&&k(h()),K.update()}function u(a){switch(a.keyCode){case K.keys.UP:ga(0,K.keyPanSpeed),K.update();break;case K.keys.BOTTOM:ga(0,-K.keyPanSpeed),K.update();break;case K.keys.LEFT:ga(K.keyPanSpeed,0),K.update();break;case K.keys.RIGHT:ga(-K.keyPanSpeed,0),K.update()}}function v(a){$.set(a.touches[0].pageX,a.touches[0].pageY)}function w(a){_.set(a.touches[0].pageX,a.touches[0].pageY),aa.subVectors(_,$),ga(aa.x,aa.y),$.copy(_),K.update()}function x(a){}function y(a){if(!1!==K.enabled){switch(a.preventDefault(),a.button){case K.mouseButtons.ORBIT:if(!1===K.enableRotate)return;m(a),Q=P.ROTATE;break;case K.mouseButtons.ZOOM:if(!1===K.enableZoom)return;n(a),Q=P.DOLLY;break;case K.mouseButtons.PAN:if(!1===K.enablePan)return;o(a),Q=P.PAN}Q!==P.NONE&&(document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",A,!1),K.dispatchEvent(N))}}function z(a){if(!1!==K.enabled){switch(K.mouseMoving=!0,a.preventDefault(),void 0!==K.mouseHookStart&&K.mouseHookStart(),Q){case P.ROTATE:if(!1===K.enableRotate)return;p(a);break;case P.DOLLY:if(!1===K.enableZoom)return;q(a);break;case P.PAN:if(!1===K.enablePan)return;r(a)}void 0!==K.mouseHookEnd&&K.mouseHookEnd()}}function A(a){!1!==K.enabled&&(K.mouseMoving=!1,s(a),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",A,!1),K.dispatchEvent(O),Q=P.NONE)}function B(a){!1===K.enabled||!1===K.enableZoom||Q!==P.NONE&&Q!==P.ROTATE||(a.preventDefault(),a.stopPropagation(),t(a),K.dispatchEvent(N),K.dispatchEvent(O))}function C(a){!1!==K.enabled&&!1!==K.enableKeys&&!1!==K.enablePan&&u(a)}function D(a){if(!1!==K.enabled){switch(a.touches.length){case 3:if(!1===K.enableRotate)return;break;case 2:if(!1===K.enableZoom)return;break;case 1:if(!1===K.enablePan)return;v(a),Q=P.TOUCH_PAN;break;default:Q=P.NONE}Q!==P.NONE&&K.dispatchEvent(N)}}function E(a){if(!1!==K.enabled)switch(a.touches.length){case 3:case 2:break;case 1:if(!1===K.enablePan)return;if(Q!==P.TOUCH_PAN)return;w(a);break;default:Q=P.NONE}}function F(a){!1!==K.enabled&&(x(a),K.dispatchEvent(O),Q=P.NONE)}function G(a){!1!==K.enabled&&a.preventDefault()}function H(){K.hammer.on(K.HAMMER_PAN,K._handlePan),K.hammer.on(K.HAMMER_PAN_START,K._handlePanStart),K.hammer.on(K.HAMMER_PAN_END,K._handlePanEnd),K.hammer.on("tap",function(a){f.selectUnit3DByPosition(a.center.x,a.center.y)}),K.hammer.on("press",function(a){f.selectUnit3DByPosition(a.center.x,a.center.y,!0)}),K.hammer.on(K.HAMMER_PINCH,K._handlePinch),K.hammer.on(K.HAMMER_PINCH_START,K._handlePinchStart),K.hammer.on(K.HAMMER_PINCH_END,K._handlePinchEnd),K.hammer.on(K.HAMMER_ROTATE_START,K._handleRotateStart),K.hammer.on(K.HAMMER_ROTATE,K._handleRotate),K.hammer.on(K.HAMMER_ROTATE,K._handleRotate),K.domElement.addEventListener("contextmenu",G,!1),K.domElement.addEventListener("mousedown",y,!1),K.domElement.addEventListener("wheel",B,!1),K.domElement.addEventListener("touchstart",D,!1),K.domElement.addEventListener("touchend",F,!1),K.domElement.addEventListener("touchmove",E,!1)}this.object=a,this.domElement=void 0!==b?b:document,this.domElement.addEventListener("touchmove",function(a){a.preventDefault()},{passive:!1}),this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=GIM.near,this.maxDistance=GIM.far,this.maxTop=THREE.CombinedCamera.prototype.getOrthoCameraSize(a,this.maxDistance).top,this.minTop=THREE.CombinedCamera.prototype.getOrthoCameraSize(a,this.minDistance).top,this.minZoom=0,this.maxZoom=4,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2.5,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=.4,this.enableRotate=!0,this.rotateSpeed=.5,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=.5,this.enableKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.RIGHT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.LEFT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.mouseMoving=!1,this.mouseHookStart=void 0,this.mouseHookEnd=void 0,this.RegisterMouseHookStart=function(a){this.mouseHookStart=a},this.RegisterMouseHookEnd=function(a){this.mouseHookEnd=a},this.updateTop=function(){this.maxTop=THREE.CombinedCamera.prototype.getOrthoCameraSize(a,K.maxDistance).top,this.minTop=THREE.CombinedCamera.prototype.getOrthoCameraSize(a,K.minDistance).top},this.setDistance=function(b){function c(){K.zoomRadius=S.radius,K.update()}function d(){K.zoomRadius=-100}a instanceof THREE.PerspectiveCamera||a.isPerspectiveCamera?(TweenLite.to(S,.7,{radius:b,onUpdate:c,onComplete:d,ease:Power1.easeOut}),f.forceUpdate()):(K.setZoom(b),f.forceUpdate())},this.setDistance2=function(a){S.radius=a};var I;this.setZoom=function(b){function c(){a.isOrthographicCamera?(W=!0,K.object.cameraO.updateProjectionMatrix()):I.kill()}function d(){I.kill()}var e=THREE.CombinedCamera.prototype.getOrthoCameraSize(a,b),f=K.object.cameraO.top/e.top;I=TweenLite.to(a.cameraO,.7,{zoom:f,onUpdate:c,onComplete:d,ease:Power1.easeOut})},this.getCameraRadius=function(){return S.radius},this.getPolarAngle=function(){return S.phi},this.setPolarAngle=function(b,c,d){function e(){K.update(!0)}0==d?(S.phi=b,K.update(!0)):(a instanceof THREE.PerspectiveCamera||a.isPerspectiveCamera)&&(TweenLite.killDelayedCallsTo(c),TweenLite.to(S,.3,{phi:b,onUpdate:e,onComplete:c||null}))},this.setAzimuthalAngle=function(a,b){function c(){K.update(!0)}0==b?(S.theta=a,K.update(!0)):TweenLite.to(S,.7,{directionalRotation:{theta:a+"_short",useRadians:!0},onUpdate:c})},this.getAzimuthalAngle=function(){return S.theta},this.lastP=new THREE.Vector3,this.saveState=function(){K.target0.copy(K.target),K.position0.copy(K.object.position),K.zoom0=K.object.zoom,K.floorPos=c.position.clone()},this.reset=function(){K.target.copy(K.target0),K.object.position.copy(K.position0),K.object.zoom=K.zoom0,c.position.copy(K.floorPos),K.object.updateProjectionMatrix(),K.dispatchEvent(L),K.update(),K.mouseMoving||(Q=P.NONE)},this.getDistance=function(){return K.object.position.clone().sub(K.target).length()},this.update=function(b){b=b||!1;var c=new THREE.Vector3,d=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),e=d.clone().invert(),f=new THREE.Vector3,h=new THREE.Quaternion;return function(a){var b=K.object.position;return c.copy(b).sub(K.target),c.applyQuaternion(d),a||S.setFromVector3(c),K.autoRotate&&Q===P.NONE&&i(g()),S.theta+=T.theta,S.phi+=T.phi,S.theta=Math.max(K.minAzimuthAngle,Math.min(K.maxAzimuthAngle,S.theta)),S.phi=Math.max(K.minPolarAngle,Math.min(K.maxPolarAngle,S.phi)),S.makeSafe(),K.zoomRadius>0?S.radius=K.zoomRadius:S.radius*=U,S.radius=Math.max(K.minDistance,Math.min(K.maxDistance,S.radius)),K.target.add(V),c.setFromSpherical(S),c.applyQuaternion(e),b.copy(K.target).add(c),K.object.lookAt(K.target),!0===K.enableDamping?(T.theta*=1-K.dampingFactor,T.phi*=1-K.dampingFactor):T.set(0,0,0),U=1,V.set(0,0,0),this.dispatchEvent({type:"update",message:K.getAzimuthalAngle()}),!!(W||f.distanceToSquared(K.object.position)>R||8*(1-h.dot(K.object.quaternion))>R)&&(K.dispatchEvent(L),f.copy(K.object.position),h.copy(K.object.quaternion),W=!1,!0)}}(),this.dispose=function(){K.domElement.removeEventListener("contextmenu",G,!1),K.domElement.removeEventListener("mousedown",y,!1),K.domElement.removeEventListener("wheel",B,!1),K.domElement.removeEventListener("touchstart",D,!1),K.domElement.removeEventListener("touchend",F,!1),K.domElement.removeEventListener("touchmove",E,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",A,!1),window.removeEventListener("keydown",C,!1)};var J,K=this,L={type:"change"},M={type:"move"},N={type:"start"},O={type:"end"},P={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:5,TOUCH_DOLLY:4,TOUCH_PAN:3},Q=P.NONE,R=1e-6,S=new THREE.Spherical,T=new THREE.Spherical,U=1,V=new THREE.Vector3,W=!1,X=new THREE.Vector2,Y=new THREE.Vector2,Z=new THREE.Vector2,$=new THREE.Vector2,_=new THREE.Vector2,aa=new THREE.Vector2,ba=new THREE.Vector2,ca=new THREE.Vector2,da=new THREE.Vector2,ea=function(){var a=new THREE.Vector3;return function(b,d){a.setFromMatrixColumn(d,0),a.multiplyScalar(b),c.position.add(a)}}(),fa=function(){var a=new THREE.Vector3;return function(b,d){a.setFromMatrixColumn(d,1),a.multiplyScalar(-b),a.z=0,c.position.add(a)}}(),ga=function(){var a=new THREE.Vector3;return function(b,c){var d=K.domElement===document?K.domElement.body:K.domElement;if(K.dispatchEvent(L),K.dispatchEvent(M),K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera){var e=K.object.position;a.copy(e).sub(K.target);var f=a.length();f*=Math.tan(K.object.fov/2*Math.PI/180),ea(2*b*f/d.clientHeight,K.object.matrix),fa(2*c*f/d.clientHeight,K.object.matrix)}else K.object instanceof THREE.OrthographicCamera||K.object.isOrthographicCamera?(ea(b*(K.object.cameraO.right-K.object.cameraO.left)/K.object.cameraO.zoom/d.clientWidth,K.object.matrix),fa(c*(K.object.cameraO.top-K.object.cameraO.bottom)/K.object.cameraO.zoom/d.clientHeight,K.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),K.enablePan=!1)}}();K._handleRotateStart=function(a){J=K.getAzimuthalAngle(),K.zoomRunning=!0,K.initialDeg=a.rotation},K._handleRotate=function(a){if(!1!==K.enableRotate){var b=(a.rotation-K.initialDeg)*Math.PI/180;S.theta=b+J,K.update(!0)}};var ha=0;K._handlePinchStart=function(a){if(K.zoomRadius=-100,K.zoomRunning=!0,ha=S.radius,K.initialScale=a.scale,K.initialDeg=a.rotation,K.object instanceof THREE.OrthographicCamera||K.object.isOrthographicCamera){var b=K.object.cameraO.zoom,d=new THREE.Vector3(0,0,c.position.z),e=d.distanceTo(K.object.position);ha=e/b,K.initialScale=b}else ha=S.radius;ja=1};var ia=0,ja=1;K._handlePinch=function(a){if(K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera){var b=a.scale-ja;ia=(a.scale,ha*(1-b)),U=ia/ha,ja=a.scale}else if(K.object instanceof THREE.OrthographicCamera||K.object.isOrthographicCamera){var c=ha/Math.pow(a.scale,.95),d=K.initialScale*(ha/c),e=K.object.cameraO.top,f=e/d;f>K.minTop&&f<K.maxTop&&(K.object.cameraO.zoom=d,K.object.cameraO.updateProjectionMatrix())}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),K.enableZoom=!1},K._handlePinchEnd=function(a){K.zoomRunning=!1},K._handlePanStart=function(a){K.panRunning=!0},K._handlePan=function(a){(K.object instanceof THREE.PerspectiveCamera||K.object.isPerspectiveCamera)&&K.panRunning&&a.changedPointers.length>=1&&("pandown"==a.additionalEvent?(T.phi-=.01,K.panPhi=!0):"panup"==a.additionalEvent&&(T.phi+=.01,K.panPhi=!0),K.update())},K._handlePanEnd=function(a){K.panRunning=!1,K.panPhi=!1},K.HAMMER_PAN="pan",K.HAMMER_PAN_START="panstart",K.HAMMER_PAN_END="panend",K.HAMMER_PINCH="pinch",K.HAMMER_PINCH_START="pinchstart",K.HAMMER_PINCH_MOVE="pinchmove",K.HAMMER_PINCH_END="pinchend",K.HAMMER_PINCH_CANCEL="pinchcancel",K.HAMMER_ROTATE="rotatemove",K.HAMMER_ROTATE_START="rotatestart",K.HAMMER_ROTATE_MOVE="rotatemove",K.HAMMER_ROTATE_END="rotateend",K.HAMMER_ROTATE_CANCEL="rotatecancel",K.hammer=new Hammer.Manager(K.domElement),K._hammerPinchRecognizer=new Hammer.Pinch({}),K._hammerRotateRecognizer=new Hammer.Rotate({threshold:20}),K._hammerPanRecognizer=new Hammer.Pan({pointers:2,direction:24,threshold:10}),K._hammerPinchRecognizer.recognizeWith([K._hammerPanRecognizer]),K._hammerPinchRecognizer.recognizeWith([K._hammerRotateRecognizer]),K._hammerRotateRecognizer.recognizeWith([K._hammerPanRecognizer,K._hammerPinchRecognizer]),K.hammer.add([K._hammerPanRecognizer,K._hammerPinchRecognizer,K._hammerRotateRecognizer,new Hammer.Tap,new Hammer.Press({time:1e3})]),this.update(),d&&H()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!a}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!a}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!a}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!a}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!a}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=a}}}),THREE.MapControls=function(a,b){THREE.OrbitControls.call(this,a,b),this.screenSpacePanning=!1,this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls,function(){"use strict";function a(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new f.BufferGeometry,this.widthCallback=null}function b(a,b,c,d,e){var f;if(a=a.subarray||a.slice?a:a.buffer,c=c.subarray||c.slice?c:c.buffer,a=b?a.subarray?a.subarray(b,e&&b+e):a.slice(b,e&&b+e):a,c.set)c.set(a,d);else for(f=0;f<a.length;f++)c[f+d]=a[f];return c}function c(a){function b(a,b){return void 0===a?b:a}var c=["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform vec3 passColor;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","","varying vec4 vColor;","varying vec4 vPassColor;","varying vec2 vUV;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, 1.0 );","    vPassColor = vec4( passColor, 1. );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","    }","","\t dir.x *= aspect;","\t dir = normalize(dir);","    vec2 offset = vec2( -dir.y, dir.x );","    offset.x /= aspect;","    offset *= lineWidth;","    offset /= resolution.y;","\t offset *= finalPosition.w;","","    offset = offset * side;","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","","","}"],d=["#extension GL_OES_standard_derivatives : enable","precision highp float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","uniform float uvDelta;","uniform float markerDelta;","uniform float passColorScale;","uniform float arrwoUVOffset;","uniform vec3 borderColor;","uniform float opacity;","","varying vec2 vUV;","varying vec4 vColor;","varying vec4 vPassColor;","varying float vCounters;","","void main()","{","      vec4 c = vColor;","      vec4 cPassColor = vPassColor;","      if(useMap > 0.0)","      {","          vec4 tc = vec4(1.0, 1.0, 1.0, 0.0);","          float uvx = vCounters * repeat.x;","          float muvx = mod(uvx, markerDelta);","          float offset = arrwoUVOffset;","          if(offset + uvDelta <= markerDelta && muvx >=  offset && muvx <= offset + uvDelta) ","          {","              float s = (muvx - offset) / uvDelta;","              tc = texture2D( map, vec2(s, vUV.y));","              c.xyzw = tc.w >= 0.5 ? tc.xyzw : c.xyzw;","              cPassColor.xyzw = tc.w >= 0.5 ? tc.xyzw : cPassColor.xyzw;","          }","","          if(offset + uvDelta > markerDelta)","          {","              if(muvx >= offset) ","              {","                  float s = (muvx - offset) / uvDelta;","                  tc = texture2D( map, vec2(s, vUV.y));","                  c.xyzw = tc.w >= 0.5 ? tc.xyzw : c.xyzw;","                  cPassColor.xyzw = tc.w >= 0.5 ? tc.xyzw : cPassColor.xyzw;","              }","              else","              {","                  if(muvx <= offset + uvDelta - markerDelta)","                  {","                      float s = (muvx + markerDelta - offset) / uvDelta;","                      tc = texture2D( map, vec2(s, vUV.y));","                      c.xyzw = tc.w >= 0.5 ? tc.xyzw : c.xyzw;","                      cPassColor.xyzw = tc.w >= 0.5 ? tc.xyzw : cPassColor.xyzw;","                  }","              }","          }","       }","    if( useDash == 1. ){","    }","    if(vCounters < passColorScale) {","        gl_FragColor = vec4(cPassColor.xyz, opacity);","    }","    else {","        gl_FragColor = vec4(c.xyz, opacity);","    }","}"];f.Material.call(this),a=a||{},this.lineWidth=b(a.lineWidth,1),this.map=b(a.map,null),this.useMap=b(a.useMap,0),this.alphaMap=b(a.alphaMap,null),this.useAlphaMap=b(a.useAlphaMap,0),this.color=b(a.color,new f.Color(16777215)),this.passColor=b(a.passColor,new f.Color(16777215)),this.opacity=b(a.opacity,1),this.resolution=b(a.resolution,new f.Vector2(1,1)),this.sizeAttenuation=b(a.sizeAttenuation,1),this.near=b(a.near,1),this.far=b(a.far,1),this.dashArray=b(a.dashArray,0),this.dashOffset=b(a.dashOffset,0),this.dashRatio=b(a.dashRatio,.5),this.useDash=0!==this.dashArray?1:0,this.visibility=b(a.visibility,1),this.alphaTest=b(a.alphaTest,0),this.repeat=b(a.repeat,new f.Vector2(1,1)),this.uvDelta=b(a.uvDelta,.5),this.markerDelta=b(a.markerDelta,2),this.passColorScale=b(a.passColorScale,0),this.arrwoUVOffset=b(a.arrwoUVOffset,0);var e=new f.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},passColor:{type:"c",value:this.passColor},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"f",value:this.dashArray},dashOffset:{type:"f",value:this.dashOffset},dashRatio:{type:"f",value:this.dashRatio},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat},uvDelta:{type:"f",value:this.uvDelta},markerDelta:{type:"f",value:this.markerDelta},passColorScale:{type:"f",value:this.passColorScale},arrwoUVOffset:{type:"f",value:this.arrwoUVOffset}},vertexShader:c.join("\r\n"),fragmentShader:d.join("\r\n")});return delete a.lineWidth,delete a.map,delete a.useMap,delete a.alphaMap,delete a.useAlphaMap,delete a.color,delete a.passColor,delete a.opacity,delete a.resolution,delete a.sizeAttenuation,delete a.near,delete a.far,delete a.dashArray,delete a.dashOffset,delete a.dashRatio,delete a.visibility,delete a.alphaTest,delete a.repeat,delete a.passColorScale,delete a.arrwoUVOffset,e.type="MeshLineMaterial",e.setValues(a),e}var d=this,e="undefined"!=typeof require,f=d.THREE||e&&require("three");if(!f)throw new Error("MeshLine requires three.js");a.prototype.setGeometry=function(a,b){this.widthCallback=b,this.positions=[],this.counters=[];var c=0,d=0;if(a instanceof f.Geometry){for(var e=1;e<a.vertices.length;e++){var g=a.vertices[e-1],h=a.vertices[e];c+=g.distanceTo(h)}for(var e=0;e<a.vertices.length;e++){var i=a.vertices[e];if(this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),0==e)this.counters.push(0),this.counters.push(0);else{var g=a.vertices[e-1],h=a.vertices[e];d+=g.distanceTo(h),this.counters.push(d/c),this.counters.push(d/c)}}}if(f.BufferGeometry,a instanceof Float32Array||a instanceof Array){for(var e=1;e<a.length;e+=3){var h=new f.Vector3(a[e],a[e+1],a[e+2]),g=new f.Vector3(a[e-3],a[e+1-3],a[e+2-3]);c+=g.distanceTo(h)}for(var e=0,j=0;e<a.length;e+=3,j++)if(this.positions.push(a[e],a[e+1],a[e+2]),this.positions.push(a[e],a[e+1],a[e+2]),0==e)this.counters.push(0),this.counters.push(0);else{var h=new f.Vector3(a[e],a[e+1],a[e+2]),g=new f.Vector3(a[e-3],a[e+1-3],a[e+2-3]);d+=g.distanceTo(h),this.counters.push(d/c),this.counters.push(d/c)}}this.process()},a.prototype.compareV3=function(a,b){var c=6*a,d=6*b;return this.positions[c]===this.positions[d]&&this.positions[c+1]===this.positions[d+1]&&this.positions[c+2]===this.positions[d+2]},a.prototype.copyV3=function(a){var b=6*a;return[this.positions[b],this.positions[b+1],this.positions[b+2]]},a.prototype.process=function(){var a=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var b=0;b<a;b++)this.side.push(1),this.side.push(-1);for(var c,b=0;b<a;b++)c=this.widthCallback?this.widthCallback(b/(a-1)):1,this.width.push(c),this.width.push(c);for(var b=0;b<a;b++)this.uvs.push(b/(a-1),0),this.uvs.push(b/(a-1),1);var d;d=this.compareV3(0,a-1)?this.copyV3(a-2):this.copyV3(0),this.previous.push(d[0],d[1],d[2]),this.previous.push(d[0],d[1],d[2]);for(var b=0;b<a-1;b++)d=this.copyV3(b),this.previous.push(d[0],d[1],d[2]),this.previous.push(d[0],d[1],d[2]);for(var b=1;b<a;b++)d=this.copyV3(b),this.next.push(d[0],d[1],d[2]),this.next.push(d[0],d[1],d[2]);d=this.compareV3(a-1,0)?this.copyV3(1):this.copyV3(a-1),this.next.push(d[0],d[1],d[2]),this.next.push(d[0],d[1],d[2]);for(var b=0;b<a-1;b++){var e=2*b;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new f.BufferAttribute(new Float32Array(this.positions),3),previous:new f.BufferAttribute(new Float32Array(this.previous),3),next:new f.BufferAttribute(new Float32Array(this.next),3),side:new f.BufferAttribute(new Float32Array(this.side),1),width:new f.BufferAttribute(new Float32Array(this.width),1),uv:new f.BufferAttribute(new Float32Array(this.uvs),2),index:new f.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new f.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},a.prototype.advance=function(a){var c=this.attributes.position.array,d=this.attributes.previous.array,e=this.attributes.next.array,f=c.length;b(c,0,d,0,f),b(c,6,c,0,f-6),c[f-6]=a.x,c[f-5]=a.y,c[f-4]=a.z,c[f-3]=a.x,c[f-2]=a.y,c[f-1]=a.z,b(c,6,e,0,f-6),e[f-6]=a.x,e[f-5]=a.y,e[f-4]=a.z,e[f-3]=a.x,e[f-2]=a.y,e[f-1]=a.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},c.prototype=Object.create(f.Material.prototype),c.prototype.constructor=c,c.prototype.copy=function(a){return f.Material.prototype.copy.call(this,a),this.lineWidth=a.lineWidth,this.map=a.map,this.useMap=a.useMap,this.alphaMap=a.alphaMap,this.useAlphaMap=a.useAlphaMap,this.color.copy(a.color),this.passColor.copy(a.passColor),this.opacity=a.opacity,this.resolution.copy(a.resolution),this.sizeAttenuation=a.sizeAttenuation,this.near=a.near,this.far=a.far,this.dashArray.copy(a.dashArray),this.dashOffset.copy(a.dashOffset),this.dashRatio.copy(a.dashRatio),this.useDash=a.useDash,this.visibility=a.visibility,this.alphaTest=a.alphaTest,this.passColorScale=a.passColorScale,this.arrwoUVOffset=a.arrwoUVOffset,this.repeat.copy(a.repeat),this},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports={MeshLine:a,MeshLineMaterial:c}),exports.MeshLine=a,exports.MeshLineMaterial=c):(d.MeshLine=a,d.MeshLineMaterial=c)}.call(this),GIM.CameraController=function(a,b,c){var d={fov:GIM.MAP_CONFIG.fov,near:GIM.MAP_CONFIG.near,far:GIM.MAP_CONFIG.far,minDistance:GIM.MAP_CONFIG.minDistance,maxDistance:GIM.MAP_CONFIG.maxDistance,minX:GIM.MAP_CONFIG.minX,maxX:GIM.MAP_CONFIG.maxX,minY:GIM.MAP_CONFIG.minY,maxY:GIM.MAP_CONFIG.maxY,cameraContainerZ:new THREE.Object3D,cameraContainerZPosition:new THREE.Vector3(0,0,0),camera:new THREE.CombinedCamera(window.innerWidth,window.innerHeight,45,100,5e4,100,5e4,b,c),positionVector:new THREE.Vector3(0,0,0),shadowLight:new THREE.DirectionalLight(16777215,.3),ambient:new THREE.AmbientLight(16777215,.7),init:function(){this.camera.near=this.near,this.camera.far=this.far,this.camera.up=new THREE.Vector3(0,0,1),this.ambient.name="ambientLight",this.shadowLight.name="shadowLight",this.shadowLight.castShadow=!1,this.shadowLight.position.set(2e3,-1e3,2500),this.shadowLight.target.position.set(0,0,0),a.add(this.shadowLight),a.add(this.ambient),this.shadowLight.shadow.mapSize.width=4096,this.shadowLight.shadow.mapSize.height=4096,this.shadowLight.shadow.camera.near=0,this.shadowLight.shadow.camera.far=1e4,this.shadowLight.shadow.bias=1e-4,this.shadowLight.shadow.radius=1.5,this.shadowLight.shadow.normalBias=.1;var b=5e3;if(this.shadowLight.shadow.camera.left=-b,this.shadowLight.shadow.camera.right=b,this.shadowLight.shadow.camera.top=b,this.shadowLight.shadow.camera.bottom=-b,this.dirLight2=new THREE.DirectionalLight(16777215,.2),this.dirLight2.position.set(-3590,2394,2373),this.dirLight2.castShadow=!1,a.add(this.dirLight2),MapConfigX.enabledShadowMap&&GIM.DEBUG_MODE){var d=new THREE.CameraHelper(this.shadowLight.shadow.camera);a.add(d);var e=new THREE.DirectionalLightHelper(this.shadowLight,5);a.add(e);var f=new THREE.DirectionalLightHelper(this.dirLight2,5,16711680);a.add(f)}a.add(this.camera),c.setAmbientColor=this.setAmbientColor,c.setAmbientIntensity=this.setAmbientIntensity,c.setDirColor=this.setDirColor,c.setDirIntensity=this.setDirIntensity,c.getAmbientColor=this.getAmbientColor,c.getAmbientIntensity=this.getAmbientIntensity,c.getDirColor=this.getDirColor,c.getDirIntensity=this.getDirIntensity},setAmbientColor:function(a){"string"==typeof a?d.ambient.color.setStyle(a):d.ambient.color.setHex(a),c.forceUpdate()},setAmbientIntensity:function(a){d.ambient.intensity=a,c.forceUpdate()},setDirColor:function(a){"string"==typeof a?(d.shadowLight.color.setStyle(a),d.dirLight2.color.setStyle(a)):(d.shadowLight.color.setHex(a),d.dirLight2.color.setHex(a)),c.forceUpdate()},setDirIntensity:function(a){d.shadowLight.intensity=a,d.dirLight2.intensity=a,c.forceUpdate()},getAmbientColor:function(a){return d.ambient.color.getHex()},getAmbientIntensity:function(a){return d.ambient.intensity},getDirColor:function(a){return d.shadowLight.color.getHex()},getDirIntensity:function(a){return d.shadowLight.intensity},_radian:.4*Math.PI,_percent:0,get percent(){return this._percent},set percent(a){this._percent=a,this.distance=(this.maxDistance-this.minDistance)*(1-this._percent/100)+this.minDistance,this.update()},_distance:0,get distance(){return this._distance},set distance(a){a=a>this.maxDistance?this.maxDistance:a<this.minDistance?this.minDistance:a,this._distance=a,this.update()},get rotation(){return this.camera.rotation},set rotation(a){this._rotation=a},get position(){return this.camera.position},update:function(){this._radian=Math.PI/2,this.positionVector.z=Math.cos(this._radian)*this._distance,this.positionVector.y=Math.sin(this._radian)*this._distance+GIM.MAP_OFFSET_Y}};return d.init(),d.percent=0,d},GIM.Compass=function(a,b,c){this.width=this.height=c[3]||40;var d=c[2]||0,e=document.createElement("div"),f=new Image;e.style.cssText="width:"+this.width+"px;height:"+this.height+"px;position:absolute;top:"+c[0]+"px;right:"+c[1]+"px;display:block;",f.src=GIM.ThemePath+"compass.png",f.style.cssText="width:"+this.width+"px;height: "+this.height+"px;position: relative;float:right;-webkit-transform: rotate(131deg);margin-right: 0px;",f.className="compassCss",f.alt="Smiley face",e.appendChild(f),a.appendChild(e),b&&b.addEventListener("update",function(a){f&&(f.style.transform="rotate("+(180*a.message/Math.PI+d)+"deg)",GIM&&GIM.compassChangeFunc&&GIM.compassChangeFunc(180*a.message/Math.PI+d))}),this.showCompass=function(a){e&&(e.style.display=a?"block":"none")}},InstancedTexture.TextureList=new Map,InstancedTexture.queueMap=new Map,InstancedTexture.queueCallback=new Map,InstancedTexture.clear=function(){InstancedTexture.TextureList.clear(),InstancedTexture.queueMap.clear(),InstancedTexture.queueCallback.clear()},GIM.LayerControl=function(a){this.toggleLayer=function(b,c){for(var d in a.children)if(a.children.hasOwnProperty(d)){var e=a.children[d];if(b==e.name)return e.visible=c,void a.forceUpdate()}}},GIM.NaviInfoUtils={areaModels:{},map:null},GIM.NaviInfoUtils.getPoiByRadius=function(a,b,c){var d,e=Number.MAX_VALUE;for(var f in GIM.Points)if(GIM.Points.hasOwnProperty(f)){var g=GIM.Points[f];if("0"==g.Code||""==g.Code)continue;if(b==g.FloorID&&c.includes(g.Code.toLocaleLowerCase())){var h=new THREE.Vector2(a.x,Math.abs(a.y)).distanceTo(new THREE.Vector2(g.x,g.y));h<e&&h<1e3&&(e=h,d=g)}}return d},THREE.TransformControls=function(a,b){function c(a,b,c){for(var d=b.intersectObject(a,!0),e=0;e<d.length;e++)if(d[e].object.visible||c)return d[e];return!1}function d(a,b){var c=b;Object.defineProperty(l,a,{get:function(){return void 0!==c?c:b},set:function(b){c!==b&&(c=b,k[a]=b,j[a]=b,l.dispatchEvent({type:a+"-changed",value:b}),l.dispatchEvent(m))}}),l[a]=b,k[a]=b,j[a]=b}function e(a){if(l.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};var c=a.changedTouches?a.changedTouches[0]:a,d=b.getBoundingClientRect();return{x:(c.clientX-d.left)/d.width*2-1,y:-(c.clientY-d.top)/d.height*2+1,button:a.button}}function f(a){if(l.enabled)switch(a.pointerType){case"mouse":case"pen":l.pointerHover(e(a))}}function g(a){l.enabled&&(l.domElement.style.touchAction="none",l.domElement.ownerDocument.addEventListener("pointermove",h,!1),l.pointerHover(e(a)),l.pointerDown(e(a)))}function h(a){l.enabled&&l.pointerMove(e(a))}function i(a){l.enabled&&(l.domElement.style.touchAction="",l.domElement.ownerDocument.removeEventListener("pointermove",h,!1),l.pointerUp(e(a)))}void 0===b&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),b=document),THREE.Object3D.call(this),this.visible=!1,this.domElement=b;var j=new THREE.TransformControlsGizmo;this.add(j);var k=new THREE.TransformControlsPlane;this.add(k);var l=this;d("camera",a),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);var m={type:"change"},n={type:"mouseDown"},o={type:"mouseUp",mode:l.mode},p={type:"objectChange"},q=new THREE.Raycaster,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Quaternion,u={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,z=new THREE.Vector3,A=new THREE.Vector3,B=0,C=new THREE.Vector3,D=new THREE.Quaternion,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Quaternion,L=new THREE.Vector3,M=new THREE.Vector3,N=new THREE.Quaternion,O=new THREE.Quaternion,P=new THREE.Vector3,Q=new THREE.Vector3,R=new THREE.Vector3,S=new THREE.Quaternion,T=new THREE.Vector3;d("worldPosition",M),d("worldPositionStart",J),d("worldQuaternion",N),d("worldQuaternionStart",K),d("cameraPosition",C),d("cameraQuaternion",D),d("pointStart",v),d("pointEnd",w),d("rotationAxis",y),d("rotationAngle",B),d("eye",Q),b.addEventListener("pointerdown",g,!1),b.addEventListener("pointermove",f,!1),l.domElement.ownerDocument.addEventListener("pointerup",i,!1),this.dispose=function(){b.removeEventListener("pointerdown",g),b.removeEventListener("pointermove",f),l.domElement.ownerDocument.removeEventListener("pointermove",h),l.domElement.ownerDocument.removeEventListener("pointerup",i),this.traverse(function(a){a.geometry&&a.geometry.dispose(),a.material&&a.material.dispose()})},this.attach=function(a){return this.object=a,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(F,G,I),this.object.matrixWorld.decompose(M,N,P),H.copy(G).invert(),O.copy(N).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(C,D,E),Q.copy(C).sub(M).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(a){if(void 0!==this.object&&!0!==this.dragging){q.setFromCamera(a,this.camera);var b=c(j.picker[this.mode],q);this.axis=b?b.object.name:null}},this.pointerDown=function(a){if(void 0!==this.object&&!0!==this.dragging&&0===a.button&&null!==this.axis){q.setFromCamera(a,this.camera);var b=c(k,q,!0);if(b){var d=this.space;if("scale"===this.mode?d="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(d="world"),"local"===d&&"rotate"===this.mode){var e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),R.copy(this.object.position),S.copy(this.object.quaternion),T.copy(this.object.scale),this.object.matrixWorld.decompose(J,K,L),v.copy(b.point).sub(J)}this.dragging=!0,n.mode=this.mode,this.dispatchEvent(n)}},this.pointerMove=function(a){var b=this.axis,d=this.mode,e=this.object,f=this.space;if("scale"===d?f="local":"E"!==b&&"XYZE"!==b&&"XYZ"!==b||(f="world"),void 0!==e&&null!==b&&!1!==this.dragging&&-1===a.button){q.setFromCamera(a,this.camera);var g=c(k,q,!0);if(g){if(w.copy(g.point).sub(J),"translate"===d)x.copy(w).sub(v),"local"===f&&"XYZ"!==b&&x.applyQuaternion(O),-1===b.indexOf("X")&&(x.x=0),-1===b.indexOf("Y")&&(x.y=0),-1===b.indexOf("Z")&&(x.z=0),"local"===f&&"XYZ"!==b?x.applyQuaternion(S).divide(I):x.applyQuaternion(H).divide(I),e.position.copy(x).add(R),this.translationSnap&&("local"===f&&(e.position.applyQuaternion(t.copy(S).invert()),-1!==b.search("X")&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),-1!==b.search("Y")&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),-1!==b.search("Z")&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.position.applyQuaternion(S)),"world"===f&&(e.parent&&e.position.add(r.setFromMatrixPosition(e.parent.matrixWorld)),-1!==b.search("X")&&(e.position.x=Math.round(e.position.x/this.translationSnap)*this.translationSnap),-1!==b.search("Y")&&(e.position.y=Math.round(e.position.y/this.translationSnap)*this.translationSnap),-1!==b.search("Z")&&(e.position.z=Math.round(e.position.z/this.translationSnap)*this.translationSnap),e.parent&&e.position.sub(r.setFromMatrixPosition(e.parent.matrixWorld))));else if("scale"===d){if(-1!==b.search("XYZ")){var h=w.length()/v.length();w.dot(v)<0&&(h*=-1),s.set(h,h,h)}else r.copy(v),s.copy(w),r.applyQuaternion(O),s.applyQuaternion(O),s.divide(r),-1===b.search("X")&&(s.x=1),-1===b.search("Y")&&(s.y=1),-1===b.search("Z")&&(s.z=1);e.scale.copy(T).multiply(s),this.scaleSnap&&(-1!==b.search("X")&&(e.scale.x=Math.round(e.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==b.search("Y")&&(e.scale.y=Math.round(e.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==b.search("Z")&&(e.scale.z=Math.round(e.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===d){x.copy(w).sub(v);var i=20/M.distanceTo(r.setFromMatrixPosition(this.camera.matrixWorld));"E"===b?(y.copy(Q),B=w.angleTo(v),z.copy(v).normalize(),A.copy(w).normalize(),B*=A.cross(z).dot(Q)<0?1:-1):"XYZE"===b?(y.copy(x).cross(Q).normalize(),B=x.dot(r.copy(y).cross(this.eye))*i):"X"!==b&&"Y"!==b&&"Z"!==b||(y.copy(u[b]),r.copy(u[b]),"local"===f&&r.applyQuaternion(N),B=x.dot(r.cross(Q).normalize())*i),this.rotationSnap&&(B=Math.round(B/this.rotationSnap)*this.rotationSnap),this.rotationAngle=B,"local"===f&&"E"!==b&&"XYZE"!==b?(e.quaternion.copy(S),e.quaternion.multiply(t.setFromAxisAngle(y,B)).normalize()):(y.applyQuaternion(H),e.quaternion.copy(t.setFromAxisAngle(y,B)),e.quaternion.multiply(S).normalize())}this.dispatchEvent(m),this.dispatchEvent(p)}}},this.pointerUp=function(a){0===a.button&&(this.dragging&&null!==this.axis&&(o.mode=this.mode,this.dispatchEvent(o)),this.dragging=!1,this.axis=null)},this.getMode=function(){return l.mode},this.setMode=function(a){l.mode=a},this.setTranslationSnap=function(a){l.translationSnap=a},this.setRotationSnap=function(a){l.rotationSnap=a},this.setScaleSnap=function(a){l.scaleSnap=a},this.setSize=function(a){l.size=a},this.setSpace=function(a){l.space=a},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var a=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1,toneMapped:!1}),b=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),c=a.clone();c.opacity=.15;var d=a.clone();d.opacity=.33;var e=a.clone();e.color.set(16711680);var f=a.clone();f.color.set(65280);var g=a.clone();g.color.set(255);var h=a.clone();h.opacity=.25;var i=h.clone();i.color.set(16776960);var j=h.clone();j.color.set(65535);var k=h.clone();k.color.set(16711935),a.clone().color.set(16776960);var l=b.clone();l.color.set(16711680);var m=b.clone();m.color.set(65280);var n=b.clone();n.color.set(255);var o=b.clone();o.color.set(65535);var p=b.clone();p.color.set(16711935);var q=b.clone();q.color.set(16776960);var r=b.clone();r.color.set(7895160);var s=q.clone();s.opacity=.25;var t=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),u=new THREE.BoxBufferGeometry(.125,.125,.125),v=new THREE.BufferGeometry;v.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var w=function(a,b){for(var c=new THREE.BufferGeometry,d=[],e=0;e<=64*b;++e)d.push(0,Math.cos(e/32*Math.PI)*a,Math.sin(e/32*Math.PI)*a);return c.setAttribute("position",new THREE.Float32BufferAttribute(d,3)),c},x=function(){var a=new THREE.BufferGeometry;return a.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),a},y={X:[[new THREE.Mesh(t,e),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(t,e),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(v,l)]],Y:[[new THREE.Mesh(t,f),[0,1,0],null,null,"fwd"],[new THREE.Mesh(t,f),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(v,m),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(t,g),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(t,g),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(v,n),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),h.clone()),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),i.clone()),[.15,.15,0]],[new THREE.Line(v,q),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(v,q),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),j.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(v,o),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(v,o),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),k.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(v,p),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(v,p),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},z={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),c),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),c)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),c),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),d),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),d),null,null,null,"helper"]],DELTA:[[new THREE.Line(x(),d),null,null,null,"helper"]],X:[[new THREE.Line(v,d.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(v,d.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(v,d.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},B={X:[[new THREE.Line(w(1,.5),l)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),e),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),m),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),f),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),n),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),g),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),s),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),s),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),s),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),s),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),s),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),r),null,[0,Math.PI/2,0]]]},C={AXIS:[[new THREE.Line(v,d.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),c),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),c),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),c),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),c)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),c)]]},E={X:[[new THREE.Mesh(u,e),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(v,l),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(u,f),[0,.8,0]],[new THREE.Line(v,m),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(u,g),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(v,n),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(u,i),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(v,q),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(v,q),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(u,j),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(v,o),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(v,o),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(u,k),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(v,p),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(v,p),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),h.clone()),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),h.clone()),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),h.clone()),[0,0,1.1]]]},F={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),c),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),c),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),c),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(u,c),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(u,c),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(u,c),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),c),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),c),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),c),[0,0,1.1]]]},G={X:[[new THREE.Line(v,d.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(v,d.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(v,d.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H=function(a){var b=new THREE.Object3D;for(var c in a)for(var d=a[c].length;d--;){var e=a[c][d][0].clone(),f=a[c][d][1],g=a[c][d][2],h=a[c][d][3],i=a[c][d][4];e.name=c,e.tag=i,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),h&&e.scale.set(h[0],h[1],h[2]),e.updateMatrix();var j=e.geometry.clone();j.applyMatrix4(e.matrix),e.geometry=j,e.renderOrder=1/0,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),b.add(e)}return b},I=new THREE.Vector3(0,0,0),J=new THREE.Euler,K=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,0,0),M=new THREE.Matrix4,N=new THREE.Quaternion,O=new THREE.Quaternion,P=new THREE.Quaternion,Q=new THREE.Vector3(1,0,0),R=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(y)),this.add(this.gizmo.rotate=H(B)),this.add(this.gizmo.scale=H(E)),this.add(this.picker.translate=H(z)),this.add(this.picker.rotate=H(D)),this.add(this.picker.scale=H(F)),this.add(this.helper.translate=H(A)),this.add(this.helper.rotate=H(C)),this.add(this.helper.scale=H(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var a=this.space;"scale"===this.mode&&(a="local");var b="local"===a?this.worldQuaternion:P;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var c=[];c=c.concat(this.picker[this.mode].children),c=c.concat(this.gizmo[this.mode].children),c=c.concat(this.helper[this.mode].children);for(var d=0;d<c.length;d++){var e=c[d];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);var f;if(f=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(f*this.size/7),"helper"!==e.tag){if(e.quaternion.copy(b),"translate"===this.mode||"scale"===this.mode){var g=.99,h=.2,i=0;"X"!==e.name&&"XYZX"!==e.name||Math.abs(K.copy(Q).applyQuaternion(b).dot(this.eye))>g&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"!==e.name&&"XYZY"!==e.name||Math.abs(K.copy(R).applyQuaternion(b).dot(this.eye))>g&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"!==e.name&&"XYZZ"!==e.name||Math.abs(K.copy(S).applyQuaternion(b).dot(this.eye))>g&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(K.copy(S).applyQuaternion(b).dot(this.eye))<h&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(K.copy(Q).applyQuaternion(b).dot(this.eye))<h&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(K.copy(R).applyQuaternion(b).dot(this.eye))<h&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),-1!==e.name.search("X")&&(K.copy(Q).applyQuaternion(b).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.x*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Y")&&(K.copy(R).applyQuaternion(b).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.y*=-1:"bwd"===e.tag&&(e.visible=!1)),-1!==e.name.search("Z")&&(K.copy(S).applyQuaternion(b).dot(this.eye)<i?"fwd"===e.tag?e.visible=!1:e.scale.z*=-1:"bwd"===e.tag&&(e.visible=!1))}else"rotate"===this.mode&&(O.copy(b),K.copy(this.eye).applyQuaternion(N.copy(b).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(M.lookAt(this.eye,L,R)),"X"===e.name&&(N.setFromAxisAngle(Q,Math.atan2(-K.y,K.z)),N.multiplyQuaternions(O,N),e.quaternion.copy(N)),"Y"===e.name&&(N.setFromAxisAngle(R,Math.atan2(K.x,K.z)),N.multiplyQuaternions(O,N),e.quaternion.copy(N)),"Z"===e.name&&(N.setFromAxisAngle(S,Math.atan2(K.y,K.x)),N.multiplyQuaternions(O,N),e.quaternion.copy(N)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._opacity=e.material._opacity||e.material.opacity,e.material._color=e.material._color||e.material.color.clone(),e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled?this.axis&&(e.name===this.axis?(e.material.opacity=1,e.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(a){return e.name===a})?(e.material.opacity=1,e.material.color.lerp(new THREE.Color(1,1,1),.5)):(e.material.opacity*=.25,e.material.color.lerp(new THREE.Color(1,1,1),.5))):(e.material.opacity*=.5,e.material.color.lerp(new THREE.Color(1,1,1),.5))}else e.visible=!1,"AXIS"===e.name?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,"X"===this.axis&&(N.setFromEuler(J.set(0,0,0)),e.quaternion.copy(b).multiply(N),Math.abs(K.copy(Q).applyQuaternion(b).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(N.setFromEuler(J.set(0,0,Math.PI/2)),e.quaternion.copy(b).multiply(N),Math.abs(K.copy(R).applyQuaternion(b).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(N.setFromEuler(J.set(0,Math.PI/2,0)),e.quaternion.copy(b).multiply(N),Math.abs(K.copy(S).applyQuaternion(b).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(N.setFromEuler(J.set(0,Math.PI/2,0)),K.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(M.lookAt(L,K,R)),e.quaternion.multiply(N),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),I.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),I.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(I),e.visible=this.dragging):(e.quaternion.copy(b),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var a=new THREE.Vector3(1,0,0),b=new THREE.Vector3(0,1,0),c=new THREE.Vector3(0,0,1),d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Matrix4,h=new THREE.Quaternion;this.updateMatrixWorld=function(){var i=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(i="local"),a.set(1,0,0).applyQuaternion("local"===i?this.worldQuaternion:h),b.set(0,1,0).applyQuaternion("local"===i?this.worldQuaternion:h),c.set(0,0,1).applyQuaternion("local"===i?this.worldQuaternion:h),f.copy(b),this.mode){case"translate":case"scale":switch(this.axis){case"X":f.copy(this.eye).cross(a),e.copy(a).cross(f);break;case"Y":f.copy(this.eye).cross(b),e.copy(b).cross(f);break;case"Z":f.copy(this.eye).cross(c),e.copy(c).cross(f);break;case"XY":e.copy(c);break;case"YZ":e.copy(a);break;case"XZ":f.copy(c),e.copy(b);break;case"XYZ":case"E":e.set(0,0,0)}break;case"rotate":default:e.set(0,0,0)}0===e.length()?this.quaternion.copy(this.cameraQuaternion):(g.lookAt(d.set(0,0,0),e,f),this.quaternion.setFromRotationMatrix(g)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.CombinedCamera=function(a,b,c,d,e,f,g,h,i){THREE.Camera.call(this),this.fov=c,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2,this.cameraO=new THREE.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,g),this.cameraP=new THREE.PerspectiveCamera(c,a/b,d,e),this.zoom=1,this.container3D=h,this.map=i,this.OToPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){},THREE.CombinedCamera.prototype.toOrthographic=function(){var a=this.fov,b=this.cameraP.aspect,c=this.cameraP.near,d=this.cameraP.far,e=(c+d)/2,f=Math.tan(a/2)*e,g=2*f,h=g*b,i=h/2;f/=this.zoom,i/=this.zoom,this.cameraO.left=this.left/this.zoom,this.cameraO.right=this.right/this.zoom,this.cameraO.top=this.top/this.zoom,this.cameraO.bottom=this.bottom/this.zoom,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.isPerspectiveCamera=!1,this.isOrthographicCamera=!0,this.cameraO.position.copy(this.cameraP.position),this.cameraO.quaternion.copy(this.cameraP.quaternion),this.matrixWorldInverse=this.cameraP.matrixWorldInverse,this.matrixWorld=this.cameraP.matrixWorld,this.type="PerspectiveCamera",this.isPerspectiveCamera=!0},THREE.CombinedCamera.prototype.perToOrthographic=function(){this.isPerspectiveCamera=!1,this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.near=this.cameraP.near,this.far=this.cameraP.far;var a=this.getOrthoCameraSize(this,this.position.distanceTo(new THREE.Vector3(0,0,this.container3D.position.z)));this.cameraO.zoom=1,this.cameraO.left=-a.right,this.cameraO.right=a.right,this.cameraO.top=a.top,this.cameraO.bottom=-a.top,this.cameraO.position.copy(this.cameraP.position),this.cameraO.quaternion.copy(this.cameraP.quaternion),this.cameraO.updateProjectionMatrix(),this.projectionMatrix=this.cameraO.projectionMatrix,this.projectionMatrixInverse=this.cameraO.projectionMatrixInverse,this.matrixWorldInverse=this.cameraO.matrixWorldInverse,this.matrixWorld=this.cameraO.matrixWorld},THREE.CombinedCamera.prototype.getOrthoCameraSize=function(a,b,c){var d=b||a.position.distanceTo(c||new THREE.Vector3(0,0,0)),e=Math.tan(a.cameraP.fov/2*THREE.Math.DEG2RAD)*d,f=e*a.cameraP.aspect;return{top:e||2,right:f}},THREE.CombinedCamera.prototype.OToPerspective=function(){this.isPerspectiveCamera=!0,this.isOrthographicCamera=!1,this.type="PerspectiveCamera";var a=this.cameraO.zoom,b=new THREE.Vector3(0,0,0),c=b.distanceTo(this.position),d=c/a,e=this.position.clone().sub(b).normalize();this.position.copy(b.clone().add(e.multiplyScalar(d))),this.godCall=!0,this.cameraP.position.copy(this.position),this.cameraP.quaternion.copy(this.quaternion),this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.projectionMatrixInverse=this.cameraP.projectionMatrixInverse,this.cameraO.zoom=1,this.map.orbitControls&&this.map.orbitControls.setDistance2(d)},THREE.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a,this.isPerspectiveCamera?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.isPerspectiveCamera?this.OToPerspective():this.perToOrthographic()},THREE.CombinedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));return this.setFov(c),c},THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a,this.isPerspectiveCamera?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.PF=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/heap")},{"./lib/heap":2}],2:[function(a,b,c){(function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p;d=Math.floor,k=Math.min,c=function(a,b){return a<b?-1:a>b?1:0},j=function(a,b,e,f,g){var h;if(null==e&&(e=0),null==g&&(g=c),e<0)throw new Error("lo must be non-negative");for(null==f&&(f=a.length);e<f;)h=d((e+f)/2),g(b,a[h])<0?f=h:e=h+1;return[].splice.apply(a,[e,e-e].concat(b)),b},g=function(a,b,d){return null==d&&(d=c),a.push(b),o(a,0,a.length-1,d)},f=function(a,b){var d,e;return null==b&&(b=c),d=a.pop(),a.length?(e=a[0],a[0]=d,p(a,0,b)):e=d,e},i=function(a,b,d){var e;return null==d&&(d=c),e=a[0],a[0]=b,p(a,0,d),e},h=function(a,b,d){var e;return null==d&&(d=c),a.length&&d(a[0],b)<0&&(e=[a[0],b],b=e[0],a[0]=e[1],p(a,0,d)),b},e=function(a,b){var e,f,g,h,i,j;for(null==b&&(b=c),h=function(){j=[];for(var b=0,c=d(a.length/2);0<=c?b<c:b>c;0<=c?b++:b--)j.push(b);return j}.apply(this).reverse(),i=[],f=0,g=h.length;f<g;f++)e=h[f],i.push(p(a,e,b));return i},n=function(a,b,d){var e;if(null==d&&(d=c),-1!==(e=a.indexOf(b)))return o(a,0,e,d),p(a,e,d)},l=function(a,b,d){var f,g,i,j,k;if(null==d&&(d=c),g=a.slice(0,b),!g.length)return g;for(e(g,d),k=a.slice(b),i=0,j=k.length;i<j;i++)f=k[i],h(g,f,d);return g.sort(d).reverse()},m=function(a,b,d){var g,h,i,l,m,n,o,p,q;if(null==d&&(d=c),10*b<=a.length){if(i=a.slice(0,b).sort(d),!i.length)return i;for(h=i[i.length-1],o=a.slice(b),l=0,n=o.length;l<n;l++)g=o[l],d(g,h)<0&&(j(i,g,0,null,d),i.pop(),h=i[i.length-1]);return i}for(e(a,d),q=[],m=0,p=k(b,a.length);0<=p?m<p:m>p;0<=p?++m:--m)q.push(f(a,d));return q},o=function(a,b,d,e){var f,g,h;for(null==e&&(e=c),f=a[d];d>b&&(h=d-1>>1,g=a[h],e(f,g)<0);)a[d]=g,d=h;return a[d]=f},p=function(a,b,d){var e,f,g,h,i;for(null==d&&(d=c),f=a.length,i=b,g=a[b],e=2*b+1;e<f;)h=e+1,h<f&&!(d(a[e],a[h])<0)&&(e=h),a[b]=a[e],b=e,e=2*b+1;return a[b]=g,o(a,i,b,d)},a=function(){function a(a){this.cmp=null!=a?a:c,this.nodes=[]}return a.push=g,a.pop=f,a.replace=i,a.pushpop=h,a.heapify=e,a.updateItem=n,a.nlargest=l,a.nsmallest=m,a.prototype.push=function(a){return g(this.nodes,a,this.cmp)},a.prototype.pop=function(){return f(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(a){return-1!==this.nodes.indexOf(a)},a.prototype.replace=function(a){return i(this.nodes,a,this.cmp)},a.prototype.pushpop=function(a){return h(this.nodes,a,this.cmp)},a.prototype.heapify=function(){return e(this.nodes,this.cmp)},a.prototype.updateItem=function(a){return n(this.nodes,a,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var b;return b=new a,b.nodes=this.nodes.slice(0),b},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),(void 0!==b&&null!==b?b.exports:void 0)?b.exports=a:window.Heap=a}).call(this)},{}],3:[function(a,b,c){var d={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};b.exports=d},{}],4:[function(a,b,c){function d(a,b,c){var d;"object"!=typeof a?d=a:(b=a.length,d=a[0].length,c=a),this.width=d,this.height=b,this.nodes=this._buildNodes(d,b,c)}var e=a("./Node"),f=a("./DiagonalMovement");d.prototype._buildNodes=function(a,b,c){var d,f,g=new Array(b);for(d=0;d<b;++d)for(g[d]=new Array(a),f=0;f<a;++f)g[d][f]=new e(f,d);if(void 0===c)return g;if(c.length!==b||c[0].length!==a)throw new Error("Matrix size does not fit");for(d=0;d<b;++d)for(f=0;f<a;++f)c[d][f]||(g[d][f].walkable=!1);return g},d.prototype.getNodeAt=function(a,b){return this.nodes[b][a]},d.prototype.isWalkableAt=function(a,b){return this.isInside(a,b)&&this.nodes[b][a].walkable},d.prototype.isInside=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},d.prototype.setWalkableAt=function(a,b,c){this.nodes[b][a].walkable=c},d.prototype.getNeighbors=function(a,b){var c=a.x,d=a.y,e=[],g=!1,h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n=!1,o=this.nodes;if(this.isWalkableAt(c,d-1)&&(e.push(o[d-1][c]),g=!0),this.isWalkableAt(c+1,d)&&(e.push(o[d][c+1]),i=!0),this.isWalkableAt(c,d+1)&&(e.push(o[d+1][c]),k=!0),this.isWalkableAt(c-1,d)&&(e.push(o[d][c-1]),m=!0),b===f.Never)return e;if(b===f.OnlyWhenNoObstacles)h=m&&g,j=g&&i,l=i&&k,n=k&&m;else if(b===f.IfAtMostOneObstacle)h=m||g,j=g||i,l=i||k,n=k||m;else{if(b!==f.Always)throw new Error("Incorrect value of diagonalMovement");h=!0,j=!0,l=!0,n=!0}return h&&this.isWalkableAt(c-1,d-1)&&e.push(o[d-1][c-1]),j&&this.isWalkableAt(c+1,d-1)&&e.push(o[d-1][c+1]),l&&this.isWalkableAt(c+1,d+1)&&e.push(o[d+1][c+1]),n&&this.isWalkableAt(c-1,d+1)&&e.push(o[d+1][c-1]),e},d.prototype.clone=function(){var a,b,c=this.width,f=this.height,g=this.nodes,h=new d(c,f),i=new Array(f);for(a=0;a<f;++a)for(i[a]=new Array(c),b=0;b<c;++b)i[a][b]=new e(b,a,g[a][b].walkable);return h.nodes=i,h},b.exports=d},{"./DiagonalMovement":3,"./Node":6}],5:[function(a,b,c){b.exports={manhattan:function(a,b){return a+b},euclidean:function(a,b){return Math.sqrt(a*a+b*b)},octile:function(a,b){var c=Math.SQRT2-1;return a<b?c*a+b:c*b+a},chebyshev:function(a,b){return Math.max(a,b)}}},{}],6:[function(a,b,c){function d(a,b,c){this.x=a,this.y=b,this.walkable=void 0===c||c}b.exports=d},{}],7:[function(a,b,c){function d(a){for(var b=[[a.x,a.y]];a.parent;)a=a.parent,b.push([a.x,a.y]);return b.reverse()}function e(a,b){var c=d(a),e=d(b);return c.concat(e.reverse())}function f(a){var b,c,d,e,f,g=0;for(b=1;b<a.length;++b)c=a[b-1],d=a[b],e=c[0]-d[0],f=c[1]-d[1],g+=Math.sqrt(e*e+f*f);return g}function g(a,b,c,d){var e,f,g,h,i,j,k=Math.abs,l=[];for(g=k(c-a),h=k(d-b),e=a<c?1:-1,f=b<d?1:-1,i=g-h;;){if(l.push([a,b]),a===c&&b===d)break;j=2*i,j>-h&&(i-=h,a+=e),j<g&&(i+=g,b+=f)}return l}function h(a){var b,c,d,e,f,h,i=[],j=a.length;if(j<2)return i;for(f=0;f<j-1;++f)for(b=a[f],c=a[f+1],d=g(b[0],b[1],c[0],c[1]),e=d.length,h=0;h<e-1;++h)i.push(d[h]);return i.push(a[j-1]),i}function i(a,b){var c,d,e,f,h,i,j,k,l,m,n,o=b.length,p=b[0][0],q=b[0][1],r=b[o-1][0],s=b[o-1][1];for(c=p,d=q,h=[[c,d]],i=2;i<o;++i){for(k=b[i],e=k[0],f=k[1],l=g(c,d,e,f),n=!1,j=1;j<l.length;++j)if(m=l[j],!a.isWalkableAt(m[0],m[1])){n=!0;break}n&&(lastValidCoord=b[i-1],h.push(lastValidCoord),c=lastValidCoord[0],d=lastValidCoord[1])}return h.push([r,s]),h}function j(a){if(a.length<3)return a;var b,c,d,e,f,g,h=[],i=a[0][0],j=a[0][1],k=a[1][0],l=a[1][1],m=k-i,n=l-j;for(f=Math.sqrt(m*m+n*n),m/=f,n/=f,h.push([i,j]),g=2;g<a.length;g++)b=k,c=l,d=m,e=n,k=a[g][0],l=a[g][1],m=k-b,n=l-c,f=Math.sqrt(m*m+n*n),m/=f,n/=f,m===d&&n===e||h.push([b,c]);return h.push([k,l]),h}c.backtrace=d,c.biBacktrace=e,c.pathLength=f,c.interpolate=g,c.expandPath=h,c.smoothenPath=i,c.compressPath=j},{}],8:[function(a,b,c){b.exports={Heap:a("heap"),Node:a("./core/Node"),Grid:a("./core/Grid"),Util:a("./core/Util"),DiagonalMovement:a("./core/DiagonalMovement"),Heuristic:a("./core/Heuristic"),AStarFinder:a("./finders/AStarFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,heap:1}],9:[function(a,b,c){function d(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.heuristic=a.heuristic||g.manhattan,this.weight=a.weight||1,this.diagonalMovement=a.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never),this.diagonalMovement===h.Never?this.heuristic=a.heuristic||g.manhattan:this.heuristic=a.heuristic||g.octile}var e=a("heap"),f=a("../core/Util"),g=a("../core/Heuristic"),h=a("../core/DiagonalMovement");d.prototype.findPath=function(a,b,c,d,g){var h,i,j,k,l,m,n,o,p=new e(function(a,b){return a.f-b.f}),q=g.getNodeAt(a,b),r=g.getNodeAt(c,d),s=this.heuristic,t=this.diagonalMovement,u=this.weight,v=Math.abs,w=Math.SQRT2;for(q.g=0,q.f=0,p.push(q),q.opened=!0;!p.empty();){if(h=p.pop(),h.closed=!0,h===r)return f.backtrace(r);for(i=g.getNeighbors(h,t),k=0,l=i.length;k<l;++k)j=i[k],j.closed||(m=j.x,n=j.y,o=h.g+(m-h.x==0||n-h.y==0?1:w),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||u*s(v(m-c),v(n-d)),j.f=j.g+j.h,j.parent=h,j.opened?p.updateItem(j):(p.push(j),j.opened=!0)))}return[]},b.exports=d},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)});var TransformManager={transformControl:null,translate:"translate",rotate:"rotate",scale:"scale",objectChangeCallback:null,attachItem:null,objectChangeEvent:{type:"objectChange"},editModel:!1};TransformManager.regcomponent=function(a,b,c,d){TransformManager.transformControl=new THREE.TransformControls(a,b),d.add(TransformManager.transformControl),TransformManager.transformControl.addEventListener("dragging-changed",function(a){c.enabled=!a.value,forceUpdate()})},TransformManager.attach=function(a){TransformManager.transformControl.attach(a),TransformManager.transformControl.setSpace("local"),TransformManager.attachItem=a,forceUpdate()},TransformManager.detach=function(){TransformManager.transformControl.detach(),TransformManager.attachItem=null,forceUpdate()},TransformManager.getMode=function(){return TransformManager.transformControl.mode},TransformManager.setMode=function(a){switch(a){case TransformManager.rotate:case TransformManager.translate:case TransformManager.scale:TransformManager.transformControl.showX=!0,TransformManager.transformControl.showY=!0,TransformManager.transformControl.showZ=!0}TransformManager.transformControl.setMode(a),forceUpdate()},GIM.AreaUnitData=function(a){function b(a){return a=parseFloat(a),NaN==a&&(a=0),a}function c(a){if(GIM.replaceColors){var b,c=parseInt(a).toString(16).toUpperCase().replace("0X","");b=void 0!==GIM.replaceColors[c]?GIM.replaceColors[c]:parseInt(a,"0x")}else 10==a.length&&-1!=a.indexOf("0x")&&(a="0x"+a.slice(-6)),b=parseInt(a,"0x");return b}function d(a){return"string"==typeof a?a.toLowerCase():a?a.toString().toLowerCase():void 0}function e(a){var b=typeof a;return"boolean"==b?a:"string"==b?"true"===a.toLowerCase():a?"true"===a.toString().toLowerCase():void 0}function f(a){var b=[];if(a){for(var c=a.split("|"),d=c.length,e="",f=[],g=0;g<d;g++)if(e!=c[g]&&-1==f.indexOf(c[g].toString())){e=c[g];var h=c[g].split(",");b.push(new THREE.Vector2(parseFloat(h[0]-GIM.OFFSET),parseFloat(-h[1]+GIM.OFFSET)))}return b}}if(a){this.shopID=a.ShopID;var g={nodeId:String(a.PointID),areaTypeID:a.AreaTypeId,bindShopId:this.shopID,fill:c(a.Color),textFill:a.TextColor,deep:b(null==a.ThreeDDepth?0:a.ThreeDDepth),name:a.Name,nameEN:a.Remark,nameZH:a.AreaName,shopName:"topName"!=GIM.showLabelType?a.ShopName||"":a.TopName||a.ShopName||"",areaTypeName:a.AreaTypeName||"",selectable:!0,origZ:0,points:f(a.Area),iconMapping:e(a.IconMapping),textMapping:e(a.TextMapping),iconRotate:b(a.IconRotate)*(Math.PI/180),textRotate:b(a.TextRotate)*(Math.PI/180),iconScale:b(a.IconScale),iconX:b(a.IconX),iconY:b(a.IconY),thirdPartyIDs:a.ThirdPartyIDs,tag:a.Tag,code:d(a.Code),fontSize:parseInt(a.FontSize),logo:a.Logo,acreage:a.Acreage,centerPoint:{x:0,y:0},area:1,classify:a.classify,modelZoom:a.model3d_zoom||1,textShowStyle:a.text_show_style,model3dShow:a.model3d_is_show||0,gapHeight:b(a.THeight)||0,modelUrl:a.model_url,isShow:a.is_show,zoneID:a.point_group_zone_id,alpha:b(a.alpha)||0,haveLine:b(a.HaveLine)||0,modelRotate:b(a.model3d_rotate||0)/180*Math.PI,textDispayType:a.TextDispayType,imgDispayType:a.img_show_style};if(this.pointID=g.nodeId,a.CPointID&&a.CPointID.length){var h=a.CPointID.split(",");g.centerPoint={x:parseFloat(h[0])-GIM.OFFSET,y:-parseFloat(h[1])+GIM.OFFSET,z:g.deep+2}}if(a.P){var i=a.P.split(",");g.nodePosition={x:parseFloat(i[0])-GIM.OFFSET,y:-parseFloat(i[1])+GIM.OFFSET,z:g.deep+g.gapHeight+3}}return g}},GIM.Collision=function(){this.rects=[]},GIM.Collision.prototype={clear:function(){this.rects.length=0},push:function(a,b){if(0==this.rects.length)return this.rects.push(b),!1;for(var c in this.rects){var d=this.rects[c];if(this.collision_(d,b))return!0}return this.rects.push(b),!1},collision_:function(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.h+a.y>b.y}},GIM.Path=function(){},GIM.prototype={calcDistance:function(a){for(var b=0,c=0;c<a.length-1;c++){var d=this.format(a[c]),e=this.format(a[c+1]);b+=this.disTo(d,e)}return b},distanceTo:function(a,b){return new THREE.Vector2(a.x,a.y).distanceTo(new THREE.Vector2(b.x,b.y))},disTo:function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},format:function(a){var b={};return a.hasOwnProperty("X")?(b.x=a.X,b.y=a.Y):(b.x=a.x,b.y=a.y),b}},GIM.Dijkstra=function(a){var b=a,c=function(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c},d=function(a,b){return parseFloat(a)-parseFloat(b)},e=function(a,b,e,f){var g,h={},i={0:[b]},j={},k=function(a,b){var c=""+a;i[c]||(i[c]=[]),i[c].push(b)};for(h[b]=0;i&&(g=c(i)).length;){g.sort(d);var l=g[0],m=i[l],n=m.shift(),o=parseFloat(l),p=a[n]||{};m.length||delete i[l];for(var q in p)if(Object.prototype.hasOwnProperty.call(p,q)){var r=p[q],s=r+o,t=h[q];(void 0===t||t>s)&&(h[q]=s,k(s,q),j[q]=n)}}return void 0===h[e]?null:j},f=function(a,b){for(var c=[],d=b;void 0!==d;)c.push(d),d=a[d];return c.reverse(),c},g=function(a,b){for(var c,d,g,h=b.shift(),i=[];b.length;){if(c=b.shift(),!(d=e(a,h,c)))return null;if(g=f(d,c),!b.length)return i.concat(g);i.push.apply(i,g.slice(0,-1)),h=c}},h=function(a,b){try{return Array.prototype.slice.call(a,b)}catch(f){for(var c=[],d=b||0,e=a.length;d<e;++d)c.push(a[d]);return c}};return GIM.Dijkstra.prototype.findShortestPath=function(a,c){return"[object Array]"===Object.prototype.toString.call(a)?g(b,a):2===arguments.length?g(b,[a,c]):g(b,h(arguments))},this},GIM.FloorData=function(a){if(void 0===a||null===a)return null;var b={floorID:a.FloorID,name:a.Name,unitsData:{},unitsList:[],order:a.Order},c=a.Area;if(c)var d=c.length;else console.log("[Map]",b.name,"楼层数据错误");for(var e=0;e<d;e++){var f=new GIM.AreaUnitData(c[e]);f.floorID=b.floorID,b.unitsData[f.nodeId]=f,b.unitsList.push(f)}return b};var MapConfigX={hideAreaTypes:[],logoFiled:"Logo",labelViewModel:"auto",lang:"zh",groundURL:"theme/ground.svg",isJavaServer:!1,facilityPanel:!1,localServerURL:"theme/ground.svg",localServer:!1,enabledShadowMap:!1,showIDSDevice:!1,outRangeTimes:5,locateLimitGrid:15,edgeColor:16777215,snapshotVersion:"",haveArea:"1",bevelEnabled:!1,defaultPolarAngle:40,parkmodelURL:"/model/geometry.json",embedParkmodel:!0,embedParkingText:!1,facilityScale:1,labelScale:1,pixelPerMeter:1,locationMarkScale:1,embedTextStroke:!0,embedTextIcon:!0,textFillStyle:"#5b6871",textStrokeStyle:"#FFFFFF",pathCenter:!0,facilityClickEmbed:!0,imageCache:new Map,xFloor:[],simulateRotate:!0,multiFloorView:!1,embedSpecialTextBG:!0,textBackgroundColor:"#66757F",embedMarkCollision:!0,displayOrder:[],alwaysDisplay:[],overrideTextStyle:!1,embedTextTip:!0,embedRobot:!1,naviRobotScale:30,robotModelURL:"/model/RobotExpressive.glb",getAreaTypeURL:"./OfflineData/getAreaType.json",getMapBuildingURL:"./OfflineData/GetMapBuildingInfo.json",getAreaURL:"./OfflineData/getAreaInfo.json",getPointURL:"./OfflineData/getPointInfo.json",getMapThroughGroupURL:"./OfflineData/getMapThroughGroup.json",gammaOutput:!1,simulateMove:!0,floor2Gap:1200,floorMultiGap:800,visibleRange:null,spriteDeepTest:!1,naviTipTypes:["shop"],naviOPatchDis:600,deviceFaceAngel:0,spriteMaterialMap:new WeakMap,LabelMuti:[],defaultInteractiveTypes:[GIM.NODE_TYPE_CARPARK,GIM.NODE_TYPE_BULID,GIM.NODE_TYPE_SHOP]};Object.defineProperties(MapConfigX,{langZH:{value:"zh",writable:!1},langEN:{value:"en",writable:!1}}),GIM.MapGrid=function(){function a(a){agrs2="getMapGrid?floorID="+a,GIM.DEBUG_MODE&&(agrs2+="&debug=1"),GIM.SVGParser.smartURLLoader(agrs2,"getMapGrid",function(c){b(a,c)})}function b(a,b){if("200"==b.c){try{for(var c=b.data,d=b.data[0].stageWidth/b.data[0].gridWidth,e=b.data[0].stageHeight/b.data[0].gridHeight,f=[[0,0,0,1,0],[1,0,0,0,1],[0,0,1,0,0]],f=new Array(e),g=0;g<f.length;g++)f[g]=new Array(d),f[g].fill(0);b.data[0].gridData.forEach(function(a){f[a[0]][a[1]]=a[2]})}catch(a){console.log("error :>> ",a)}c&&Array.isArray(c)&&(h[a]=f)}}function c(a,b,c,d,e){var f=h[a],g=new PF.Grid(f);return void 0==f||void 0==g?(console.log("MAP grid or matrix is null "),null):(new PF.AStarFinder).findPath(b,c,d,e,g)}function d(a,b,c){var d=Math.floor(Math.abs(b)/g),e=Math.floor(Math.abs(c)/g);if(h[a]&&e<k&&d<j)try{var f=h[a][e][d]}catch(b){console.log("grids[floorID][py] :",h[a][e],d,e)}return{statu:f,px:d,py:e}}function e(a,b,e){if(!h[a])return{};var i=d(a,b,e),j=null,k={};if(1==i.statu)return l.length&&(j=c(a,i.px,i.py,l[l.length-1].px,l[l.length-1].py)),j&&j.length>MapConfigX.locateLimitGrid&&m<MapConfigX.outRangeTimes?(m++,k.x=l[l.length-1].px*g-g/2,k.y=-l[l.length-1].py*g+g/2,{x:k.x,y:k.y}):(m=0,l.push(i),{x:b,y:e});for(var n,o=25;!(n=f(a,b,e,o));)o+=25;return 1==n?console.warn("MAP 网格数据异常，请排查！ "):(k.x=n.px*g-g/2,k.y=-n.py*g+g/2,l.length&&(j=c(a,n.px,n.py,l[l.length-1].px,l[l.length-1].py)),j&&j.length>50&&m<5?(m++,k.x=l[l.length-1].px*g-g/2,k.y=-l[l.length-1].py*g+g/2):(m=0,l.push(n)),k)}function f(a,b,c,e){if(e>2500)return!0;for(var f=36,h=0,i=360/f/180*Math.PI,j=0;j<f;j++){var k=b+Math.cos(h)*e,l=Math.abs(c)+Math.sin(h)*e;h+=i;var m=d(a,k,l);if(1==m.statu)return{statu:m.statu,px:Math.floor(Math.abs(k)/g),py:Math.floor(Math.abs(l)/g)}}return null}var g=50,h={},i=this,j=100,k=100;i.grids=h;var l=[],m=0;this.getFloorGrid=a,this.getStatusbyPoint=d,this.getNearstPoint=e},GIM.MarkAbstract=function(){},GIM.MarkAbstract.prototype=Object.assign({},{dispose:function(){this.remove(),this.material.map&&this.material.map.dispose(),this.geometry.dispose()},remove:function(){this.parent&&(this.parent.remove(this),forceUpdate())}}),Object.defineProperties(GIM.MarkAbstract.prototype,{interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,a?GIM.prototype.hitCheckMeshs.push(this):GIM.prototype.hitCheckMeshs.remove(this)}},data:{get:function(){return this._data},set:function(a){this._data=a}},rotationZ:{get:function(){return this.rotation.z},set:function(a){this.rotation.z=a,forceUpdate()}}}),GIM.Points={},GIM.Graph={},GIM.Links={},GIM.Lifts={},GIM.FloorGraph={},GIM.passGroup={},GIM.OutGraph={},GIM.INGraph={},GIM.Navigation=function(a){function b(b){if(b.v&&b.v[0].Floor){b.v[0].Floor.forEach(function(a){var b=a.FloorID;if(GIM.floorOrders[a.FloorID]=a.Order,!a.Point)return void console.log("[MAP] Point data error");a.Point.forEach(function(a){a.FloorID=b,GIM.Points[a.PointID]=a;var c=a.Code?a.Code.toLowerCase():"";a.x=a.X-GIM.OFFSET,a.y=parseFloat(a.Y)-GIM.OFFSET,c==GIM.NODE_TYPE_LIFT||c==GIM.NODE_TYPE_ESCALATOR||"escalators"==c||"escalator down"==c||"escalator up"==c||c==GIM.NODE_TYPE_STAIR?(GIM.Links[a.PointID]=a,"0"!=a.Name&&""!=a.Name&&" "!=a.Name&&(GIM.Lifts[a.Name]||(GIM.Lifts[a.Name]={}),GIM.Lifts[a.Name][a.PointID]=a)):"in"==a.Name?GIM.INGraph[a.PointID]=a:"out"==a.Name&&(GIM.OutGraph[a.PointID]=a)})});var d=[];for(var e in GIM.Lifts)if(GIM.Lifts.hasOwnProperty(e)){var f=GIM.Lifts[e];for(var g in f)if(f.hasOwnProperty(g)){var h=f[g],i=GIM.floorOrders[h.FloorID];d=[];for(var j in f)if(f.hasOwnProperty(j)){var k=f[j],l=GIM.floorOrders[k.FloorID];if(floorGap=i-l,h.Path||(h.Path=[]),h.PointID!=k.PointID&&-1==d.indexOf(k.PointID))switch(h.Code.toLowerCase()){case GIM.NODE_TYPE_ESCALATOR:case"escalators":Math.abs(floorGap)<=1&&(h.Path.push({ID:k.PointID}),d.push(k.PointID));break;case"escalator up":floorGap<=1&&(h.Path.push({ID:k.PointID}),d.push(k.PointID));break;case"escalator down":floorGap>=1&&(h.Path.push({ID:k.PointID}),d.push(k.PointID));break;default:h.Path.push({ID:k.PointID}),d.push(k.PointID)}}}}for(var e in GIM.OutGraph){var m=GIM.OutGraph[e];m.Path.forEach(function(a){GIM.INGraph[a.ID]&&m.Path.remove(a)})}var n=5;for(var e in GIM.Points)if(GIM.Points.hasOwnProperty(e)){var k=GIM.Points[e],o=k.Path,p=k.PointID,q=GIM.Graph[p]={};GIM.FloorGraph[k.FloorID]=GIM.FloorGraph[k.FloorID]?GIM.FloorGraph[k.FloorID]:{};var r=GIM.FloorGraph[k.FloorID][p]={};"[object Array]"===Object.prototype.toString.call(o)&&o.length?(k.Path=o=o.filter(function(a){return p!=a.ID}),o.forEach(function(b){var c=GIM.Points[b.ID];if(c&&c.PointID!=p)if(c.FloorID==k.FloorID)a.parkingFloorIDs.length&&(n=-1!=a.parkingFloorIDs.indexOf(k.floorID)?1:5),q[b.ID]=new THREE.Vector2(k.X,k.Y).distanceTo(new THREE.Vector2(c.X,c.Y))/n,-1!=a.unusualPointIDs.indexOf(p)&&(q[b.ID]+=1e3),r[b.ID]=q[b.ID];else{var d,e=k.Code.toLocaleLowerCase(),f=GIM.floorOrders[k.FloorID],g=GIM.floorOrders[c.FloorID],h=Math.abs(f-g);switch(e){case GIM.NODE_TYPE_ESCALATOR:case"escalators":d=1==h?3e3:6e3;break;case GIM.NODE_TYPE_LIFT:1==h?d=6e3:(d=1e3*h-50*Math.pow(h,2))<100&&(d=100);break;case GIM.NODE_TYPE_STAIR:d=1==h?12e3:6e3*h}q[b.ID]=d,r[b.ID]=d}})):delete GIM.Graph[p]}a.onPathDownloaded?setTimeout(function(){a.onPathDownloaded(!0),a.pathDownloaded=!0},1e3):a.pathDownloaded=!0,c()}}function c(a){function b(a){a.sort(function(a,b){return GIM.floorOrders[GIM.Points[a].FloorID]-GIM.floorOrders[GIM.Points[b].FloorID]})}function c(b){for(;b.length;){var c=b.shift();if(!(c.length<2)){var d=GIM.Points[c].FloorID,e=GIM.FloorGraph[d][c];void 0==e&&(e={});var f=GIM.floorOrders[d];b.forEach(function(b){var c=GIM.Points[b].FloorID,d=GIM.floorOrders[c],g=Math.abs(f-d);1==g?dis=6e3:(dis=500*g-50*Math.pow(g,2),dis<100&&(dis=100)),e[b]=1==a?50:dis})}}}for(var d in GIM.passGroup){var e=GIM.passGroup[d];b(e.upLine),b(e.downLine),c(e.upLine),c(e.downLine.reverse())}}function d(){function c(a){"200"==a.c?a.v.forEach(function(a){a=a.data;var b={};b.upLine=a.label.split(";"),b.downLine=a.label2.split(";"),b.groupName=a.groupName,b.id=a.id,GIM.passGroup[b.id]=b}):console.warn("跨层组加载数据失败")}var d="../cmappax/getMapThroughGroup?pid="+GIM.PID;GIM.SVGParser.loadURL(GIM.REMOTE_SERVER,d,c);var e="PathData:"+GIM.PID+"-"+a.buildingID,f=e+"Time",g=e+"Data";if(localStorage)var h=localStorage.getItem(g),i=localStorage.getItem(f),j=Date.now()-i;if(j<3e5&&h&&GIM.DEBUG_MODE)b(JSON.parse(h)),console.log("[MAP] localData path");else{console.log("[MAP] remote path");var k={};k.command="getPointInfo",k.pid=GIM.PID,k.lan="sc",k.parameter={FormfatFloor:"TRUE",floorID:a.optFloorID,buildingID:a.buildingID};var l="code="+JSON.stringify(k);if(GIM.DEBUG_MODE&&(l+="&timingdata=0"),MapConfigX.isJavaServer&&(l="getPointInfo?pid="+GIM.PID+"&lan=SC&buildingID="+a.buildingID+"&SnapshootVesion="+MapConfigX.snapshotVersion,GIM.DEBUG_MODE&&(l+="&debug=1")),MapConfigX.localServer)GIM.SVGParser.smartURLLoader(l,"getPointInfo",function(a){b(a)});else{var m=0,n=function(c){if(c){b(c),m=0;try{localStorage&&(localStorage.setItem(g,JSON.stringify(c)),localStorage.setItem(f,Date.now()))}catch(a){localStorage&&(localStorage.removeItem(g),localStorage.removeItem(f),localStorage.clear())}}else m<5?GIM.SVGParser.loadURL(GIM.REMOTE_SERVER,l,n):a.onPathDownloaded&&a.onPathDownloaded(!1),m++};GIM.SVGParser.loadURL(GIM.REMOTE_SERVER,l,n)}}}function e(b,c,d){g();var f={};if(!GIM.Points[b])return[];var i=GIM.Points[b].FloorID;if(GIM.Points[c])var j=GIM.Points[c].FloorID;var k=GIM.floorOrders[i],l=GIM.floorOrders[j],m="",n=1e3;if(a.crossBuild||d)f=GIM.Graph;else{if(i!==j){var o=MapConfigX.xFloor.findIndex(function(a){return a.Order==k}),p=MapConfigX.xFloor.findIndex(function(a){return a.Order==l});MapConfigX.xFloor.slice(Math.min(o,p),Math.max(o,p)+1).forEach(function(a){f=Object.assign(f,GIM.FloorGraph[a.FloorID])})}else f=GIM.FloorGraph[i];var q=a.linkFloorID;if(q&&q.length>=1){for(var r=0;r<q.length;r++){var s=q[r],t=GIM.floorOrders[s],u=Math.abs(t-k);n>=u&&(n=u,m=s)}var v=GIM.FloorGraph[m];f=Object.assign(f,v)}}h=new GIM.Dijkstra(f);var w=new Date,x=w.getTime(),y=h.findShortestPath(b,c),z=new Date,A=z.getTime();return null!==y?(y=y.map(function(a){return GIM.Points[a]}),console.warn(f===GIM.Graph?"Full":"Optimization","SearchPath Fee Time:",A-x,"ms"),y||e(b,c,!0)):void 0==d?e(b,c,!0):void 0}function f(b,c){if(b){var d=1e4,e=new THREE.Vector3;return b.forEach(function(a,b){for(var f=0;f<a.length;f++){var g=a[f];if(!(Math.abs(g.z-c.z)>100)){var h=GIM.prototype.distanceTo(g,c);h<d&&(d=h,e.copy(g),e.loopIndex=b,e.insideIndex=f)}}}),d/MapConfigX.pixelPerMeter<=a.constraintOffset?e:null}}function g(){for(var a in GIM.Lifts)if(GIM.Lifts.hasOwnProperty(a)){var b=GIM.Lifts[a];for(var a in b){var d=b[a],e=GIM.floorOrders[d.FloorID],f=0,g=GIM.Graph[d.PointID];d.Path.forEach(function(a){var b=GIM.Points[a.ID];if(b){var h=GIM.floorOrders[b.FloorID],i=Math.abs(h-e),j=b.Code.toLocaleLowerCase();switch(j){case GIM.NODE_TYPE_ESCALATOR:case"escalators":case"escalators up":case"escalators down":f=1==i?3e3:6e3;break;case GIM.NODE_TYPE_LIFT:case"lift":1==i?f=6e3:(f=2e3*i-50*Math.pow(i,2))<100&&(f=100);break;case GIM.NODE_TYPE_STAIR:f=1==i?5e3:6e3*i}GIM.pathPriority!=GIM.normalFirst&&(-1!=j.indexOf("escalator")&&(j="escalator"),-1!=GIM.pathPriority.search(j)&&j.length>1?f=50:j.length>1&&(f+=1e4),GIM.pathPriority==GIM.liftFirst&&c(!0)),g[b.PointID]=f,GIM.FloorGraph[d.FloorID][d.PointID][b.PointID]=f}})}}}var h;a.loadPointData=d,d(),this.searchPath=e,this.getPathNearPoint=f},THREE.SVGLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.SVGLoader.prototype={constructor:THREE.SVGLoader,load:function(a,b,c,d){var e=this;new THREE.FileLoader(e.manager).load(a,function(a){b(e.parse(a))},c,d)},parse:function(a){function b(a,d){if(1===a.nodeType){switch(a.nodeName){case"svg":break;case"g":d=l(a,d);break;case"path":d=l(a,d),a.hasAttribute("d")&&m(d)&&p.push(c(a,d));break;case"rect":d=l(a,d),m(d)&&p.push(f(a,d));break;case"polygon":d=l(a,d),m(d)&&p.push(g(a,d));break;case"polyline":d=l(a,d),m(d)&&p.push(h(a,d));break;case"circle":d=l(a,d),m(d)&&p.push(i(a,d));break;case"ellipse":d=l(a,d),m(d)&&p.push(j(a,d));break;case"line":d=l(a,d),m(d)&&p.push(k(a,d))}for(var e=a.childNodes,n=0;n<e.length;n++)b(e[n],d)}}function c(a,b){var c=new THREE.ShapePath;c.color.setStyle(b.fill);for(var e=new THREE.Vector2,f=new THREE.Vector2,g=a.getAttribute("d"),h=g.match(/[a-df-z][^a-df-z]*/gi),i=0,j=h.length;i<j;i++){var k=h[i],l=k.charAt(0),m=k.substr(1).trim();switch(l){case"M":for(var p=o(m),q=0,r=p.length;q<r;q+=2)e.x=p[q+0],e.y=p[q+1],f.x=e.x,f.y=e.y,c.moveTo(e.x,e.y);break;case"H":for(var p=o(m),q=0,r=p.length;q<r;q++)e.x=p[q],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"V":for(var p=o(m),q=0,r=p.length;q<r;q++)e.y=p[q],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"L":for(var p=o(m),q=0,r=p.length;q<r;q+=2)e.x=p[q+0],e.y=p[q+1],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"C":for(var p=o(m),q=0,r=p.length;q<r;q+=6)c.bezierCurveTo(p[q+0],p[q+1],p[q+2],p[q+3],p[q+4],p[q+5]),f.x=p[q+2],f.y=p[q+3],e.x=p[q+4],e.y=p[q+5];break;case"S":for(var p=o(m),q=0,r=p.length;q<r;q+=4)c.bezierCurveTo(n(e.x,f.x),n(e.y,f.y),p[q+0],p[q+1],p[q+2],p[q+3]),f.x=p[q+0],f.y=p[q+1],e.x=p[q+2],e.y=p[q+3];break;case"Q":for(var p=o(m),q=0,r=p.length;q<r;q+=4)c.quadraticCurveTo(p[q+0],p[q+1],p[q+2],p[q+3]),f.x=p[q+0],f.y=p[q+1],e.x=p[q+2],e.y=p[q+3];break;case"T":for(var p=o(m),q=0,r=p.length;q<r;q+=2){var s=n(e.x,f.x),t=n(e.y,f.y);c.quadraticCurveTo(s,t,p[q+0],p[q+1]),f.x=s,f.y=t,e.x=p[q+0],e.y=p[q+1]}break;case"A":for(var p=o(m),q=0,r=p.length;q<r;q+=7){var u=e.clone();e.x=p[q+5],e.y=p[q+6],f.x=e.x,f.y=e.y,d(c,p[q],p[q+1],p[q+2],p[q+3],p[q+4],u,e)}break;case"m":for(var p=o(m),q=0,r=p.length;q<r;q+=2)e.x+=p[q+0],e.y+=p[q+1],f.x=e.x,f.y=e.y,c.moveTo(e.x,e.y);break;case"h":for(var p=o(m),q=0,r=p.length;q<r;q++)e.x+=p[q],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"v":for(var p=o(m),q=0,r=p.length;q<r;q++)e.y+=p[q],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"l":for(var p=o(m),q=0,r=p.length;q<r;q+=2)e.x+=p[q+0],e.y+=p[q+1],f.x=e.x,f.y=e.y,c.lineTo(e.x,e.y);break;case"c":for(var p=o(m),q=0,r=p.length;q<r;q+=6)c.bezierCurveTo(e.x+p[q+0],e.y+p[q+1],e.x+p[q+2],e.y+p[q+3],e.x+p[q+4],e.y+p[q+5]),f.x=e.x+p[q+2],f.y=e.y+p[q+3],e.x+=p[q+4],e.y+=p[q+5];break;case"s":for(var p=o(m),q=0,r=p.length;q<r;q+=4)c.bezierCurveTo(n(e.x,f.x),n(e.y,f.y),e.x+p[q+0],e.y+p[q+1],e.x+p[q+2],e.y+p[q+3]),f.x=e.x+p[q+0],f.y=e.y+p[q+1],e.x+=p[q+2],e.y+=p[q+3];break;case"q":for(var p=o(m),q=0,r=p.length;q<r;q+=4)c.quadraticCurveTo(e.x+p[q+0],e.y+p[q+1],e.x+p[q+2],e.y+p[q+3]),f.x=e.x+p[q+0],f.y=e.y+p[q+1],e.x+=p[q+2],e.y+=p[q+3];break;case"t":for(var p=o(m),q=0,r=p.length;q<r;q+=2){var s=n(e.x,f.x),t=n(e.y,f.y);c.quadraticCurveTo(s,t,e.x+p[q+0],e.y+p[q+1]),f.x=s,f.y=t,e.x=e.x+p[q+0],e.y=e.y+p[q+1]}break;case"a":for(var p=o(m),q=0,r=p.length;q<r;q+=7){var u=e.clone();e.x+=p[q+5],e.y+=p[q+6],f.x=e.x,f.y=e.y,d(c,p[q],p[q+1],p[q+2],p[q+3],p[q+4],u,e)}break;case"Z":case"z":if(c.currentPath.autoClose=!0,c.currentPath.curves.length>0){var v=c.currentPath.curves[0];v.isLineCurve?(e.x=v.v1.x,e.y=v.v1.y):v.isEllipseCurve||v.isArcCurve?(e.x=v.aX,e.y=v.aY):v.isCubicBezierCurve||v.isQuadraticBezierCurve?(e.x=v.v0.x,e.y=v.v0.y):v.isSplineCurve&&(e.x=v.points[0].x,e.y=v.points[0].y),c.currentPath.currentPoint.copy(e)}break;default:console.warn(k)}}return c}function d(a,b,c,d,f,g,h,i){d=d*Math.PI/180,b=Math.abs(b),c=Math.abs(c);var j=(h.x-i.x)/2,k=(h.y-i.y)/2,l=Math.cos(d)*j+Math.sin(d)*k,m=-Math.sin(d)*j+Math.cos(d)*k,n=b*b,o=c*c,p=l*l,q=m*m,r=p/n+q/o;if(r>1){var s=Math.sqrt(r);b*=s,c*=s,n=b*b,o=c*c}var t=n*q+o*p,u=(n*o-t)/t,v=Math.sqrt(Math.max(0,u));f===g&&(v=-v);var w=v*b*m/c,x=-v*c*l/b,y=Math.cos(d)*w-Math.sin(d)*x+(h.x+i.x)/2,z=Math.sin(d)*w+Math.cos(d)*x+(h.y+i.y)/2,A=e(1,0,(l-w)/b,(m-x)/c),B=e((l-w)/b,(m-x)/c,(-l-w)/b,(-m-x)/c)%(2*Math.PI);a.currentPath.absellipse(y,z,b,c,A,A+B,0===g,d)}function e(a,b,c,d){var e=a*c+b*d,f=Math.sqrt(a*a+b*b)*Math.sqrt(c*c+d*d),g=Math.acos(Math.max(-1,Math.min(1,e/f)));return a*d-b*c<0&&(g=-g),g}function f(a,b){var c=parseFloat(a.getAttribute("x")||0),d=parseFloat(a.getAttribute("y")||0),e=parseFloat(a.getAttribute("rx")||0),f=parseFloat(a.getAttribute("ry")||0),g=parseFloat(a.getAttribute("width")),h=parseFloat(a.getAttribute("height")),i=new THREE.ShapePath;return i.color.setStyle(b.fill),i.moveTo(c+2*e,d),i.lineTo(c+g-2*e,d),0===e&&0===f||i.bezierCurveTo(c+g,d,c+g,d,c+g,d+2*f),i.lineTo(c+g,d+h-2*f),0===e&&0===f||i.bezierCurveTo(c+g,d+h,c+g,d+h,c+g-2*e,d+h),i.lineTo(c+2*e,d+h),0===e&&0===f||(i.bezierCurveTo(c,d+h,c,d+h,c,d+h-2*f),i.lineTo(c,d+2*f),i.bezierCurveTo(c,d,c,d,c+2*e,d)),i}function g(a,b){function c(a,b,c){var d=parseFloat(b),g=parseFloat(c);0===f?e.moveTo(d,g):e.lineTo(d,g),f++}var d=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,e=new THREE.ShapePath;e.color.setStyle(b.fill);var f=0;return a.getAttribute("points").replace(d,c),e.currentPath.autoClose=!0,e}function h(a,b){function c(a,b,c){var d=parseFloat(b),g=parseFloat(c);0===f?e.moveTo(d,g):e.lineTo(d,g),f++}var d=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,e=new THREE.ShapePath;e.color.setStyle(b.fill);var f=0;return a.getAttribute("points").replace(d,c),e.currentPath.autoClose=!1,e}function i(a,b){var c=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),e=parseFloat(a.getAttribute("r")),f=new THREE.Path;f.absarc(c,d,e,0,2*Math.PI);var g=new THREE.ShapePath;return g.color.setStyle(b.fill),g.subPaths.push(f),g}function j(a,b){var c=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),e=parseFloat(a.getAttribute("rx")),f=parseFloat(a.getAttribute("ry")),g=new THREE.Path;g.absellipse(c,d,e,f,0,2*Math.PI);var h=new THREE.ShapePath;return h.color.setStyle(b.fill),h.subPaths.push(g),h}function k(a,b){var c=parseFloat(a.getAttribute("x1")),d=parseFloat(a.getAttribute("y1")),e=parseFloat(a.getAttribute("x2")),f=parseFloat(a.getAttribute("y2")),g=new THREE.ShapePath;return g.moveTo(c,d),g.lineTo(e,f),g.currentPath.autoClose=!1,g}function l(a,b){return b=Object.assign({},b),a.hasAttribute("fill")&&(b.fill=a.getAttribute("fill")),""!==a.style.fill&&(b.fill=a.style.fill),b}function m(a){return"none"!==a.fill&&"transparent"!==a.fill}function n(a,b){return a-(b-a)}function o(a){for(var b=a.split(/[\s,]+|(?=\s?[+\-])/),c=0;c<b.length;c++){var d=b[c];if(d.indexOf(".")!==d.lastIndexOf("."))for(var e=d.split("."),f=2;f<e.length;f++)b.splice(c+f-1,0,"0."+e[f]);b[c]=parseFloat(d)}return b}var p=[];return b((new DOMParser).parseFromString(a,"image/svg+xml").documentElement,{fill:"#000"}),p}},GIM.SVGParser={loadTexture:function(a,b,c){var d=new THREE.TextureLoader;d.crossOrigin="Anonymous",d.load(a,function(a){var d=a.image.width,e=a.image.height,f=new THREE.SpriteMaterial({map:a,color:16777215,fog:!1,depthTest:!1,depthWrite:!1,sizeAttenuation:!1}),g=new THREE.Sprite(f);g.center=new THREE.Vector2(.5,0),g.renderOrder=1e20,g.width=d,g.height=e,g.sx=g.width/3e3,g.sy=g.height/3e3,g.scale.set(g.sx,g.sy,1),g.visible=!1,g.name=b,g.scaleRatio=d/e,c(g),a=null},null,function(a){console.log("loadTexture error :",a);var d=document.createElement("canvas"),e=64,f=64;d.width=64,d.height=64;var g=d.getContext("2d");g.fillStyle="rgba(255,255,255,+0.0001)",g.fillRect(0,0,e,f);var h=new THREE.Texture(d);h.needsUpdate=!0,h.minFilter=THREE.LinearFilter,h.generateMipmaps=!1;var i=new THREE.SpriteMaterial({map:h,color:16773120,fog:!1,sizeAttenuation:!1});i.map.repeat.set(1,1,0);var j=new THREE.Sprite(i);j.center=new THREE.Vector2(.5,0),j.width=e,j.height=f,j.scaleRatio=e/f,j.scale.set(e,f,1),j.visible=!1,j.name=b,d=null,c(j)})},loadURL:function(a,b,c){GIM.SVGParser.XHR(GIM.REMOTE_SERVER,b,function(a){c(a)})},smartURLLoader:function(a,b,c){var d=b+"~"+GIM.PID,e=d+"~Time",f=d+"~Data";if(localStorage)var g=localStorage.getItem(f),h=localStorage.getItem(e),i=Date.now()-h;if(MapConfigX.localServer)switch(console.log("localServer :",b,MapConfigX.localServer),b){case"areaType":GIM.SVGParser.XHR(MapConfigX.getAreaTypeURL,"",function(a){c(a)});break;case"GetMapBuildingInfo":GIM.SVGParser.XHR(MapConfigX.getMapBuildingURL,"",function(a){c(a)});break;case"getArea":GIM.SVGParser.XHR(MapConfigX.getAreaURL,"",function(a){c(a)});break;case"getPointInfo":GIM.SVGParser.XHR(MapConfigX.getPointURL,"",function(a){c(a)});case"getMapThroughGroup":GIM.SVGParser.XHR(MapConfigX.getMapThroughGroupURL,"",function(a){c(a)})}else i<3e5&&g&&g.length>100&&GIM.oneStepLoad,GIM.SVGParser.XHR(GIM.REMOTE_SERVER,a,function(a){c(a)})},XHR:function(a,b,c){var d;if("undefined"!=typeof XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)for(var e=["Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","Msxml2.XMLHttp.3.0","Msxml2.XMLHttp","Microsoft.XMLHttp"],f=0;f<e.length;f++)try{d=new ActiveXObject(e[f]);break}catch(a){}d.onreadystatechange=function(){4==this.readyState&&200==this.status?c(JSON.parse(this.responseText)):4==this.readyState&&(console.warn(" [Map] Load fail:",a+b),c(!1))},d.open("GET",a+b,!0),d.send()},loadLocalURL:function(a,b){GIM.SVGParser.XHR(a,"",function(a){b(a)})}},GIM.DisplayFloor3D=function(a,b,c,d){function e(a,b,c){a.faces.forEach(function(a,d){try{a.vertexColors[0].getHex()}catch(a){console.warn("[MAP] Cannot read property getHex of vertexColors")}if(!b)for(var e in q){var f=q[e];if(d>=f.faceRange[0]&&d<f.faceRange[1]){100;break}}a.materialIndex=0,1!==a.vertexNormals[0].z||c||(200,a.materialIndex=1)})}function f(){q=null;var a=c.floorOpacity.get(g.floorID)||c.opacity,b=a<1,d=new THREE.MeshLambertMaterial({vertexColors:THREE.VertexColors,depthTest:!1,flatShading:!0,shadowSide:THREE.BackSide,transparent:b,wireframe:!1,fog:!1,opacity:a});h.push(d);var f=new THREE.MeshLambertMaterial({combine:THREE.MixOperation,vertexColors:THREE.VertexColors,depthWrite:!0,flatShading:!0,shadowSide:THREE.BackSide,fog:!1,transparent:b,opacity:a});i.push(f);var j=new THREE.MeshBasicMaterial({transparent:b,vertexColors:THREE.VertexColors,shadowSide:THREE.BackSide,opacity:a});h.push(j),i.push(j),w=new THREE.Mesh(g.groundGeometry,i),w.name=g.name+"-ground";var k=new THREE.Mesh(g.courtyardGeometry,h);k.name=g.name+"-courtyardMesh",g.courtyardLayer.position.z=0,x=new THREE.Mesh(g.geometry,i),x.floorID=g.floorID,x.position.z=0,x.name=g.name+"-geometry",x.castShadow=!1,x.receiveShadow=!1,w.castShadow=!1,w.receiveShadow=!1;var l=new THREE.Mesh(g.elevationGeometry,h);if(l.floorID=g.floorID,l.position.z=0,l.name=g.name+"-elevationGeometry",c.showEdge){var m=new THREE.EdgesGeometry(g.geometry,60),n=new THREE.LineSegments(m,new THREE.LineBasicMaterial({linewidth:1,color:MapConfigX.edgeColor,depthWrite:!0,opacity:.5,transparent:!0,depthTest:!0}));n.renderOrder=g.renderOrder+41,g.polygonLayer.add(n)}w.renderOrder=g.renderOrder+10,k.renderOrder=g.renderOrder+20,x.renderOrder=g.renderOrder+30,g.textMarkerLayer.children.forEach(function(a){a.renderOrder="elevation"!=a.areaType?g.renderOrder+41:Math.pow(2,44)}),l.renderOrder=Math.pow(2,22),g.groundLayer.renderOrder=g.renderOrder,g.courtyardLayer.renderOrder=g.renderOrder,g.polygonLayer.renderOrder=g.renderOrder,g.elevationLayer.renderOrder=g.renderOrder,g.textMarkerLayer.renderOrder=g.renderOrder+1,g.markerLayer.renderOrder=g.renderOrder+2,g.facilityLayer.renderOrder=g.renderOrder+3,g.imageLayer.renderOrder=g.renderOrder+4,g.groundLayer.add(w),g.courtyardLayer.add(k),g.polygonLayer.add(x),g.elevationLayer.add(l),GIM.prototype.hitCheckMeshs.push(x),GIM.prototype.hitCheckMeshs.push(w),g.creationComplete=!0,e(g.geometry,!0),e(g.groundGeometry,!0),e(g.courtyardGeometry,!0),e(g.elevationGeometry,!0),g.labelPOIList.sort(function(a,b){return a.priority==b.priority?b.area-a.area:b.priority-a.priority})}THREE.Group.call(this),this.forceUpdate=c.forceUpdate,this.parkingData=[];var g=this;g.isCreated=!1,g.data=new GIM.FloorData(a),g.groundLayer=new THREE.Group,g.courtyardLayer=new THREE.Group,g.polygonLayer=new THREE.Group,g.facilityLayer=new THREE.Group,g.textMarkerLayer=new THREE.Group,g.markerLayer=new THREE.Group,g.imageLayer=new THREE.Group,g.staffLayer=new THREE.Group,g.elevationLayer=new THREE.Group,g.modelLayer=new THREE.Group,g.groundGeometry=new THREE.Geometry,g.courtyardGeometry=new THREE.Geometry,g.elevationGeometry=new THREE.Geometry,g.geometry=new THREE.Geometry,g.groundLayer.name="groundLayer",g.courtyardLayer.name="courtyardLayer",g.polygonLayer.name="polygonLayer",g.facilityLayer.name="facilityLayer",g.textMarkerLayer.name="textMarkerLayer",g.markerLayer.name="markerLayer",g.imageLayer.name="imageLayer",g.staffLayer.name="staffLayer",g.elevationLayer.name="elevationLayer",g.labelPOIList=[],g.facilityPOIList=[];var h=[],i=[];this.add(g.elevationLayer),this.add(g.groundLayer),this.add(g.courtyardLayer),this.add(g.polygonLayer),this.add(g.facilityLayer),this.add(g.textMarkerLayer),this.add(g.imageLayer),this.add(g.markerLayer),this.add(g.staffLayer),this.add(g.modelLayer),this.floorID=a.FloorID,this.name=a.Name,this.order=a.Order,this.frustumCulled=!0;var j=new THREE.Matrix4,k=new THREE.Quaternion,l=new THREE.Vector3,m=new THREE.Euler,n=new THREE.Vector3(1,1,1);k.setFromEuler(m,!1),j.compose(l,k,n);var o=g.data.unitsList,p=0,q=[],r=!1;if(g.renderOrder=1100*g.data.order,!b&&o){var s=o.length>300?300:100,t=0,u=+new Date,v=function(){function b(a,b){var c=b.points[0].distanceTo(b.points[1]),d=b.points[1].distanceTo(b.points[2]),e=b.points[c>d?0:1],f=b.points[c>d?1:2],g=Math.atan2(parseFloat(e.y-f.y),parseFloat(e.x-f.x)),h=new THREE.Vector3,i=new THREE.Quaternion,j=new THREE.Vector3;h.x=b.nodePosition.x,h.y=b.nodePosition.y,h.z=b.deep;var k=new THREE.Euler;k.z=g,i.setFromEuler(k),j.x=j.y=j.z=1,a.compose(h,i,j)}if(p>=o.length){TweenLite.ticker.removeEventListener("tick",v),f(),g.isCreated=!0;var e=c.floorCreatCompleteCallList[g.floorID];if(a.isCreated=!0,g.dispatchEvent({type:"CreatedCompleted",message:g.floorID}),e)for(;e.length;){var h=e.shift();h&&h(g)}d&&d(),setTimeout(function(){g.geometry.sortFacesByMaterialIndex(),g.geometry.elementsNeedUpdate=!0,g.geometry.groupsNeedUpdate=!0},300);var i=+new Date;if(console.warn(g.name,"ID: "+g.floorID,"-> 渲染用时共计"+(i-u)+"ms"),GIM.DEBUG_MODE&&console.log(g.name+" creationComplete",o.length,"faces:",0),g.parkingData&&g.parkingData.length&&MapConfigX.embedParkmodel&&r){var k=new THREE.Color;(new THREE.BufferGeometryLoader).load(MapConfigX.parkmodelURL,function(a){var c=new THREE.MeshPhongMaterial;c.transparent=!0,a.computeVertexNormals();var a=new THREE.PlaneBufferGeometry(30,14,2),d=new THREE.InstancedMesh(a,c,g.parkingData.length),e=0;g.parkingData.forEach(function(a){var c=new THREE.Matrix4;b(c,a),d.setMatrixAt(e,c),d.setColorAt(e,k.setHex(16777215*Math.random())),e++}),GIM.prototype.hitCheckMeshs.push(d),g.markerLayer.add(d)})}}else{(t=p+s)>o.length&&(t=o.length);var l=o.slice(p,t);for(var m in l){var n=l[m];if("function"!=typeof n)if(n.code==GIM.NODE_TYPE_CARPARK&&r)g.parkingData.push(n);else{var q=new GIM.DisplayUnit3D(n,g);q&&q.geometry?(n.code&&-1==n.code.search("ground")?"courtyard"==n.code||"elevation"==n.code?"courtyard"==n.code?g.courtyardGeometry.merge(q.geometry,j):g.elevationGeometry.merge(q.geometry,j):(q.geometry.faces.forEach(function(a){a.nodeId=n.nodeId}),g.geometry.merge(q.geometry,j),new GIM.DisplayModel(n.areaID,null,n,g.geometry,g)):q.geometry&&GIM.NODE_TYPE_ENTRANCE!=n.code&&g.groundGeometry.merge(q.geometry,j),q.geometry.faces=null,q.geometry.faceVertexUvs=null,q.geometry.vertices=null,q.geometry.colors=null,q.geometry.normals=null,q.geometry.uvs=null,q.geometry.dispose(),q.geometry=null,q=null):new GIM.DisplayModel(n.areaID,null,n,null,g)}}l=null,p+=s}};TweenLite.ticker.addEventListener("tick",v)}var w,x;this.updateFloorMaterial=function(a){w.material=a,w.needUpdate=!0},this.updateFloorDeep=function(a){g.groundGeometry.scale(1,1,a),g.groundGeometry.groupsNeedUpdate=!0,g.groundGeometry.colorsNeedUpdate=!0,g.groundGeometry.uvsNeedUpdate=!0},this.update=function(){},this.updateTextDirection=function(a){function b(b){b.children.forEach(function(b){if(b&&"Mesh"==b.type){var c=180*b.orgZ/Math.PI,d=(120+c+360)%360,e=(270+c+360)%360;a>Math.min(d,e)&&a<Math.max(d,e)?b.rotation.z=b.orgZ+Math.PI:(b.rotation.z=b.orgZ,b.rotation.y=0,b.rotation.x=0)}})}a%=360,a<0&&(a=360+a),b(g.textMarkerLayer),b(g.imageLayer)},this.updateMaterial=function(){for(var a=0;a<i.length;a++){var b=i[a];b&&(b.needsUpdate=!0)}for(var a=0;a<h.length;a++){var c=h[a];c&&(c.needsUpdate=!0)}},this.updateMeshScale=function(a){this.groundLayer.scale.set(a,a,a),this.courtyardLayer.scale.set(a,a,a),this.polygonLayer.scale.set(a,a,a)},this.updateOpacity=function(a){c.floorOpacity.set(this.floorID,a);for(var b=0;b<i.length;b++){var d=i[b];d&&(d.opacity=a,d.transparent=!0,d.needUpdate=!0)}g&&(g.textMarkerLayer.children.forEach(function(b){b.material&&(b.material.opacity=a)}),g.modelLayer.children.forEach(function(b){b&&void 0!==b.setOpacity&&b.setOpacity(a)}))},this.dispose=function(){for(console.log("[MAP] dispose",g.name),TweenLite.ticker.removeEventListener("tick",v),g.data=null,o=null,g.parent&&g.parent.remove(g);h.length;){var a=h.shift();a&&a.dispose()}for(;i.length;){var a=i.shift();a&&a.dispose()}for(this.children.forEach(function(a){for(;a.children.length;){var b=a.children.shift();switch(b.type){case"Mesh":b.geometry.faces=null,b.geometry.faceVertexUvs=null,b.geometry.vertices=null,b.geometry.colors=null,b.geometry.normals=null,b.geometry.uvs=null,b.geometry.dispose();var c=b.geometry.__directGeometry;c&&(c.normals=null,c.colors=null,c.vertices=null,c.uvs=null,c=null),b.geometry._bufferGeometry&&b.geometry._bufferGeometry.dispose();break;case"Sprite":-1==b.name.search("mark")&&(b.geometry.dispose(),b.material&&b.material.dispose())}}}),forceUpdate();g.labelPOIList.length;){var b=g.labelPOIList.shift();b&&(b.parent&&b.parent.remove(b),"TextMarker"==b.type?b.dispose():(b.material.dispose(),b.material.map.dispose(),b.geometry.dispose(),b.material.map=null,b.material=null),b=null)}for(;g.facilityPOIList.length;){var c=g.facilityPOIList.shift();-1==c.name.search("mark")&&(c&&(c.parent&&c.parent.remove(c),c.material.dispose(),c.geometry.dispose(),c.material=null,c=null))}for(;g.children.length;){var d=g.children.shift();d&&(g.remove(d),g.geometry.dispose())}g=null}},GIM.DisplayFloor3D.prototype=Object.create(THREE.Group.prototype),GIM.DisplayFloor3D.prototype.constructor=GIM.DisplayFloor3D,Object.defineProperties(GIM.DisplayFloor3D.prototype,{opacity:{get:function(){return this._opacity},set:function(a){this.updateOpacity(a),this._opacity=a}}}),GIM.DisplayModel=function(a,b,c,d,e){this.data=c,this.floor=e,this.faceRange=b,this.floorID=c.floorID,this.geometry=d,this.pointID=c.nodeId,this.orgColor=this.data.fill,this.orgText=this.data.shopName?this.data.shopName:this.data.name,this.push(this.pointID),this.allShop[c.shopID]=this,this._interactive=!0,this._visible=!0},GIM.DisplayModel.prototype={allArea:{},geoArea:{},allShop:{},allThreeID:{},areaNameMap:new Map,dispose:function(){this.allArea={},this.geoArea={},this.allShop={},this.allThreeID={},this.areaNameMap=new Map},recover:function(){this.setColor(this.orgColor)},setColor:function(a,b){if(a=a||9968681,b=void 0==b,!this.geometry||!this.geometry.faces)return console.warn("[Map setColor] geometry face is null");var c=this.pointID,d=this.geometry.faces.length,e=new THREE.Color(a);if(this.faceList)for(var f=0;f<this.faceList.length;f++)for(var g=this.faceList[f],h=0;h<3;h++)g.vertexColors[h].copy(e);else for(var g,f=0;f<d;f++)if(g=this.geometry.faces[f],g.nodeId==c)for(var h=0;h<3;h++)g.vertexColors[h].copy(e);1!=this.floor.isUpdating&&TweenLite.delayedCall(2,function(a){this.geometry.colorsNeedUpdate=!0,this.floor.update(),this.floor.forceUpdate(),this.floor.isUpdating=!1},[this],this,!0),b&&(this.data.fill=a),this.floor.isUpdating=!0},setText:function(a){var b=this.floor.textMarkerLayer.getObjectByName(this.pointID);if(null==a||void 0==a)return void(b&&(b.parent&&b.parent.remove(b),this.floor.labelPOIList.remove(b),b.geometry.dispose(),b.material.dispose()));if(b)b.text=a,b.name=this.pointID;else{var b=new GIM.TextMarker({fillStyle:"#5b6871",fontFamily:GIM.FONT_NAME,fontSize:30,fontWeight:"400",text:a,strokeStyle:"#FFFFFF",strokeWidth:MapConfigX.embedTextStroke?.15:0});b.center=new THREE.Vector2(.5,0),b.position.x=this.data.nodePosition.x,b.position.y=this.data.nodePosition.y,b.position.z=parseInt(this.data.deep)+2,b.name=this.pointID,b.renderOrder=this.floor.renderOrder+40,this.floor.textMarkerLayer.add(b),b.scale.set(b.width/200,b.height/200,1),this.floor.labelPOIList.push(b)}this.floor.forceUpdate()},push:function(a){this.allArea[a]=this},remove:function(a){delete this.allArea[a]},getAreaByShop:function(a){return this.allShop[a]},getAreaBySN:function(a){return this.areaNameMap.get(a)},getAreaByThree:function(a){return this.allThreeID[a]},clean:function(){this.allArea={}}},Object.defineProperties(GIM.DisplayModel.prototype,{interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a}},visible:{get:function(){return this._visible},set:function(a){a?(this.recover(),this.setText(this.orgText)):(this.setColor(9527),this.setText(null)),this._visible=a}}}),GIM.DisplayModel.prototype.constructor=GIM.DisplayModel,GIM.DisplayUnit3D=function(a,b){function c(){if("0"!=a.isShow){if(a.points&&a.points.length<3)return null;try{var b=new THREE.Shape(a.points),c=a.deep<1?1:a.deep;a.deep=c;var e={depth:c,steps:2,bevelThickness:2,bevelSize:12,bevelSegments:3,bevelEnabled:MapConfigX.bevelEnabled},f=new THREE.Color(a.fill);c<=GIM.maxFlatHeight?(this.geometry=new THREE.ShapeGeometry(b),a.deep=1):this.geometry=new THREE.ExtrudeGeometry(b,e),this.geometry.translate(0,0,a.gapHeight),b=null,d(this.geometry,f)}catch(a){}}}function d(a,b){a.faces.forEach(function(a){for(var c=a instanceof THREE.Face3?3:4,d=0;d<c;d++)a.vertexColors[d]=b})}function e(c,d){function e(c){var e=c.image.width,f=c.image.height;if(d){var g;g=MapConfigX.spriteMaterialMap.has(c)?MapConfigX.spriteMaterialMap.get(c):new THREE.SpriteMaterial({map:c,depthTest:MapConfigX.spriteDeepTest,depthWrite:!1,transparent:!0,opacity:.99});var i=new THREE.Sprite(g);g.sizeAttenuation=!1,i.width=e,i.height=f/3,i.scaleRatio=e/f,i.scale.set(e,f,1),i.sx=.02*MapConfigX.facilityScale,i.sy=.02*MapConfigX.facilityScale,i.scale.set(i.sx,i.sy,1),i.position.set(a.nodePosition.x+a.iconX,a.nodePosition.y-a.iconY,parseInt(a.deep+a.gapHeight)+2),i.visible=!1,i.center=new THREE.Vector2(.5,0),a.code==GIM.NODE_TYPE_FLOORLABEL&&(i.center=new THREE.Vector2(.5,.5)),b.facilityPOIList.push(i),b.facilityLayer.add(i),i.isFacility=!0,i.renderOrder=b.renderOrder+35,i.name=a.code+"_"+a.nodeId,i.isServiceLogo=!0,a.isServiceLogo=!0,i.data=a,i.type=a.code,i.areaType=a.code,GIM.prototype.hitCheckMeshs.push(i)}else{var j=new THREE.PlaneBufferGeometry(e*a.iconScale,f*a.iconScale,1),k=new THREE.MeshBasicMaterial({map:c,side:THREE.FrontSide,transparent:!0,depthTest:!1,depthWrite:!0}),l=new THREE.Mesh(j,k);MapConfigX.isJavaServer?(l.position.x=a.nodePosition.x+a.iconX,l.position.y=a.nodePosition.y-a.iconY):(l.position.x=a.centerPoint.x+a.iconX,l.position.y=a.centerPoint.y-a.iconY),l.position.z=parseInt(a.deep+a.gapHeight)+h,l.renderOrder=b.renderOrder+30,l.rotation.z=-a.iconRotate,l.orgZ=l.rotation.z,b.textMarkerLayer.add(l)}forceUpdate()}if(!(c&&c.length-c.lastIndexOf(".")>5||void 0==c)){if(c&&-1!=c.lastIndexOf("i?i=http")){var f=c.lastIndexOf("http");c=c.substring(f)}if(a.textMapping&&d&&i&&i.length>0)var g=new GIM.ImageMarker(c,a.nodePosition.x+a.iconX,a.nodePosition.y-a.iconY,parseInt(a.deep+a.gapHeight)+2,i,function(){g.material.depthTest=MapConfigX.spriteDeepTest,b.facilityPOIList.push(g),b.facilityLayer.add(g),g.isFacility=!0,g.sx=.02*MapConfigX.facilityScale,g.sy=.02*MapConfigX.facilityScale,g.scale.set(g.sx,g.sy,1),g.isServiceLogo=!0,g.height=g.height/3,g.data=a,g.type=a.code,g.areaType=a.code,g.renderOrder=1100*b.data.order+35,g.scaleRatio=g.width/g.height,g.visible=a.code==GIM.NODE_TYPE_MACHINE,g.center=new THREE.Vector2(.5,0),MapConfigX.LabelMuti.push(g)},40,MapConfigX.textFillStyle);else InstancedTexture(c,e)}}function f(c,d,e){var f=a.code;if(""!=c&&void 0!=a.points){var g=Math.abs(THREE.ShapeUtils.area(a.points));a.area=g;var i=.01,j=null;if((f==GIM.NODE_TYPE_ENTRANCE||f==GIM.NODE_TYPE_SECTION||"elevation"==a.code||"check in counter"==a.code)&&MapConfigX.embedSpecialTextBG){i=.99;j="#"+new THREE.Color(a.fill).getHexString()}var k;if(!MapConfigX.overrideTextStyle)if(a.textFill.includes("#"))k=a.textFill;else{var l=new THREE.Color(parseInt(a.textFill,16));k="#"+l.getHexString()}if(f!=GIM.NODE_TYPE_ROADMARK){var m=new GIM.TextMarker({fillStyle:k||MapConfigX.textFillStyle,bgColor:j,fontFamily:GIM.FONT_NAME,fontSize:30,fontWeight:"350",lineGap:1==GIM.OS.isPc?.5:.25,text:c,strokeStyle:"#FFFFFF",areaType:a.code,strokeWidth:MapConfigX.embedTextStroke?.1:0,src:"购物"==a.classify?GIM.ThemePath+"../shop.png":void 0==a.classify||a.classify.length<2?null:GIM.ThemePath+"../dine.png"});m.scale.set(1e-4,1e-4,1),m.material.depthTest=MapConfigX.spriteDeepTest,m.priority=d,m.sx=m.width/3500,m.sy=m.height/3500*2,m.scale.set(m.sx,m.sy,1),m.center=new THREE.Vector2(.5,.5),m.position.x=a.nodePosition.x,m.position.y=a.nodePosition.y,m.position.z=parseInt(a.deep+a.gapHeight)+h,m.renderOrder=101e3,m.area=g,f==GIM.NODE_TYPE_LIFT&&0!=a.centerPoint.x&&0!=a.centerPoint.y&&(m.position.x=a.centerPoint.x,m.position.y=a.centerPoint.y),b.textMarkerLayer.add(m),b.labelPOIList.push(m),"elevation"==a.code&&(m.areaType=a.code),m.name=a.nodeId,m.visible=!1,m.data=a,m.areaType=a.code,1==i&&(m.areaType=f,GIM.prototype.hitCheckMeshs.push(m)),1==e&&MapConfigX.LabelMuti.push(m)}else{var n=new THREE.TextTexture({fillStyle:k||MapConfigX.textFillStyle,fontFamily:GIM.FONT_NAME,fontSize:a.fontSize,fontWeight:"400",lineGap:1==GIM.OS.isPc?.5:.25,text:c,strokeStyle:"#FFFFFF",areaType:a.code,strokeWidth:MapConfigX.embedTextStroke?.15:0,src:"购物"==a.classify?GIM.ThemePath+"../shop.png":void 0==a.classify||a.classify.length<2?null:GIM.ThemePath+"../dine.png"});n.redraw();var o=new THREE.PlaneBufferGeometry(n.image.width,n.image.height,2),p=new THREE.MeshBasicMaterial({map:n,side:THREE.FrontSide,transparent:!0,flatShading:!0,opacity:1,depthTest:!1,depthWrite:!1}),q=new THREE.Mesh(o,p);q.position.x=a.nodePosition.x,a.textX,q.position.y=a.nodePosition.y,q.position.z=parseInt(a.deep+a.gapHeight)+1,q.rotation.z=-a.textRotate,q.orgZ=q.rotation.z,q.data=a,q.areaType=a.code,b.textMarkerLayer.add(q),1==e&&MapConfigX.LabelMuti.push(q)}}}function g(c,d,e){var f=new GIM.ModelMarker(c,d,e,function(){});f.rotation.z=a.modelRotate,f.interactive=!0,f.data=a,f.position.set(a.nodePosition.x,a.nodePosition.y,a.deep+a.gapHeight),b.modelLayer.add(f)}c=c.bind(this);var h=3,i="";if(a.model3dShow&&g(GIM.REMOTE_SERVER+a.modelUrl,a.modelZoom,b.renderOrder),!(MapConfigX.hideAreaTypes.filter(function(b){return a.code==b}).length>0)){if(a.textMapping&&"none"!=MapConfigX.labelViewModel)switch(GIM.showLabelType.toLowerCase()){case"No.".toLowerCase():case"number":i=a.name,f(i,1);break;case"shopName".toLowerCase():case"topName".toLowerCase():i=a.shopName||a.name,f(i,a.shopName?3:1);break;case"areaname":i=("en"==MapConfigX.lang?a.nameEN:a.nameZH)||a.name,f(i,2,!0);break;default:switch(a.textDispayType+""){case"1":i=a.shopName,f(i);break;case"2":i=a.name,f(i);break;case"3":i="en"==MapConfigX.lang?a.nameEN:a.nameZH,f(i,2,!0)}}if(!a.code||-1==a.code.search("action")&&-1==a.code.search("view95"))switch(a.code){case GIM.NODE_TYPE_GROUND:c(),this.geometry&&this.geometry.translate(0,0,-a.deep);break;case GIM.NODE_TYPE_SHOP:case GIM.NODE_TYPE_BULID:c(),a.iconMapping&&e(MapConfigX.isJavaServer?GIM.REMOTE_SERVER+a.logo:a.logo,!1);break;case GIM.NODE_TYPE_SECTION:break;case GIM.NODE_TYPE_ENTRANCE:case GIM.NODE_TYPE_ROADMARK:var j=GIM.AreaTypes[a.areaTypeID];if(j){var k=GIM.REMOTE_SERVER+j[MapConfigX.logoFiled];e(k)}break;case GIM.NODE_TYPE_DIRMARK:var j=GIM.AreaTypes[a.areaTypeID];if(j){var k=j[MapConfigX.logoFiled];e(k)}break;case GIM.NODE_TYPE_CARPARK:b.parkingData.push(a),c();break;case GIM.NODE_TYPE_TEXTMARK:c();break;default:if(GIM.AreaTypes&&""!=a.code){var j=GIM.AreaTypes[a.areaTypeID];if(j){var k=j[MapConfigX.logoFiled];k&&k.length>5&&1==j.MapVisible&&a.iconMapping?((GIM.NODE_TYPE_MACHINE!=a.code||MapConfigX.showIDSDevice)&&e(MapConfigX.isJavaServer?GIM.REMOTE_SERVER+k:k,!0),MapConfigX.facilityPanel&&"yzz"!==a.code&&c()):c()}else c()}else a.deep=20,c()}else c(),a.iconMapping&&e(GIM.REMOTE_SERVER+a.logo,!1);return this.data=a,this}},GIM.DisplayUnit3D.prototype.fills={},GIM.prototype.hitCheckMeshs=[],GIM.prototype.removeHitCheckMesh=function(a){this.hitCheckMeshs.remove(a)},GIM.Tip=function(a,b,c,d){function e(a,b,e){if(""!=a){var g=20,i=document.createElement("canvas"),j=i.getContext("2d");j.font=g+"px "+GIM.FONT_NAME;var k=Math.round(j.measureText(a).width);i.width=k+30,i.height=g+30,j.fillStyle="#6d7281",f(j,0,0,i.width-2,i.height-20,2,7172737),j.fillStyle="white",j.font=g+"px "+GIM.FONT_NAME,j.textAlign="center",j.fillText(a,i.width/2,i.height-27);var l=new THREE.Texture(i);l.needsUpdate=!0,l.minFilter=THREE.LinearFilter;var m=new THREE.SpriteMaterial({map:l,depthWrite:!1,depthTest:!1,sizeAttenuation:!1,fog:!1}),n=new THREE.Sprite(m);n.center=new THREE.Vector2(.5,0),n.renderOrder=d,n.scale.set(.001,.001,1),n.scaleRatio=i.width/i.height,n.height=i.height,n.name=a,h.add(n),n.targetfloorID=c,n.type=b,i=null}}function f(a,b,c,d,e,f,h){if(2*f>d||2*f>e)return!1;a.save(),a.translate(b,c),g(a,d,e,f),a.fillStyle=h||"#000",a.fillStyle="rgba(255, 50, 50,0.7)",a.fill(),a.restore()}function g(a,b,c,d){a.beginPath(0),a.arc(b-d,c-d,d,0,Math.PI/2),a.lineTo(b/2-10,c),a.lineTo(b/2,c+10),a.lineTo(b/2+10,c),a.arc(d,c-d,d,Math.PI/2,Math.PI),a.lineTo(0,d),a.arc(d,d,d,Math.PI,3*Math.PI/2),a.lineTo(b-d,0),a.arc(b-d,d,d,3*Math.PI/2,2*Math.PI),a.lineTo(b,c-d),a.closePath()}THREE.Object3D.call(this);var h=this;e(a,b,c)},GIM.Tip.prototype=Object.create(THREE.Object3D.prototype),GIM.Tip.prototype.constructor=GIM.Tip;var fontWeight="400";GIM.prototype.getTextTexture=function(a,b,c,d,e,f){var g=b||30,c=void 0==c?.001:c,h=document.createElement("canvas"),i=0;h.width=0,h.height=0;var j=h.getContext("2d");if(f&&MapConfigX.embedTextIcon&&void 0!=f){i=50;var k=new Image;k.onload=function(){j.drawImage(k,0,0)},k.src="购物"==f?GIM.ThemePath+"../shop.png":GIM.ThemePath+"../dine.png"}j.font="italic "+fontWeight+" "+g+"px "+GIM.FONT_NAME,j.fillStyle="black",j.strokeStyle="#FFFFFF",j.lineWidth=2,a.length>29&&(a=a.substring(0,29)+"...");var l=Math.round(j.measureText(a).width)+i;l=Math.min(512,l),h.width=l+4,h.height=g+10,j.fillStyle="rgba(255,255,255,+"+c+")",j.fillRect(0,0,h.width,h.height),j.fillStyle="#8c8c8c","#000000"==e&&(e="#5b6871"),e?"string"==typeof e&&(j.fillStyle=e.includes("0x")?e.replace("0x","#"):e):j.fillStyle="#5b6871",j.font=fontWeight+" "+g+"px "+GIM.FONT_NAME,j.fillText(a,2+i,g+2,512),d&&(j.clearRect(0,0,h.width,h.height),j.shadowBlur=0,h.width=h.width+10,h.height=g+10,j.font=fontWeight+" "+g+"px "+GIM.FONT_NAME,j.fillStyle="#66757F",j.fillStyle="#000000",j.fillRect(0,0,h.width,h.height),j.fillStyle="#FFFFFF",j.fillText(a,6,g+2,512)),j.fill(),j.stroke();var m=new THREE.Texture(h);return m.needsUpdate=!0,m.width=h.width,m.height=h.height,h=null,m};var globalCanvas=document.createElement("canvas");GIM.GroundLayer=function(){THREE.Object3D.call(this);var a=new THREE.SVGLoader,b=this;if(this.groundLayerFloor,this.setBoxVisible=function(a){if(a>3e3&&this.groundLayerFloor){var b=this.groundLayerFloor.elevationLayer.children[0];b&&(b.visible=(a-4e3)/1e3>1)}},"svg"==MapConfigX.groundURL.substring(MapConfigX.groundURL.length-3))a.load(MapConfigX.groundURL,function(a){var c=new THREE.Group;c.scale.y*=-1;for(var d=0;d<a.length;d++)for(var e=a[d],f=new THREE.MeshBasicMaterial({color:e.color,side:THREE.DoubleSide,depthWrite:!1}),g=e.toShapes(!0),h=0;h<g.length;h++){var i=g[h],j=new THREE.ShapeBufferGeometry(i),k=new THREE.Mesh(j,f);c.add(k)}b.add(c)});else{var c=new THREE.TextureLoader;c.crossOrigin="Anonymous",c.load(MapConfigX.groundURL,function(a){var c=new THREE.PlaneGeometry(a.image.width,a.image.height),d=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide,depthWrite:!1,transparent:!0}),e=new THREE.Mesh(c,d);e.position.z=-10,e.position.x=a.image.width/2,e.position.y=-a.image.height/2,e.renderOrder=0,b.add(e)})}},GIM.GroundLayer.prototype=Object.create(THREE.Object3D.prototype),GIM.GroundLayer.prototype.constructor=GIM.GroundLayer,GIM.HeatMap=function(a,b){function c(a){for(var c=[],d=new THREE.BufferGeometry,f=[],g=0;g<100;g++){var h=2e3*Math.random()+1e3,i=1e3*-Math.random()-2e3;f.push(h,i,10)}d.setAttribute("position",new THREE.Float32BufferAttribute(f,3));for(var j=[[[2.4,1,.6],e,19]],g=0;g<j.length;g++){var k=(j[g][0],j[g][1]),l=j[g][2];c[g]=new THREE.PointsMaterial({size:l,map:k,depthTest:!1,transparent:!0,sizeAttenuation:!1});var m=new THREE.Points(d,c[g]);b.add(m)}}for(THREE.Object3D.call(this);b.children.length;)b.children[0]&&b.remove(b.children[0]);var d=new THREE.TextureLoader,e=d.load("/theme/person.png",c)},GIM.HeatMap.prototype=Object.create(THREE.Object3D.prototype),GIM.HeatMap.prototype.constructor=GIM.HeatMap,GIM.ImageMarker=function(a,b,c,d,e,f,g,h){function i(a){(new THREE.ImageLoader).load(a,function(a){var b=document.createElement("canvas"),c=b.getContext("2d"),d=0,e=0;if(n&&n.length){c.font="400 "+m+"px "+GIM.FONT_NAME;var g=Math.round(c.measureText(n).width),i=0;g<a.width?(b.width=a.width,i=(b.width-g)/2):(b.width=g,e=(g-a.width)/2),d=m+m/5,b.height=a.height+d,c.fillStyle="rgba(255,255,255,+0.01)",c.fillRect(0,0,b.width,38),c.fillStyle=h||"#6d7281",c.font="400 "+m+"px "+GIM.FONT_NAME,c.fillText(n,i,"top"==o?m:b.height-m/5),c.fill()}else b.width=a.width,b.height=a.height;c.drawImage(a,e,"top"==o?d:0,a.width,a.height);var j=new THREE.Texture(b);j.needsUpdate=!0,null!=l&&void 0!=l&&(l.material&&l.material.map&&l.material.map.dispose(),l.material.map=j,l.material.needsUpdate=!0,clearTimeout(window.timer008),window.timer008=setTimeout(function(){clearTimeout(window.timer008),updateSpriteSize072(),forceUpdate()},30),l.width=b.width,l.height=b.height,f&&"function"==typeof f?f(l):l.isFacility&&(l.height=b.height/3),l.scaleRatio=b.width/b.height,forceUpdate(),j.needsUpdate=!1,j.dispose(),b=null)},void 0,function(){console.error("loaderImage error url.",a)})}function j(a){l&&(l.visible=!l.visible)}var k=new THREE.SpriteMaterial({depthWrite:!1,depthTest:!1,sizeAttenuation:!1,transparent:!0,opacity:.99});THREE.Sprite.call(this,k),h&&"string"==typeof h&&h.includes("0x")?(h=parseInt(h,16),h="#"+new THREE.Color(h).getHexString()):"number"==typeof h&&(h="#"+new THREE.Color(h).getHexString()),this.type="ImageMarker",this.isImageMark=!0,this.scale.set(1e-4,1e-4,1),this.center=new THREE.Vector2(.5,0),this.interactive=!0;var l=(this.extra=this.data=arguments,this),m=g||30,n=this.label=e||"",o="top1";this.updateImage=function(a){l.imageURL=a,i(a)},this.updateLabel=function(a){l.label=n=a,f=null,i(l.imageURL)},this.updateImage(a),this.position.x=b,this.position.y=-Math.abs(c),this.position.z=d,this.moveTo=function(a,b,c,d,e,f){function g(){h%8==0&&f&&f(),h++}d=d||1;var h=1;TweenLite.to(l.position,d,{x:a,y:-Math.abs(b),z:c,onUpdate:g,onComplete:e,ease:Power0.easeNone})},this.inPolygon=function(a){return rayCasting({x:l.position.x,y:-l.position.y},a)},this.dispose=function(){l&&(GIM.prototype.removeHitCheckMesh(this),GIM.DEBUG_MODE&&console.log("ImageMarker >> dispose() :",l),l.parent&&l.parent.remove(l),l.material&&l.material.dispose(),l.geometry&&l.geometry.dispose())},this.scaleX=function(a){l.scale.x=a},this.scaleY=function(a){l.scale.y=a};var p;this.flicker=function(a){a?p=setInterval(j,400):(clearInterval(p),l.visible=!0,l.position.z=d)}},GIM.ImageMarker.prototype=Object.create(THREE.Sprite.prototype),GIM.ImageMarker.prototype.constructor=GIM.ImageMarker,Object.defineProperty(GIM.ImageMarker.prototype,"url",{get:function(){return this.imageURL},set:function(a){this.updateImage(a)}}),Object.defineProperty(GIM.ImageMarker.prototype,"text",{get:function(){return this.label},set:function(a){this.updateLabel(a)}}),Object.defineProperty(GIM.ImageMarker.prototype,"scaleVal",{get:function(){return this._sacleVal?this._sacleVal:1},set:function(a){this._sacleVal=a}}),Object.defineProperty(GIM.ImageMarker.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,a?GIM.prototype.hitCheckMeshs.push(this):GIM.prototype.hitCheckMeshs.remove(this)}}),GIM.Object3D=THREE.Object3D,Object.defineProperties(THREE.Object3D.prototype,{x:{get:function(){return this.position.x},set:function(a){this.position.x=a,forceUpdate()}},y:{get:function(){return Math.abs(this.position.y)},set:function(a){this.position.y=-Math.abs(a),forceUpdate()}},z:{get:function(){return this.position.z},set:function(a){this.position.z=a,forceUpdate()}}});var logDBF=!1;GIM.Map3D=function(a){function b(){wb&&(s(),Qa.setPolarAngle(60),fa(10),X(),Qa.move2Point(Qa.defaultCenterPoint,"reset"))}function d(a,b,c){Array.isArray(a)||(a=[a]),MapConfigX.multiFloorView&&1==a.length&&Pb.length>1&&s();var d=b||!1;if(a==jb)return $a[jb].visible=!0,void yb.add($a[jb]);for(var e in $a){var f=$a[e];f.scale.set(1,1,1),e!=jb?(f.visible=!1,yb.remove(f)):(a.length,f.visible=!1,yb.add(f)),Ba||(f.position.z=vb)}if(1==a.length){if(a[0]==jb)return;if(!$a[a[0]]){var g=function(a){c&&c(a),$()};return void U(a[0],g,!0,d)}}var h=!1;if(null===_a&&(_a=a.map(function(a){return a.toString()})),1===a.length){if(_a.length>0)var i=_a[0],j=$a[i];var k=a[0],l=$a[k];if(j&&(Ba||(j.visible=!0),yb.add(j),TweenLite.killTweensOf(j)),l&&(TweenLite.killTweensOf(l),Ba||(l.visible=!0),yb.add(l)),l&&j&&j.name!==l.name){h=parseInt(j.order)>parseInt(l.order),j.position.z=0;var m=2;Ba||(l.position.x=h?ub/m:vb/m),l.pathCenter&&MapConfigX.pathCenter?MapConfigX.multiFloorView||Qa.move2Point(l.pathCenter,"showFloor"):d&&(MapConfigX.multiFloorView||Qa.move2Point(Qa.defaultCenterPoint,"showFloor")),TweenLite.to(j.position,Ba?0:.6,{x:h?vb/m:ub/m,y:0,onComplete:function(){j.visible=!1,yb.remove(j)}}),Ma?(l.opacity=.2,TweenLite.to(l,.6,{opacity:Qa.opacity||Qa.floorOpacity.get(l.floorID),onComplete:function(){_()}})):(l.opacity=Qa.opacity||Qa.floorOpacity.get(l.floorID),TweenLite.delayedCall(.6,_)),l.visible=!0,TweenLite.to(l.position,Ba?.1:.7,{x:0,z:0,y:0,onComplete:function(){j.position.z=vb,l.position.set(0,0,0),$()}})}else l&&(l.position.set(0,0,0),TweenLite.to(l.position,Ba?.1:.7,{x:0,z:0,y:0}),l.visible=!0,l.facilityLayer.visible=!0,l.textMarkerLayer.visible=!0,l.imageLayer.visible=!0,TweenLite.to(l,.6,{opacity:Qa.opacity||Qa.floorOpacity.get(l.floorID),onComplete:function(){_(),$(),c&&"function"==typeof c&&c(a)}}),l.pathCenter&&MapConfigX.pathCenter?MapConfigX.multiFloorView||Qa.move2Point(l.pathCenter,"showFloor"):d&&Qa.move2Point(Qa.defaultCenterPoint,"showFloor"))}else if(a.length>=2){for(var n=[],o=0;o<a.length;o++){var e=a[o];if($a.hasOwnProperty(e)){var p=$a[e];n.push(p)}else U(e)}n=n.sort(function(a,b){return a.order>b.order?1:a.order<b.order?-1:0});var q=Math.floor(n.length/2),r=2==n.length?MapConfigX.floor2Gap:MapConfigX.floorMultiGap;n.forEach(function(b,d){if(b){var e=.99;if(b.visible=!0,yb.add(b),e-=Math.abs(d-q)/10,b.opacity=.99,2==n.length)var f=1==d?r/2:-r/2;else f=r*(d-q);var g=function(){Z(),$(),c&&"function"==typeof c&&d==a.length-1&&c(a)};TweenLite.killTweensOf(b.position),TweenLite.to(b.position,.7,{z:f,x:0,onComplete:g})}})}void 0!=$a[jb]&&Ba&&(l&&l.name.includes("B")?$a[jb].visible=!1:Array.isArray(a)&&1==a.length&&($a[jb].visible=!0)),_a=a.map(function(a){return a.toString()}),Ic&&Ic(a),X()}function j(a,b,c,d){GIM.pathPriority=b||GIM.normalFirst,s(!1);var e="startNodeId or endNodeId is null",f=Qa.startPID,g=Qa.endPID;lb=0;var h=GIM.Points[f],i=GIM.Points[g];if(!i||!h)return e="Path Download Error or startNodeId.endNodeId is null or not find ",Mb.msg=e,Mb.startNodeId=f,Mb.endNodeId=g,Mb.startNode=h,Mb.endNode=i,void(a&&a(Mb));if(Qa.startNode.floorID=h.FloorID,Qa.endNode.floorID=i.FloorID,!f||!g)return Mb.msg=e,Mb.startNodeId=f,Mb.endNodeId=g,void(a&&a(Mb));if(Pb=[],Zb=0,bc=Qa.navigation.searchPath(f,g),GIM.DEBUG_MODE&&console.log("path :",bc,GIM.Points[f],GIM.Points[g]),!bc||0==bc.length)return e="can not find path",Mb.msg=e,void(a&&a(Mb));if(c)return void a(bc);void 0==d&&!1!==d&&(d=!0);var j=Qa.getPolygonCrossPoint(bc),n=GIM.Points[g];if(j&&d){for(j.Code=n.Code,j.Name=n.Name,j.FloorID=n.FloorID,j.y=Math.abs(j.y);j.count--;)bc.pop();bc.push(j)}var o=h.x-i.x,p=-h.y+i.y,q=(Math.atan2(p,o),{}),r="",t=[],u=[];bc.forEach(function(a){r!=a.FloorID&&(r=a.FloorID,Pb.push(a.FloorID),u=[],u.floorID=a.FloorID,t.push(u)),u.push(a);var b=q[a.FloorID];b?b.push(a):(q[a.FloorID]=[],q[a.FloorID].push(a))}),_b=surplusDistance=GIM.prototype.calcDistance(bc)/Qa.pixelPerMeter,ac=GIM.prototype.calcDistance([bc[0],bc[bc.length-1]])/Qa.pixelPerMeter,Qb=[],Cb=!0,Ib={},hc=0;for(var v=0;v<Pb.length;v++){var w=Pb[v],x=t[v];l(x,v,a),$a[w]?m(x,v,a):k(w,x,v,a)}}function k(a,b,c,d){function e(a,b,c){return function(){m(a,b,c)}}U(a,e(b,c,d))}function l(a,b){for(var c=a,d=c.floorID,e=[],f=0;f<c.length;f++){var g=c[f],h=new THREE.Vector3(g.x,-g.y,logDBF?1:Qa.pathElevation);h.code=g.Code,h.floorID=d,h.pointID=g.PointID,e.push(h)}var i=o(e,b==Pb.length-1);if(Ib[d]=i,Nb[b]={points:i.newSteps,floorID:d,length:GIM.prototype.calcDistance(i.newStepPoints)/Qa.pixelPerMeter},Jb[b]=i,0==b)for(var j=i.setpList.concat();j.length;){var k=j.shift(),l=k[0],m=k[k.length-1],n=180*Math.atan2(parseFloat(Math.abs(m.y)-Math.abs(l.y)),parseFloat(m.x-l.x))/Math.PI,p={},q=parseInt(MapConfigX.deviceFaceAngel+n)%360;return q<0&&(q=180+(180+q)),p.corners=q,p.turn=q>225&&q<315?"forward":q>45&&q<=135?"backward":q>135&&q<=225?"left":"right",void(i.deviceFace=p)}}function m(a,b,c){Zb++;for(var e,f,g=a,h=g.floorID,i=$a[h],j=g,k=[],l=0;l<j.length;l++){var m=j[l],o=new THREE.Vector3(m.x,-m.y,logDBF?1:Qa.pathElevation);o.code=m.Code,o.floorID=h,o.pointID=m.PointID,k.push(o)}var q=GIM.prototype.calcDistance(k);e=k[0],f=k[k.length-1];var r=Qa.getMarkerLayer(h),s=new GIM.ImageMarker(GIM.ThemePath+"../startDot@3x.png",e.x,e.y,e.z,"",null,{x:20,y:0});s.center=new THREE.Vector2(.5,.5),s.name="dot",s.interactive=!1,r&&r.add(s);var t=new GIM.ImageMarker(GIM.ThemePath+"../endDot@3x.png",f.x,f.y,f.z,"",null,{x:20,y:0});t.center=new THREE.Vector2(.5,.5),s.scaleVal=t.scaleVal=.5,t.name="dot",t.interactive=!1,r&&r.add(t),Qb.push(s),Qb.push(t);var u=e.clone().lerp(f.clone(),.5);i&&(i.pathCenter=u),1==Pb.length&&MapConfigX.pathCenter&&!MapConfigX.multiFloorView&&Qa.move2Point(u,"drawPathInFloor");var v=p(k,q,GIM.PATH_COLOR,!0);v.renderOrder=i.renderOrder+15,i.add(v);var w,x=null,y=null;if(MapConfigX.embedTextTip){var z="来自";switch(MapConfigX.lang){case"en":z="From ";break;case"zh-hant":z="來自"}var A="floorTip",B=k[k.length-1];if(0==b&&Pb.length>1)w=Pb[1],x=GIM.codeToText(B)+vc[w].Name,y=new GIM.Tip(x,A,w,v.renderOrder+50),y.name=A,y.floorID=h,y.position.copy(B),i.facilityLayer.add(y);else if(b==Pb.length-1&&Pb.length>1)w=Pb[Pb.length-2],x=z+vc[w].Name,y=new GIM.Tip(x,A,w,v.renderOrder+50),y.floorID=h,y.name=A,y.position.copy(k[0]),i.facilityLayer.add(y);else if(Pb.length>2){var C=Pb.indexOf(h);C=b,w=Pb[C-1],vc[w]&&(x=z+vc[w].Name);var D=new GIM.Tip(x,A,w,v.renderOrder+50);D.floorID=h,D.name=A,D.position.copy(k[0]),i.facilityLayer.add(D),GIM.prototype.hitCheckMeshs.push(D),Qb.push(D),D.position.setZ(50);var E=Pb[C+1];vc[E]&&(x=GIM.codeToText(B)+vc[E].Name),y=new GIM.Tip(x,A,E,v.renderOrder+50),y.floorID=h,y.name=A,y.position.copy(B),i.facilityLayer.add(y)}y&&(GIM.prototype.hitCheckMeshs.push(y),y.position.setZ(80),Qb.push(y))}v.floorIndex=b,Qb.push(v),pb=0,ob=0,cc=null,Zb==Pb.length&&(Lb.dis=_b,Lb.realDis=ac,Lb.path=bc,Lb.stepDetails=Jb,Lb.floorIDs=Pb.slice(),Lb.pixelPerMeter=Qa.pixelPerMeter,c&&c(Lb),MapConfigX.multiFloorView&&Pb.length>1?d(Pb.slice(),!1,function(){n(Jb,Pb.slice())}):d(Pb.slice(),!1,function(){})),Z(),X()}function n(a,b){var c=[],d=null,e=null;for(var f in a){var g=a[f],h=g.floorID,i=g.newStepPoints[0].clone();i.floorID=h,d&&(i.previousFloorID=d,i.previousPoint=e,c.push(i)),d=h,e=g.newStepPoints[g.newStepPoints.length-1].clone()}var j=0;c.forEach(function(a){var b=a.previousPoint.clone();b.z=$a[a.previousFloorID].position.z;var c=a.clone();c.z=$a[a.floorID].position.z;var d=p([b,c],Math.abs(c.z-c.z),GIM.PATH_COLOR,!0,!1);d.renderOrder=$a[a.previousFloorID].renderOrder,d.endNode=a,d.floorIndex=j+.5,j++,yb.add(d),Qb.push(d)})}function o(a,b){Eb=[];var c,d=a[0];d.turn="start",Eb.push([d]);for(var e=a.slice(),f=1;f<e.length-1;f+=1){var g=e[f-1],h=e[f],i=e[f+1],j=GIM.Calc3PAngel(g,h,i),k=j.corners;switch(h.angel=k,h.turn=j.turn,h.id=f,j.turn){case"Left":case"LeftFront":case"Right":case"RightFront":Eb.length&&Eb[Eb.length-1].push(h),Eb.push([h]);break;default:Eb.length&&Eb[Eb.length-1].push(h)}d=h}if(Eb.length){var l=a[a.length-1];"shop"==l.code?l.turn="end":l.turn=l.code,b&&(l.turn="end"),c=l.turn,Eb[Eb.length-1].push(l)}var m=[],n=[];routeDscription=[],Eb.forEach(function(a,b){if(a.length>5)for(var c=1;c<a.length-1;c+=1){var d=a[c-1],e=a[c],f=a[c+1],g=GIM.Calc3PAngel(d,e,f);if(Math.abs(g.corners)>5&&d.distanceTo(e)>MapConfigX.naviOPatchDis){GIM.DEBUG_MODE&&Qa.addBoxMark(e,1118481);var h={distance:d.distanceTo(e)/Qa.pixelPerMeter,turn:g.turn,point:e,corners:g.corners,patch:!0};routeDscription.push(h)}}var i=Math.round(GIM.prototype.calcDistance(a)/Qa.pixelPerMeter),j=a[a.length-1],k=GIM.NaviInfoUtils.getPoiByRadius(j,j.floorID,MapConfigX.naviTipTypes),l={distance:i,turn:j?j.turn:0,point:j,corners:j.corners,patch:!1,nearPoi:k};routeDscription.push(l),GIM.DEBUG_MODE&&Qa.addBoxMark(l.point,16777215*Math.random());var o=E(a,10).reverse();m.push(o),n=n.concat(o)});var o={};return o.newSteps=m,o.setpList=Eb,o.target=c,o.newStepPoints=n,o.routeDscription=routeDscription,o.floorID=d.floorID,o}function p(a,b,c,d){a&&a.length>3&&(a=new GIM.roundedCornerLine(a.slice(),2,5)),d&&a.length>=2&&(a=E(a,10),a.reverse());var e=new THREE.Geometry;e.vertices=a;var f="canvasID",g=ea(f);nb=new THREE.Texture(g),nb.needsUpdate=!0,nb.wrapS=nb.wrapT=THREE.RepeatWrapping,nb.repeat.set(.08,.08);var h=new THREE.Vector2(Ra,Sa),i=new MeshLine;i.setGeometry(e);var j=new THREE.Color(c),k=new THREE.Color(6710886),l=10*Qa.pathGap/b;$b=a.length/Qa.pathGap;var m=new MeshLineMaterial({map:nb,useMap:!0,color:j,passColor:k,resolution:h,lineWidth:GIM.pathWidth,near:Za.minDistance,far:Za.maxDistance,depthWrite:!0,depthTest:!0,dashArray:l,dashRatio:0,dashOffset:0,transparent:!0,opacity:.99,passColorScale:0,side:THREE.DoubleSide,repeat:new THREE.Vector2($b,1),sizeAttenuation:!1}),n=new THREE.Mesh(i.geometry,m);return n.name="line2",n}function q(){if(Pb&&!(Pb.length<1)){var a=Qa.startNode.floorID,b=Qa.endNode.floorID;if(gb=Pb[fc],Ib.hasOwnProperty(gb)&&fc!=qb&&(Db=Jb[fc].newSteps,Eb=Jb[fc].setpList,sb=Jb[fc].routeDscription,ic=GIM.prototype.calcDistance(Jb[fc].newStepPoints)/Qa.pixelPerMeter,jc=0,cc=null,rb=0,qb=fc),Kb=.17/Qa.simulateMoveSpeed,ec=!1,!Gc)return void clearInterval(dc);if(!(0==Db.length||ob>Db.length)){var c=Db[ob],e=c.length;if(pb>=e&&(pb=0,ob++),ob>=Db.length){if(ob=0,pb=0,ec=!0,!(fc<Pb.length-1))return Bb=!1,cc=null,qb=-1,Qa.hideLocationMark(),hc=0,ga(),sc&&sc.fadeToAction("Yes",.2),Pa&&Pa(),void clearInterval(dc);fc++,rb=0,gb=Pb[fc],Db=Jb[fc].newSteps,Eb=Jb[fc].setpList,jc=0,cc=null;var f={nextFloorID:gb,nextFloorName:vc[gb]?vc[gb].Name:"",pass:Eb[0][0].code};gc=gb,za&&za(f),MapConfigX.multiFloorView||d([gb]),Kb=1.5}c=Db[ob],e=c.length;var g=c[pb],h=sb[rb];if(g){0==ob&&0==pb||ec?Qa.setLocation(g,MapConfigX.simulateMove,!0):Qa.setLocation(g);var i=Eb[ob],j=i[i.length-1];if(j){var k=j.z-g.z,l={},m=0;if(Math.abs(k)<5){m=new THREE.Vector2(j.x,j.y).distanceTo(new THREE.Vector2(g.x,g.y));new THREE.Vector2(h.point.x,h.point.y).distanceTo(new THREE.Vector2(g.x,g.y))<1&&rb<sb.length-1&&rb++}if(cc){var n=g.distanceTo(cc)/Qa.pixelPerMeter;hc+=n,jc+=n}l.z=k,l.dis=m/Qa.pixelPerMeter,l.turn=j.turn,l.pointID=j.pointID,l.loopIndex=ob,l.insideIndex=pb,l.insideLoopLen=e,l.pathFloorIndex=fc,l.surplusDistance=Math.floor(_b)-Math.floor(hc),l.passingDis=hc,l.distance=_b,l.textTipCount=rb,l.nextFloorID=fc<Pb.length-1?Pb[fc+1]:b;var o=Ib[j.floorID].target;l.floorTarget=o,l.floorID=gb,za&&za(l,a),r(gb,jc/ic,fc)}}if(cc&&g.distanceTo(cc)>.2){var p=Math.atan2(g.y-cc.y,g.x-cc.x)-Math.PI/2;p=p>0?p:Math.PI+(Math.PI+p),Na&&Qa.setAzimuthalAngle(180*p/Math.PI),Qa.locationMarkRotation(p)}pb++,cc=g,TweenLite.delayedCall(Kb,q)}}}function r(a,b,c){for(var d=0;d<Qb.length;d++){var e=Qb[d];switch(e.name){case"line2":var f=e.material.uniforms;c==e.floorIndex?f&&(f.passColorScale.value=b,e.material.needsUpdate=!0):c>e.floorIndex&&(f.passColorScale.value=1,e.material.needsUpdate=!0)}}}function s(a){X(),Ib={},Jb={},Nb={},qb=-1,TweenLite.killDelayedCallsTo(q),clearInterval(dc),yb.remove(yb.getObjectByName("line")),eb&&Bb&&(eb.visible=!1),sc&&(sc.visible=!1),Cb=!1,Bb=!1,Gc=!1,a&&(Qa.clearEndArea(),Qa.clearStartArea(),Qa.endPID=null,Qa.startPID=null),cb&&(cb.parent.remove(cb),cb=null);for(var b=0;b<Qb.length;b++){var c=Qb[b];switch(c.parent&&(c.parent.pathCenter=null),c.name){case"floorTip":c.children[0].material.dispose(),GIM.prototype.removeHitCheckMesh(c),c.parent.remove(c),c=null;break;case"line2":c.material.dispose(),c.geometry.dispose(),c.parent.remove(c),c=null;break;case"dot":c.dispose(),c=null}}Qb=[];for(var d in $a)if($a.hasOwnProperty(d)){var e=$a[d];e.pathCenter=null;var f=e.getObjectByName("floorTip");f&&(f.children[0].material.dispose(),GIM.prototype.removeHitCheckMesh(f),e.remove(f),f=null);var g=e.getObjectByName("line2");g&&(g.material.dispose(),g.geometry.dispose(),e.remove(g),g=null)}pathAnimatePointMeshes=[],Db=[],a&&Qa.move2Point(Qa.defaultCenterPoint,"clearPath")}function t(a,b){GIM.DEBUG_MODE&&console.log("Map3D.setSize:",a,b),Ra=a||20,Sa=b||20,Ta=.5*Ra,Ua=.5*Sa,Xa.camera.aspect=Ra/Sa,db&&db.setSize&&db.setSize(Ra,Sa),Xa.camera.updateProjectionMatrix(),Va&&Va.setSize(Ra,Sa),bb=oa.getBoundingClientRect(),Wa.background&&void 0!=Wa.background.name&&Wa.background.repeat.set(Ra/Sb*GIM.bgScale,Sa/Tb*GIM.bgScale),Va&&(Ub=window.devicePixelRatio)>2&&(Ub=2),X()}function u(a){return GIM.DisplayModel.prototype.allArea[a]}function v(a,b,c){var e=u(a);if(e){if(!e.interactive)return void ta(null,null,Vb);if(Qa.multipleSelectionMode||A(),Qa.multipleSelectionMode){var f=Vb.find(function(b){return b.nodeId==a});if(f)return e.setColor(f.fill),Vb.remove(f),Qa.mark.visible=!1,void(ta&&ta(e.data,null,Vb.concat()));Vb.push(e.data)}else Vb=[e.data];Qa.mark&&(Qa.mark.pointID=a,ha(e.data.nodePosition,Qa.mark,e.floorID)),e.setColor(Qa.selectedColor,!1),ta&&ta(e.data,null,Vb.concat()),_a&&(_a.length>1||-1==_a.indexOf(e.floorID))&&b?(Qa.focusSelect&&Qa.move2Point(e.data.nodePosition,"selectByAreaID"),MapConfigX.multiFloorView&&0!=Qa.getFloorByID(e.floorID).visible||d([e.floorID])):b&&"undefined"!=b&&Qa.focusSelect&&Qa.move2Point(e.data.nodePosition,"selectByAreaID"),Qa.currentSelectUint3DID=a,zb=a}else if(c){var g=function(){v(a,!0)};U(c,g,!0)}else{var g=function(){v(a,!0)},h=tc[a];h&&U(h.FloorID,g,!0)}}function w(a,b,c){var e=b||!0,f=u(a);if(f)return Qa.endMark.visible=!1,ha(f.data.nodePosition,Qa.endMark,f.floorID),_a.length>1||-1==_a.indexOf(f.floorID)&&e?MapConfigX.multiFloorView||d([f.floorID]):e&&"undefined"!=e&&Qa.focusSelect&&Qa.move2Point(f.data.nodePosition,"setEndArea"),Qa.endPID=f.pointID,Qa.endNode.floorID=f.floorID,f.pointID;c&&(d([c]),TweenLite.delayedCall(1,function(){v(a,!0)}))}function x(a,b,c,d){var e,f=1e11,g=a||{x:eb.position.x,y:eb.position.y},h=b||eb.floorID,i=Math.abs(g.y);if(g&&h)for(var j in GIM.Points)if(GIM.Points.hasOwnProperty(j)){var k=GIM.Points[j];if(MapConfigX.isJavaServer){if(d&&""!=k.Code)continue}else if(d&&"0"!=k.Code)continue;if(h==k.FloorID){var l=new THREE.Vector2(g.x,i).distanceTo(new THREE.Vector2(k.x,k.y));l<f&&l<1e3&&(f=l,e=k)}}return e?(GIM.DEBUG_MODE&&Qa.addBoxMark(new THREE.Vector3(e.X-GIM.OFFSET,-e.Y+GIM.OFFSET,40)),c||(Qa.startNode.pointID=e.PointID,Qa.startNode.floorID=e.FloorID),e.PointID):null}function y(a,b){var c=b||!0,e=u(a);return e?(Qa.startMark.visible=!1,ha(e.data.nodePosition,Qa.startMark,e.floorID),_a.length>1||-1==_a.indexOf(e.floorID)&&c?MapConfigX.multiFloorView||d([e.floorID]):c&&"undefined"!=c&&Qa.focusSelect&&Qa.move2Point(e.data.nodePosition,"setStartArea"),Qa.startPID=e.pointID,Qa.startNode.floorID=e.floorID,e.pointID):null}function z(a,b,c){bb=Va.domElement.getBoundingClientRect(),tb.x=(a-bb.left)/bb.width*2-1,tb.y=-(b-bb.top)/bb.height*2+1,tb.z=.5,ab.setFromCamera(tb,db);var e=ab.intersectObjects(GIM.prototype.hitCheckMeshs,!0),f={};if(f.mouseX=a,f.mouseY=b,f.containerRect=bb,f.intersects=e,e.length>0){var g=e.map(function(a){function b(a){for(var b={},c=["x","y","z"],d=3*a;d<3*a+3;d++)b[c[d%3]]=h[d];return b}if(a.object.parent&&a.object.parent.parent&&a.object.parent.parent.visible&&-1!=a.object.name.search("ground")&&(f.x=a.point.x-yb.position.x,f.y=a.point.y-yb.position.y),"ModelMarker"==a.object.type){var c=a.face,d=c.a,e=c.b,g=c.c,h=a.object.geometry.attributes.position.array;f.faceA=b(d),f.faceB=b(e),f.faceC=b(g)}return a.object.data});ua&&!c&&ua(f);var h=g.filter(function(a){return void 0!=a}),i=e[0],j=i.object;switch(j.type){case"Plane":j.data.type="Plane",ta(j.data);break;case"PolygonMarker":return void ta(j)}if("floorTip"==j.type&&-1!=_a.indexOf(j.parent.floorID)&&!c)return j.targetfloorID&&d([j.targetfloorID]),f;for(var k=!1,l=0,i=null;!k;){var m=e[l];if(void 0!=m&&null!=m){var j=m.object;if(!1!==j.visible){if("ModelMarker"==j.type&&TransformManager.editModel&&TransformManager.attach(j.traget),j.isServiceLogo||j.isSprite&&j.data){if(j.isImageMark&&j&&j.parent&&-1!=_a.indexOf(j.parent.parent.floorID))return c?qa&&qa(j.data,h):ta(j.data,h),f;if(-1!=_a.indexOf(j.data.floorID)&&MapConfigX.facilityClickEmbed)return i=j.data,c?qa&&j&&qa(j.data):(f.x=m.point.x-yb.position.x,f.y=m.point.y-yb.position.y,v(j.data.nodeId,GIM.CLICK_FOCUS),ua&&ua(f)),f}if(Qa.areaClickEmbed&&-1!=_a.indexOf(j.floorID)){var n=m.face?m.face.nodeId:null,o=u(n);if(MapConfigX.interactiveTypes.indexOf(o.data.code)>-1||o.data&&-1!=o.data.code.search("action")){k=!0,c?qa&&o&&qa(o.data):v(n,GIM.CLICK_FOCUS);break}}if(++l>=e.length)return f}else l++}else if(++l>=e.length)return}}}function A(a){if(a&&a.length&&Array.isArray(a)){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=Vb.find(function(a){return a.nodeId==d});e&&b.push(e)}if(b.length){B(b.concat());for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];Vb.remove(g)}}}else if("string"==typeof a){var h=u(a);h&&h.setColor(h.data.fill)}else B(Vb.concat()),Vb=[];return Qa.mark.visible=!1,Vb}function B(a){a.forEach(function(a){var b=u(a.nodeId);zb=null,b&&b.setColor(b.data.fill)}),a=[],Qa.mark&&(Qa.mark.visible=!1)}function C(a,b){[Qa.mark,Qa.endMark,Qa.startMark].forEach(function(b){b!=a&&b.pointID==a.pointID&&(b.visible=!1)}),a.position.x=b.x,a.position.y=b.y,a.position.z=b.z+5}function D(a,b,c,d){var e=0;d&&$a[d]&&(e=$a[d].position.z);var f=new THREE.Vector3(a+yb.position.x,b+yb.position.y,yb.position.z+c+e);f.project(db);var g=f.clone();return bb=Va.domElement.getBoundingClientRect(),Ta=bb.width/2,Ua=bb.height/2,g.x=g.x*Ta+Ta,g.y=-g.y*Ua+Ua,{x:g.x-1,y:g.y+1}}function E(a,b){for(var c=[],d=null,e=a.length-1;e>=0;e--){var f=a[e];if(d){c.push(d);var g=f.clone().sub(d),h=g.length();if(h>b)for(var i=parseInt(h/b),j=1;j<i;j++)c.push(g.clone().multiplyScalar(j/i).add(d))}d=f.clone()}return c.push(d),c}function F(a){a.preventDefault();var b;b=a instanceof MouseEvent?a:a.targetTouches[0],xb.x=b.clientX,xb.y=b.clientY,Ka&&kc&&(T(),kc=!1)}function G(a){!0!==a&&(J(),K()),Qa.initAreaType(a),Fa?P():N(),H(oa)}function H(a){a&&void 0!=a&&(a.addEventListener("click",F,!1),qa&&(a.addEventListener("mousemove",I),a.addEventListener("touchmove",I)),t(parseFloat(a.clientWidth),parseFloat(a.clientHeight)),nc&&nc.setSize(parseFloat(a.clientWidth),parseFloat(a.clientHeight)),a.appendChild(Va.domElement),oa=a,$())}function I(a){var b,c;a.changedTouches?(b=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY):(b=a.clientX,c=a.clientY);Math.sqrt((lc-=b)*lc+(mc-=c)*mc);lc=b,mc=c}function J(){Va=new THREE.WebGLRenderer({antialias:Ma,alpha:Ha,preserveDrawingBuffer:!!GIM.OS.isPc,stencil:!1,powerPreference:GIM.OS.isPc?"default":"low-power",logarithmicDepthBuffer:logDBF}),Qa.glRenderer=Va,yb.name="floorContainer",Va.setPixelRatio(window.devicePixelRatio),Va.sortObjects=!0,Va.autoClear=!0,Va.shadowMap.enabled=MapConfigX.enabledShadowMap,Va.gammaFactor=2,Va.gammaOutput=Oa,Wa=new THREE.Scene,Ha||(Wa.background=new THREE.Color(wa)),Ya=new THREE.Group,Wa.add(Ya);var a=new THREE.Group;a.renderOrder=Number.MAX_VALUE,Ya.add(a),Wa.name="scene",Ya.name="container3D",Ya.add(yb),window.scene=Wa,Xa=new GIM.CameraController(Ya,yb,Qa),db=Xa.camera,bb=oa.getBoundingClientRect(),Lc=new THREE.Scene,Lc.background=new THREE.Color(0),Lc.overrideMaterial=new THREE.MeshBasicMaterial({color:13107200}),Lc.add(yb),Za=new THREE.OrbitControls(db,Va.domElement,yb,sa,D,Qa),Za.saveState(),Za.addEventListener("change",da),TransformManager.regcomponent(db,Va.domElement,Za,a),db.position.z=7e3,db.position.x=0,db.position.y=0,ab=new THREE.Raycaster,mb=new Stats,mb.showPanel(0),window.addEventListener("resize",function(){t(parseFloat(oa.clientWidth),parseFloat(oa.clientHeight)),nc&&nc.setSize(parseFloat(oa.clientWidth),parseFloat(oa.clientHeight))},!1);var b=onContextRestore=function(a){console.warn("webglcontextlost  or webglcontextrestored"),ra&&ra(a)};Va.domElement.addEventListener("webglcontextlost",b,!1),Va.domElement.addEventListener("webglcontextrestored",onContextRestore,!1),Qa.startRender(),ka(),GIM.NaviInfoUtils.map=Qa}function K(){R(),fb=new GIM.Compass(oa,Za,xa),hb=new GIM.MapGrid(Qa)}function L(a,b,c){var d=a*(Math.PI/180),e=b*(Math.PI/180),f=c*(Math.PI/180),g=Math.cos(d),h=Math.sin(d),i=(Math.cos(e),Math.sin(e)),j=Math.cos(f),k=Math.sin(f),l=-g*k-h*i*j,m=-h*k+g*i*j,n=Math.atan(l/m);return m<0?n+=Math.PI:l<0&&(n+=2*Math.PI),n*=180/Math.PI}function M(a){if(eb&&!Bb&&eb.visible){var b;if("webkitCompassHeading"in a)b=360-a.webkitCompassHeading;else if(window.chrome){if(null==a.alpha)return console.warn("event alpha is null");b=a.alpha-270,b<0&&(b+=360)}else b="0"==0?a.alpha:360-L(a.alpha,a.beta,a.gamma);var c=b;c+=parseFloat(xa[2])||0;var d=c-Qa.currentPathAngel;d<0&&(d+=360,d=360-d),"firstPerson"==pc&&(Qa.setAzimuthalAngle(c),rc||Qa.moveToLocation(!0)),Qa.arrowPathAngle=d,Qa.locationMarkRotation(c/180*Math.PI)}}function N(){var a=(window.location.host,{});a.command="GetMapBuildingInfo",a.pid=GIM.PID,a.lan="sc",a.parameter={domain:"",key:va,buildingID:Qa.buildingID};var b="code="+JSON.stringify(a);GIM.DEBUG_MODE&&(b+="&timingdata=0"),(!Fa||"86E81446-7C98-432F"!=va&&"999"!=va)&&(MapConfigX.isJavaServer&&(b="GetMapBuildingInfo?pid="+GIM.PID+"&lan=SC&buildingID="+Qa.buildingID+"&SnapshootVesion="+MapConfigX.snapshotVersion+"&haveArea="+MapConfigX.haveArea,GIM.DEBUG_MODE&&(b+="&debug=1")),GIM.SVGParser.smartURLLoader(b,"GetMapBuildingInfo",function(a){if(a&&"200"==a.c)if(Fa){var b=a.v[0].Building.length>0?a.v[0].Building[0].Floor:0;MapConfigX.xFloor=b}else O(a);else console.log("GetMapBuildingInfo Data Error !!! :",a),GIM.DEBUG_MODE&&document.write("accessToken is Invalid"),pa&&pa(null,null,"GetMapBuildingInfo Data Error"),oa.removeChild(Va.domElement)}))}function O(a){var b=null;if(a&&a.v&&a.v[0]&&a.v[0].Building){var c=a.v[0].Building.length>0?a.v[0].Building[0].Floor:0;if(MapConfigX.xFloor=c,Qa.projectInfo=a.v[0].Building,!c)return console.log("init floor data fail! 检查 GetMapBuildingInfo 接口 "),void(pa&&pa(c,GIM.AreaTypes,"GetMapBuildingInfo Error"));c.sort(function(a,b){return a.Order-b.Order},16);for(var e=0;e<c.length;e++){var f="AN",g="BI",h="PI",i=c[e];vc[i.FloorID]=i;var j=i.Area;if(!j)return void console.log("[MAP] Floor area is null ! Please check the data MapBuildingInfo");"ground"==i.Name&&(jb=i.FloorID,ib=i);for(var k,l=j.length,m=0;m<l;m++){var n=j[m];n.FloorID=i.FloorID,tc[n[h]]=n,k=n.Tag,GIM.DisplayModel.prototype.allThreeID[k]={floorID:i.FloorID,pointID:n[h],areaName:n[f]},GIM.DisplayModel.prototype.allThreeID[n[g]]={floorID:i.FloorID,pointID:n[h]},GIM.DisplayModel.prototype.areaNameMap.set(n[f],{floorID:i.FloorID,pointID:n[h],areaName:n[f]})}switch(i.Name=i.Name?i.Name:i.name,trimName=i.Name.toUpperCase().replace(/\s+/g,""),trimName){case"1F":case"1L":case"F1":case"L1":case"G1":case"G":b||(b=i.FloorID)}Qa.floorOpacity.set(i.FloorID,Qa.opacity),GIM.INIT_FLOORID&&GIM.INIT_FLOORID.toString().toUpperCase()==trimName&&(b=i.FloorID)}c.remove(ib);var o=function(){pa&&pa(c,GIM.AreaTypes),Aa&&V(c)},p=vc[GIM.INIT_FLOORID];Ga&&!p?(GIM.INIT_FLOORID=b||i.FloorID,p=p||vc[GIM.INIT_FLOORID]):p||pa&&pa(c,GIM.AreaTypes,"initFloorID Error"),p&&U(p.FloorID,o,!0,!0)}var q=MapConfigX.groundURL.length>4;if(Ba){var r=function(a){a&&a.hasOwnProperty("visible")&&(kb.groundLayerFloor=a,d(jb,null))};kb=new GIM.GroundLayer,q&&yb.add(kb),jb&&vc[jb]&&U(jb,r,!1)}wb=!0}function P(){Q(Qa.optFloorID,function(a){setTimeout(function(){N&&N()},2e3),a?S(a):console.warn("数据加载失败 ")})}function Q(a,b){var c=a||"",d={};switch(d.command="getAreaInfo",d.pid=GIM.PID,MapConfigX.lang){case"zh":d.lan="sc";break;case"zh-hant":d.lan="tc";break;case"en":d.lan="en";break;default:d.lan="sc"}d.parameter={FormfatFloor:"true",floorID:c,buildingID:Qa.buildingID};var e="code="+JSON.stringify(d);GIM.DEBUG_MODE&&(e+="&timingdata=0"),MapConfigX.isJavaServer&&(e="getAreaInfo?pid="+GIM.PID+"&lan=SC&buildingID="+Qa.buildingID+"&floorID="+c+"&SnapshootVesion="+MapConfigX.snapshotVersion,GIM.DEBUG_MODE&&(e+="&debug=1"),c.length&&Ja&&hb.getFloorGrid(c)),GIM.SVGParser.smartURLLoader(e,"getArea",function(a){b(a)})}function R(){var a=GIM.ThemePath+"navigationICON.png";Qa.mark=new THREE.Sprite,GIM.OverrideURL?(GIM.SVGParser.loadTexture(GIM.MURL,"mark",function(a){Qa.mark=a}),GIM.SVGParser.loadTexture(GIM.EURL,"endmark",function(a){Qa.endMark=a}),GIM.SVGParser.loadTexture(GIM.SURL,"startmark",function(a){Qa.startMark=a}),a=GIM.NURL):(GIM.SVGParser.loadTexture(GIM.ThemePath+"imageMarker.png","mark",function(a){Qa.mark=a}),GIM.SVGParser.loadTexture(GIM.ThemePath+"end.png","endmark",function(a){Qa.endMark=a}),GIM.SVGParser.loadTexture(GIM.ThemePath+"start.png","startmark",function(a){Qa.startMark=a}));var b=new THREE.TextureLoader;b.crossOrigin="Anonymous",b.load(a,function(a){var b=a.image.width,c=(a.image.height,new THREE.CircleGeometry(b/2,32)),d=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide,transparent:!0,depthWrite:!0,depthTest:!1});eb=new THREE.Mesh(c,d),eb.name="locationMark",eb.renderOrder=5e6,yb.add(eb),eb.visible=!1},void 0,function(a){var b=64,c=new THREE.CircleGeometry(b/2,32),d=new THREE.MeshBasicMaterial({color:96767});eb=new THREE.Mesh(c,d),yb.add(eb),eb.visible=!1})}function S(a){function b(){Qa.originAreaData=c,pa(c,c,GIM.shopNames)}var c=a.v[0].Building[0].Floor,d=[];c.sort(function(a,b){return a.Order-b.Order},16),GIM.shopNames={};var e;jb=null,c.forEach(function(a){var b={};d.push(a.FloorID),b.floorID=a.FloorID,b.order=a.Order,b.name=a.Name,uc.push(b),vc[a.FloorID]=a;var c=a.Name.toUpperCase().replace(/\s+/g,"");GIM.INIT_FLOORID&&GIM.INIT_FLOORID.toString().toUpperCase()==c&&(GIM.INIT_FLOORID=a.FloorID),"ground"==a.Name&&(jb=a.FloorID,ib=a),GIM.INIT_FLOORID&&GIM.INIT_FLOORID.toString().toUpperCase()==c&&(e=a.FloorID),GIM.floorOrders[a.FloorID]=a.Order;var f,g="";a.Area.forEach(function(b){if(wc[b.AreaID]=b.FloorID,g=b.ThirdPartyIDs,f=b.ShopID,g&&g.includes(","))g=g.split(","),g.forEach(function(c){GIM.DisplayModel.prototype.allThreeID[c]={pointID:b.PointID,floorID:a.FloorID,areaName:b.Name}}),f&&f.includes(",")&&(f=f.split(","),f.forEach(function(c){GIM.DisplayModel.prototype.allThreeID[c]={pointID:b.PointID,floorID:a.FloorID,areaName:b.Name}}));else{GIM.DisplayModel.prototype.allThreeID[g];GIM.DisplayModel.prototype.allThreeID[g]={pointID:b.PointID,floorID:a.FloorID,areaName:b.Name},GIM.DisplayModel.prototype.allThreeID[f]={pointID:b.PointID,floorID:a.FloorID,areaName:b.Name}}if(GIM.DisplayModel.prototype.areaNameMap.set(b.Name,{floorID:a.FloorID,pointID:b.PointID,areaName:b.Name}),GIM.shopNames[b.ShopName]&&""!=b.ShopName){var c=GIM.shopNames[b.ShopName];c.list||(c.list=[]),c.list.push({areaID:b.AreaID,floorID:a.FloorID,name:a.Name})}else""!=b.ShopName&&(GIM.shopNames[b.ShopName]={areaID:b.AreaID,floorID:a.FloorID,name:a.Name})})});var f=vc[GIM.INIT_FLOORID];Ga&&!f&&(GIM.INIT_FLOORID=e||vc[d[0]].FloorID);var f=vc[GIM.INIT_FLOORID]?vc[GIM.INIT_FLOORID]:vc[d[0]];c.remove(ib);var g=MapConfigX.groundURL.length>4;if(Ba){var h=function(a){a&&a.hasOwnProperty("visible")&&(a.visible=!0,kb.groundLayerFloor=a)};kb=new GIM.GroundLayer,g&&yb.add(kb),jb&&vc[jb]&&U(jb,h,!1)}f&&U(f.FloorID,b,!0,!0),Aa&&V(c),wb=!0}function T(){void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(function(a){"granted"==a&&window.addEventListener("deviceorientation",M,!1)}).catch(function(a){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",a)}):window.addEventListener("deviceorientation",M,!1)}function U(a,b,c,e){function f(a,b){return function(){c&&d([b],e),a&&"function"==typeof a&&a($a[b])}}if(void 0!=a){if($a[a]&&b&&b(),xc[a]&&!$a[a]&&(Qa.floorCreatCompleteCallList[a]||(Qa.floorCreatCompleteCallList[a]=[]),"function"==typeof b&&Qa.floorCreatCompleteCallList[a].push(b)),!$a[a]&&a&&vc[a]&&Fa){var g=new GIM.DisplayFloor3D(vc[a],!1,Qa,f(b,a));return g.isCreated=!0,g.visible=!1,$a[a]=g,!0}return!(!$a[a]&&!xc[a])||(xc[a]=!0,c&&Qa.showLoading&&Qa.showLoading(!0),Q(a,function(f){function g(a,b){return function(){c&&(d([b],e),Qa.showLoading&&Qa.showLoading(!1)),Qa.applyLoadTheme(b),a&&"function"==typeof a&&a($a[b])}}if(!f||200!=f.c)return console.warn("loadOptionalFloorData Error!!:"+a,f),void(b&&b());var h=f.v[0].Building[0].Floor[0];if(!h){var i={type:"fail",msg:"floorID error or network bad"};return void(b&&b(i))}Qa.originAreaData[a]=h,vc[a]=h;var j=new GIM.DisplayFloor3D(vc[a],!1,Qa,g(b,a));$a[a]=j,j.isCreated=!0,j.visible=!1,oc&&(oc.selectedObjects=j.polygonLayer.children)}),!1)}}function V(a){var b=0,c=setInterval(function(){var d=a[b];if(b++,b==a.length&&clearInterval(c),!d.isCreated&&!$a[d.FloorID])if(Fa){var e=new GIM.DisplayFloor3D(d,!1,Qa);$a[d.FloorID]=e,e.isCreated=!0,e.visible=!1,yb.add(e),e.position.z=vb,e.addEventListener("CreatedCompleted",function(b){Qa.allFloorCreated=a.every(function(a){return 1==a.isCreated}),Qa.allFloorCreatedFunc&&Qa.allFloorCreated&&Qa.allFloorCreatedFunc()})}else U(d.FloorID)},Fa?200:1500)}function W(){Y(),Qa.isRender&&(Qa.loopHander=requestAnimationFrame(W))}function X(){Bc=!0,clearInterval(Ec),Ec=setInterval(function(){Bc=!1},2e3)}function Y(){(Bc||Cb||!Za.enabled)&&(yc=Date.now(),(zc=yc-Cc)>Dc&&Va&&(Cc=yc-zc%Dc,Za&&Za.update(),Rb&&Ac%5==0&&Z(),Ac%10==0&&_(),Qa.isCalcRenderSize&&Ac%10==0&&la(),db instanceof THREE.OrthographicCamera||db.isOrthographicCamera,$(),Va.render(Wa,db),Ac++,Yb.length>0&&Yb.forEach(function(a){a&&a()}),Xb&&mb&&mb.update(),Qa.updateMarker&&Qa.updateMarker()))}function Z(){$a[jb]&&($a[jb].position.z=Qa.cameraRadius/1e3*-3);for(var a=0;a<Qb.length;a++){var b=Qb[a];switch(b.name){case"line2":var c=b.material.uniforms;b.material.needsUpdate=!0,c&&(c.markerDelta.value=Qa.cameraRadius/1e3/1.3,c.uvDelta.value=Qa.cameraRadius/1e3*(Ra>Sa?.5:.3),c.arrwoUVOffset&&(c.arrwoUVOffset.value>=c.markerDelta.value&&(c.arrwoUVOffset.value=0),c.arrwoUVOffset.value+=.05*c.markerDelta.value),c.lineWidth.value=GIM.pathWidth,c.resolution.value=new THREE.Vector2(Ra,Sa));break;case"dot":break;default:ba(b.children[0],Qa.naviTipScale);var d=.008*length;d<15&&(d=15),d>68&&(d=68),b.position.z=d}}}function $(){var a=Qa.cameraRadius;(db instanceof THREE.OrthographicCamera||db.isOrthographicCamera)&&(a=Qa.vlength),eb&&(db.isPerspectiveCamera?length=a:length=Qa.vlength,eb.scale.x=eb.scale.y=length/100/30*MapConfigX.locationMarkScale);for(var b in $a){var c=$a[b];if(-1!=_a.indexOf(c.floorID)){c.imageLayer.position.z=a/1e3;var d=1,e=[];e=e.concat(c.facilityPOIList,c.labelPOIList);for(var f,g=e.length,h=0;h<g;h++)(f=e[h])&&(a<GIM.SHOW_SPRITE_LENGTH?(d=-1!=f.name.search("mark")?Qa.sysScale:f.isFacility?Qa.facilityScale:MapConfigX.labelScale,db instanceof THREE.PerspectiveCamera||db.isPerspectiveCamera,ba(f,d)):f.visible=!1);scaleFactorX=Qa.markerScale||1,c.markerLayer.children.forEach(function(a){a.isImageMark?(scaleFactorX="dot"==a.name?.7:Qa.markerScale,db instanceof THREE.PerspectiveCamera||db.isPerspectiveCamera,ba(a,scaleFactorX),a.renderOrder=c.renderOrder+60,a&&(a.visible=!0)):"ImageMarker"!=a.type&&(a.traverse(function(a){a.renderOrder=c.renderOrder+60}),a.isTextMarker&&ba(a,scaleFactorX))})}}}function _(a){var b=Qa.cameraRadius;(db instanceof THREE.OrthographicCamera||db.isOrthographicCamera)&&(b=Qa.vlength);for(var c in $a){var d=$a[c];if(-1!=_a.indexOf(d.floorID)){d.imageLayer.position.z=b/1e3;var e=[];e=e.concat(d.facilityPOIList,d.labelPOIList),MapConfigX.visibleRange&&(e=e.filter(function(a){if(a.areaType){var c=MapConfigX.visibleRange[a.areaType];if(c){if(c=c.markRange,!(1==a.isflick||b>c[0]&&b<c[1]))return TweenLite.to(a.material,.5,{opacity:0,onComplete:function(a){a.visible=!1},onCompleteParams:[a]}),!1;na.visible=!0,TweenLite.to(a.material,.5,{opacity:f})}}return!0})),e.sort(function(a,b){var c=MapConfigX.displayOrder.indexOf(void 0!=a.data?a.data.code:0);return MapConfigX.displayOrder.indexOf(void 0!=b.data?b.data.code:0)-c});var f=Qa.floorOpacity.get(d.floorID);aa(e,Ab,b,f),MapConfigX.embedMarkCollision&&aa(d.markerLayer.children,Ab,b,f)}}}function aa(a,b,c,d){var e,f=a.length;b.clear();for(var g=0;g<f;g++)if(e=a[g]){var h=ca(e);if((!e.data||"yzz"!=e.data.code&&e.data.code!=GIM.NODE_TYPE_MACHINE)&&!1!==e.isShow)if(c<GIM.SHOW_SPRITE_LENGTH)if("all"==Ca)-1!=e.name.search("mark")||(e.visible=!0);else if("none"!=Ca||e.isServiceLogo){var i=e.height*(e.userData.mspriteScale||1),j=i*e.scaleRatio,k={w:j,h:i,x:h.x-j/2,y:h.y-i,priority:e.isFacility?2:1};if(-1==e.name.search("mark")&&e.isSprite){var l=b.push(null,k);TweenLite.killTweensOf(e.material),e.data&&MapConfigX.alwaysDisplay.includes(e.data.code)&&(l=!1),l?TweenLite.to(e.material,.5,{opacity:0,onComplete:function(a){a.visible=!1},onCompleteParams:[e]}):(e.visible=!0,TweenLite.to(e.material,.5,{opacity:d}))}}else-1==e.name.search("mark")&&(e.visible=!1);else e.visible=!1}}function ba(a,b){if(a.userData.mspriteScale=b,db.isPerspectiveCamera){var c=a.height/(Sa/(2*Math.tan(db.fov*THREE.Math.DEG2RAD/2)));isNaN(c)&&(c=1),a.scale.set(c,c,c),a.scale.multiplyScalar(b),a.scale.setX(a.scale.x*a.scaleRatio)}else{var d=a.height*Math.abs(db.cameraO.top-db.cameraO.bottom)/db.cameraO.zoom/Sa;isNaN(d)&&(d=1),a.scale.set(d,d,d),a.scale.multiplyScalar(b),a.scale.setX(a.scale.x*a.scaleRatio)}}function ca(a){return D(a.position.x,a.position.y,a.position.z)}function da(){if(null!=Qa){if(db.isOrthographicCamera){var a=db.cameraO.zoom,b=new THREE.Vector3(0,0,yb.position.z),c=b.distanceTo(db.position),d=db.position.clone().sub(b).normalize();Qa.vlength=b.distanceTo(b.clone().add(d.multiplyScalar(c/a)))}else Qa.vlength=Qa.cameraRadius,db.cameraO.zoom=1;Wb&&Wb(Qa.cameraRadius),kb&&Ba&&kb.setBoxVisible(Qa.cameraRadius);for(var e in $a){var f=$a[e];f&&f.visible&&f.updateTextDirection(Qa.getAzimuthalAngle())}X()}}function ea(a){var b=1,d=GIM.PATH_COLOR,j="#FFFFFF",k=200/b,l=300/b,m=.5*b,n=.2*b,o=.3*b,p=.6*b,q=.07*b,r=document.createElement("canvas"),s=r.getContext("2d");s.fillStyle=d;var t=n*k/2;c=(m+q)*k;var u={x:l/2,y:k/2};return e=l*o,f=l*q,g=l*(o-q)*p,h=u.x-e/2*p,i=u.y-e/2,s.beginPath(),s.moveTo(h,t),s.lineTo(h+f,t),s.lineTo(h+f+g,c/2+t),s.lineTo(h+f,c+t),s.lineTo(h,c+t),s.lineTo(h+g,c/2+t),s.closePath(),s.fillStyle=j,s.fill(),r}function fa(a){if(X(),Za&&db){var b=(Za.maxDistance-Za.minDistance)/20,c=a*b+Za.minDistance;console.warn("[Map]  zoomLevel :>> ",a,"Distance:",c+"\n","max:"+Za.maxDistance,"min:"+Za.minDistance,db.type),Za.setDistance(c)}}function ga(){cc=null,Qb.forEach(function(a){if("line2"==a.name){var b=a.material.uniforms;b&&(b.passColorScale.value=0,a.material.needsUpdate=!0)}})}function ha(a,b,c){b.visible=!1;var d=$a[c];d.imageLayer.add(b),C(b,a),-1==d.facilityPOIList.indexOf(b)&&d.facilityPOIList.push(b),setTimeout(function(){b.visible=!0},30),$()}function ia(a,b,c){function d(a){X(),TweenLite.killTweensOf(a),TweenLite.fromTo(a.position,.5,{z:f},{z:50,onComplete:function(){TweenLite.to(a.position,.5,{z:f})}}),++e>15&&(ia(a,!1),setTimeout(function(){c&&c(a)},300))}if(void 0!=a.data){var e=0,f=a.data.deep;b?(a.timer&&clearInterval(a.timer),a.isflick=!0,a.timer=setInterval(d,1e3,a)):(a.timer&&clearInterval(a.timer),a.position.z=f,a.isflick=!1)}}function ja(a){a&&(a.material.map&&a.material.map.dispose(),a.material.map&&a.material.dispose(),a.material.map=null,a=null)}function ka(){Kc&&Kc.dispose(),Mc=50,Nc=Mc*oa.clientHeight/oa.clientWidth,Kc=new THREE.WebGLRenderTarget(Mc,Nc),Kc.texture.format=THREE.RGBAFormat,Kc.texture.minFilter=THREE.NearestFilter,Kc.texture.magFilter=THREE.NearestFilter,Kc.texture.generateMipmaps=!1,Kc.depthBuffer=!0,Kc.depthTexture=new THREE.DepthTexture}function la(){Va.setRenderTarget(Kc),Va.clear(),Va.render(Lc,db);var a=new Uint8Array(Mc*Nc*4);Va.readRenderTargetPixels(Kc,0,0,Mc,Nc,a);for(var b=0,c=0;c<Mc*Nc;c+=4)0!=a[4*c+0]&&b++;b/(Mc*Nc)<.005&&Za.reset(),Za.update(),Za.saveState(),Va.setRenderTarget(null)}function ma(a,b,c,d){if(c<=0||isNaN(c))return void console.log("参数错误, 缩放必须为大于0的数 ");var e=!1;"2d"==Qa.viewMode&&(e=!0,db.OToPerspective(),$());var f=b.getPolarAngle(),g=b.getAzimuthalAngle();if(b.setPolarAngle(0,null,0),b.setAzimuthalAngle(0,0,0),!a||void 0==a.geometry||null==a.geometry)return console.log("transMeshCenter floor geometry is null:>> ");a.geometry.computeBoundingBox();var h=a.geometry.boundingBox,i=h.min,j=h.max;i.z=j.z=0;var k=new THREE.Vector3;h.getCenter(k),Qa.move2Point(k),db.position.set(k.x,k.y,k.z+20),b.update();var l=i.clone().project(db),m=j.clone().project(db),n=Math.max(Math.abs(l.x),Math.abs(m.x)),o=Math.max(Math.abs(l.y),Math.abs(m.y));if(n>o){var p=n/c*(k.z+db.position.z);db.position.set(0,0,k.z+p),b.update()}else{var p=o/c*(k.z+db.position.z);db.position.set(0,0,k.z+p),b.update()}1==d&&(b.setPolarAngle(f,null,0),b.setAzimuthalAngle(g,0,0)),e&&Qa.setViewMode("2d")}var na=a||{},oa=void 0!==na.container?na.container:document.createElement("div"),pa=void 0!==na.initCompleted?na.initCompleted:null,qa=void 0!==na.onHover?na.onHover:null,ra=void 0!==na.onWebglcontextlost?na.onWebglcontextlost:null,sa=void 0===na.enabledControl||na.enabledControl,ta=void 0!==na.onSelected?na.onSelected:null,ua=void 0!==na.onClick?na.onClick:null,va=void 0!==na.accessToken?na.accessToken:null,wa=void 0!==na.backgroundColor?na.backgroundColor:0,xa=void 0!==na.compassOffset?na.compassOffset:[10,10],ya=(void 0!==na.cloudID&&na.cloudID,void 0!==na.themeID?na.themeID:""),za=void 0!==na.walkFunc?na.walkFunc:null,Aa=void 0===na.preCreation||na.preCreation,Ba=void 0===na.groundLayer||na.groundLayer,Ca=void 0!==na.labelViewModel?na.labelViewModel:"auto",Da=void 0!==na.delayNavigation?na.delayNavigation:0,Ea=void 0!==na.isVue&&na.isVue,Fa=void 0!==na.oneStepLoad&&na.oneStepLoad,Ga=void 0===na.initFloorCorrect||na.initFloorCorrect,Ha=void 0!==na.backgroundAlpha&&na.backgroundAlpha,Ia=void 0!==na.noNavigation&&na.noNavigation;GIM.oneStepLoad=Fa,MapConfigX.labelScale=void 0!==na.labelScale?na.labelScale:1.2,this.optFloorID=void 0!==na.optFloorID?na.optFloorID:"",this.linkFloorID=void 0!==na.linkFloorID?na.linkFloorID:"",this.crossBuild=void 0===na.crossBuild||na.crossBuild,this.buildingID=void 0!==na.buildingID?na.buildingID:null,this.showEdge=na.showEdge||!1,this.editModel=!0,this.projectInfo=null,this.opacity=na.opacity||1,this.parkingFloorIDs=na.parkingFloorIDs||[],this.unusualPointIDs=na.unusualPointIDs||[],GIM.isTextColorWrite=void 0!==na.isTextColorWrite?na.isTextColorWrite:GIM.isTextColorWrite,MapConfigX.logoFiled=void 0!==na.logoFiled?na.logoFiled:MapConfigX.logoFiled,MapConfigX.labelViewModel=Ca,MapConfigX.lang=void 0!==na.lang?na.lang:MapConfigX.lang,MapConfigX.enabledShadowMap=void 0!==na.enabledShadowMap?na.enabledShadowMap:MapConfigX.enabledShadowMap,MapConfigX.showIDSDevice=void 0!==na.showIDSDevice?na.showIDSDevice:MapConfigX.showIDSDevice,GIM.ThemePath="theme/"+ya+"/",GIM.ThemePath=Ea?"./static/"+GIM.ThemePath:GIM.ThemePath,GIM.INIT_FLOORID=na.initFloorID,GIM.PID=na.projectID,GIM.showLabelType=void 0!==na.showLabelType?na.showLabelType:"No.",GIM.DEBUG_MODE=void 0!==na.debug&&na.debug,GIM.REMOTE_SERVER=void 0!==na.server?na.server:GIM.REMOTE_SERVER,GIM.FLOOR_GAP=void 0!==na.floorGap?na.floorGap:GIM.FLOOR_GAP,MapConfigX.hideAreaTypes=void 0!==na.hideAreaTypes?na.hideAreaTypes:[],MapConfigX.groundURL=void 0!==na.groundURL?na.groundURL:"",MapConfigX.interactiveTypes=void 0!==na.interactiveTypes?na.interactiveTypes:MapConfigX.defaultInteractiveTypes,MapConfigX.isJavaServer=void 0!==na.isJavaServer?na.isJavaServer:MapConfigX.isJavaServer,MapConfigX.facilityPanel=void 0!==na.facilityPanel?na.facilityPanel:MapConfigX.facilityPanel,MapConfigX.localServer=void 0!==na.localServer?na.localServer:MapConfigX.localServer,MapConfigX.localServerURL=void 0!==na.localServerURL?na.localServerURL:MapConfigX.localServerURL,MapConfigX.outRangeTimes=void 0!==na.outRangeTimes?na.outRangeTimes:MapConfigX.outRangeTimes,MapConfigX.locateLimitGrid=void 0!==na.locateLimitGrid?na.locateLimitGrid:MapConfigX.locateLimitGrid,MapConfigX.edgeColor=void 0!==na.edgeColor?na.edgeColor:MapConfigX.edgeColor,MapConfigX.snapshotVersion=void 0!==na.snapshotVersion?na.snapshotVersion:MapConfigX.snapshotVersion,MapConfigX.bevelEnabled=void 0!==na.bevelEnabled?na.bevelEnabled:MapConfigX.bevelEnabled,MapConfigX.embedParkingText=void 0!==na.embedParkingText?na.embedParkingText:MapConfigX.embedParkingText,MapConfigX.embedTextStroke=void 0!==na.embedTextStroke?na.embedTextStroke:MapConfigX.embedTextStroke,MapConfigX.embedTextIcon=void 0!==na.embedTextIcon?na.embedTextIcon:MapConfigX.embedTextIcon,MapConfigX.textFillStyle=void 0!==na.textFillStyle?na.textFillStyle:MapConfigX.textFillStyle,MapConfigX.textStrokeStyle=void 0!==na.textStrokeStyle?na.textStrokeStyle:MapConfigX.textStrokeStyle,MapConfigX.multiFloorView=void 0!==na.multiFloorView?na.multiFloorView:MapConfigX.multiFloorView,MapConfigX.embedSpecialTextBG=void 0!==na.embedSpecialTextBG?na.embedSpecialTextBG:MapConfigX.embedSpecialTextBG,MapConfigX.embedMarkCollision=void 0!==na.embedMarkCollision?na.embedMarkCollision:MapConfigX.embedMarkCollision,MapConfigX.displayOrder=void 0!==na.displayOrder?na.displayOrder:MapConfigX.displayOrder,MapConfigX.alwaysDisplay=void 0!==na.alwaysDisplay?na.alwaysDisplay:MapConfigX.alwaysDisplay,MapConfigX.embedTextTip=void 0!==na.embedTextTip?na.embedTextTip:MapConfigX.embedTextTip,MapConfigX.robotModelURL=void 0!==na.robotModelURL?na.robotModelURL:MapConfigX.robotModelURL,MapConfigX.embedRobot=void 0!==na.embedRobot?na.embedRobot:MapConfigX.embedRobot,MapConfigX.simulateMove=void 0!==na.simulateMove?na.simulateMove:MapConfigX.simulateMove,MapConfigX.floor2Gap=void 0!==na.floor2Gap?na.floor2Gap:MapConfigX.floor2Gap,MapConfigX.floorMultiGap=void 0!==na.floorMultiGap?na.floorMultiGap:MapConfigX.floorMultiGap,logDBF=void 0!==na.logDBF&&na.logDBF,GIM.SHOW_SPRITE_LENGTH=void 0!==na.showLabelLength?na.showLabelLength:GIM.SHOW_SPRITE_LENGTH,GIM.SHOW_Facility_LENGTH=void 0!==na.showImageLength?na.showImageLength:GIM.SHOW_Facility_LENGTH;var Ja=void 0!==na.loadMapGrid&&na.loadMapGrid,Ka=void 0!==na.listenerOrientation&&na.listenerOrientation,La=void 0!==na.fps&&"number"==typeof na.fps?na.fps:30,Ma=void 0===na.antialias||na.antialias,Na=void 0!==na.simulateRotate?na.simulateRotate:MapConfigX.simulateRotate,Oa=void 0!==na.gammaOutput?na.gammaOutput:MapConfigX.gammaOutput;void 0!==na.buURL&&(MapConfigX.groundURL=na.buURL);var Pa=null,Qa=this;this.startNode={},this.endNode={};var Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a={},_a=[];this.floor3Ds=$a;var ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb=new THREE.Vector2,ub=GIM.MAP_CONFIG.minFloorPositionZ,vb=GIM.MAP_CONFIG.maxFloorPositionZ,wb=!1,xb={x:0,y:0},yb=new THREE.Group,zb=null,Ab=new GIM.Collision,Bb=!1,Cb=!1,Db=[],Eb=[],Fb=[],Gb=[],Hb=0,Ib={},Jb={},Kb=.17,Lb={type:"done",dis:0,realDis:0},Mb={type:"fail",dis:0,code:1,msg:""},Nb={},Ob=null,Pb=[],Qb=[],Rb=!0,Sb=1,Tb=1,Ub=1,Vb=[],Wb=null,Xb=!1,Yb=[],Zb=0,$b=0,_b=0,ac=0,bc=0,cc=null,dc=null,ec=!1,fc=0,gc=null,hc=0,ic=0,jc=0;this.selectUnit3DByPosition=z,window.onscroll=function(){bb=Va.domElement.getBoundingClientRect()};var kc=!0;this.init=G,this.initAreaType=function(a){GIM.AreaTypes={};var b={};b.command="getAreaType",b.pid=GIM.PID,b.lan="sc",b.parameter={FormfatFloor:"TRUE"};var c="code="+JSON.stringify(b);GIM.DEBUG_MODE&&(c+="&timingdata=0"),MapConfigX.isJavaServer&&(c="getAreaType?pid="+GIM.PID+"&lan=SC&SnapshootVesion="+MapConfigX.snapshotVersion,GIM.DEBUG_MODE&&(c+="&debug=1")),GIM.SVGParser.smartURLLoader(c,"areaType",function(b){b&&b.v?b.v.forEach(function(a){GIM.AreaTypes[a.AreaTypeID]=a}):console.log("getAreaType Data Error !!! :",b),Ia||1==a||TweenLite.delayedCall(Da,function(){Qa.navigation=new GIM.Navigation(Qa)})})},this.setDom=H;var lc=null,mc=null,nc=null,oc=null,pc="firstPerson";this.setLocateOrientationMode=function(a){pc=a,"firstPerson"==pc&&eb&&eb.visible?Qa.move2Point(eb.position):yb&&TweenLite.killTweensOf(yb.position),qc&&"function"==typeof qc&&qc(pc)};var qc;this.pauseNavigation=function(a){rc=a};var rc=!0;this.regLocateOrientationModeChange=function(a){qc=a},this.checkAuthorization=N;var sc,tc={},uc=[],vc={},wc={};this.navigation={};var xc={};Qa.floorCreatCompleteCallList={};var yc,zc,Ac=0,Bc=!0,Cc=Date.now(),Dc=1e3/La;this.isCalcRenderSize=!1;var Ec=setInterval(function(){Bc=!1},5e3);this.setPolarAngle=function(a,b,c){if(Za){var d=a/180*Math.PI;Za.setPolarAngle(d,b,c)}},this.setAzimuthalAngle=function(a){if(Za){var b=a/180*Math.PI;Za.setAzimuthalAngle(b)}},this.clearEndArea=function(){Qa.endMark&&(Qa.endMark.visible=!1),Qa.endNode={}},this.clearStartArea=function(){Qa.startMark&&(Qa.startMark.visible=!1),Qa.startNode={}},this.move2Point=function(a,b){function c(){b&&"function"==typeof b&&b()}Bc=!0,TweenLite.killTweensOf(yb.position),TweenLite.to(yb.position,.4,{x:-a.x,y:-a.y,z:0,onComplete:c,onUpdate:function(){da()}})},this.moveTo=function(a,b){Qa.move2Point(a,b)},this.setLocation=function(a,b,c){if(void 0!=eb&&a){var d=$a[gb];if(d){d.facilityLayer.getObjectByName("locationMark")||(d.facilityLayer.add(eb),sc&&d.facilityLayer.add(sc)),eb.visible=!0;var e=Math.abs(eb.position.z-a.z);eb.position.distanceTo(a),Qa.pixelPerMeter;e>1e3&&(c=!0),sc&&TweenLite.to(sc.position,c?0:.5,{x:a.x,y:a.y,z:a.z}),TweenLite.to(eb.position,c?0:.9,{x:a.x,y:-Math.abs(a.y),z:a.z+Qa.pathThickness/2}),void 0!==b&&1==b&&TweenLite.set(yb.position,{x:-a.x,y:-a.y,z:-a.z}),X()}}},this.locationMarkRotation=function(a){eb&&(eb.visible=!0,TweenLite.killTweensOf(eb.rotation),TweenLite.to(eb.rotation,.5,{directionalRotation:{z:a+"_short",useRadians:!0}}),sc&&TweenLite.to(sc.rotation,1,{directionalRotation:{z:a+Math.PI+"_short",useRadians:!0}}))},this.moveToLocation=function(a){var b=a?.01:1;if(yb&&eb&&eb.visible){Bc=!0;var c=MapConfigX.multiFloorView?-eb.parent.parent.z||0:0;TweenLite.to(yb.position,b,{x:-eb.position.x,y:-eb.position.y,z:c,onComplete:function(){da()}})}da()},this.showLocation=function(){if(eb&&eb.floorID){var a=$a[eb.floorID];return a&&a.visible?setTimeout(function(){$a[eb.floorID];Qa.moveToLocation()},100):(d([eb.floorID]),setTimeout(function(){$a[eb.floorID];Qa.moveToLocation()},1e3)),!0}return!1},this.setLocationMark=function(a,b,c){a&&a.direction&&Qa.locationMarkRotation(-a.direction/180*Math.PI);var e=$a[b];if(!e)return void U(b,function(a){d([a.floorID])});if(eb&&!Bb){eb.floorID=b;var f=eb.visible;if(eb.visible=e.visible,gb=e.floorID,Ja){var g=Qa.getNearstPoint(b,a.x,a.y);console.log("p3 :>> ",g),g&&g.hasOwnProperty("x")&&!isNaN(g.x)&&(g.moving=a.moving,a=g)}switch(a.z=20,a.y=-Math.abs(a.y),Fc){case"lockCenter":Qa.setLocation(a,!0,!f);break;case"lookAt":if(Cb){if(eb){var h=null;for(var i in Nb)if(Nb.hasOwnProperty(i)){var j=Nb[i];if(j.floorID==gb){var k=Qa.navigation.getPathNearPoint(j.points,a);if(k){var l=i;h=k,ic=j.length}}}var m=function(a){if(Jb[l]){Fb=Jb[l].newSteps,Gb=Jb[l].setpList;var b=Jb[l].newStepPoints,c=Fb[a.loopIndex],d=c[a.insideIndex],e=b.indexOf(d),f=b.slice(0,e),g=GIM.prototype.calcDistance(f)/Qa.pixelPerMeter,h=Gb[a.loopIndex],i=h[h.length-1],j=(h[h.length-1],new THREE.Vector2(i.x,i.y).distanceTo(new THREE.Vector2(d.x,d.y))),k={};k.dis=j/Qa.pixelPerMeter,k.turn=i.turn,k.floorID=gb,k.arrowPathAngle=Qa.arrowPathAngle,k.passingDis=g,k.surplusDistance=Math.floor(_b)-Math.floor(g),k.distance=_b;var m=Math.atan2(i.y-d.y,i.x-d.x)-Math.PI/2;m=m>0?m:Math.PI+(Math.PI+m),Qa.currentPathAngel=180*m/Math.PI,r(gb,g/ic,l),za&&za(k)}};null!==h?(m(h),Qa.setLocation(h,!1),Hb=0):(Hb++,Qa.setLocation(a,!1),3==Hb&&(Hb=0,Ob&&Ob()))}}else(void 0==a.moving||a.moving)&&Qa.setLocation(a,!1,!f);break;case"normal":Qa.setLocation(a,!1)}return e.visible||c&&d([b]),eb}};var Fc="lookAt";this.setLocationModel=function(a){Fc=a},this.getLocationModel=function(a){return Fc},this.hideLocationMark=function(){console.log("hideLocationMark"),eb&&!Bb&&(eb.visible=!1,eb.floorID=null)},this.setShop=function(a,b){var c=GIM.DisplayModel.prototype.getAreaByShop(a);return setTimeout(function(){v(c.pointID,b,c.floorID)},200),c},this.getPointIDByName=function(a){return GIM.DisplayModel.prototype.getAreaBySN(a)},this.getShopByNo=this.getPointIDByName,this.getAreaByThree=function(a,b){var c=GIM.DisplayModel.prototype.getAreaByThree(a);return c?(b&&(Array.isArray(c)&&(c=c[0]),v(c.pointID,b,c.floorID)),c):(console.warn("- map can't find this id!!"),null)},this.showCompass=function(a){fb&&fb.showCompass(a)},this.setFloorMaterial=function(a,b){for(var c in $a)if($a.hasOwnProperty(c)){var d=$a[c];d.updateFloorMaterial(a)}},this.setFloorDeep=function(a,b){if(b){if($a.hasOwnProperty(b)){var c=$a[b];c.updateFloorDeep(a)}}else for(var d in $a)if($a.hasOwnProperty(d)){var c=$a[d];c.updateFloorDeep(a)}},this.setBackgroundColor=function(a){Wa&&(Wa.background=new THREE.Color(a),Bc=!0)},this.setBackgroundURL=function(a,b){if(b||(b=GIM.bgScale),Wa&&a){var c=new THREE.TextureLoader;c.crossOrigin="Anonymous",c.load(a,function(a){a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,Sb=a.image.width,Tb=a.image.height,a.repeat.set(Ra/Sb*b,Sa/Tb*b),a.magFilter=THREE.LinearFilter,a.minFilter=THREE.LinearMipMapLinearFilter,Wa.background=a})}},this.addBoxMark=function(a,b){a.z||(a.z=10);var c=new THREE.BoxGeometry(10,10,100),d=new THREE.MeshLambertMaterial({color:b||16711680,depthTest:!0,transparent:!0}),e=new THREE.Mesh(c,d);e.renderOrder=111e3,e.position.copy(a),yb.add(e),TweenLite.delayedCall(10,function(a){yb.remove(a)},[e])},this.addPointMark=this.addBoxMark,this.focusToShopByNo=function(a,b,c){this.selectByAreaName(a,b,c)},this.selectByAreaName=function(a,b,c){var d=Qa.getPointIDByName(a);d&&v(d.pointID,!0,d.floorID),b&&(fa(b),TweenLite.delayedCall(2,function(){0==c&&(c=1),Qa.setPolarAngle(c||60)}))},this.focusToShopByID=function(a,b,c){this.getAreaByThree(a,!0),b&&(fa(b),TweenLite.delayedCall(1,function(){Qa.setPolarAngle(c||60)}))};var Gc=!1;this.toggleSimulate=function(a){Bb&&(a?(TweenLite.killDelayedCallsTo(q),MapConfigX.simulateMove&&(clearInterval(dc),dc=setInterval(Qa.moveToLocation,2500)),Gc=!0,q()):(Gc=!1,Hc&&Hc()))},this.regNavigationWalk=function(a){za=a},this.regNavigationComplete=function(a){Pa=a},this.regCompassChange=function(a){GIM.compassChangeFunc=a};var Hc=null;this.regNavigationPause=function(a){Hc=a},this.addMarkToPoint=function(a,b,c){var e=u(a),f=e?e.data.nodePosition:tc[a];if((!f||!f.hasOwnProperty("y"))&&(f=GIM.Points[a]))var g=f.y>0?-f.y:f.y;e&&(f.FloorID=e.floorID);var h=Qa.startMark;switch(b){case"end":h=Qa.endMark;break;case"start":h=Qa.startMark;break;case"mark":h=Qa.mark}if(f&&h){$a[f.FloorID]?1!=c||$a[f.FloorID].visible||d(f.FloorID):U(f.FloorID,function(){setTimeout(function(){Qa.addMarkToPoint(a,b,c)},100)},!1);var i=e?e.data.nodePosition.z:20;h.pointID=a;var j=$a[f.FloorID];if(j){j.data.unitsData[a]?(g=f.hasOwnProperty("Code")?-f.y:f.y,ha({x:f.x+0,y:g-0,z:i},h,f.FloorID)):ha({x:f.x,y:g,z:i},h,f.FloorID),c&&Qa.move2Point({x:f.x,y:g},"addMarkToPoint")}}},this.startRender=function(){Qa.isRender=!0,X(),W()},this.stopRender=function(){Qa.isRender=!1};var Ic;this.regFloorChange=function(a){Ic=a},this.onPathDownloaded=null,this.regPathDownloaded=function(a){Qa.onPathDownloaded=a},this.regShowLoading=function(a){Qa.showLoading=a},this.regOffsetTipFunc=function(a){Ob=a},this.showStats=function(a){Xb=a,Xb?oa.appendChild(mb.dom):mb.dom.parentNode&&oa.removeChild(mb.dom)},this.getFloorByID=function(a,b){var c=$a[a];return c?b&&"function"==typeof b&&b(c):U(a,b),c};this.hideTypeIcon=function(a){for(var b in $a)$a[b].facilityPOIList.forEach(function(b){a.includes(b.type)&&(b.visible=!1,b.isShow=!1,b.timer&&clearInterval(b.timer))});X()},this.flickerTypeIcon=function(a,b,c){function d(a,b){for(var c=0;c<e.facilityPOIList.length;c++){var d=e.facilityPOIList[c];!d.data||d.data.areaTypeID!=a&&d.data.nodeId!=a||ia(d,b)}}var e=Qa.getFloorByID(b);e&&d(a,c)},this.restoreFacilityType=function(){for(var a in $a)$a[a].facilityPOIList.forEach(function(a){a.visible=!0,a.isShow=!0,a.timer&&clearInterval(a.timer)});X()},this.hideAllFacilityType=function(){for(var a in $a)$a[a].facilityPOIList.forEach(function(a){a.name.includes("mark")||(a.visible=!1,a.isShow=!1,a.timer&&clearInterval(a.timer))});X()},this.flickerFacilityType=function(a,b){Qa.restoreFacilityType();var c=0,d=[];for(var e in $a)$a[e].facilityPOIList.forEach(function(e){if(e.type==a)ia(e,!0,0==c?b:null),c++,d.push(e);else{if(e.name.includes("mark"))return;e.visible=!1,e.isShow=!1}});return 0==c&&Qa.restoreFacilityType(),d},this.regMapChange=function(a){Wb=a},this.simulate=function(){if(!Pb||!Pb.length)return console.log("pathFloors is null");fc=0,jc=0,qb=-1,ga(),ob=0,MapConfigX.multiFloorView||d(Pb[fc]),Bb=!0,gb=Qa.startNode.floorID,Gc=!0,TweenLite.killDelayedCallsTo(q),q(),sc&&(sc.fadeToAction("Walking",.2),sc.visible=!0),MapConfigX.simulateMove&&(Qa.moveToLocation(),clearInterval(dc),dc=setInterval(Qa.moveToLocation,2500))},this.setBuildingID=function(a){Qa.buildingID=a,buildingID=a},G(),this.viewMode="3d";var Jc=!0;this.setViewMode=function(a){if(!Jc)return console.log("setViewMode is running now  no completed! "),Jc;"2d"==a.toLocaleLowerCase()?(Jc=!1,Qa.setPolarAngle(0,function(){db.perToOrthographic(),$(),Jc=!0},1),TweenLite.delayedCall(.3,function(){Jc=!0})):"3d"==a.toLocaleLowerCase()&&(db.OToPerspective(),$(),TweenLite.delayedCall(.1,function(){Qa.setPolarAngle(MapConfigX.defaultPolarAngle),Jc=!0})),this.viewMode=a.toLocaleLowerCase(),console.log("viewMode :",this.viewMode)};new GIM.Marker(this,$a);new GIM.Map3DExpand(this,yb),this.getAzimuthalAngle=function(){return Za?THREE.Math.radToDeg(Za.getAzimuthalAngle()):0},this.getPolarAngle=function(){return Za?THREE.Math.radToDeg(Za.getPolarAngle()):0},this.floorOpacity=new Map,this.updateOpacity=function(a,b){for(var c in $a)if($a.hasOwnProperty(c)){var d=$a[c];if(void 0!=b&&b!=d.floorID)continue;d.opacity=a}X()},this.disposeData=function(){if(GIM){GIM.prototype.hitCheckMeshs=[],GIM.DisplayModel.prototype.dispose(),GIM.floorOrders={},GIM.imgPool={},GIM.Graph={},GIM.FloorGraph={},GIM.Lifts={},GIM.Links={},GIM.AreaTypes={},GIM.shopNames={};for(var a in $a)if($a.hasOwnProperty(a)){var b=$a[a];delete $a[a],b.dispose(),b=null}GIM.Points={}}MapConfigX.xFloor.length=0,MapConfigX.imageCache.clear(),MapConfigX.LabelMuti.length=0,tc={},xc={},InstancedTexture.clear()},this.disposeScene=function(){oa.removeEventListener("click",F,!1),ja(Qa.mark),ja(Qa.startMark),ja(Qa.endMark),Qa.isRender=!1,Bc=!1,ta=null,pa=null,Ic=null,cancelAnimationFrame(Qa.loopHander),clearInterval(Ec),Va&&(Va.clear(),Va.dispose(),Va.renderLists.dispose(),oa.removeChild(Va.domElement)),Va=null,Qa.originAreaData={},Qa.projectInfo={},vc={},fb=null,Za&&(Za.dispose(),Za=null)},this.dispose=function(){Qa.disposeData(),Qa.disposeScene()},this.getCurFloorIDs=function(){return _a},this.selectByAreaID=v,this.selectByID=v,this.setEndArea=w,this.setStartArea=y,this.searchPath=j,this.clearPath=s,this.showFloors=d,this.setSize=t,this.reset=b,this.forceUpdate=X,this.cleanSelectUnit3D=A,this.getNearPoint=x,this.zoomLevel=fa,this.toScreenXY=D,this.getModelByID=u,this.originAreaData={},this.pathElevation=20,this._markerScale=1,this.simulateMoveSpeed=2,this.pathDownloaded=!1,this.multipleSelectionMode=!1,this.focusSelect=void 0===na.focusSelect||na.focusSelect,this._facilityScale=1,this._selectedColor=GIM.SELECT_COLOR,this._areaClickEmbed=!0,this.orbitControls=Za,this._pathGap=5,this._defaultCenterPoint=new THREE.Vector2(2500,-2500),this.getNearstPoint=hb.getNearstPoint,this.getStatusbyPoint=hb.getStatusbyPoint,window.forceUpdate=X,this.initCompleted=pa,this.updateSpriteSize=window.updateSpriteSize072=$,MapConfigX.embedRobot&&(sc=new GIM.ModelMarker(MapConfigX.robotModelURL,MapConfigX.naviRobotScale,1e4,function(){Yb.push(sc.updateAnimation)})),this.registerAnimation=function(a){Yb.push(a)};var Kc,Lc,Mc,Nc;this.centerScaleMap=function(a,b){var c=this.getCurFloorIDs()[0];if(c){return ma(this.getFloorByID(c),Za,a||1,b)}}},GIM.Map3DExpand=function(a,b){a.loadTheme=function(b){GIM.SVGParser.loadLocalURL(b,function(b){console.log("loadTheme :",b),a.setBackgroundColor(parseInt(b.backgroundColor,16));var c=parseInt(b.floorStyle.color,16),d=parseInt(b.floorStyle.deep),e=b.floorStyle.texture,f=(new THREE.TextureLoader).load(e);f.wrapS=THREE.RepeatWrapping,f.wrapT=THREE.RepeatWrapping,f.repeat.set(5e-4,5e-4);var g=new THREE.MeshLambertMaterial({map:null,color:c});a.setFloorDeep(d),a.setFloorMaterial(g),CustomTheme.floorDeep=d,CustomTheme.material=g})},a.applyLoadTheme=function(b){CustomTheme.floorDeep&&a.setFloorDeep(CustomTheme.floorDeep,b),CustomTheme.material&&a.setFloorMaterial(CustomTheme.material,b)},a.setShadowMap=function(b){MapConfigX.enabledShadowMap=b,a.glRenderer.shadowMap.enabled=MapConfigX.enabledShadowMap,a.updateMaterial(),a.forceUpdate()},a.updateMaterial=function(){for(var b in a.floor3Ds){a.floor3Ds[b].updateMaterial()}},a.saveScreenshot=function(b){var b=b||"screenshot";!function(a,b){var c=document.createElement("a");"string"==typeof c.download?(document.body.appendChild(c),c.download=b,c.href=a,c.click(),document.body.removeChild(c)):location.replace(uri)}(a.getScreenshot(),b+".png")},a.getScreenshot=function(){return a.glRenderer.domElement.toDataURL().replace("image/png","image/octet-stream")},a.getPositionByID=function(b){points=GIM.Points?GIM.Points[b]:null;var c=a.getModelByID(b);return c||points?{floorID:c?c.floorID:points.FloorID,x:c?c.data.nodePosition.x:points.x,y:c?-c.data.nodePosition.y:points.y}:(console.warn("[getPositionByID] 不能找到该点的坐标！"),{})},a.getNearAreaByType=function(b,c,d){if(b&&b.floorID){var e=new THREE.Vector2(b.x,Math.abs(b.y)),f=a.floor3Ds[b.floorID];if(!f)return void console.warn(" [MAP => getNearAreaByType]楼层ID错误或此楼层未构建！！！");for(var g,h,i=f.data.unitsList,j=1e7,k=0;k<i.length;k++){var l=i[k];l.code==c&&(g=new THREE.Vector2(l.nodePosition.x,Math.abs(l.nodePosition.y)).distanceTo(e))<500&&g<j&&(h=l,j=g)}return h}},a.beOffCameraView=function(a,b){var c=a.applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix);return Math.abs(c.x)>=1||Math.abs(c.y)>=1||Math.abs(c.z)>=1},a.getPolygonCrossPoint=function(b){var c=b.length-1,d=b[c];pointID=d.PointID;var e,f=0,g=a.getModelByID(pointID);if(g){for(;void 0==e&&f<8&&c>1;){var h=new THREE.Vector2(b[c-1].x,-Math.abs(b[c-1].y)),i=new THREE.Vector2(b[c].x,-Math.abs(b[c].y));e=polygonCrossPoint(g.data.points,i,h),f++,c--}e&&(e=new THREE.Vector2(e.x,e.y).lerp(h,.05),e.count=f,corssLength=e.distanceTo(i)/a.pixelPerMeter)}return e},a.updateProjectID=function(b,c,d){if(b==GIM.PID&&c==a.buildingID&&1!=MapConfigX.localServer)return console.warn("当前项目与传入的相同 :>> ","projectID:",b,"buildingID:",c),a.initCompleted&&"function"==typeof a.initCompleted&&a.initCompleted(MapConfigX.xFloor,GIM.AreaTypes),void a.showFloors(d);a.disposeData(),GIM.INIT_FLOORID=d,a.buildingID=c||"",GIM.PID=b,a.loadPointData&&a.loadPointData(),map.init(!0),forceUpdate()},a.getMapPosition=function(){return b.position},a.allFloorCreated=!1,a.allFloorCreatedFunc=!1,a.regAllCreatedCall=function(b){a.allFloorCreatedFunc=b},a.setLang=function(a){MapConfigX.lang=a,MapConfigX.LabelMuti.forEach(function(a){MapConfigX.lang==MapConfigX.langEN?a.text=a.data.nameEN:a.text=a.data.nameZH}),forceUpdate()},a.updateMarker=function(){if(null!=a.markerLocate&&void 0!=a.markerLocate&&"function"==typeof a.markerLocate&&void 0!=a.markerHeap&&0!=Object.keys(a.markerHeap).length){var b={};for(var c in a.markerHeap)if(a.markerHeap.hasOwnProperty(c)){var d=a.markerHeap[c],e=a.floor3Ds[d.floorID];if(e){var f=a.toScreenXY(d.x,d.y,e.position.z+d.z);b[c]=f}}a.markerLocate(b)}}},Object.defineProperty(GIM.Map3D.prototype,"lang",{get:function(){return MapConfigX.lang},set:function(a){this.setLang(a)}});var CustomTheme={};GIM.Marker=function(a){function b(b){a.markerPool||(a.markerPool={}),a.markerPool[b.id]=b}function c(b){var c=a.markerPool[b];c&&c.parent?(c.parent.remove(c),c.geometry&&c.geometry.dispose(),c.material&&c.material.dispose(),c=null):console.log("removeObjectFormPool :",b+"not found"),delete a.markerPool[b]}a.regMarkerLocate=function(b){a.markerLocate=b},a.regMarker=function(b,c,d,e,f){var g=f||0;a.markerHeap||(a.markerHeap={}),d-=GIM.OFFSET,e=-Math.abs(e)+GIM.OFFSET,a.markerHeap[b]={markID:b,floorID:c,x:d,y:e,z:g};var h=a.toScreenXY(d,e,f);if(this.orbitControls){var i={type:"change"};a.orbitControls.dispatchEvent(i)}return h},a.removeMarker=function(b){c(b),a.markerHeap||(a.markerHeap={}),delete a.markerHeap[b],console.log("removeMarker markerHeap :",a.markerHeap)},a.removeAllMarker=function(){a.markerHeap=null;for(var b in a.markerPool)if(a.markerPool.hasOwnProperty(b)){var d=a.markerPool[b];c(d.id)}a.markerPool=null},a.measureRealDis=function(){a.toScreenXY(0,0,0),a.toScreenXY(1e3,1e3,0)},a.addPathMarker=function(c,d,e){var f=e||16711680;if(!c)return console.log("coords is null");var g=new THREE.Geometry;c.forEach(function(a){g.vertices.push(new THREE.Vector3(a.x,-Math.abs(a.y),a.z))});var h=new THREE.LineBasicMaterial({color:f,transparent:!0}),i=new THREE.Line(g,h);i.renderOrder=1e7;var j=a.getFloorByID(d);return j?(j.add(i),b(i),i.id):(console.log("[MAP] floor not creates"),null)},a.addPolygonMarker=function(c,d,e,f,g){var h=e||16711680,i=f||.5,j=void 0!=g?Number(g):0;if(!c)return console.log("coords is null");var k=new THREE.Shape;c.forEach(function(a,b){0==b?k.moveTo(a.x,-a.y):k.lineTo(a.x,-a.y)});var l=new THREE.ShapeGeometry(k),m=new THREE.MeshBasicMaterial({color:h,transparent:!0,opacity:i}),n=new THREE.Mesh(l,m);n.position.z=j;var o=a.getFloorByID(d);return n.renderOrder=o.renderOrder+40,o?(o.add(n),b(n),n.id):(console.log("--floor  not creates"),null)},a.getMarkerLayer=function(b){var c=a.getFloorByID(b);return c?c.markerLayer:null}},Object.defineProperties(GIM.Map3D.prototype,{facilityScale:{get:function(){return this._facilityScale},set:function(a){if(isNaN(a))return console.log("facilityScale Not a Number!");this._facilityScale=a,MapConfigX.facilityScale=a,this.forceUpdate(),this.updateSpriteSize()}},markerScale:{get:function(){return this._markerScale},set:function(a){if(isNaN(a))return console.log("markerScale Not a Number!");this._markerScale=a,this.forceUpdate(),this.updateSpriteSize()}},sysScale:{get:function(){return this._sysScale?this._sysScale:1},set:function(a){if(isNaN(a))return console.log("sysScale Not a Number!");this._sysScale=a,this.forceUpdate(),this.updateSpriteSize()}},naviTipScale:{get:function(){return this._naviTipScale?this._naviTipScale:1},set:function(a){if(isNaN(a))return console.log("sysScale Not a Number!");this._naviTipScale=a,this.forceUpdate(),this.updateSpriteSize()}},labelScale:{get:function(){return MapConfigX.labelScale},set:function(a){if(isNaN(a))return console.log("facilityScale Not a Number!");MapConfigX.labelScale=a,this.forceUpdate(),this.updateSpriteSize()}},selectedColor:{get:function(){return this._selectedColor},set:function(a){if(isNaN(a))return console.log("selectedColor Not a Number!");this._selectedColor=a}},cameraRadius:{get:function(){return"3d"==this.viewMode?this.orbitControls?this.orbitControls.getCameraRadius():0:this.vlength},set:function(a){if(isNaN(a))return console.log("cameraRadius Not a Number!");this.orbitControls&&this.orbitControls.setDistance(a)}},minCameraRadius:{get:function(){return this.orbitControls.minDistance},set:function(a){if(isNaN(a))return console.log("minCameraRadius Not a Number!");this.orbitControls.minDistance=a,this.orbitControls.updateTop()}},maxCameraRadius:{get:function(){return this.orbitControls?this.orbitControls.maxDistance:8e4},set:function(a){if(isNaN(a))return console.log("maxCameraRadius Not a Number!");this.orbitControls.maxDistance=a,this.orbitControls.updateTop()}},enableRotate:{get:function(){return!!this.orbitControls&&this.orbitControls.enableRotate},set:function(a){this.orbitControls.enableRotate=a}},pathColor:{get:function(){return GIM.PATH_COLOR},set:function(a){if("string"==typeof a&&"#"==a.charAt(0))var b=a;else{if(isNaN(a))return console.log("pathColor Not a Number!");a=parseInt(a),b="#"+new THREE.Color(a).getHexString()}GIM.PATH_COLOR=b}},pathThickness:{get:function(){return GIM.pathWidth},set:function(a){if(isNaN(a))return console.log("pathThickness Not a Number!");GIM.pathWidth=a}},areaClickEmbed:{get:function(){return this._areaClickEmbed},set:function(a){this._areaClickEmbed=a}},facilityClickEmbed:{get:function(){return MapConfigX.facilityClickEmbed},set:function(a){MapConfigX.facilityClickEmbed=a}},constraintOffset:{get:function(){return this._constraintOffset||(this._constraintOffset=100),this._constraintOffset},set:function(a){if(isNaN(a))return console.log("value Not a Number!");this._constraintOffset=a}},startPID:{get:function(){return this.startNode.pointID},set:function(a){this.startNode.pointID=a,this.addMarkToPoint(a,"start",this.focusSelect)}},endPID:{get:function(){return this.endNode.pointID},set:function(a){this.endNode.pointID=a,this.addMarkToPoint(a,"end",this.focusSelect)}},pathGap:{get:function(){return this._pathGap},set:function(a){this._pathGap=a}},maxFlatHeight:{get:function(){return GIM.maxFlatHeight},set:function(a){GIM.maxFlatHeight=a}},defaultCenterPoint:{get:function(){return this._defaultCenterPoint},set:function(a){a?this._defaultCenterPoint=a:console.log("value is not Vector2")}},pixelPerMeter:{get:function(){return MapConfigX.pixelPerMeter},set:function(a){MapConfigX.pixelPerMeter=a}},locationMarkScale:{get:function(){return MapConfigX.locationMarkScale},set:function(a){MapConfigX.locationMarkScale=a}}}),GIM.ModelMarker=function(a,b,c,d){function e(a,b){k=new THREE.AnimationMixer(a),m={};for(var c=0;c<b.length;c++){var e=b[c],f=k.clipAction(e);m[e.name]=f}d&&"function"==typeof d&&d()}function f(a,b){o=n,n=m[a],o!==n&&void 0!=o&&o.fadeOut(b),n&&n.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(b).play()}function g(){var a=j.getDelta();k&&k.update(a)}THREE.Object3D.call(this);var h=this,i=a.slice(a.lastIndexOf(".")+1).toLowerCase();this.isModelMarker=!0,this.type="ModelMarker";var j,k,l,m,n,o;switch(j=new THREE.Clock,void 0!=a&&null!=a||console.warn("modelURL is invalid address ||模型路径无效"),i){case"glb":case"gltf":var p=new THREE.GLTFLoader;break;case"fbx":if(THREE.FBXLoader)var p=new THREE.FBXLoader;break;default:return}p.load(a,function(a){var b=a.animations;h.animations=b,l=[],b&&b.length>0&&("fbx"==i?e(a,b):e(a.scene,b)),a.scene&&(a=a.scene),a.traverse(function(a){a&&(a.up=new THREE.Vector3(0,1,0),a.material&&(a.material.transparent=!0,a.material.metalness=0,l.push(a.material)),a.renderOrder=c||1e5,a.isModelMarker=!0,a.type="ModelMarker",a.traget=h)}),a.rotation.x=Math.PI/2,a.scale.set(1,1,1),h.add(a)}),this.fadeToAction=f,this.updateAnimation=g,this.scale.multiplyScalar(b||10),this.setOpacity=function(a){isNaN(a)?console.warn("setOpacity value  is NaN"):void 0!=l&&l.forEach(function(b){b&&(b.opacity=a)})},this.hasAction=function(a){return void 0!==m[a]}},GIM.ModelMarker.prototype=Object.create(THREE.Object3D.prototype),GIM.ModelMarker.prototype.constructor=GIM.ModelMarker,Object.defineProperty(GIM.ModelMarker.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,a?GIM.prototype.hitCheckMeshs.push(this):GIM.prototype.hitCheckMeshs.remove(this)}}),GIM.Plane=function(a,b,c,d){function e(a){this.material.transparent=!0,this.material.color=new THREE.Color("white"),this.material.map=a,this.material.needsUpdate=!0}this.data=arguments;var f=new THREE.PlaneBufferGeometry(a,b,2),g=new THREE.MeshBasicMaterial({color:d||16711680,side:THREE.DoubleSide,depthTest:!1,transparent:!0});THREE.Mesh.call(this,f,g);var h=new THREE.TextureLoader;h.crossOrigin="Anonymous",e=e.bind(this),h.load(c,e);var i=function(){void 0==this.interactive&&(this.interactive=!0),this.removeEventListener("added",i)};this.type="Plane",this.addEventListener("added",i)},GIM.Plane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:GIM.Plane,dispose:function(){this.remove(),this.material.map&&this.material.map.dispose(),this.geometry.dispose()}}),Object.copyProperties=function(a,b){Object.getOwnPropertyNames(b).forEach(function(c){/^(?:constructor|isInstanceOf)$/.test(c)||Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))})},Object.copyProperties(GIM.Plane.prototype,GIM.MarkAbstract.prototype),GIM.PolygonMarker=function(a,b,c){var d=new THREE.Shape;a.forEach(function(a,b){0==b?d.moveTo(a.x,-a.y):d.lineTo(a.x,-a.y)});var e=new THREE.ShapeGeometry(d),f=new THREE.MeshBasicMaterial({color:b||16711680,side:THREE.DoubleSide,depthTest:!1,transparent:!0,opacity:c});THREE.Mesh.call(this,e,f),this.type="PolygonMarker";var g=function(){forceUpdate(),this.removeEventListener("added",g)},h=function(){forceUpdate(),this.interactive=!1,this.removeEventListener("removed",h)};this.addEventListener("added",g),this.addEventListener("removed",h)},GIM.PolygonMarker.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:GIM.PolygonMarker,dispose:function(){this.remove(),this.interactive=!1,this.material.map&&this.material.map.dispose(),this.geometry.dispose()},remove:function(){this.parent&&this.parent.remove(this)},setColor:function(a){this.material&&("string"==typeof a&&(a=a.replace("#","0x")),this.material.color.setHex(a)),forceUpdate()},updateCoords:function(a){var b=new THREE.Shape;a.forEach(function(a,c){0==c?b.moveTo(a.x,-a.y):b.lineTo(a.x,-a.y)});var c=new THREE.ShapeGeometry(b);b=null,this.geometry.dispose(),this.geometry=c,forceUpdate()}}),Object.defineProperties(GIM.PolygonMarker.prototype,{interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,a?GIM.prototype.hitCheckMeshs.push(this):GIM.prototype.hitCheckMeshs.remove(this)}},color:{get:function(){return this.material.color},set:function(a){this.setColor(a)}},opacity:{get:function(){return this.material.opacity},set:function(a){this.material.opacity=a,forceUpdate()}}});var TO_RADIANS=Math.PI/180;Particle3D=function(a){THREE.Sprite.call(this,a),this.velocity=new THREE.Vector3(0,0,-8),this.velocity.rotateX(randomRange(-45,45)),this.velocity.rotateY(randomRange(0,360)),this.velocity.rotateZ(randomRange(0,360)),this.gravity=new THREE.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new THREE.Sprite,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.add(this.gravity),this.position.add(this.velocity)},THREE.Vector3.prototype.rotateY=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.z,c=this.x;this.x=c*cosRY+b*sinRY,this.z=c*-sinRY+b*cosRY},THREE.Vector3.prototype.rotateX=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.z,c=this.y;this.y=c*cosRY+b*sinRY,this.z=c*-sinRY+b*cosRY},THREE.Vector3.prototype.rotateZ=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.x,c=this.y;this.y=c*cosRY+b*sinRY,this.x=c*-sinRY+b*cosRY};var SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight;GIM.Snow3D=function(a){for(var b,c=[],d=new THREE.TextureLoader,e=d.load("/theme/snowflake1.png"),f=d.load("/theme/snowflake2.png"),g=d.load("/theme/snowflake3.png"),h=d.load("/theme/snowflake4.png"),i=d.load("/theme/snowflake5.png"),j=[],k=[],l=0;l<1e3;l++){var m=1e4*Math.random(),n=1e4*Math.random()*-1,o=1e4*Math.random()-1e4;j.push(m,n,o)}var p=new THREE.BufferGeometry;p.setAttribute("position",new THREE.Float32BufferAttribute(j,3)),b=[[[1,.2,.5],f,200],[[.95,.1,.5],g,150],[[.9,.05,.5],e,100],[[.85,0,.5],i,80],[[.8,0,.5],h,50]];for(var l=0;l<b.length;l++){var q=b[l][0],r=b[l][1],s=b[l][2];k[l]=new THREE.PointsMaterial({size:s,map:r,depthTest:!1,blending:THREE.AdditiveBlending,transparent:!1}),k[l].color.setHSL(q[0],q[1],q[2]);var t=new THREE.Points(p,k[l]);t.renderOrder=1e7,t.rotation.x=6*Math.random(),t.rotation.y=6*Math.random(),t.rotation.z=6*Math.random(),a.add(t),c.push(t)}this.render=function(){for(var a=5e-6*Date.now(),d=0;d<c.length;d++){var e=c[d];e instanceof THREE.Points&&(e.rotation.y=a*(d<4?d+1:-(d+1)))}for(var d=0;d<k.length;d++){var f=b[d][0],g=360*(f[0]+a)%360/360;k[d].color.setHSL(g,f[1],f[2])}}},GIM.TextMarker=function(a){var b=new THREE.TextTexture(a),c=new THREE.SpriteMaterial({map:b,depthWrite:!1,depthTest:!1,sizeAttenuation:!1,transparent:!0,opacity:.99});THREE.Sprite.call(this,c),b.redraw(),this.width=b.image.width,this.height=b.image.height,this.scaleRatio=this.width/this.height,this.fontSize=b.fontSize,this.height/=2,this.type="TextMarker",this.name=a.text,this.scale.set(1e-4,1e-4,1),this.addEventListener("added",function(){clearTimeout(window.timer007),window.timer007=setTimeout(function(){clearTimeout(window.timer007),updateSpriteSize072(),forceUpdate()},30)})},GIM.TextMarker.prototype=Object.assign(Object.create(THREE.Sprite.prototype),{moveTo:function(a,b,c,d,e,f){function g(){h%8==0&&f&&f(),h++}d=d||1;var h=1;TweenLite.to(this.position,d,{x:a,y:b,z:c,onUpdate:g,onComplete:e,ease:Power0.easeNone}),forceUpdate()},redraw:function(){this.material.map.redraw(),forceUpdate()},dispose:function(){this.material.map.dispose(),this.material.dispose()}});var propertyList=["align","fillStyle","fontFamily","fontStyle","fontVariant","fontWeight","lineGap","padding","strokeStyle","strokeWidth","fontSize"];propertyList.forEach(function(a){Object.defineProperty(GIM.TextMarker.prototype,a,{get:function(){return this.material.map[a]},set:function(b){this.material.map[a]=b}})}),Object.defineProperties(GIM.TextMarker.prototype,{isTextMarker:{value:!0,writable:!1},text:{get:function(){return this.material.map.text},set:function(a){if(void 0!=a&&null!=a){if(this.name=a,MapConfigX.lang==MapConfigX.langEN&&a.length>15){var b=a.split(" ");if(b.length>=4){var c=Math.floor(b.length/2);a=b.slice(0,c).join(" ")+" \n"+b.slice(c,b.length).join(" ")}}this.material.map.text=a,this.material.map.redraw(),this.width=this.material.map.image.width,this.height=this.material.map.image.height,this.scaleRatio=this.width/this.height,this.height/=2,forceUpdate(),updateSpriteSize072()}}},label:{get:function(){return this.text},set:function(a){this.text=a}}});var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.1",API:2,init:function(a,b,c,d){"object"!=typeof b&&(b={rotation:b}),this.finals={};var e,f,g,h,i,j,k=!0===b.useRadians?2*Math.PI:360,l=1e-6;for(e in b)"useRadians"!==e&&(h=b[e],"function"==typeof h&&(h=h(d,a)),j=(h+"").split("_"),f=j[0],g=parseFloat("function"!=typeof a[e]?a[e]:a[e.indexOf("set")||"function"!=typeof a["get"+e.substr(3)]?e:"get"+e.substr(3)]()),h=this.finals[e]="string"==typeof f&&"="===f.charAt(1)?g+parseInt(f.charAt(0)+"1",10)*Number(f.substr(2)):Number(f)||0,i=h-g,j.length&&(f=j.join("_"),-1!==f.indexOf("short")&&(i%=k)!==i%(k/2)&&(i=i<0?i+k:i-k),-1!==f.indexOf("_cw")&&i<0?i=(i+9999999999*k)%k-(i/k|0)*k:-1!==f.indexOf("ccw")&&i>0&&(i=(i-9999999999*k)%k-(i/k|0)*k)),(i>l||i<-l)&&(this._addTween(a,e,g,g+i,e),this._overwriteProps.push(e)));return!0},set:function(a){var b;if(1!==a)this._super.setRatio.call(this,a);else for(b=this._firstPT;b;)b.f?b.t[b.p](this.finals[b.p]):b.t[b.p]=this.finals[b.p],b=b._next}})._autoCSS=!0}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(a){"use strict";var b=function(){return(_gsScope.GreenSockGlobals||_gsScope)[a]};"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd&&define(["TweenLite"],b)}("DirectionalRotationPlugin"),function(a,b){"use strict";var c={},d=a.document,e=a.GreenSockGlobals=a.GreenSockGlobals||a;if(!e.TweenLite){var f,g,h,i,j,k=function(a){var b,c=a.split("."),d=e;for(b=0;b<c.length;b++)d[c[b]]=d=d[c[b]]||{};return d},l=k("com.greensock"),m=1e-10,n=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},o=function(){},p=function(){var a=Object.prototype.toString,b=a.call([]);return function(c){return null!=c&&(c instanceof Array||"object"==typeof c&&!!c.push&&a.call(c)===b)}}(),q={},r=function(d,f,g,h){this.sc=q[d]?q[d].sc:[],q[d]=this,this.gsClass=null,this.func=g;var i=[];this.check=function(j){for(var l,m,n,o,p=f.length,s=p;--p>-1;)(l=q[f[p]]||new r(f[p],[])).gsClass?(i[p]=l.gsClass,s--):j&&l.sc.push(this);if(0===s&&g){if(m=("com.greensock."+d).split("."),n=m.pop(),o=k(m.join("."))[n]=this.gsClass=g.apply(g,i),h)if(e[n]=c[n]=o,"undefined"!=typeof module&&module.exports)if(d===b){module.exports=c[b]=o;for(p in c)o[p]=c[p]}else c[b]&&(c[b][n]=o);else"function"==typeof define&&define.amd&&define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+d.split(".").pop(),[],function(){return o});for(p=0;p<this.sc.length;p++)this.sc[p].check()}},this.check(!0)},s=a._gsDefine=function(a,b,c,d){return new r(a,b,c,d)},t=l._class=function(a,b,c){return b=b||function(){},s(a,[],function(){return b},c),b};s.globals=e;var u=[0,0,1,1],v=t("easing.Ease",function(a,b,c,d){this._func=a,this._type=c||0,this._power=d||0,this._params=b?u.concat(b):u},!0),w=v.map={},x=v.register=function(a,b,c,d){for(var e,f,g,h,i=b.split(","),j=i.length,k=(c||"easeIn,easeOut,easeInOut").split(",");--j>-1;)for(f=i[j],e=d?t("easing."+f,null,!0):l.easing[f]||{},g=k.length;--g>-1;)h=k[g],w[f+"."+h]=w[h+f]=e[h]=a.getRatio?a:a[h]||new a};for(h=v.prototype,h._calcEnd=!1,h.getRatio=function(a){if(this._func)return this._params[0]=a,this._func.apply(null,this._params);var b=this._type,c=this._power,d=1===b?1-a:2===b?a:.5>a?2*a:2*(1-a);return 1===c?d*=d:2===c?d*=d*d:3===c?d*=d*d*d:4===c&&(d*=d*d*d*d),1===b?1-d:2===b?d:.5>a?d/2:1-d/2},f=["Linear","Quad","Cubic","Quart","Quint,Strong"],g=f.length;--g>-1;)h=f[g]+",Power"+g,x(new v(null,null,1,g),h,"easeOut",!0),x(new v(null,null,2,g),h,"easeIn"+(0===g?",easeNone":"")),x(new v(null,null,3,g),h,"easeInOut");w.linear=l.easing.Linear.easeIn,w.swing=l.easing.Quad.easeInOut;var y=t("events.EventDispatcher",function(a){this._listeners={},this._eventTarget=a||this});h=y.prototype,h.addEventListener=function(a,b,c,d,e){e=e||0;var f,g,h=this._listeners[a],k=0;for(this!==i||j||i.wake(),null==h&&(this._listeners[a]=h=[]),g=h.length;--g>-1;)f=h[g],f.c===b&&f.s===c?h.splice(g,1):0===k&&f.pr<e&&(k=g+1);h.splice(k,0,{c:b,s:c,up:d,pr:e})},h.removeEventListener=function(a,b){var c,d=this._listeners[a];if(d)for(c=d.length;--c>-1;)if(d[c].c===b)return void d.splice(c,1)},h.dispatchEvent=function(a){var b,c,d,e=this._listeners[a];if(e)for(b=e.length,b>1&&(e=e.slice(0)),c=this._eventTarget;--b>-1;)(d=e[b])&&(d.up?d.c.call(d.s||c,{type:a,target:c}):d.c.call(d.s||c))};var z=a.requestAnimationFrame,A=a.cancelAnimationFrame,B=Date.now||function(){return(new Date).getTime()},C=B();for(f=["ms","moz","webkit","o"],g=f.length;--g>-1&&!z;)z=a[f[g]+"RequestAnimationFrame"],A=a[f[g]+"CancelAnimationFrame"]||a[f[g]+"CancelRequestAnimationFrame"];t("Ticker",function(a,b){var c,e,f,g,h,k=this,l=B(),n=!(!1===b||!z)&&"auto",p=500,q=33,r="tick",s=function(a){var b,d,i=B()-C;i>p&&(l+=i-q),C+=i,k.time=(C-l)/1e3,b=k.time-h,(!c||b>0||!0===a)&&(k.frame++,h+=b+(b>=g?.004:g-b),d=!0),!0!==a&&(f=e(s)),d&&k.dispatchEvent(r)};y.call(k),k.time=k.frame=0,k.tick=function(){s(!0)},k.lagSmoothing=function(a,b){return arguments.length?(p=a||1/m,void(q=Math.min(b,p,0))):1/m>p},k.sleep=function(){null!=f&&(n&&A?A(f):clearTimeout(f),e=o,f=null,k===i&&(j=!1))},k.wake=function(a){null!==f?k.sleep():a?l+=-C+(C=B()):k.frame>10&&(C=B()-p+5),e=0===c?o:n&&z?z:function(a){return setTimeout(a,1e3*(h-k.time)+1|0)},k===i&&(j=!0),s(2)},k.fps=function(a){return arguments.length?(c=a,g=1/(c||60),h=this.time+g,void k.wake()):c},k.useRAF=function(a){return arguments.length?(k.sleep(),n=a,void k.fps(c)):n},k.fps(a),setTimeout(function(){"auto"===n&&k.frame<5&&"hidden"!==d.visibilityState&&k.useRAF(!1)},1500)}),h=l.Ticker.prototype=new l.events.EventDispatcher,h.constructor=l.Ticker;var D=t("core.Animation",function(a,b){if(this.vars=b=b||{},this._duration=this._totalDuration=a||0,this._delay=Number(b.delay)||0,this._timeScale=1,this._active=!0===b.immediateRender,this.data=b.data,this._reversed=!0===b.reversed,X){j||i.wake();var c=this.vars.useFrames?W:X;c.add(this,c._time),this.vars.paused&&this.paused(!0)}});i=D.ticker=new l.Ticker,h=D.prototype,h._dirty=h._gc=h._initted=h._paused=!1,h._totalTime=h._time=0,h._rawPrevTime=-1,h._next=h._last=h._onUpdate=h._timeline=h.timeline=null,h._paused=!1;var E=function(){j&&B()-C>2e3&&("hidden"!==d.visibilityState||!i.lagSmoothing())&&i.wake();var a=setTimeout(E,2e3);a.unref&&a.unref()};E(),h.play=function(a,b){return null!=a&&this.seek(a,b),this.reversed(!1).paused(!1)},h.pause=function(a,b){return null!=a&&this.seek(a,b),this.paused(!0)},h.resume=function(a,b){return null!=a&&this.seek(a,b),this.paused(!1)},h.seek=function(a,b){return this.totalTime(Number(a),!1!==b)},h.restart=function(a,b){return this.reversed(!1).paused(!1).totalTime(a?-this._delay:0,!1!==b,!0)},h.reverse=function(a,b){return null!=a&&this.seek(a||this.totalDuration(),b),this.reversed(!0).paused(!1)},h.render=function(a,b,c){},h.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},h.isActive=function(){var a,b=this._timeline,c=this._startTime;return!b||!this._gc&&!this._paused&&b.isActive()&&(a=b.rawTime(!0))>=c&&a<c+this.totalDuration()/this._timeScale-1e-7},h._enabled=function(a,b){return j||i.wake(),this._gc=!a,this._active=this.isActive(),!0!==b&&(a&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!a&&this.timeline&&this._timeline._remove(this,!0)),!1},h._kill=function(a,b){return this._enabled(!1,!1)},h.kill=function(a,b){return this._kill(a,b),this},h._uncache=function(a){for(var b=a?this:this.timeline;b;)b._dirty=!0,b=b.timeline;return this},h._swapSelfInParams=function(a){for(var b=a.length,c=a.concat();--b>-1;)"{self}"===a[b]&&(c[b]=this);return c},h._callback=function(a){var b=this.vars,c=b[a],d=b[a+"Params"],e=b[a+"Scope"]||b.callbackScope||this;switch(d?d.length:0){case 0:c.call(e);break;case 1:c.call(e,d[0]);break;case 2:c.call(e,d[0],d[1]);break;default:c.apply(e,d)}},h.eventCallback=function(a,b,c,d){if("on"===(a||"").substr(0,2)){var e=this.vars;if(1===arguments.length)return e[a];null==b?delete e[a]:(e[a]=b,e[a+"Params"]=p(c)&&-1!==c.join("").indexOf("{self}")?this._swapSelfInParams(c):c,e[a+"Scope"]=d),"onUpdate"===a&&(this._onUpdate=b)}return this},h.delay=function(a){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+a-this._delay),this._delay=a,this):this._delay},h.duration=function(a){return arguments.length?(this._duration=this._totalDuration=a,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==a&&this.totalTime(this._totalTime*(a/this._duration),!0),this):(this._dirty=!1,this._duration)},h.totalDuration=function(a){return this._dirty=!1,arguments.length?this.duration(a):this._totalDuration},h.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(a>this._duration?this._duration:a,b)):this._time},h.totalTime=function(a,b,c){if(j||i.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>a&&!c&&(a+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var d=this._totalDuration,e=this._timeline;if(a>d&&!c&&(a=d),this._startTime=(this._paused?this._pauseTime:e._time)-(this._reversed?d-a:a)/this._timeScale,e._dirty||this._uncache(!1),e._timeline)for(;e._timeline;)e._timeline._time!==(e._startTime+e._totalTime)/e._timeScale&&e.totalTime(e._totalTime,!0),e=e._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==a||0===this._duration)&&(J.length&&Z(),this.render(a,b,!1),J.length&&Z())}return this},h.progress=h.totalProgress=function(a,b){var c=this.duration();return arguments.length?this.totalTime(c*a,b):c?this._time/c:this.ratio},h.startTime=function(a){return arguments.length?(a!==this._startTime&&(this._startTime=a,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,a-this._delay)),this):this._startTime},h.endTime=function(a){return this._startTime+(0!=a?this.totalDuration():this.duration())/this._timeScale},h.timeScale=function(a){if(!arguments.length)return this._timeScale;var b,c;for(a=a||m,this._timeline&&this._timeline.smoothChildTiming&&(b=this._pauseTime,c=b||0===b?b:this._timeline.totalTime(),this._startTime=c-(c-this._startTime)*this._timeScale/a),this._timeScale=a,c=this.timeline;c&&c.timeline;)c._dirty=!0,c.totalDuration(),c=c.timeline;return this},h.reversed=function(a){return arguments.length?(a!=this._reversed&&(this._reversed=a,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},h.paused=function(a){if(!arguments.length)return this._paused;var b,c,d=this._timeline;return a!=this._paused&&d&&(j||a||i.wake(),b=d.rawTime(),c=b-this._pauseTime,!a&&d.smoothChildTiming&&(this._startTime+=c,this._uncache(!1)),this._pauseTime=a?b:null,this._paused=a,this._active=this.isActive(),!a&&0!==c&&this._initted&&this.duration()&&(b=d.smoothChildTiming?this._totalTime:(b-this._startTime)/this._timeScale,this.render(b,b===this._totalTime,!0))),this._gc&&!a&&this._enabled(!0,!1),this};var F=t("core.SimpleTimeline",function(a){D.call(this,0,a),this.autoRemoveChildren=this.smoothChildTiming=!0});h=F.prototype=new D,h.constructor=F,h.kill()._gc=!1,h._first=h._last=h._recent=null,h._sortChildren=!1,h.add=h.insert=function(a,b,c,d){var e,f;if(a._startTime=Number(b||0)+a._delay,a._paused&&this!==a._timeline&&(a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale),a.timeline&&a.timeline._remove(a,!0),a.timeline=a._timeline=this,a._gc&&a._enabled(!0,!0),e=this._last,this._sortChildren)for(f=a._startTime;e&&e._startTime>f;)e=e._prev;return e?(a._next=e._next,e._next=a):(a._next=this._first,this._first=a),a._next?a._next._prev=a:this._last=a,a._prev=e,this._recent=a,this._timeline&&this._uncache(!0),this},h._remove=function(a,b){return a.timeline===this&&(b||a._enabled(!1,!0),a._prev?a._prev._next=a._next:this._first===a&&(this._first=a._next),a._next?a._next._prev=a._prev:this._last===a&&(this._last=a._prev),a._next=a._prev=a.timeline=null,a===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},h.render=function(a,b,c){var d,e=this._first;for(this._totalTime=this._time=this._rawPrevTime=a;e;)d=e._next,(e._active||a>=e._startTime&&!e._paused&&!e._gc)&&(e._reversed?e.render((e._dirty?e.totalDuration():e._totalDuration)-(a-e._startTime)*e._timeScale,b,c):e.render((a-e._startTime)*e._timeScale,b,c)),e=d},h.rawTime=function(){return j||i.wake(),this._totalTime};var G=t("TweenLite",function(b,c,d){if(D.call(this,c,d),this.render=G.prototype.render,null==b)throw"Cannot tween a null target.";this.target=b="string"!=typeof b?b:G.selector(b)||b;var e,f,g,h=b.jquery||b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType),i=this.vars.overwrite;if(this._overwrite=i=null==i?V[G.defaultOverwrite]:"number"==typeof i?i>>0:V[i],(h||b instanceof Array||b.push&&p(b))&&"number"!=typeof b[0])for(this._targets=g=n(b),this._propLookup=[],this._siblings=[],e=0;e<g.length;e++)f=g[e],f?"string"!=typeof f?f.length&&f!==a&&f[0]&&(f[0]===a||f[0].nodeType&&f[0].style&&!f.nodeType)?(g.splice(e--,1),this._targets=g=g.concat(n(f))):(this._siblings[e]=$(f,this,!1),1===i&&this._siblings[e].length>1&&aa(f,this,null,1,this._siblings[e])):"string"==typeof(f=g[e--]=G.selector(f))&&g.splice(e+1,1):g.splice(e--,1);else this._propLookup={},this._siblings=$(b,this,!1),1===i&&this._siblings.length>1&&aa(b,this,null,1,this._siblings);(this.vars.immediateRender||0===c&&0===this._delay&&!1!==this.vars.immediateRender)&&(this._time=-m,this.render(Math.min(0,-this._delay)))},!0),H=function(b){return b&&b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType)},I=function(a,b){var c,d={};for(c in a)U[c]||c in b&&"transform"!==c&&"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c&&"className"!==c&&"border"!==c||!(!R[c]||R[c]&&R[c]._autoCSS)||(d[c]=a[c],delete a[c]);a.css=d};h=G.prototype=new D,h.constructor=G,h.kill()._gc=!1,h.ratio=0,h._firstPT=h._targets=h._overwrittenProps=h._startAt=null,h._notifyPluginsOfEnabled=h._lazy=!1,G.version="1.20.3",G.defaultEase=h._ease=new v(null,null,1,1),G.defaultOverwrite="auto",G.ticker=i,G.autoSleep=120,G.lagSmoothing=function(a,b){i.lagSmoothing(a,b)},G.selector=a.$||a.jQuery||function(b){var c=a.$||a.jQuery;return c?(G.selector=c,c(b)):void 0===d?b:d.querySelectorAll?d.querySelectorAll(b):d.getElementById("#"===b.charAt(0)?b.substr(1):b)};var J=[],K={},L=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,M=/[\+-]=-?[\.\d]/,N=function(a){for(var b,c=this._firstPT,d=1e-6;c;)b=c.blob?1===a&&null!=this.end?this.end:a?this.join(""):this.start:c.c*a+c.s,c.m?b=c.m(b,this._target||c.t):d>b&&b>-d&&!c.blob&&(b=0),c.f?c.fp?c.t[c.p](c.fp,b):c.t[c.p](b):c.t[c.p]=b,c=c._next},O=function(a,b,c,d){var e,f,g,h,i,j,k,l=[],m=0,n="",o=0;for(l.start=a,l.end=b,a=l[0]=a+"",b=l[1]=b+"",c&&(c(l),a=l[0],b=l[1]),l.length=0,e=a.match(L)||[],f=b.match(L)||[],d&&(d._next=null,d.blob=1,l._firstPT=l._applyPT=d),i=f.length,h=0;i>h;h++)k=f[h],j=b.substr(m,b.indexOf(k,m)-m),n+=j||!h?j:",",m+=j.length,o?o=(o+1)%5:"rgba("===j.substr(-5)&&(o=1),k===e[h]||e.length<=h?n+=k:(n&&(l.push(n),n=""),g=parseFloat(e[h]),l.push(g),l._firstPT={_next:l._firstPT,t:l,p:l.length-1,s:g,c:("="===k.charAt(1)?parseInt(k.charAt(0)+"1",10)*parseFloat(k.substr(2)):parseFloat(k)-g)||0,f:0,m:o&&4>o?Math.round:0}),m+=k.length;return n+=b.substr(m),n&&l.push(n),l.setRatio=N,M.test(b)&&(l.end=null),l},P=function(a,b,c,d,e,f,g,h,i){"function"==typeof d&&(d=d(i||0,a));var j,k=typeof a[b],l="function"!==k?"":b.indexOf("set")||"function"!=typeof a["get"+b.substr(3)]?b:"get"+b.substr(3),m="get"!==c?c:l?g?a[l](g):a[l]():a[b],n="string"==typeof d&&"="===d.charAt(1),o={t:a,p:b,s:m,f:"function"===k,pg:0,n:e||b,m:f?"function"==typeof f?f:Math.round:0,pr:0,c:n?parseInt(d.charAt(0)+"1",10)*parseFloat(d.substr(2)):parseFloat(d)-m||0};return("number"!=typeof m||"number"!=typeof d&&!n)&&(g||isNaN(m)||!n&&isNaN(d)||"boolean"==typeof m||"boolean"==typeof d?(o.fp=g,j=O(m,n?parseFloat(o.s)+o.c:d,h||G.defaultStringFilter,o),o={t:j,p:"setRatio",s:0,c:1,f:2,pg:0,n:e||b,pr:0,m:0}):(o.s=parseFloat(m),n||(o.c=parseFloat(d)-o.s||0))),o.c?((o._next=this._firstPT)&&(o._next._prev=o),this._firstPT=o,o):void 0},Q=G._internals={isArray:p,isSelector:H,lazyTweens:J,blobDif:O},R=G._plugins={},S=Q.tweenLookup={},T=0,U=Q.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1,yoyoEase:1},V={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},W=D._rootFramesTimeline=new F,X=D._rootTimeline=new F,Y=30,Z=Q.lazyRender=function(){var a,b=J.length;for(K={};--b>-1;)(a=J[b])&&!1!==a._lazy&&(a.render(a._lazy[0],a._lazy[1],!0),a._lazy=!1);J.length=0};X._startTime=i.time,W._startTime=i.frame,X._active=W._active=!0,setTimeout(Z,1),D._updateRoot=G.render=function(){var a,b,c;if(J.length&&Z(),X.render((i.time-X._startTime)*X._timeScale,!1,!1),W.render((i.frame-W._startTime)*W._timeScale,!1,!1),J.length&&Z(),i.frame>=Y){Y=i.frame+(parseInt(G.autoSleep,10)||120);for(c in S){for(b=S[c].tweens,a=b.length;--a>-1;)b[a]._gc&&b.splice(a,1);0===b.length&&delete S[c]}if((!(c=X._first)||c._paused)&&G.autoSleep&&!W._first&&1===i._listeners.tick.length){for(;c&&c._paused;)c=c._next;c||i.sleep()}}},i.addEventListener("tick",D._updateRoot);var $=function(a,b,c){var d,e,f=a._gsTweenID;if(S[f||(a._gsTweenID=f="t"+T++)]||(S[f]={target:a,tweens:[]}),b&&(d=S[f].tweens,d[e=d.length]=b,c))for(;--e>-1;)d[e]===b&&d.splice(e,1);return S[f].tweens},_=function(a,b,c,d){var e,f,g=a.vars.onOverwrite;return g&&(e=g(a,b,c,d)),g=G.onOverwrite,g&&(f=g(a,b,c,d)),!1!==e&&!1!==f},aa=function(a,b,c,d,e){var f,g,h,i;if(1===d||d>=4){for(i=e.length,f=0;i>f;f++)if((h=e[f])!==b)h._gc||h._kill(null,a,b)&&(g=!0);else if(5===d)break;return g}var j,k=b._startTime+m,l=[],n=0,o=0===b._duration;for(f=e.length;--f>-1;)(h=e[f])===b||h._gc||h._paused||(h._timeline!==b._timeline?(j=j||ba(b,0,o),0===ba(h,j,o)&&(l[n++]=h)):h._startTime<=k&&h._startTime+h.totalDuration()/h._timeScale>k&&((o||!h._initted)&&k-h._startTime<=2e-10||(l[n++]=h)));for(f=n;--f>-1;)if(h=l[f],2===d&&h._kill(c,a,b)&&(g=!0),2!==d||!h._firstPT&&h._initted){if(2!==d&&!_(h,b))continue;h._enabled(!1,!1)&&(g=!0)}return g},ba=function(a,b,c){for(var d=a._timeline,e=d._timeScale,f=a._startTime;d._timeline;){if(f+=d._startTime,e*=d._timeScale,d._paused)return-100;d=d._timeline}return f/=e,f>b?f-b:c&&f===b||!a._initted&&2*m>f-b?m:(f+=a.totalDuration()/a._timeScale/e)>b+m?0:f-b-m};h._init=function(){var a,b,c,d,e,f,g=this.vars,h=this._overwrittenProps,i=this._duration,j=!!g.immediateRender,k=g.ease;if(g.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),e={};for(d in g.startAt)e[d]=g.startAt[d];if(e.data="isStart",e.overwrite=!1,e.immediateRender=!0,e.lazy=j&&!1!==g.lazy,e.startAt=e.delay=null,e.onUpdate=g.onUpdate,e.onUpdateParams=g.onUpdateParams,e.onUpdateScope=g.onUpdateScope||g.callbackScope||this,this._startAt=G.to(this.target,0,e),j)if(this._time>0)this._startAt=null;else if(0!==i)return}else if(g.runBackwards&&0!==i)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(j=!1),c={};for(d in g)U[d]&&"autoCSS"!==d||(c[d]=g[d]);if(c.overwrite=0,c.data="isFromStart",c.lazy=j&&!1!==g.lazy,c.immediateRender=j,this._startAt=G.to(this.target,0,c),j){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=k=k?k instanceof v?k:"function"==typeof k?new v(k,g.easeParams):w[k]||G.defaultEase:G.defaultEase,g.easeParams instanceof Array&&k.config&&(this._ease=k.config.apply(k,g.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(f=this._targets.length,a=0;f>a;a++)this._initProps(this._targets[a],this._propLookup[a]={},this._siblings[a],h?h[a]:null,a)&&(b=!0);else b=this._initProps(this.target,this._propLookup,this._siblings,h,0);if(b&&G._onPluginEvent("_onInitAllProps",this),h&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),g.runBackwards)for(c=this._firstPT;c;)c.s+=c.c,c.c=-c.c,c=c._next;this._onUpdate=g.onUpdate,this._initted=!0},h._initProps=function(b,c,d,e,f){var g,h,i,j,k,l;if(null==b)return!1;K[b._gsTweenID]&&Z(),this.vars.css||b.style&&b!==a&&b.nodeType&&R.css&&!1!==this.vars.autoCSS&&I(this.vars,b);for(g in this.vars)if(l=this.vars[g],U[g])l&&(l instanceof Array||l.push&&p(l))&&-1!==l.join("").indexOf("{self}")&&(this.vars[g]=l=this._swapSelfInParams(l,this));else if(R[g]&&(j=new R[g])._onInitTween(b,this.vars[g],this,f)){for(this._firstPT=k={_next:this._firstPT,t:j,p:"setRatio",s:0,c:1,f:1,n:g,pg:1,pr:j._priority,m:0},h=j._overwriteProps.length;--h>-1;)c[j._overwriteProps[h]]=this._firstPT;(j._priority||j._onInitAllProps)&&(i=!0),(j._onDisable||j._onEnable)&&(this._notifyPluginsOfEnabled=!0),k._next&&(k._next._prev=k)}else c[g]=P.call(this,b,g,"get",l,g,0,null,this.vars.stringFilter,f);return e&&this._kill(e,b)?this._initProps(b,c,d,e,f):this._overwrite>1&&this._firstPT&&d.length>1&&aa(b,this,c,this._overwrite,d)?(this._kill(c,b),this._initProps(b,c,d,e,f)):(this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration)&&(K[b._gsTweenID]=!0),i)},h.render=function(a,b,c){var d,e,f,g,h=this._time,i=this._duration,j=this._rawPrevTime;if(a>=i-1e-7&&a>=0)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===i&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(0>j||0>=a&&a>=-1e-7||j===m&&"isPause"!==this.data)&&j!==a&&(c=!0,j>m&&(e="onReverseComplete")),this._rawPrevTime=g=!b||a||j===a?a:m);else if(1e-7>a)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==h||0===i&&j>0)&&(e="onReverseComplete",d=this._reversed),0>a&&(this._active=!1,0===i&&(this._initted||!this.vars.lazy||c)&&(j>=0&&(j!==m||"isPause"!==this.data)&&(c=!0),this._rawPrevTime=g=!b||a||j===a?a:m)),(!this._initted||this._startAt&&this._startAt.progress())&&(c=!0);else if(this._totalTime=this._time=a,this._easeType){var k=a/i,l=this._easeType,n=this._easePower;(1===l||3===l&&k>=.5)&&(k=1-k),3===l&&(k*=2),1===n?k*=k:2===n?k*=k*k:3===n?k*=k*k*k:4===n&&(k*=k*k*k*k),this.ratio=1===l?1-k:2===l?k:.5>a/i?k/2:1-k/2}else this.ratio=this._ease.getRatio(a/i);if(this._time!==h||c){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=h,this._rawPrevTime=j,J.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/i):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(!1!==this._lazy&&(this._lazy=!1),this._active||!this._paused&&this._time!==h&&a>=0&&(this._active=!0),0===h&&(this._startAt&&(a>=0?this._startAt.render(a,!0,c):e||(e="_dummyGS")),this.vars.onStart&&(0!==this._time||0===i)&&(b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(0>a&&this._startAt&&-1e-4!==a&&this._startAt.render(a,!0,c),b||(this._time!==h||d||c)&&this._callback("onUpdate")),e&&(!this._gc||c)&&(0>a&&this._startAt&&!this._onUpdate&&-1e-4!==a&&this._startAt.render(a,!0,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===i&&this._rawPrevTime===m&&g!==m&&(this._rawPrevTime=0))}},h._kill=function(a,b,c){if("all"===a&&(a=null),null==a&&(null==b||b===this.target))return this._lazy=!1,this._enabled(!1,!1);b="string"!=typeof b?b||this._targets||this.target:G.selector(b)||b;var d,e,f,g,h,i,j,k,l,m=c&&this._time&&c._startTime===this._startTime&&this._timeline===c._timeline;if((p(b)||H(b))&&"number"!=typeof b[0])for(d=b.length;--d>-1;)this._kill(a,b[d],c)&&(i=!0);else{if(this._targets){for(d=this._targets.length;--d>-1;)if(b===this._targets[d]){h=this._propLookup[d]||{},this._overwrittenProps=this._overwrittenProps||[],e=this._overwrittenProps[d]=a?this._overwrittenProps[d]||{}:"all";break}}else{if(b!==this.target)return!1;h=this._propLookup,e=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(h){if(j=a||h,k=a!==e&&"all"!==e&&a!==h&&("object"!=typeof a||!a._tempKill),c&&(G.onOverwrite||this.vars.onOverwrite)){for(f in j)h[f]&&(l||(l=[]),l.push(f));if((l||!a)&&!_(this,c,b,l))return!1}for(f in j)(g=h[f])&&(m&&(g.f?g.t[g.p](g.s):g.t[g.p]=g.s,i=!0),g.pg&&g.t._kill(j)&&(i=!0),g.pg&&0!==g.t._overwriteProps.length||(g._prev?g._prev._next=g._next:g===this._firstPT&&(this._firstPT=g._next),g._next&&(g._next._prev=g._prev),g._next=g._prev=null),delete h[f]),k&&(e[f]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return i},h.invalidate=function(){return this._notifyPluginsOfEnabled&&G._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],D.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-m,this.render(Math.min(0,-this._delay))),this},h._enabled=function(a,b){if(j||i.wake(),a&&this._gc){var c,d=this._targets;if(d)for(c=d.length;--c>-1;)this._siblings[c]=$(d[c],this,!0);else this._siblings=$(this.target,this,!0)}return D.prototype._enabled.call(this,a,b),!(!this._notifyPluginsOfEnabled||!this._firstPT)&&G._onPluginEvent(a?"_onEnable":"_onDisable",this)},G.to=function(a,b,c){return new G(a,b,c)},G.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new G(a,b,c)},G.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new G(a,b,d)},G.delayedCall=function(a,b,c,d,e){return new G(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,lazy:!1,useFrames:e,overwrite:0})},G.set=function(a,b){return new G(a,0,b)},G.getTweensOf=function(a,b){if(null==a)return[];a="string"!=typeof a?a:G.selector(a)||a;var c,d,e,f;if((p(a)||H(a))&&"number"!=typeof a[0]){for(c=a.length,d=[];--c>-1;)d=d.concat(G.getTweensOf(a[c],b));for(c=d.length;--c>-1;)for(f=d[c],e=c;--e>-1;)f===d[e]&&d.splice(c,1)}else if(a._gsTweenID)for(d=$(a).concat(),c=d.length;--c>-1;)(d[c]._gc||b&&!d[c].isActive())&&d.splice(c,1);return d||[]},G.killTweensOf=G.killDelayedCallsTo=function(a,b,c){"object"==typeof b&&(c=b,b=!1);for(var d=G.getTweensOf(a,b),e=d.length;--e>-1;)d[e]._kill(c,a)};var ca=t("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(","),this._propName=this._overwriteProps[0],this._priority=b||0,this._super=ca.prototype},!0);if(h=ca.prototype,ca.version="1.19.0",ca.API=2,h._firstPT=null,h._addTween=P,h.setRatio=N,h._kill=function(a){var b,c=this._overwriteProps,d=this._firstPT;if(null!=a[this._propName])this._overwriteProps=[];else for(b=c.length;--b>-1;)null!=a[c[b]]&&c.splice(b,1);for(;d;)null!=a[d.n]&&(d._next&&(d._next._prev=d._prev),d._prev?(d._prev._next=d._next,d._prev=null):this._firstPT===d&&(this._firstPT=d._next)),d=d._next;return!1},h._mod=h._roundProps=function(a){for(var b,c=this._firstPT;c;)b=a[this._propName]||null!=c.n&&a[c.n.split(this._propName+"_").join("")],b&&"function"==typeof b&&(2===c.f?c.t._applyPT.m=b:c.m=b),c=c._next},G._onPluginEvent=function(a,b){var c,d,e,f,g,h=b._firstPT;if("_onInitAllProps"===a){for(;h;){for(g=h._next,d=e;d&&d.pr>h.pr;)d=d._next;(h._prev=d?d._prev:f)?h._prev._next=h:e=h,(h._next=d)?d._prev=h:f=h,h=g}h=b._firstPT=e}for(;h;)h.pg&&"function"==typeof h.t[a]&&h.t[a]()&&(c=!0),h=h._next;return c},ca.activate=function(a){for(var b=a.length;--b>-1;)a[b].API===ca.API&&(R[(new a[b])._propName]=a[b]);return!0},s.plugin=function(a){if(!(a&&a.propName&&a.init&&a.API))throw"illegal plugin definition.";var b,c=a.propName,d=a.priority||0,e=a.overwriteProps,f={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},g=t("plugins."+c.charAt(0).toUpperCase()+c.substr(1)+"Plugin",function(){ca.call(this,c,d),this._overwriteProps=e||[]},!0===a.global),h=g.prototype=new ca(c);h.constructor=g,g.API=a.API;for(b in f)"function"==typeof a[b]&&(h[f[b]]=a[b]);return g.version=a.version,ca.activate([g]),g},f=a._gsQueue){for(g=0;g<f.length;g++)f[g]();for(h in q)q[h].func||a.console.log("GSAP encountered missing dependency: "+h)}j=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenLite"),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return!!Array.isArray(a)&&(g(a,c[b],c),!0)}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if(c=ma[g],(e=c?c+f:b)in a)return e;g++}return d}function v(){return ua++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b=a.options.inputClass;return new(b||(xa?M:ya?P:wa?R:L))(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e==0,g=b&(Ga|Ha)&&d-e==0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?0>a?Ja:Ka:0>b?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}function K(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function S(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function U(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(db>=f&&db>=g)return!0}return!1}function V(a,b){this.manager=a,this.set(b)}function W(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}function X(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=!c||a.CSS.supports("touch-action",d)}),b}function Y(a){this.options=la({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=y(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;if(c.style){var d;g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&va.test(navigator.userAgent),za="touch",Aa="pen",Ba="mouse",Ca="kinect",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:Aa,4:Ba,5:Ca},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length==0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)S.call(this,b,c);else if(e&&U.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=X();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),W(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16,tb=32;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;qb>d&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=tb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(tb|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|tb)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=tb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:tb}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:0>f?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:0>g?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return tb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return tb},failTimeout:function(){return this._timer=e(function(){this.state=tb},this.options.interval,this),tb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.8",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ub=2;ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?ub:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===ub||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:tb,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=ha,"function"==typeof define&&define.amd?define(function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a[c]=ha}(window,document,"Hammer"),THREE.GLTFLoader=function(){function a(a){THREE.Loader.call(this,a),this.dracoLoader=null,this.ddsLoader=null}function b(){var a={};return{get:function(b){return a[b]},add:function(b,c){a[b]=c},remove:function(b){delete a[b]},removeAll:function(){a={}}}}function c(a){if(!a)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=z.MSFT_TEXTURE_DDS,this.ddsLoader=a}function d(a){this.name=z.KHR_LIGHTS_PUNCTUAL;var b=a.extensions&&a.extensions[z.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=b.lights||[]}function e(){this.name=z.KHR_MATERIALS_UNLIT}function f(){this.name=z.KHR_MATERIALS_CLEARCOAT}function g(a){this.name=z.KHR_BINARY_GLTF,this.content=null,this.body=null;var b=new DataView(a,0,B);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:b.getUint32(4,!0),length:b.getUint32(8,!0)},this.header.magic!==A)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var c=new DataView(a,B),d=0;d<c.byteLength;){var e=c.getUint32(d,!0);d+=4;var f=c.getUint32(d,!0);if(d+=4,f===C.JSON){var g=new Uint8Array(a,B+d,e);this.content=THREE.LoaderUtils.decodeText(g)}else if(f===C.BIN){var h=B+d;this.body=a.slice(h,h+e)}d+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function h(a,b){if(!b)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=z.KHR_DRACO_MESH_COMPRESSION,this.json=a,this.dracoLoader=b,this.dracoLoader.preload()}function i(){this.name=z.KHR_TEXTURE_TRANSFORM}function j(a){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var b=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),c=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),d=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),e=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),g={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=g,this.onBeforeCompile=function(a){for(var h in g)a.uniforms[h]=g[h];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),a.fragmentShader=a.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),a.fragmentShader=a.fragmentShader.replace("#include <roughnessmap_pars_fragment>",b),a.fragmentShader=a.fragmentShader.replace("#include <metalnessmap_pars_fragment>",c),a.fragmentShader=a.fragmentShader.replace("#include <roughnessmap_fragment>",d),a.fragmentShader=a.fragmentShader.replace("#include <metalnessmap_fragment>",e),a.fragmentShader=a.fragmentShader.replace("#include <lights_physical_fragment>",f)},Object.defineProperties(this,{specular:{get:function(){return g.specular.value},set:function(a){g.specular.value=a}},specularMap:{get:function(){return g.specularMap.value},set:function(a){g.specularMap.value=a}},glossiness:{get:function(){return g.glossiness.value},set:function(a){g.glossiness.value=a}},glossinessMap:{get:function(){return g.glossinessMap.value},set:function(a){g.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(a)}function k(){return{name:z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return j},extendParams:function(a,b,c){var d=b.extensions[this.name];a.color=new THREE.Color(1,1,1),a.opacity=1;var e=[];if(Array.isArray(d.diffuseFactor)){var f=d.diffuseFactor;a.color.fromArray(f),a.opacity=f[3]}if(void 0!==d.diffuseTexture&&e.push(c.assignTexture(a,"map",d.diffuseTexture)),a.emissive=new THREE.Color(0,0,0),a.glossiness=void 0!==d.glossinessFactor?d.glossinessFactor:1,a.specular=new THREE.Color(1,1,1),Array.isArray(d.specularFactor)&&a.specular.fromArray(d.specularFactor),void 0!==d.specularGlossinessTexture){var g=d.specularGlossinessTexture;e.push(c.assignTexture(a,"glossinessMap",g)),e.push(c.assignTexture(a,"specularMap",g))}return Promise.all(e)},createMaterial:function(a){var b=new j(a);return b.fog=!0,b.color=a.color,b.map=void 0===a.map?null:a.map,b.lightMap=null,b.lightMapIntensity=1,b.aoMap=void 0===a.aoMap?null:a.aoMap,b.aoMapIntensity=1,b.emissive=a.emissive,b.emissiveIntensity=1,b.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap,b.bumpMap=void 0===a.bumpMap?null:a.bumpMap,b.bumpScale=1,b.normalMap=void 0===a.normalMap?null:a.normalMap,b.normalMapType=THREE.TangentSpaceNormalMap,a.normalScale&&(b.normalScale=a.normalScale),b.displacementMap=null,b.displacementScale=1,b.displacementBias=0,b.specularMap=void 0===a.specularMap?null:a.specularMap,b.specular=a.specular,b.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap,b.glossiness=a.glossiness,b.alphaMap=null,b.envMap=void 0===a.envMap?null:a.envMap,b.envMapIntensity=1,b.refractionRatio=.98,b}}}function l(){this.name=z.KHR_MESH_QUANTIZATION}function m(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)}function n(a,b){return"string"!=typeof a||""===a?"":(/^https?:\/\//i.test(b)&&/^\//.test(a)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)?a:/^data:.*,.*$/i.test(a)?a:/^blob:.*$/i.test(a)?a:b+a)}function o(a){return void 0===a.DefaultMaterial&&(a.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),a.DefaultMaterial}function p(a,b,c){for(var d in c.extensions)void 0===a[d]&&(b.userData.gltfExtensions=b.userData.gltfExtensions||{},b.userData.gltfExtensions[d]=c.extensions[d])}function q(a,b){void 0!==b.extras&&("object"==typeof b.extras?Object.assign(a.userData,b.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+b.extras))}function r(a,b,c){for(var d=!1,e=!1,f=0,g=b.length;f<g;f++){var h=b[f];if(void 0!==h.POSITION&&(d=!0),void 0!==h.NORMAL&&(e=!0),d&&e)break}if(!d&&!e)return Promise.resolve(a);for(var i=[],j=[],f=0,g=b.length;f<g;f++){var h=b[f];if(d){var k=void 0!==h.POSITION?c.getDependency("accessor",h.POSITION):a.attributes.position;i.push(k)}if(e){var k=void 0!==h.NORMAL?c.getDependency("accessor",h.NORMAL):a.attributes.normal;j.push(k)}}return Promise.all([Promise.all(i),Promise.all(j)]).then(function(b){var c=b[0],f=b[1];return d&&(a.morphAttributes.position=c),e&&(a.morphAttributes.normal=f),a.morphTargetsRelative=!0,a})}function s(a,b){if(a.updateMorphTargets(),void 0!==b.weights)for(var c=0,d=b.weights.length;c<d;c++)a.morphTargetInfluences[c]=b.weights[c];if(b.extras&&Array.isArray(b.extras.targetNames)){var e=b.extras.targetNames;if(a.morphTargetInfluences.length===e.length){a.morphTargetDictionary={};for(var c=0,d=e.length;c<d;c++)a.morphTargetDictionary[e[c]]=c}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function t(a){var b=a.extensions&&a.extensions[z.KHR_DRACO_MESH_COMPRESSION];return b?"draco:"+b.bufferView+":"+b.indices+":"+u(b.attributes):a.indices+":"+u(a.attributes)+":"+a.mode}function u(a){for(var b="",c=Object.keys(a).sort(),d=0,e=c.length;d<e;d++)b+=c[d]+":"+a[c[d]]+";";return b}function v(a,c,d){this.json=a||{},this.extensions=c||{},this.options=d||{},this.cache=new b,this.associations=new Map,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function w(a,b,c){var d=b.attributes,e=new THREE.Box3;if(void 0!==d.POSITION){var f=c.json.accessors[d.POSITION],g=f.min,h=f.max;if(void 0===g||void 0===h)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");e.set(new THREE.Vector3(g[0],g[1],g[2]),new THREE.Vector3(h[0],h[1],h[2]));var i=b.targets;if(void 0!==i){for(var j=new THREE.Vector3,k=new THREE.Vector3,l=0,m=i.length;l<m;l++){var n=i[l];if(void 0!==n.POSITION){var f=c.json.accessors[n.POSITION],g=f.min,h=f.max;void 0!==g&&void 0!==h?(k.setX(Math.max(Math.abs(g[0]),Math.abs(h[0]))),k.setY(Math.max(Math.abs(g[1]),Math.abs(h[1]))),k.setZ(Math.max(Math.abs(g[2]),Math.abs(h[2]))),j.max(k)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}e.expandByVector(j)}a.boundingBox=e;var o=new THREE.Sphere;e.getCenter(o.center),o.radius=e.min.distanceTo(e.max)/2,a.boundingSphere=o}}function x(a,b,c){function d(b,d){return c.getDependency("accessor",b).then(function(b){a.setAttribute(d,b)})}var e=b.attributes,f=[];for(var g in e){var h=I[g]||g.toLowerCase();h in a.attributes||f.push(d(e[g],h))}if(void 0!==b.indices&&!a.index){var i=c.getDependency("accessor",b.indices).then(function(b){a.setIndex(b)});f.push(i)}return q(a,b),w(a,b,c),Promise.all(f).then(function(){return void 0!==b.targets?r(a,b.targets,c):a})}function y(a,b){var c=a.getIndex();if(null===c){var d=[],e=a.getAttribute("position");if(void 0===e)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(var f=0;f<e.count;f++)d.push(f);a.setIndex(d),c=a.getIndex()}var g=c.count-2,h=[];if(b===THREE.TriangleFanDrawMode)for(var f=1;f<=g;f++)h.push(c.getX(0)),h.push(c.getX(f)),h.push(c.getX(f+1));else for(var f=0;f<g;f++)f%2==0?(h.push(c.getX(f)),h.push(c.getX(f+1)),h.push(c.getX(f+2))):(h.push(c.getX(f+2)),h.push(c.getX(f+1)),h.push(c.getX(f)));h.length/3!==g&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var i=a.clone();return i.setIndex(h),i}a.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:a,load:function(a,b,c,d){var e,f=this;e=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(a),f.manager.itemStart(a);var g=function(b){d?d(b):console.error(b),f.manager.itemError(a),f.manager.itemEnd(a)},h=new THREE.FileLoader(f.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),"use-credentials"===f.crossOrigin&&h.setWithCredentials(!0),h.load(a,function(c){try{f.parse(c,e,function(c){b(c),f.manager.itemEnd(a)},g)}catch(a){g(a)}},c,g)},setDRACOLoader:function(a){return this.dracoLoader=a,this},setDDSLoader:function(a){return this.ddsLoader=a,this},parse:function(a,b,j,m){var n,o={};if("string"==typeof a)n=a;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(a,0,4))===A){try{o[z.KHR_BINARY_GLTF]=new g(a)}catch(a){return void(m&&m(a))}n=o[z.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(a))}var p=JSON.parse(n);if(void 0===p.asset||p.asset.version[0]<2)return void(m&&m(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));if(p.extensionsUsed)for(var q=0;q<p.extensionsUsed.length;++q){var r=p.extensionsUsed[q],s=p.extensionsRequired||[];switch(r){case z.KHR_LIGHTS_PUNCTUAL:o[r]=new d(p);break;case z.KHR_MATERIALS_CLEARCOAT:o[r]=new f;break;case z.KHR_MATERIALS_UNLIT:o[r]=new e;break;case z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[r]=new k;break;case z.KHR_DRACO_MESH_COMPRESSION:o[r]=new h(p,this.dracoLoader);break;case z.MSFT_TEXTURE_DDS:o[r]=new c(this.ddsLoader);break;case z.KHR_TEXTURE_TRANSFORM:o[r]=new i;break;case z.KHR_MESH_QUANTIZATION:o[r]=new l;break;default:s.indexOf(r)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+r+'".')}}var t=new v(p,o,{path:b||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});t.fileLoader.setRequestHeader(this.requestHeader),t.parse(j,m)}});var z={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};d.prototype.loadLight=function(a){var b,c=this.lightDefs[a],d=new THREE.Color(16777215);void 0!==c.color&&d.fromArray(c.color);var e=void 0!==c.range?c.range:0;switch(c.type){case"directional":b=new THREE.DirectionalLight(d),b.target.position.set(0,0,-1),b.add(b.target);break;case"point":b=new THREE.PointLight(d),b.distance=e;break;case"spot":b=new THREE.SpotLight(d),b.distance=e,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,b.angle=c.spot.outerConeAngle,b.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,b.target.position.set(0,0,-1),b.add(b.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+c.type+'".')}return b.position.set(0,0,0),b.decay=2,void 0!==c.intensity&&(b.intensity=c.intensity),b.name=c.name||"light_"+a,Promise.resolve(b)},e.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},e.prototype.extendParams=function(a,b,c){var d=[];a.color=new THREE.Color(1,1,1),a.opacity=1;var e=b.pbrMetallicRoughness;if(e){if(Array.isArray(e.baseColorFactor)){var f=e.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}void 0!==e.baseColorTexture&&d.push(c.assignTexture(a,"map",e.baseColorTexture))}return Promise.all(d)},f.prototype.getMaterialType=function(){return THREE.MeshPhysicalMaterial},f.prototype.extendParams=function(a,b,c){var d=[],e=b.extensions[this.name];if(void 0!==e.clearcoatFactor&&(a.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&d.push(c.assignTexture(a,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(a.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&d.push(c.assignTexture(a,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(d.push(c.assignTexture(a,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale)){var f=e.clearcoatNormalTexture.scale;a.clearcoatNormalScale=new THREE.Vector2(f,f)}return Promise.all(d)};var A="glTF",B=12,C={JSON:1313821514,BIN:5130562};h.prototype.decodePrimitive=function(a,b){var c=this.json,d=this.dracoLoader,e=a.extensions[this.name].bufferView,f=a.extensions[this.name].attributes,g={},h={},i={};for(var j in f){var k=I[j]||j.toLowerCase();g[k]=f[j]}for(j in a.attributes){var k=I[j]||j.toLowerCase();if(void 0!==f[j]){var l=c.accessors[a.attributes[j]],m=E[l.componentType];i[k]=m,h[k]=!0===l.normalized}}return b.getDependency("bufferView",e).then(function(a){return new Promise(function(b){d.decodeDracoFile(a,function(a){for(var c in a.attributes){var d=a.attributes[c],e=h[c];void 0!==e&&(d.normalized=e)}b(a)},g,i)})})},i.prototype.extendTexture=function(a,b){return a=a.clone(),void 0!==b.offset&&a.offset.fromArray(b.offset),void 0!==b.rotation&&(a.rotation=b.rotation),void 0!==b.scale&&a.repeat.fromArray(b.scale),void 0!==b.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),a.needsUpdate=!0,a},j.prototype=Object.create(THREE.MeshStandardMaterial.prototype),j.prototype.constructor=j,j.prototype.copy=function(a){return THREE.MeshStandardMaterial.prototype.copy.call(this,a),this.specularMap=a.specularMap,this.specular.copy(a.specular),this.glossinessMap=a.glossinessMap,this.glossiness=a.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},m.prototype=Object.create(THREE.Interpolant.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(a){for(var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d*3+d,f=0;f!==d;f++)b[f]=c[e+f];return b},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=2*g,i=3*g,j=d-b,k=(c-b)/j,l=k*k,m=l*k,n=a*i,o=n-i,p=-2*m+3*l,q=m-l,r=1-p,s=q-l+k,t=0;t!==g;t++){var u=f[o+t+g],v=f[o+t+h]*j,w=f[n+t+g],x=f[n+t]*j;e[t]=r*u+s*v+p*w+q*x}return e};var D={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},E={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},G={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},J={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},L={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},M={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};return v.prototype.parse=function(a,b){var c=this,d=this.json,e=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(b){var f={scene:b[0][d.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:d.asset,parser:c,userData:{}};p(e,f,d),q(f,d),a(f)}).catch(b)},v.prototype.markDefs=function(){for(var a=this.json.nodes||[],b=this.json.skins||[],c=this.json.meshes||[],d={},e={},f=0,g=b.length;f<g;f++)for(var h=b[f].joints,i=0,j=h.length;i<j;i++)a[h[i]].isBone=!0;for(var k=0,l=a.length;k<l;k++){var m=a[k];void 0!==m.mesh&&(void 0===d[m.mesh]&&(d[m.mesh]=e[m.mesh]=0),d[m.mesh]++,void 0!==m.skin&&(c[m.mesh].isSkinnedMesh=!0))}this.json.meshReferences=d,this.json.meshUses=e},v.prototype.getDependency=function(a,b){var c=a+":"+b,d=this.cache.get(c);if(!d){switch(a){case"scene":d=this.loadScene(b);break;case"node":d=this.loadNode(b);break;case"mesh":d=this.loadMesh(b);break;case"accessor":d=this.loadAccessor(b);break;case"bufferView":d=this.loadBufferView(b);break;case"buffer":d=this.loadBuffer(b);break;case"material":d=this.loadMaterial(b);break;case"texture":d=this.loadTexture(b);break;case"skin":d=this.loadSkin(b);break;case"animation":d=this.loadAnimation(b);break;case"camera":d=this.loadCamera(b);break;case"light":d=this.extensions[z.KHR_LIGHTS_PUNCTUAL].loadLight(b);break;default:throw new Error("Unknown type: "+a)}this.cache.add(c,d)}return d},v.prototype.getDependencies=function(a){var b=this.cache.get(a);if(!b){var c=this,d=this.json[a+("mesh"===a?"es":"s")]||[];b=Promise.all(d.map(function(b,d){return c.getDependency(a,d)})),this.cache.add(a,b)}return b},v.prototype.loadBuffer=function(a){var b=this.json.buffers[a],c=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw new Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===a)return Promise.resolve(this.extensions[z.KHR_BINARY_GLTF].body);var d=this.options;return new Promise(function(a,e){c.load(n(b.uri,d.path),a,void 0,function(){e(new Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})})},v.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteLength||0,d=b.byteOffset||0;return a.slice(d,d+c)})},v.prototype.loadAccessor=function(a){var b=this,c=this.json,d=this.json.accessors[a];if(void 0===d.bufferView&&void 0===d.sparse)return Promise.resolve(null);var e=[];return void 0!==d.bufferView?e.push(this.getDependency("bufferView",d.bufferView)):e.push(null),void 0!==d.sparse&&(e.push(this.getDependency("bufferView",d.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",d.sparse.values.bufferView))),Promise.all(e).then(function(a){var e,f,g=a[0],h=H[d.type],i=E[d.componentType],j=i.BYTES_PER_ELEMENT,k=j*h,l=d.byteOffset||0,m=void 0!==d.bufferView?c.bufferViews[d.bufferView].byteStride:void 0,n=!0===d.normalized;if(m&&m!==k){var o=Math.floor(l/m),p="InterleavedBuffer:"+d.bufferView+":"+d.componentType+":"+o+":"+d.count,q=b.cache.get(p);q||(e=new i(g,o*m,d.count*m/j),q=new THREE.InterleavedBuffer(e,m/j),b.cache.add(p,q)),f=new THREE.InterleavedBufferAttribute(q,h,l%m/j,n)}else e=null===g?new i(d.count*h):new i(g,l,d.count*h),f=new THREE.BufferAttribute(e,h,n);if(void 0!==d.sparse){var r=H.SCALAR,s=E[d.sparse.indices.componentType],t=d.sparse.indices.byteOffset||0,u=d.sparse.values.byteOffset||0,v=new s(a[1],t,d.sparse.count*r),w=new i(a[2],u,d.sparse.count*h);null!==g&&(f=new THREE.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(var x=0,y=v.length;x<y;x++){var z=v[x];if(f.setX(z,w[x*h]),h>=2&&f.setY(z,w[x*h+1]),h>=3&&f.setZ(z,w[x*h+2]),h>=4&&f.setW(z,w[x*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})},v.prototype.loadTexture=function(a){var b,c=this,d=this.json,e=this.options,f=this.textureLoader,g=self.URL||self.webkitURL,h=d.textures[a],i=h.extensions||{};b=i[z.MSFT_TEXTURE_DDS]?d.images[i[z.MSFT_TEXTURE_DDS].source]:d.images[h.source];var j=b.uri,k=!1;return void 0!==b.bufferView&&(j=c.getDependency("bufferView",b.bufferView).then(function(a){k=!0;var c=new Blob([a],{type:b.mimeType});return j=g.createObjectURL(c)})),Promise.resolve(j).then(function(a){var b=e.manager.getHandler(a);return b||(b=i[z.MSFT_TEXTURE_DDS]?c.extensions[z.MSFT_TEXTURE_DDS].ddsLoader:f),new Promise(function(c,d){b.load(n(a,e.path),c,void 0,d)})}).then(function(e){!0===k&&g.revokeObjectURL(j),e.flipY=!1,h.name&&(e.name=h.name),b.mimeType in M&&(e.format=M[b.mimeType]);var f=d.samplers||{},i=f[h.sampler]||{};return e.magFilter=F[i.magFilter]||THREE.LinearFilter,e.minFilter=F[i.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=G[i.wrapS]||THREE.RepeatWrapping,e.wrapT=G[i.wrapT]||THREE.RepeatWrapping,c.associations.set(e,{type:"textures",index:a}),e})},v.prototype.assignTexture=function(a,b,c){var d=this;return this.getDependency("texture",c.index).then(function(e){if(!e.isCompressedTexture)switch(b){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":e.format=THREE.RGBFormat}if(void 0===c.texCoord||0==c.texCoord||"aoMap"===b&&1==c.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+c.texCoord+" for texture "+b+" not yet supported."),d.extensions[z.KHR_TEXTURE_TRANSFORM]){var f=void 0!==c.extensions?c.extensions[z.KHR_TEXTURE_TRANSFORM]:void 0;if(f){var g=d.associations.get(e);e=d.extensions[z.KHR_TEXTURE_TRANSFORM].extendTexture(e,f),d.associations.set(e,g)}}a[b]=e})},v.prototype.assignFinalMaterial=function(a){var b=a.geometry,c=a.material,d=void 0!==b.attributes.tangent,e=void 0!==b.attributes.color,f=void 0===b.attributes.normal,g=!0===a.isSkinnedMesh,h=Object.keys(b.morphAttributes).length>0,i=h&&void 0!==b.morphAttributes.normal;if(a.isPoints){var j="PointsMaterial:"+c.uuid,k=this.cache.get(j);k||(k=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(k,c),k.color.copy(c.color),k.map=c.map,k.sizeAttenuation=!1,this.cache.add(j,k)),c=k}else if(a.isLine){var j="LineBasicMaterial:"+c.uuid,l=this.cache.get(j);l||(l=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(l,c),l.color.copy(c.color),this.cache.add(j,l)),c=l}if(d||e||f||g||h){var j="ClonedMaterial:"+c.uuid+":";c.isGLTFSpecularGlossinessMaterial&&(j+="specular-glossiness:"),g&&(j+="skinning:"),d&&(j+="vertex-tangents:"),e&&(j+="vertex-colors:"),f&&(j+="flat-shading:"),h&&(j+="morph-targets:"),i&&(j+="morph-normals:");var m=this.cache.get(j);m||(m=c.clone(),g&&(m.skinning=!0),d&&(m.vertexTangents=!0),e&&(m.vertexColors=!0),f&&(m.flatShading=!0),h&&(m.morphTargets=!0),i&&(m.morphNormals=!0),this.cache.add(j,m),this.associations.set(m,this.associations.get(c))),c=m}c.aoMap&&void 0===b.attributes.uv2&&void 0!==b.attributes.uv&&b.setAttribute("uv2",b.attributes.uv),c.normalScale&&!d&&(c.normalScale.y=-c.normalScale.y),c.clearcoatNormalScale&&!d&&(c.clearcoatNormalScale.y=-c.clearcoatNormalScale.y),a.material=c},v.prototype.loadMaterial=function(a){var b,c=this,d=this.json,e=this.extensions,f=d.materials[a],g={},h=f.extensions||{},i=[];if(h[z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var k=e[z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];b=k.getMaterialType(),i.push(k.extendParams(g,f,c))}else if(h[z.KHR_MATERIALS_UNLIT]){var l=e[z.KHR_MATERIALS_UNLIT];b=l.getMaterialType(),i.push(l.extendParams(g,f,c))}else{b=THREE.MeshStandardMaterial;var m=f.pbrMetallicRoughness||{};if(g.color=new THREE.Color(1,1,1),g.opacity=1,Array.isArray(m.baseColorFactor)){var n=m.baseColorFactor;g.color.fromArray(n),g.opacity=n[3]}void 0!==m.baseColorTexture&&i.push(c.assignTexture(g,"map",m.baseColorTexture)),g.metalness=void 0!==m.metallicFactor?m.metallicFactor:1,g.roughness=void 0!==m.roughnessFactor?m.roughnessFactor:1,void 0!==m.metallicRoughnessTexture&&(i.push(c.assignTexture(g,"metalnessMap",m.metallicRoughnessTexture)),i.push(c.assignTexture(g,"roughnessMap",m.metallicRoughnessTexture)))}!0===f.doubleSided&&(g.side=THREE.DoubleSide);var o=f.alphaMode||L.OPAQUE;if(o===L.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,o===L.MASK&&(g.alphaTest=void 0!==f.alphaCutoff?f.alphaCutoff:.5)),void 0!==f.normalTexture&&b!==THREE.MeshBasicMaterial&&(i.push(c.assignTexture(g,"normalMap",f.normalTexture)),g.normalScale=new THREE.Vector2(1,1),void 0!==f.normalTexture.scale&&g.normalScale.set(f.normalTexture.scale,f.normalTexture.scale)),void 0!==f.occlusionTexture&&b!==THREE.MeshBasicMaterial&&(i.push(c.assignTexture(g,"aoMap",f.occlusionTexture)),void 0!==f.occlusionTexture.strength&&(g.aoMapIntensity=f.occlusionTexture.strength)),void 0!==f.emissiveFactor&&b!==THREE.MeshBasicMaterial&&(g.emissive=(new THREE.Color).fromArray(f.emissiveFactor)),void 0!==f.emissiveTexture&&b!==THREE.MeshBasicMaterial&&i.push(c.assignTexture(g,"emissiveMap",f.emissiveTexture)),h[z.KHR_MATERIALS_CLEARCOAT]){var r=e[z.KHR_MATERIALS_CLEARCOAT];b=r.getMaterialType(),i.push(r.extendParams(g,{extensions:h},c))}return Promise.all(i).then(function(){var d;return d=b===j?e[z.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(g):new b(g),f.name&&(d.name=f.name),d.map&&(d.map.encoding=THREE.sRGBEncoding),d.emissiveMap&&(d.emissiveMap.encoding=THREE.sRGBEncoding),q(d,f),c.associations.set(d,{type:"materials",index:a}),f.extensions&&p(e,d,f),d})},v.prototype.loadGeometries=function(a){function b(a){return d[z.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,c).then(function(b){return x(b,a,c)})}for(var c=this,d=this.extensions,e=this.primitiveCache,f=[],g=0,h=a.length;g<h;g++){var i=a[g],j=t(i),k=e[j];if(k)f.push(k.promise);else{var l;l=i.extensions&&i.extensions[z.KHR_DRACO_MESH_COMPRESSION]?b(i):x(new THREE.BufferGeometry,i,c),e[j]={primitive:i,promise:l},f.push(l)}}return Promise.all(f)},v.prototype.loadMesh=function(a){for(var b=this,c=this.json,d=c.meshes[a],e=d.primitives,f=[],g=0,h=e.length;g<h;g++){var i=void 0===e[g].material?o(this.cache):this.getDependency("material",e[g].material);f.push(i)}return f.push(b.loadGeometries(e)),Promise.all(f).then(function(c){for(var f=c.slice(0,c.length-1),g=c[c.length-1],h=[],i=0,j=g.length;i<j;i++){var k,l=g[i],m=e[i],n=f[i];if(m.mode===D.TRIANGLES||m.mode===D.TRIANGLE_STRIP||m.mode===D.TRIANGLE_FAN||void 0===m.mode)k=!0===d.isSkinnedMesh?new THREE.SkinnedMesh(l,n):new THREE.Mesh(l,n),!0!==k.isSkinnedMesh||k.geometry.attributes.skinWeight.normalized||k.normalizeSkinWeights(),m.mode===D.TRIANGLE_STRIP?k.geometry=y(k.geometry,THREE.TriangleStripDrawMode):m.mode===D.TRIANGLE_FAN&&(k.geometry=y(k.geometry,THREE.TriangleFanDrawMode));else if(m.mode===D.LINES)k=new THREE.LineSegments(l,n);else if(m.mode===D.LINE_STRIP)k=new THREE.Line(l,n);else if(m.mode===D.LINE_LOOP)k=new THREE.LineLoop(l,n);else{if(m.mode!==D.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);k=new THREE.Points(l,n)}Object.keys(k.geometry.morphAttributes).length>0&&s(k,d),k.name=d.name||"mesh_"+a,g.length>1&&(k.name+="_"+i),q(k,d),b.assignFinalMaterial(k),h.push(k)}if(1===h.length)return h[0];for(var o=new THREE.Group,i=0,j=h.length;i<j;i++)o.add(h[i]);return o})},v.prototype.loadCamera=function(a){var b,c=this.json.cameras[a],d=c[c.type];return d?("perspective"===c.type?b=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(d.yfov),d.aspectRatio||1,d.znear||1,d.zfar||2e6):"orthographic"===c.type&&(b=new THREE.OrthographicCamera(-d.xmag,d.xmag,d.ymag,-d.ymag,d.znear,d.zfar)),c.name&&(b.name=c.name),q(b,c),Promise.resolve(b)):void console.warn("THREE.GLTFLoader: Missing camera parameters.")},v.prototype.loadSkin=function(a){var b=this.json.skins[a],c={joints:b.joints};return void 0===b.inverseBindMatrices?Promise.resolve(c):this.getDependency("accessor",b.inverseBindMatrices).then(function(a){return c.inverseBindMatrices=a,c})},v.prototype.loadAnimation=function(a){for(var b=this.json,c=b.animations[a],d=[],e=[],f=[],g=[],h=[],i=0,j=c.channels.length;i<j;i++){var k=c.channels[i],l=c.samplers[k.sampler],n=k.target,o=void 0!==n.node?n.node:n.id,p=void 0!==c.parameters?c.parameters[l.input]:l.input,q=void 0!==c.parameters?c.parameters[l.output]:l.output;d.push(this.getDependency("node",o)),e.push(this.getDependency("accessor",p)),f.push(this.getDependency("accessor",q)),g.push(l),h.push(n)}return Promise.all([Promise.all(d),Promise.all(e),Promise.all(f),Promise.all(g),Promise.all(h)]).then(function(b){for(var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=[],j=0,k=d.length;j<k;j++){var l=d[j],n=e[j],o=f[j],p=g[j],q=h[j];if(void 0!==l){l.updateMatrix(),l.matrixAutoUpdate=!0;var r;switch(J[q.path]){case J.weights:r=THREE.NumberKeyframeTrack;break;case J.rotation:r=THREE.QuaternionKeyframeTrack;break;case J.position:case J.scale:default:r=THREE.VectorKeyframeTrack}var s=l.name?l.name:l.uuid,t=void 0!==p.interpolation?K[p.interpolation]:THREE.InterpolateLinear,u=[];J[q.path]===J.weights?l.traverse(function(a){!0===a.isMesh&&a.morphTargetInfluences&&u.push(a.name?a.name:a.uuid)}):u.push(s);var v=o.array;if(o.normalized){var w;if(v.constructor===Int8Array)w=1/127;else if(v.constructor===Uint8Array)w=1/255;else if(v.constructor==Int16Array)w=1/32767;else{if(v.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var x=new Float32Array(v.length),y=0,z=v.length;y<z;y++)x[y]=v[y]*w;v=x}for(var y=0,z=u.length;y<z;y++){var A=new r(u[y]+"."+J[q.path],n.array,v,t);"CUBICSPLINE"===p.interpolation&&(A.createInterpolant=function(a){return new m(this.times,this.values,this.getValueSize()/3,a)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),i.push(A)}}}var B=c.name?c.name:"animation_"+a;return new THREE.AnimationClip(B,void 0,i)})},v.prototype.loadNode=function(a){var b=this.json,c=this.extensions,d=this,e=b.meshReferences,f=b.meshUses,g=b.nodes[a];return function(){var a=[];return void 0!==g.mesh&&a.push(d.getDependency("mesh",g.mesh).then(function(a){var b;if(e[g.mesh]>1){var c=f[g.mesh]++;b=a.clone(),b.name+="_instance_"+c}else b=a;return void 0!==g.weights&&b.traverse(function(a){if(a.isMesh)for(var b=0,c=g.weights.length;b<c;b++)a.morphTargetInfluences[b]=g.weights[b]}),b})),void 0!==g.camera&&a.push(d.getDependency("camera",g.camera)),g.extensions&&g.extensions[z.KHR_LIGHTS_PUNCTUAL]&&void 0!==g.extensions[z.KHR_LIGHTS_PUNCTUAL].light&&a.push(d.getDependency("light",g.extensions[z.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(a)}().then(function(b){var e;if((e=!0===g.isBone?new THREE.Bone:b.length>1?new THREE.Group:1===b.length?b[0]:new THREE.Object3D)!==b[0])for(var f=0,h=b.length;f<h;f++)e.add(b[f]);if(g.name&&(e.userData.name=g.name,e.name=THREE.PropertyBinding.sanitizeNodeName(g.name)),q(e,g),g.extensions&&p(c,e,g),void 0!==g.matrix){var i=new THREE.Matrix4;i.fromArray(g.matrix),e.applyMatrix4(i)}else void 0!==g.translation&&e.position.fromArray(g.translation),void 0!==g.rotation&&e.quaternion.fromArray(g.rotation),void 0!==g.scale&&e.scale.fromArray(g.scale);return d.associations.set(e,{type:"nodes",index:a}),e})},v.prototype.loadScene=function(){function a(b,c,d,e){var f=d.nodes[b];return e.getDependency("node",b).then(function(a){if(void 0===f.skin)return a;var b;return e.getDependency("skin",f.skin).then(function(a){b=a;for(var c=[],d=0,f=b.joints.length;d<f;d++)c.push(e.getDependency("node",b.joints[d]));return Promise.all(c)}).then(function(c){return a.traverse(function(a){if(a.isMesh){for(var d=[],e=[],f=0,g=c.length;f<g;f++){var h=c[f];if(h){d.push(h);var i=new THREE.Matrix4;void 0!==b.inverseBindMatrices&&i.fromArray(b.inverseBindMatrices.array,16*f),e.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',b.joints[f])}a.bind(new THREE.Skeleton(d,e),a.matrixWorld)}}),a})}).then(function(b){c.add(b);var g=[];if(f.children)for(var h=f.children,i=0,j=h.length;i<j;i++){var k=h[i];g.push(a(k,b,d,e))}return Promise.all(g)})}return function(b){var c=this.json,d=this.extensions,e=this.json.scenes[b],f=this,g=new THREE.Group;e.name&&(g.name=e.name),q(g,e),e.extensions&&p(d,g,e);for(var h=e.nodes||[],i=[],j=0,k=h.length;j<k;j++)i.push(a(h[j],g,c,f));return Promise.all(i).then(function(){return g})}}(),a}(),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Stats=b()}(this,function(){var a=function(){function b(a){return e.appendChild(a.dom),a}function c(a){for(var b=0;b<e.children.length;b++)e.children[b].style.display=b===a?"block":"none";d=a}var d=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(a){a.preventDefault(),c(++d%e.children.length)},!1);var f=(performance||Date).now(),g=f,h=0,i=b(new a.Panel("FPS","#0ff","#002")),j=b(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var k=b(new a.Panel("MB","#f08","#201"));return c(0),{REVISION:16,dom:e,addPanel:b,showPanel:c,begin:function(){f=(performance||Date).now()},end:function(){h++;var a=(performance||Date).now();if(j.update(a-f,200),a>=g+1e3&&(i.update(1e3*h/(a-g),100),g=a,h=0,k)){var b=performance.memory;k.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return a},update:function(){f=this.end()},domElement:e,setMode:c}};return a.Panel=function(a,b,c){var d=1/0,e=0,f=Math.round,g=f(window.devicePixelRatio||1),h=80*g,i=48*g,j=3*g,k=2*g,l=3*g,m=15*g,n=74*g,o=30*g,p=document.createElement("canvas");p.width=h,p.height=i,p.style.cssText="width:80px;height:48px";var q=p.getContext("2d");return q.font="bold "+9*g+"px Helvetica,Arial,sans-serif",q.textBaseline="top",q.fillStyle=c,q.fillRect(0,0,h,i),q.fillStyle=b,q.fillText(a,j,k),q.fillRect(l,m,n,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l,m,n,o),{dom:p,update:function(i,r){d=Math.min(d,i),e=Math.max(e,i),q.fillStyle=c,q.globalAlpha=1,q.fillRect(0,0,h,m),q.fillStyle=b,q.fillText(f(i)+" "+a+" ("+f(d)+"-"+f(e)+")",j,k),q.drawImage(p,l+g,m,n-g,o,l,m,n-g,o),q.fillRect(l+n-g,m,g,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l+n-g,m,g,f((1-i/r)*o))}}},a});
//# sourceMappingURL=map.min.js.map